(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{126:function(e,t,n){},151:function(e){e.exports={name:"cba",version:"10.0.0",private:!0,dependencies:{ajv:"^6.12.6","ajv-cli":"^3.2.1",axios:"^0.18.1","babel-polyfill":"^6.26.0","draft-js":"^0.10.5","draft-js-plugins-editor":"^2.1.1",enzyme:"^3.11.0","enzyme-adapter-react-16":"^1.15.7",fbemitter:"^2.1.1",glob:"^10.3.10","glob-fs":"^0.1.7","hot-formula-parser":"^3.0.2",ifvisible:"^1.1.0","jest-enzyme":"^6.1.2","lodash.debounce":"^4.0.8","lodash.throttle":"^4.1.1",moment:"^2.29.4","prop-types":"^15.8.1","pure-react-carousel":"^1.30.1",react:"^16.14.0","react-contextmenu":"^2.14.0","react-data-grid":"^4.0.9","react-data-grid-addons":"^4.0.9","react-dialog":"^1.0.2","react-dnd":"^10.0.2","react-dnd-html5-backend":"^10.0.2","react-dnd-test-backend":"^10.0.2","react-dnd-test-utils":"^10.0.2","react-dnd-touch-backend":"^10.0.2","react-dom":"^16.14.0","react-hotkeys":"^1.1.4","react-media-recorder":"1.6.3","react-notify-toast":"^0.5.1","react-numeric-input":"^2.2.3","react-rangeslider":"^2.2.0","react-scripts":"^2.0.3","react-select":"^3.2.0","react-split-pane":"^0.1.91","react-test-renderer":"^16.14.0","replace-in-file":"^3.4.2",scxml:"^3.1.5",shortid:"^2.2.16"},scripts:{start:"set REACT_APP_CBA_DEPLOYMENT=preview && react-scripts --openssl-legacy-provider start","start-ee4cba":"set REACT_APP_CBA_DEPLOYMENT=rest-api  && react-scripts start",build:"set REACT_APP_CBA_DEPLOYMENT=preview && react-scripts --openssl-legacy-provider build","build-ee4cba":"set REACT_APP_CBA_DEPLOYMENT=rest-api  && react-scripts build",postbuild:"node ./node_scripts/post-build-script.js",test:"react-scripts test --env=jsdom --watchAll=false",coverage:"react-scripts test --env=jsdom --watchAll=false --coverage",eject:"react-scripts eject",extractItems:"node ./node_scripts/itemConfigurationExtractor generate ./test/itemZip ./test/itemJsonManual ./test/itemJsonFixed ./public/items",ee4testerUpdate:"node ./node_scripts/ee4xxxUpdater ./build ../../ee4tester public/react-runtime public/react-runtime/frameContent.html",ee4macoUpdate:"node ./node_scripts/ee4xxxUpdater ./build ../../ee4maco public/react-runtime public/index.html",ee4singleUpdate:"node ./node_scripts/ee4xxxUpdater ./build ../../ee4single . index.html",eslintAll:"eslint --ignore-pattern src/**/*.test.js src/**/*.js",eslintTests:"eslint src/**/*.test.js"},devDependencies:{"eslint-config-airbnb":"^17.1.1","eslint-config-airbnb-base":"^13.2.0","eslint-plugin-import":"^2.27.5","eslint-plugin-jest":"^22.21.0","eslint-plugin-jsx-a11y":"^6.7.1","eslint-plugin-react":"^7.32.2",handlebars:"^4.7.7",jszip:"^3.10.1","jszip-sync":"^3.1.3-x"},homepage:".",browserslist:[">0.2%","not dead","not ie <= 11","not op_mini all"]}},279:function(e,t,n){},332:function(e,t,n){e.exports=n(784)},362:function(e,t){},368:function(e,t,n){},380:function(e,t,n){},381:function(e,t,n){},382:function(e,t,n){},552:function(e,t,n){},553:function(e,t,n){},554:function(e,t,n){},560:function(e,t,n){},561:function(e,t,n){},571:function(e,t,n){},575:function(e,t,n){},576:function(e,t,n){},578:function(e,t,n){},579:function(e,t,n){},783:function(e,t){var n=this;!function(){if("function"===typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}(),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,n.indexOf(e,t)===t})},784:function(e,t,n){"use strict";n.r(t);var a=n(3),r=n(4),i=n(38),o=n(85),s=n.n(o),c=n(113),l=n.n(c),u=n(151),d=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"withDefault",value:function(e,t){return void 0===e?t:e}},{key:"getPropUndefinedSafe",value:function(e,t,n){return void 0===e?n:e[t]}},{key:"isEmptyObject",value:function(e){return!!e&&e.constructor===Object&&0===Object.keys(e).length}},{key:"isNonEmptyArray",value:function(t){return void 0!==t&&null!==t&&0!==t.length&&e.arrayContainsNonEmptyEntry(t)}},{key:"arrayContainsNonEmptyEntry",value:function(e){return e.some(function(e){return void 0!==e&&null!==e&&""!==e.toString()})}},{key:"arrayContainsEmptyEntry",value:function(e){return e.some(function(e){return void 0===e||null===e||""===e.toString()})}},{key:"getCbaVersionNumber",value:function(){return"".concat(u.version)}},{key:"getCbaVersion",value:function(){return"".concat(u.name," ").concat(u.version)}},{key:"printCbaVersion",value:function(){console.info("Running ".concat(e.getCbaVersion()))}},{key:"isMobileModeSetAsParameter",value:function(){var t=e.getQueryParam("forceMobileMode");return"true"==="".concat(t)}},{key:"isTouchDevice",value:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0}},{key:"getSettingsValueByNameSafe",value:function(e,t){return e&&void 0!==e[t]?e[t]:""}},{key:"getControllerMode",value:function(){var e="external-controller",t=window.cba_runtime_config;if(void 0===t||null===t)return e;var n=t.mode;if(void 0===n||null===n)return e;if("string"!==typeof n)return console.warn("Invalid controller mode ignored, switching to external-controller mode.",n),e;switch(n.trim()){case"preview":return"preview";case"rest-api":return"rest-api";case"external-controller":return"external-controller";default:return e}}},{key:"getEventReceiverConfiguration",value:function(){return e.getEventReceiverConfigurationInternal(window.cba_runtime_config,window.location.href)}},{key:"getEventReceiverConfigurationInternal",value:function(t,n){return{eventTargetWindow:e.getParameterValueFromUrlOrConfigStructure(t,n,"eventTargetWindow",void 0),eventDomainUri:e.getParameterValueFromUrlOrConfigStructure(t,n,"eventDomainUri",void 0),startTaskPlayerEvent:e.getParameterValueFromUrlOrConfigStructure(t,n,"startTaskPlayerEvent",void 0)}}},{key:"getWaitingMessageTexts",value:function(){return e.getWaitingMessageTextsInternal(window.cba_runtime_config,window.location.href)}},{key:"getWaitingMessageTextsInternal",value:function(t,n){return{primary:e.getParameterValueFromUrlOrConfigStructure(t,n,"initialWaitingMessagePrimary","We are waiting to receive the test configuration..."),secondary:e.getParameterValueFromUrlOrConfigStructure(t,n,"initialWaitingMessageSecondary","If this waiting takes more than a few seconds inform your test administrator.")}}},{key:"getParameterValueFromUrlOrConfigStructure",value:function(e,t,n,a){if(void 0!==e&&null!==e&&void 0!==e[n])return e[n];var r=l.a.parse(t,!0).query;return void 0!==r&&null!==r&&void 0!==r[n]?r[n]:a}},{key:"getCallingUrlWithoutPath",value:function(){return this.getUrlWithoutPathFromLocation(window.location)}},{key:"getUrlWithoutPathFromLocation",value:function(e){switch(e.protocol){case"http:":case"https:":var t=e.port?":".concat(e.port):"";return"".concat(e.protocol,"//").concat(e.hostname).concat(t);case"file:":case"atom:":return e.protocol;default:return void console.error("Unknown protocol",e.protocol)}}},{key:"getQueryParam",value:function(t){return e.getQueryParams()[t]}},{key:"getQueryParams",value:function(){return e.getQueryParamsFromUrlString(window.location.href)}},{key:"getQueryParamsFromUrlString",value:function(e){return l.a.parse(e,!0).query}},{key:"openFullScreen",value:function(e){document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled?e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen():console.warn("Current browser does not allow for fullscreen")}},{key:"closeFullScreen",value:function(){document.fullscreenElement&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen())}},{key:"mapResourcePath",value:function(t,n,a){return t.map(function(t){var r=e.safeDeepCopy(t);return r.path="".concat(n,"/").concat(r.name),r.isExternal=a,r})}},{key:"checkType",value:function(e,t){var n=typeof e;return"integer"===t&&"number"===n?Number.isInteger(e):t===n}},{key:"doScrollOnHTMLElement",value:function(t,n,a,r,i){var o=a.scrollHeight,s=a.scrollWidth,c=o-(i?i.clientHeight:r.clientHeight),l=s-(i?i.clientWidth:r.clientWidth),u=e.calculateFinalScrollValue(t,n,c,l),d=u.finalX,g=u.finalY;e.doScroll(g,d,r)}},{key:"doScroll",value:function(e,t,n){n&&n.scroll({top:e,left:t,behavior:"smooth"})}},{key:"calculateFinalScrollValue",value:function(t,n,a,r){var i=t?parseInt(t,10):void 0,o=n?parseInt(n,10):void 0;return t&&t.includes("%")&&(i=e.computePercentage(r,parseFloat(t))),n&&n.includes("%")&&(o=e.computePercentage(a,parseFloat(n))),{finalX:i,finalY:o}}},{key:"computePercentage",value:function(e,t){return e*(t/100)}}]),e}();d.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},d.safeDeepCopy=function(e){if(void 0!==e)return d.deepCopy(e)},d.safeDeepCopyObjects=function(e,t){return null==e||"object"!==typeof e?e:e.constructor!==Object&&e.constructor!==Array?e:e.constructor===Date||e.constructor===RegExp||e.constructor===Function||e.constructor===String||e.constructor===Number||e.constructor===Boolean?new e.constructor(e):(t=t||new e.constructor,Object.keys(e).forEach(function(n){t[n]="undefined"===typeof t[n]?d.safeDeepCopyObjects(e[n],null):t[n]}),t)},d.isMobile=function(){var e,t=d.isMobileModeSetAsParameter();return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},d.keyCodes={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Escape:27};var g=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"runWithSimplifiedPreviewServer",value:function(){switch(d.getControllerMode()){case"preview":return!0;case"rest-api":default:return!1}}},{key:"getJsonsData",value:function(t){return console.log("Getting configuration data in ".concat(e.runWithSimplifiedPreviewServer()?"preview":"rest-api"," mode.")),e.doGetCourseConfigurationStep(e.getFirstCourse(),t).then(function(t){return e.doGetTestConfigurationsStep(t)}).then(function(t){return e.doGetItemConfigurationsStep(t)}).then(function(t){return e.doBuildConfigurationStep(t)})}},{key:"cacheAssets",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];console.log(e)}},{key:"preloadResources",value:function(e,t){var n=e.map(function(e){return new Promise(function(n,a){var r=document.createElement("link");r.as=t,r.href=e.path,r.rel="preload","video"!==t&&"audio"!==t||(r.type="media",r.rel="prefetch"),e.size>5*Math.pow(10,6)&&("video"===t||"audio"===t)&&(r.as="fetch"),r.onload=function(){e.hadErrors=!1,n(e)},r.onerror=function(){console.error("Error while loading resource: ",e),e.hadErrors=!0,n(e)},document.head.append(r)})});return Promise.all(n)}},{key:"getServerPath",value:function(){return e.runWithSimplifiedPreviewServer()?e.getCallingUrlWithoutParams():"".concat(d.getCallingUrlWithoutPath(),"/").concat(e.restApiTargets.CONFIGURATION_API,"/")}},{key:"getCallingUrlWithoutParams",value:function(){var e=window.location.href.split("?")[0];return"".concat(e.substring(0,e.lastIndexOf("/")),"/")}},{key:"getFirstCourse",value:function(){return e.runWithSimplifiedPreviewServer()?"previewcourses":""}},{key:"doGetCourseConfigurationStep",value:function(t,n){return e.getCourse(t,n)}},{key:"doGetTestConfigurationsStep",value:function(t){var n=t.settings,a=t.headerButtons,r=t.sessionId,i=t.courses,o=e.buildArrayWithoutDuplicates(i),s=o.map(function(t){return e.getTest(t)});return e.axiosAllWrapper({settings:n,headerButtons:a,sessionId:r,courses:i,testsToRetrieve:o},s)}},{key:"isEmptyRetrievedValue",value:function(e){return void 0===e||null===e||""===e.toString()}},{key:"doGetItemConfigurationsStep",value:function(t){var n=this,a=t.contextData,r=a.settings,i=a.headerButtons,o=a.sessionId,s=a.courses,c=a.testsToRetrieve,l=t.response,u=[];0===l.length&&u.push("no tests to execute found in course configuration"),l.forEach(function(e,t){n.isEmptyRetrievedValue(e)&&u.push("could not retrieve test ".concat(c[t]))});var d=l.filter(function(e){return!n.isEmptyRetrievedValue(e)}).reduce(function(e,t){return e.concat(t.items)},[]),g=e.buildArrayWithoutDuplicates(d),f=g.map(function(t){return e.getItem(t)});return e.axiosAllWrapper({settings:r,headerButtons:i,sessionId:o,courses:s,tests:l,itemsToRetrieve:g,flaggedErrors:u},f)}},{key:"doBuildConfigurationStep",value:function(t){var n=this,a=t.contextData,r=a.settings,i=a.headerButtons,o=a.sessionId,s=a.courses,c=a.tests,l=a.itemsToRetrieve,u=a.flaggedErrors,d=t.response;return 0===d.length&&u.push("no required items found in test specifications"),d.forEach(function(e,t){n.isEmptyRetrievedValue(e)&&u.push("could not retrieve item ".concat(l[t]))}),e.validateJsonResults(u,s,c,d.filter(function(e){return!n.isEmptyRetrievedValue(e)}))?{success:!0,payload:{settings:r,headerButtons:i,sessionId:o,courses:s,tests:c,items:d}}:{success:!1}}},{key:"axiosAllWrapper",value:function(e,t){return s.a.all(t).then(function(t){return{contextData:e,response:t}}).catch(function(e){console.info(e)})}},{key:"buildArrayWithoutDuplicates",value:function(e){return Object(i.a)(new Set(e))}},{key:"validateJsonResults",value:function(e,t,n,a){return 0!==e.length&&(console.info("Errors during data retrieval:",e),console.info("loaded course:",t),console.info("loaded tests:",n),console.info("loaded items:",a)),0===e.length&&(void 0!==t||t.length>0)&&(void 0!==n||n.length>0)&&(void 0!==a||a.length>0)}},{key:"getCourse",value:function(t,n){return e.getDataFromServer("courses",t,n)}},{key:"getTest",value:function(t){return e.getDataFromServer("tests",t,void 0)}},{key:"getItem",value:function(t){return e.getDataFromServer("items",t,void 0)}},{key:"getDataFromServer",value:function(t,n,a){var r="/".concat(t,"/").concat(n).concat(e.runWithSimplifiedPreviewServer()?".json":""),i=e.runWithSimplifiedPreviewServer()?{}:{params:e.addAsParam(d.getQueryParams(),a)};return e.instance.get(r,i).then(function(e){return e.data}).catch(function(e){return console.info(e),[]})}},{key:"addAsParam",value:function(e,t){return void 0!==t&&(e.userId=t),e}}]),e}();g.restApiTargets={CONFIGURATION_API:"ee4cba-api",ASSETS_API:"ee4cba_assets",TRACE_ENDPOINT:"trace",RECORDING_ENDPOINT:"recording"},g.instance=s.a.create({baseURL:g.getServerPath(),timeout:3e4,headers:{"Content-Type":"application/json"}});var f=function(){function e(t,n){var r=this;Object(a.a)(this,e),this.findFirstMatchingTaskInTest=function(t,n,a){var i=e.getTestForName(r.tests,t);if(void 0!==i){var o=i.taskCourse.find(function(e,t,a){return e.task===n});if(void 0!==o)return{testName:t,itemName:o.item,taskName:o.task};a&&console.error("Task ".concat(n," is not defined in test ").concat(t))}else a&&console.error("Test ".concat(t," is not defined in the test course"))},this.getNextTaskInfo=function(){return r.nextTaskAvailable()?r.taskList[r.getCurrentTaskIndex()+1]:void 0},this.getPreviousTaskInfo=function(){return r.previousTaskAvailable()?r.taskList[r.getCurrentTaskIndex()-1]:void 0},this.nextTaskAvailable=function(){return r.taskList.length>r.getCurrentTaskIndex()+1},this.previousTaskAvailable=function(){return r.getCurrentTaskIndex()>0},this.switchCurrentTask=function(e,t,n){r.activeTestName=e,r.activeItemName=t,r.activeTaskName=n},this.getCurrentTaskInfo=function(){return{testName:r.activeTestName,itemName:r.activeItemName,taskName:r.activeTaskName}},this.getConfigurationInfo=function(){return{course:r.course,tests:r.tests}},this.getCurrentTaskIndex=function(){var t=e.getIndexForTask(r.taskList,r.activeTestName,r.activeItemName,r.activeTaskName);if(!(t<0))return t;console.error("Cannot find task in task list")},this.course=t,this.tests=n,this.taskList=e.buildTaskList(t,n);var i=this.taskList[0];if(void 0===i)console.error("No task found in standard task sequencer."),this.activeTestName=void 0,this.activeItemName=void 0,this.activeTaskName=void 0;else{var o=i.testName,s=i.itemName,c=i.taskName;this.activeTestName=o,this.activeItemName=s,this.activeTaskName=c}}return Object(r.a)(e,null,[{key:"getIndexForTask",value:function(e,t,n,a){return e.findIndex(function(e,r,i){return e.testName===t&&e.itemName===n&&e.taskName===a})}},{key:"getTestForName",value:function(e,t){var n=e.find(function(e,n,a){return e.name===t});return void 0===n&&console.error("Could not find test ".concat(t)),n}},{key:"buildTaskList",value:function(t,n){var a=[];return t.forEach(function(t){e.getTestForName(n,t).taskCourse.forEach(function(e){a.push({testName:t,itemName:e.item,taskName:e.task})})}),a}}]),e}(),p=function(){function e(){var t=this;Object(a.a)(this,e),this.runController=function(e){(t.taskPlayer=e,e.runPlayer(),g.runWithSimplifiedPreviewServer()||(e.setHttpTraceTransmission("".concat(d.getCallingUrlWithoutPath(),"/").concat(g.restApiTargets.CONFIGURATION_API,"/").concat(g.restApiTargets.TRACE_ENDPOINT),2e4,1e4),e.setHttpRecordingTransmission("".concat(d.getCallingUrlWithoutPath(),"/").concat(g.restApiTargets.CONFIGURATION_API,"/").concat(g.restApiTargets.RECORDING_ENDPOINT))),g.runWithSimplifiedPreviewServer())?"true"===d.getQueryParam("showLogin")?t.showLogin():t.obtainConfigurationAndRunFirstTask("PreviewUser"):t.showLogin()},this.showLogin=function(){t.taskPlayer.showLogin("Login","Username: ","Ok",t.loginDialogClosedCallback)},this.loginDialogClosedCallback=function(e){t.obtainConfigurationAndRunFirstTask(e)},this.obtainConfigurationAndRunFirstTask=function(e){g.getJsonsData(e).then(function(n){t.processConfigurationAndRunFirstTask(e,n)}).catch(function(e){console.error("Failure during task start in task player.",e)})},this.processConfigurationAndRunFirstTask=function(e,n){t.userId=e,n.success?(t.digestConfigurationResponse(n.payload),t.startFirstTaskInTaskPlayer()):console.error("Server failed to send test configuration for user ".concat(e))},this.startFirstTaskInTaskPlayer=function(){t.sendItemConfigurationToTaskPlayer(),t.taskPlayer.setTraceContextId(t.sessionId),t.taskPlayer.setRecordingContextId(t.sessionId),t.taskPlayer.setUserId(t.userId),t.taskPlayer.setTaskSequencer(t.taskSwitchCallback,t.taskAvailableCallback),t.taskPlayer.setHeaderButtons(t.headerButtons);var e=t.taskSequencer.getConfigurationInfo(),n=e.course,a=e.tests;!0===t.settings.ShowTaskNavigationBars?t.taskPlayer.setMenuCarousels(n,a.map(function(e){return{name:e.name,tasks:e.taskCourse}})):t.taskPlayer.setMenuCarousels([],[]),t.taskPlayer.activateDebuggingWindows(t.settings.scoreDebugging.hotKey,t.settings.traceDebugging.hotKey,t.settings.statemachineDebugging.hotKey);var r=t.taskSequencer.getCurrentTaskInfo();void 0===r.taskName?console.error("No task found."):(t.taskSequencer.switchCurrentTask(r.testName,r.itemName,r.taskName),t.taskPlayer.startTask(r.testName,r.itemName,r.taskName))},this.digestConfigurationResponse=function(e){t.taskSequencer=new f(e.courses,e.tests),t.items=e.items,t.settings=e.settings,t.headerButtons=e.headerButtons,t.sessionId=e.sessionId,console.log("courses:",t.taskSequencer.getConfigurationInfo().course),console.log("tests",t.taskSequencer.getConfigurationInfo().tests),console.log("items",t.items),console.log("settings",t.settings),console.log("headerButtons",t.headerButtons),console.log("sessionId",t.sessionId)},this.sendItemConfigurationToTaskPlayer=function(){var e={MathJax:"./MathJax-local-server/mathjax@3.1.2-tex-mml-chtml.js"};t.items.forEach(function(n){var a=g.runWithSimplifiedPreviewServer()?"./":"".concat(d.getCallingUrlWithoutPath(),"/").concat(g.restApiTargets.ASSETS_API,"/").concat(n.name,"/"),r={};n.dependencies&&n.dependencies.length>0&&n.dependencies.forEach(function(t){r[t.name]=e[t.name]}),t.taskPlayer.addItem(n,"".concat(a,"resources"),"".concat(a,"external-resources"),r)})},this.stopOldTaskAndStartNewTask=function(e,n,a){t.taskSequencer.switchCurrentTask(e,n,a),t.taskPlayer.stopTask(),t.taskPlayer.startTask(e,n,a)},this.stopOldTaskLogoutAndShowLogin=function(){t.taskPlayer.stopTask(),t.taskPlayer.logout(),t.taskPlayer.clearItems(),g.runWithSimplifiedPreviewServer()&&alert("Session finished."),t.showLogin()},this.taskSwitchCallback=function(e,n,a,r){switch(e){case"nextTask":t.switchTaskNext();break;case"previousTask":t.switchTaskPrevious();break;case"cancelTask":t.stopOldTaskLogoutAndShowLogin();break;case"goToTask":void 0===a?t.switchFirstMatchingTaskInterTest(n,r):t.stopOldTaskAndStartNewTask(n,a,r);break;default:console.error("Unknown switch task callback type: ".concat(e))}},this.taskAvailableCallback=function(e,n,a,r){switch(e){case"nextTask":return t.taskSequencer.nextTaskAvailable();case"previousTask":return t.taskSequencer.previousTaskAvailable();case"goToTask":return void 0!==a||void 0!==t.taskSequencer.findFirstMatchingTaskInTest(n,r,!1);default:return console.error("Unknown switch task callback type: ".concat(e)),!1}},this.switchFirstMatchingTaskInterTest=function(e,n){var a=t.taskSequencer.findFirstMatchingTaskInTest(e,n,!0);void 0!==a?t.stopOldTaskAndStartNewTask(a.testName,a.itemName,a.taskName):t.missingTaskErrorFeedback("Task ".concat(n," in test ").concat(e," is unknown. We are in ").concat(t.buildCurrentTaskLogString()),e)},this.switchTaskNext=function(){var e=t.taskSequencer.getNextTaskInfo();void 0!==e?t.stopOldTaskAndStartNewTask(e.testName,e.itemName,e.taskName,!1):t.missingTaskErrorFeedback("There is no next task. We are in ".concat(t.buildCurrentTaskLogString()),void 0)},this.switchTaskPrevious=function(){var e=t.taskSequencer.getPreviousTaskInfo();void 0!==e?t.stopOldTaskAndStartNewTask(e.testName,e.itemName,e.taskName):t.missingTaskErrorFeedback("There is no previous task. We are in ".concat(t.buildCurrentTaskLogString()),void 0)},this.missingTaskErrorFeedback=function(e,n){if(g.runWithSimplifiedPreviewServer()){var a=void 0!==n&&t.taskSequencer.getCurrentTaskInfo().testName!==n;alert("The preview failed to do a task switch for this reason: ".concat(e," ").concat(a?". Task switches with explicit test names are not supported by the preview.":". If the missing task exists in your item consider running a project preview."))}console.warn(e)},this.buildCurrentTaskLogString=function(){return e.buildLogString(t.taskSequencer.getCurrentTaskInfo())},this.taskPlayer=void 0,this.taskSequencer=void 0,this.items=[],this.settings=[],this.headerButtons=[],this.sessionId=void 0,this.userId=void 0,this.activeTestName=void 0,this.activeItemName=void 0,this.activeTaskName=void 0}return Object(r.a)(e,null,[{key:"buildLogString",value:function(e){return g.runWithSimplifiedPreviewServer()?"task ".concat(e.taskName):"task ".concat(e.taskName," from item ").concat(e.itemName," in test ").concat(e.testName)}}]),e}(),h=n(0),v=n.n(h),m=n(26),y=n.n(m),b=(n(368),n(316)),k=n(32),S=n.n(k),C=n(215),T=n(330),P=n(787),E=n(7),x=n(6),I=n(8),O=n(1),M=n(86),w=n.n(M),R=n(142),D=n.n(R),N=n(12),A=n(331),F=n(317),j=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"buildPathRoot",value:function(e,t,n){return"/test=".concat(e,"/item=").concat(t,"/task=").concat(n)}},{key:"buildPageSegment",value:function(e){return"/page=".concat(e)}},{key:"getPageNameFromPageSegment",value:function(e){if(e.startsWith("/page=")){var t=e.substring(6),n=t.indexOf("/");return-1===n?t:t.substring(0,n)}console.warn("Cannot get page name from invalid page segment: ".concat(e))}},{key:"getPageNameFromPath",value:function(t){var n=t.indexOf("/page=");if(-1!==n)return e.getPageNameFromPageSegment(t.slice(n));console.warn("Cannot get page segment from invalid path: ".concat(t))}},{key:"appendPageSegmentToPathRoot",value:function(e,t,n,a){return"".concat(e,"/pageAreaType=").concat(t,"/pageAreaName=").concat(n).concat(a)}},{key:"appendPageSegmentsToPath",value:function(e,t){return e+t}},{key:"dropPageSegmentFromPath",value:function(e){var t=e.lastIndexOf("/page=");return-1===t?void 0:e.substring(0,t)}},{key:"dropAllPageSegments",value:function(e){var t=e.indexOf("/page=");return-1===t?e:e.substring(0,t)}},{key:"getLastPageSegmentFromPath",value:function(e){var t=e.lastIndexOf("/page=");return-1===t?void 0:e.substring(t)}},{key:"getPageSegmentArray",value:function(t){for(var n=[],a=t,r=e.getLastPageSegmentFromPath(t);void 0!==r;)n.splice(0,0,r),a=e.dropPageSegmentFromPath(a),r=e.getLastPageSegmentFromPath(a);return n}},{key:"getReversedPageSegmentArray",value:function(t){for(var n=[],a=t,r=e.getLastPageSegmentFromPath(t);void 0!==r;)n.push(r),a=e.dropPageSegmentFromPath(a),r=e.getLastPageSegmentFromPath(a);return n}},{key:"appendIndexToPageSegment",value:function(e,t){return"".concat(e,"/index=").concat(t)}},{key:"dropIndexFromPageSegment",value:function(e){var t=e.lastIndexOf("/index=");return-1===t?void 0:e.substring(0,t)}},{key:"getLastIndexFromPageSegment",value:function(e){var t=e.lastIndexOf("/index=");return-1===t?void 0:e.substring(t+7)}},{key:"trimTestFromPath",value:function(e){var t=e.indexOf("/item=");return-1===t?void 0:e.substring(t)}},{key:"trimRootAndPageAreaFromPath",value:function(e){var t=e.indexOf("/page=");return-1===t?void 0:e.substring(t)}},{key:"getRootFromPath",value:function(e){var t=e.indexOf("/pageAreaType=");return-1===t?e:e.substring(0,t)}},{key:"extractTreeChildPathFromTreePath",value:function(e,t){return-1===t.indexOf(e)?null:t.substr(e.length)}},{key:"getPageAreaTypeFromPath",value:function(e){var t=e.indexOf("/pageAreaType="),n=e.indexOf("/pageAreaName=");return-1===t||-1===n?void 0:e.substring(t+14,n)}},{key:"getPageAreaNameFromPath",value:function(e){var t=e.indexOf("/pageAreaName=");if(-1!==t){var n=e.indexOf("/page=");return-1===n?e.substring(t+14):e.substring(t+14,n)}}},{key:"findPageAreaAncestorPath",value:function(t){var n=e.dropPageSegmentFromPath(t);if(void 0!==e.getLastPageSegmentFromPath(n))return n}},{key:"getPagePath",value:function(t){var n=e.dropAllPageSegments(t),a=e.getPageNameFromPath(t);return e.appendPageSegmentsToPath(n,e.buildPageSegment(a))}},{key:"getValidCssIdFromPath",value:function(e){return e.replace(/[&/\\#, +()$~%.'":*?<>{}=]/g,"")}}]),e}(),L=n(19),V=n(2),U=n.n(V),B=function e(t){var n=this;Object(a.a)(this,e),this.toString=function(){return"".concat(n.name,": ").concat(n.message)},this.name="PropertyMissingException",this.message=t},H=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"asOptional",value:function(e){return function(t,n,a){if(void 0!==t[n])return U.a.checkPropTypes(e,t[n],n,a)}}},{key:"raiseError",value:function(e){var t=new B(e);console.error(t.toString())}},{key:"addPropTypes",value:function(e,t){return Object.keys(t).forEach(function(n){e[n]=t[n]}),e}},{key:"getStandardRuntimePropTypes",value:function(){return{componentStateManager:U.a.object.isRequired,componentDirectory:U.a.object.isRequired,incidentsAccumulator:U.a.object.isRequired,taskResultsManager:U.a.object.isRequired,statemachinesManager:U.a.object.isRequired,presenterStateManager:U.a.object.isRequired,taskNavigatorStateManager:U.a.object.isRequired,traceLogBuffer:U.a.object.isRequired,traceLogUploader:U.a.object.isRequired,recordingBuffer:U.a.object.isRequired,recordingUploader:U.a.object.isRequired,clipboardManager:U.a.object.isRequired,pageConfigurationsManager:U.a.object.isRequired,taskManager:U.a.object.isRequired}}},{key:"positionPropsCheck",value:function(e,t,n){var a={x:U.a.number.isRequired,y:U.a.number.isRequired,width:U.a.number.isRequired,height:U.a.number.isRequired};return U.a.checkPropTypes(a,e[t],t,n)}},{key:"fontPropsCheck",value:function(e,t,n){var a={name:U.a.string.isRequired,size:U.a.number.isRequired,alignmentHorizontal:U.a.oneOf(["left","center","right"]).isRequired,bold:U.a.bool.isRequired,italic:U.a.bool.isRequired,underlined:U.a.bool.isRequired};return U.a.checkPropTypes(a,e[t],t,n)}},{key:"getColorVariantsPropTypes",value:function(){return{default:U.a.string.isRequired,disabled:U.a.oneOfType([U.a.string,U.a.object]),visited:U.a.oneOfType([U.a.string,U.a.object]),selected:U.a.oneOfType([U.a.string,U.a.object])}}},{key:"colorPropsCheck",value:function(t,n,a){var r={text:e.asOptional(e.getColorVariantsPropTypes()),background:e.asOptional(e.getColorVariantsPropTypes())};return U.a.checkPropTypes(r,t[n],n,a)}},{key:"borderPropsCheck",value:function(t,n,a){var r={style:U.a.oneOf(["none","solid","outset","inset"]).isRequired,width:U.a.number,radius:U.a.number,color:e.asOptional(e.getColorVariantsPropTypes())};return U.a.checkPropTypes(r,t[n],n,a)}},{key:"getTransformOriginPropTypes",value:function(){return{x:U.a.number.isRequired,y:U.a.number.isRequired}}},{key:"transformPropsCheck",value:function(t,n,a){var r={rotate:U.a.number,transformOrigin:e.asOptional(e.getTransformOriginPropTypes())};return U.a.checkPropTypes(r,t[n],n,a)}},{key:"statePropsCheck",value:function(e,t,n){var a={disabled:U.a.bool.isRequired,selected:U.a.bool.isRequired,hidden:U.a.bool.isRequired};return U.a.checkPropTypes(a,e[t],t,n)}},{key:"textPropsCheck",value:function(e,t,n){var a={label:U.a.oneOfType([U.a.string,U.a.number]),mouseOver:U.a.string,dynamic:U.a.shape({variable:U.a.string.isRequired,valueMap:U.a.string})};return U.a.checkPropTypes(a,e[t],t,n)}},{key:"imagePropsCheck",value:function(e,t,n){var a={displayMode:U.a.oneOf(["none","left","right","initial","overlay"]).isRequired,overlayType:U.a.oneOf(["stretch","center","default","left"]),default:U.a.string,disabled:U.a.oneOfType([U.a.string,U.a.object]),visited:U.a.oneOfType([U.a.string,U.a.object]),selected:U.a.oneOfType([U.a.string,U.a.object]),dynamic:U.a.shape({variable:U.a.string.isRequired,valueMap:U.a.string})};return U.a.checkPropTypes(a,e[t],t,n)}},{key:"eventPropsCheck",value:function(e,t,n){var a={standard:U.a.string,alternate:U.a.string,onFocusIn:U.a.string,onFocusOut:U.a.string};return U.a.checkPropTypes(a,e[t],t,n)}},{key:"linkPropsCheck",value:function(e,t,n){var a={page:U.a.string,pageUrl:U.a.string,conditional:U.a.object,pageAreaType:U.a.oneOf(["main","dialog","modal"]),pageAreaName:U.a.string,receiver:U.a.string,receiverTab:U.a.object,historyMove:U.a.oneOf(["home","forward","back"])};return U.a.checkPropTypes(a,e[t],t,n)}},{key:"tracePropsCheck",value:function(e,t,n){var a={type:U.a.string.isRequired,addOn:U.a.object,skipTrace:U.a.bool.isRequired};return U.a.checkPropTypes(a,e[t],t,n)}},{key:"cursorPropsCheck",value:function(e,t,n){var a={standard:U.a.string,image:U.a.string};return U.a.checkPropTypes(a,e[t],t,n)}},{key:"getStandardConfigPropTypes",value:function(t){var n={position:e.positionPropsCheck,font:e.fontPropsCheck,color:e.colorPropsCheck,border:e.borderPropsCheck,transform:e.transformPropsCheck,state:e.statePropsCheck,text:e.textPropsCheck,image:e.imagePropsCheck,cursor:e.cursorPropsCheck,event:e.eventPropsCheck,classifiers:U.a.array.isRequired,link:e.linkPropsCheck,userDefinedId:U.a.string,pageEditId:U.a.string,trace:e.tracePropsCheck};return t&&(n.cbaChildren=U.a.array.isRequired),n}},{key:"addSelectGroupControllerConfigPropTypes",value:function(e){return e.selectGroups=U.a.arrayOf(U.a.shape({blockSelectionChanges:U.a.bool.isRequired,enforceSingleSelect:U.a.bool.isRequired,allowDeselect:U.a.bool.isRequired,initiallySelected:U.a.string,deselectTarget:U.a.string})),e}},{key:"addSelectGroupMemberConfigPropTypes",value:function(e){return e.selectGroupMember=U.a.shape({controllerPathId:U.a.string.isRequired,groupName:U.a.string.isRequired,selectGroupMemberName:U.a.string}),e}},{key:"getCbaTreeColumnConfig",value:function(){return{mouseOver:U.a.string,label:U.a.string,moveable:U.a.bool,resizable:U.a.bool,width:U.a.number}}},{key:"getCbaTreeRowConfig",value:function(){return{cells:U.a.array.isRequired,expanded:U.a.bool.isRequired,nodes:U.a.array.isRequired,imagePath:U.a.string,depth:U.a.number.isRequired,onRowExpandClick:U.a.func,onRowSelect:U.a.func.isRequired,path:U.a.string.isRequired}}},{key:"getInputLabelConfig",value:function(){return U.a.shape({distance:U.a.number.isRequired,position:U.a.string.isRequired})}}]),e}(),W=n(320),K=n.n(W),q=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"forEachUserDefIdInPath",value:function(t,n){if(void 0!==t&&-1!==t.lastIndexOf("/id=")){e.forEachUserDefIdInPath(e.dropUserDefIdFromPath(t),n);var a=e.getLastUserDefIdFromPath(t);void 0!==a&&n(a)}}},{key:"dropUserDefIdFromPath",value:function(e){if(void 0!==e){var t=e.lastIndexOf("/id=");if(-1!==t)return e.substring(0,t)}}},{key:"getLastUserDefIdFromPath",value:function(e){if(void 0!==e){var t=e.lastIndexOf("/id=");if(-1!==t)return e.substring(t+4)}}},{key:"getPageAreaTypeFromPath",value:function(e){if(void 0!==e){var t=e.indexOf("/pageAreaName=");return e.substring(14,t)}}},{key:"getPageAreaNameFromPath",value:function(e){if(void 0!==e){var t=e.indexOf("/pageAreaName=")+14,n=e.indexOf("/id=");return-1===n?e.substring(t):e.substring(t,n)}}},{key:"buildUserDefIdPath",value:function(e,t,n){if(void 0!==e&&void 0!==t&&void 0!==n)return"/pageAreaType=".concat(e,"/pageAreaName=").concat(t,"/id=").concat(n)}},{key:"appendUserDefIdToPath",value:function(e,t){if(void 0!==e&&void 0!==t)return"".concat(e,"/id=").concat(t)}}]),e}(),G=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"getStateAttribute",value:function(e,t){if(void 0!==e)return e[t]}},{key:"setStateAttribute",value:function(e,t,n){e[t]=n}},{key:"extractDeepCopy",value:function(t){return e.getStateAttribute(t,"deepCopy")}},{key:"setDeepCopy",value:function(t,n){e.setStateAttribute(t,"deepCopy",n)}},{key:"extractVolatile",value:function(t){return e.getStateAttribute(t,"volatile")}},{key:"setVolatile",value:function(t,n){e.setStateAttribute(t,"volatile",n)}},{key:"extractComponentClassName",value:function(t){return e.getStateAttribute(t,"componentClassName")}},{key:"setComponentClassName",value:function(t,n){e.setStateAttribute(t,"componentClassName",n)}},{key:"extractDisabled",value:function(t){return e.getStateAttribute(t,"disabled")}},{key:"setDisabled",value:function(t,n){e.setStateAttribute(t,"disabled",n)}},{key:"extractHidden",value:function(t){return e.getStateAttribute(t,"hidden")}},{key:"setHidden",value:function(t,n){e.setStateAttribute(t,"hidden",n)}},{key:"extractVisited",value:function(t){return e.getStateAttribute(t,"visited")}},{key:"setVisited",value:function(t,n){e.setStateAttribute(t,"visited",n)}},{key:"extractPosition",value:function(t){return e.getStateAttribute(t,"position")}},{key:"setPosition",value:function(t,n){e.setStateAttribute(t,"position",n)}},{key:"extractDefaultLinkReceiver",value:function(t){return e.getStateAttribute(t,"defaultLinkReceiver")}},{key:"setDefaultLinkReceiver",value:function(t,n){e.setStateAttribute(t,"defaultLinkReceiver",n)}},{key:"extractSelectable",value:function(t){return e.getStateAttribute(t,"selectable")}},{key:"setSelectable",value:function(t,n){e.setStateAttribute(t,"selectable",n)}},{key:"extractSelected",value:function(t){return e.getStateAttribute(t,"selected")}},{key:"setSelected",value:function(t,n){e.setStateAttribute(t,"selected",n)}},{key:"extractSelectGroupMemberInfo",value:function(t){return e.getStateAttribute(t,"selectGroupMemberInfo")}},{key:"setSelectGroupMemberInfo",value:function(t,n){e.setStateAttribute(t,"selectGroupMemberInfo",n)}},{key:"extractSelectGroupControllerState",value:function(t){return e.getStateAttribute(t,"selectGroupControllerState")}},{key:"setSelectGroupControllerState",value:function(t,n){e.setStateAttribute(t,"selectGroupControllerState",n)}},{key:"extractPropagationGroupControllerState",value:function(t){return e.getStateAttribute(t,"propagationGroupControllerState")}},{key:"setPropagationGroupControllerState",value:function(t,n){e.setStateAttribute(t,"propagationGroupControllerState",n)}},{key:"extractTextValue",value:function(t){return e.getStateAttribute(t,"textValue")}},{key:"setTextValue",value:function(t,n){e.setStateAttribute(t,"textValue",n)}},{key:"extractHighlightable",value:function(t){return e.getStateAttribute(t,"highlightable")}},{key:"setHighlightable",value:function(t,n){e.setStateAttribute(t,"highlightable",n)}},{key:"extractMediaVolume",value:function(t){return e.getStateAttribute(t,"volume")}},{key:"setMediaVolume",value:function(t,n){e.setStateAttribute(t,"volume",n)}},{key:"extractLastOperation",value:function(t){return e.getStateAttribute(t,"lastOperation")}},{key:"setLastOperation",value:function(t,n){e.setStateAttribute(t,"lastOperation",n)}},{key:"extractCurrentTime",value:function(t){return e.getStateAttribute(t,"currentTime")}},{key:"setCurrentTime",value:function(t,n){e.setStateAttribute(t,"currentTime",n)}},{key:"extractPlayNumber",value:function(t){return e.getStateAttribute(t,"playNumber")}},{key:"setPlayNumber",value:function(t,n){e.setStateAttribute(t,"playNumber",n)}},{key:"extractMaxPlay",value:function(t){return e.getStateAttribute(t,"maxPlay")}},{key:"setMaxPlay",value:function(t,n){e.setStateAttribute(t,"maxPlay",n)}},{key:"extractRecordNumber",value:function(t){return e.getStateAttribute(t,"recordNumber")}},{key:"setRecordNumber",value:function(t,n){e.setStateAttribute(t,"recordNumber",n)}},{key:"extractMaxRecord",value:function(t){return e.getStateAttribute(t,"maxRecord")}},{key:"setMaxRecord",value:function(t,n){e.setStateAttribute(t,"maxRecord",n)}},{key:"extractHideControls",value:function(t){return e.getStateAttribute(t,"hideControls")}},{key:"setHideControls",value:function(t,n){e.setStateAttribute(t,"hideControls",n)}},{key:"extractAutomaticStart",value:function(t){return e.getStateAttribute(t,"automaticStart")}},{key:"setAutomaticStart",value:function(t,n){e.setStateAttribute(t,"automaticStart",n)}},{key:"extractMediaBlob",value:function(t){return e.getStateAttribute(t,"mediaBlob")}},{key:"setMediaBlob",value:function(t,n){e.setStateAttribute(t,"mediaBlob",n)}},{key:"extractExternalContentState",value:function(t){return e.getStateAttribute(t,"externalContentState")}},{key:"setExternalContentState",value:function(t,n){e.setStateAttribute(t,"externalContentState",n)}},{key:"extractSelectedCell",value:function(t){return e.getStateAttribute(t,"selectedCell")}},{key:"setSelectedCell",value:function(t,n){e.setStateAttribute(t,"selectedCell",n)}},{key:"extractOldSelectedCell",value:function(t){return e.getStateAttribute(t,"oldSelectedCell")}},{key:"setOldSelectedCell",value:function(t,n){e.setStateAttribute(t,"oldSelectedCell",n)}},{key:"extractTableData",value:function(t){return e.getStateAttribute(t,"tableData")}},{key:"setTableData",value:function(t,n){e.setStateAttribute(t,"tableData",n)}},{key:"extractFormula",value:function(t){return e.getStateAttribute(t,"formula")}},{key:"setFormula",value:function(t,n){e.setStateAttribute(t,"formula",n)}},{key:"extractCellHadFocus",value:function(t){return e.getStateAttribute(t,"cellHadFocus")}},{key:"setCellHadFocus",value:function(t,n){e.setStateAttribute(t,"cellHadFocus",n)}},{key:"extractCellTitle",value:function(t){return e.getStateAttribute(t,"cellTitle")}},{key:"setCellTitle",value:function(t,n){e.setStateAttribute(t,"cellTitle",n)}},{key:"extractCellHasError",value:function(t){return e.getStateAttribute(t,"cellHasError")}},{key:"setCellHasError",value:function(t,n){e.setStateAttribute(t,"cellHasError",n)}},{key:"extractCellType",value:function(t){return e.getStateAttribute(t,"cellType")}},{key:"setCellType",value:function(t,n){e.setStateAttribute(t,"cellType",n)}},{key:"extractCellEditorAddress",value:function(t){return e.getStateAttribute(t,"cellEditorAddress")}},{key:"setCellEditorAddress",value:function(t,n){e.setStateAttribute(t,"cellEditorAddress",n)}},{key:"extractCellEditorContent",value:function(t){return e.getStateAttribute(t,"cellEditorContent")}},{key:"setCellEditorContent",value:function(t,n){e.setStateAttribute(t,"cellEditorContent",n)}},{key:"extractCellEditorIsNotValid",value:function(t){return e.getStateAttribute(t,"cellEditorIsNotValid")}},{key:"setCellEditorIsNotValid",value:function(t,n){e.setStateAttribute(t,"cellEditorIsNotValid",n)}},{key:"extractCellEditorContentIsReadOnly",value:function(t){return e.getStateAttribute(t,"cellEditorContentIsReadOnly")}},{key:"setCellEditorContentIsReadOnly",value:function(t,n){e.setStateAttribute(t,"cellEditorContentIsReadOnly",n)}},{key:"extractCellEditorErrorMessage",value:function(t){return e.getStateAttribute(t,"cellEditorErrorMessage")}},{key:"setCellEditorErrorMessage",value:function(t,n){e.setStateAttribute(t,"cellEditorErrorMessage",n)}},{key:"extractDragAndDrop",value:function(t){return e.getStateAttribute(t,"dragAndDrop")}},{key:"setDragAndDrop",value:function(t,n){e.setStateAttribute(t,"dragAndDrop",n)}},{key:"extractCounterValue",value:function(t){return e.getStateAttribute(t,"counterValue")}},{key:"setCounterValue",value:function(t,n){e.setStateAttribute(t,"counterValue",n)}},{key:"extractTreeNodes",value:function(t){return e.getStateAttribute(t,"treeNodes")}},{key:"setTreeNodes",value:function(t,n){e.setStateAttribute(t,"treeNodes",n)}},{key:"extractTreeColumns",value:function(t){return e.getStateAttribute(t,"treeColumns")}},{key:"setTreeColumns",value:function(t,n){e.setStateAttribute(t,"treeColumns",n)}},{key:"extractTreeState",value:function(t){return e.getStateAttribute(t,"treeState")}},{key:"setTreeState",value:function(t,n){e.setStateAttribute(t,"treeState",n)}},{key:"extractNodeTypes",value:function(t){return e.getStateAttribute(t,"nodeTypes")}},{key:"setNodeTypes",value:function(t,n){e.setStateAttribute(t,"nodeTypes",n)}},{key:"extractTreeReadOnly",value:function(t){return e.getStateAttribute(t,"treeReadOnly")}},{key:"setTreeReadOnly",value:function(t,n){e.setStateAttribute(t,"treeReadOnly",n)}},{key:"extractTreeViewSort",value:function(t){return e.getStateAttribute(t,"treeViewSort")}},{key:"setTreeViewSort",value:function(t,n){e.setStateAttribute(t,"treeViewSort",n)}},{key:"extractSelectedIds",value:function(t){return e.getStateAttribute(t,"selectedIds")}},{key:"setSelectedIds",value:function(t,n){e.setStateAttribute(t,"selectedIds",n)}},{key:"extractDefaultHighlightColor",value:function(t){return e.getStateAttribute(t,"defaultHighlightColor")}},{key:"setDefaultHighlightColor",value:function(t,n){e.setStateAttribute(t,"defaultHighlightColor",n)}},{key:"extractEditorState",value:function(t){return e.getStateAttribute(t,"editorState")}},{key:"setEditorState",value:function(t,n){e.setStateAttribute(t,"editorState",n)}},{key:"extractSelections",value:function(t){return e.getStateAttribute(t,"selections")}},{key:"setSelections",value:function(t,n){e.setStateAttribute(t,"selections",n)}},{key:"extractModifiersInEditorState",value:function(t){return e.getStateAttribute(t,"modifiersInEditorState")}},{key:"setModifiersInEditorState",value:function(t,n){e.setStateAttribute(t,"modifiersInEditorState",n)}}]),e}(),z=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"deepCopy",value:function(e){if(void 0!==e)return JSON.parse(JSON.stringify(e))}}]),e}(),_=function(){function e(t){var n=this;Object(a.a)(this,e),this.setRecommendations=function(t){var a=n.recommendations;n.recommendations=z.deepCopy(t),e.traceRecommendationChange(a,n.recommendations,n.runtime),void 0!==n.taskNavigator&&n.taskNavigator.highlightRecommendations(n.recommendations),e.refreshRecommendedComponents(a,n.runtime),e.refreshRecommendedComponents(n.recommendations,n.runtime)},this.setTaskNavigator=function(e){n.taskNavigator=e},this.isRecommended=function(e){var t=n.runtime,a=t.taskManager.getCurrentTestTaskItemNames(),r=!1;return n.recommendations.forEach(function(n,i,o){if(n.testName===a.test&&n.taskName===a.task&&void 0!==n.absoluteUserDefId){var s=X.getUserDefPathForIndexPath(e,t);void 0!==s&&n.absoluteUserDefId===s&&(r=!0)}}),r},this.processTaskSelected=function(t,a,r){var i=n.runtime,o=e.findFirstRecommendationForTask(n.recommendations,t,r);e.setSelectedOnRecommendedComponent(o,i),e.doRecommendedPageSwitch(o,i)},this.runtime=t,this.recommendations=[],this.taskNavigator=void 0}return Object(r.a)(e,null,[{key:"findFirstRecommendationForTest",value:function(e,t){return e.find(function(e,n,a){return e.testName===t})}},{key:"findFirstRecommendationForTask",value:function(e,t,n){return e.find(function(e,a,r){return e.testName===t&&e.taskName===n})}},{key:"getRecommendationColor",value:function(){return"rgba(206, 239, 253, 1)"}},{key:"traceRecommendationChange",value:function(t,n,a){a.traceLogBuffer.reportEvent("Recommend",new Date,{oldRecommendations:e.buildRecommendationListForTrace(t),newRecommendations:e.buildRecommendationListForTrace(n)})}},{key:"buildRecommendationListForTrace",value:function(e){return e.map(function(e){return{testName:e.testName,taskName:e.taskName,userDefIdPath:e.absoluteUserDefId,userDefId:q.getLastUserDefIdFromPath(e.absoluteUserDefId)}})}},{key:"setSelectedOnRecommendedComponent",value:function(e,t){void 0!==e&&void 0!==e.absoluteUserDefId&&$.updateStateAttributeByUserDefPath(G.extractSelected,G.setSelected,!0,e.absoluteUserDefId,t,!0)}},{key:"doRecommendedPageSwitch",value:function(e,t){if(void 0!==e&&void 0!==e.absoluteUserDefId){var n=t.pageConfigurationsManager,a=q.getLastUserDefIdFromPath(e.absoluteUserDefId),r=n.findPageSegmentForUserDefId(a);if(void 0===r)return void console.warn("Recommendation switch could not find page segment for user defined ID ".concat(a));var i=n.findConfigurationForPageSegment(r),o=t.componentStateManager.findOrBuildStateByUserDefPath(e.absoluteUserDefId,t),s=G.extractDefaultLinkReceiver(o);Re.doPageSwitch(i.config.link,t,s,void 0)}}},{key:"refreshRecommendedComponents",value:function(e,t){var n=t.taskManager.getCurrentTestTaskItemNames();e.forEach(function(e,a,r){e.testName===n.test&&e.taskName===n.task&&void 0!==e.absoluteUserDefId&&Q.triggerRenderingViaUserDefPath(e.absoluteUserDefId,t)})}}]),e}(),J=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"buildStyleForAutoLayout",value:function(t,n,a){var r={};switch(t.autoLayoutLayer){case"panel":r=Object.assign(Y.buildAbsoluteStyleFromConfig(t,n,a),e.buildStyleForAutoLayoutPanel(t,n,a));break;case"cell":r=e.buildStyleForAutoLayoutCell(t);break;case"element":r=e.buildStyleForAutoLayoutElement(t,n,a);break;case"panel-element":r=Object.assign(e.buildStyleForAutoLayoutPanel(t,n,a),e.buildStyleForAutoLayoutElement(t,n,a));break;case"none":r=Y.buildAbsoluteStyleFromConfig(t,n,a);break;default:r=Y.buildAbsoluteStyleFromConfig(t,n,a),H.raiseError("autoLayoutLayer value missing")}return r}},{key:"transformTemplateKeywords",value:function(e){return e.map(function(e){return"fill"===e?"auto":e.endsWith("%")||e.endsWith("px")?e:"auto"===e?"min-content":null}).join(" ")}},{key:"buildStyleForAutoLayoutPanel",value:function(t,n,a){var r=t.autoLayout,i=r.rows,o=r.columns,s=r.blockAlignVertically,c=r.blockAlignHorizontally,l=r.gap;return{display:"grid",gridTemplateRows:e.transformTemplateKeywords(i),gridTemplateColumns:e.transformTemplateKeywords(o),alignContent:s,justifyContent:c,rowGap:l.row,columnGap:l.column}}},{key:"buildStyleForAutoLayoutCell",value:function(t){var n=t.autoLayout,a=n.columnStart,r=n.rowStart,i=n.columnSpan,o=n.rowSpan,s=n.alignVertically,c=n.alignHorizontally;return{position:"relative",gridColumnStart:a,gridRowStart:r,gridColumnEnd:"span ".concat(i),gridRowEnd:"span ".concat(o),alignItems:e.transformFlexAlignmentKeyword(s),justifyContent:e.transformFlexAlignmentKeyword(c),display:"flex"}}},{key:"transformFlexAlignmentKeyword",value:function(e){switch(e){case"start":return"flex-start";case"end":return"flex-end";case"center":case"none":case"stretch":return e;default:return H.raiseError("autoLayoutLayer -> cell alignment value invalid")}}},{key:"addHorizontalElementValues",value:function(e,t,n,a,r){var i=Y.buildAbsoluteStyleFromConfig(t,a,r);n&&(e.left=i.left,e.right=i.right),e.width=i.width}},{key:"addVerticalElementValues",value:function(e,t,n,a,r){var i=Y.buildAbsoluteStyleFromConfig(t,a,r);n&&(e.top=i.top),e.height=i.height}},{key:"buildStyleForAutoLayoutElement",value:function(t,n,a){var r=t.autoLayout,i=r.alignVertically,o=r.alignHorizontally,s={position:"relative"};switch(i){case"start":case"center":case"end":e.addVerticalElementValues(s,t,!1,n,a);break;case"none":e.addVerticalElementValues(s,t,!0,n,a);break;case"stretch":s.height="100%";break;default:H.raiseError("autoLayoutLayer -> alignVertically value invalid")}switch(o){case"start":case"center":case"end":e.addHorizontalElementValues(s,t,!1,n,a);break;case"none":e.addHorizontalElementValues(s,t,!0,n,a),s.position="relative";break;case"stretch":s.width="100%";break;default:H.raiseError("autoLayoutLayer -> alignHorizontally value invalid")}return s}}]),e}(),Y=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"checkPosition",value:function(e){var t=(void 0===e.x?"x value missing":"")+(void 0===e.y?"y value missing":"")+(void 0===e.width?"width value missing":"")+(void 0===e.height?"height value missing":"");""!==t&&H.raiseError(t)}},{key:"checkFont",value:function(e){var t=(void 0===e.name?"font name missing":"")+(void 0===e.size?"font size missing":"");""!==t&&H.raiseError(t)}},{key:"checkState",value:function(e){var t=(void 0===e.disabled?"disabled status missing":"")+(void 0===e.selected?"selected status missing":"")+(void 0===e.hidden?"hidden status missing":"");""!==t&&H.raiseError(t)}},{key:"getDisabled",value:function(e){return e.state.disabled}},{key:"getSelected",value:function(e){return e.state.selected}},{key:"getHidden",value:function(e){return e.state.hidden}},{key:"getPosition",value:function(e){return e.position}},{key:"getUserDefinedId",value:function(e){return e.userDefinedId}},{key:"getDragAndDrop",value:function(e){return e.dragAndDrop}},{key:"getIdentifyingInfoForLogMessage",value:function(t){var n=e.getUserDefinedId(t),a="at (".concat(t.position.x,",").concat(t.position.y,")");return(void 0!==n?"".concat(n," "):"")+a}},{key:"getObservedStatemachineVariableNames",value:function(e){var t=[];return void 0===e.text||void 0===e.text.dynamic||t.includes(e.text.dynamic.variable)||t.push(e.text.dynamic.variable),void 0===e.image||void 0===e.image.dynamic||t.includes(e.image.dynamic.variable)||t.push(e.image.dynamic.variable),t}},{key:"buildDisplayText",value:function(t,n,a){if(void 0!==t.text&&void 0!==t.text.dynamic){var r=e.getDynamicValueFromStatemachineAndMapper(t.text.dynamic,a);if(void 0!==r)return r}var i=G.extractTextValue(n);return void 0!==i?i:void 0!==t.text&&void 0!==t.text.label?t.text.label:""}},{key:"buildTitle",value:function(e){return e.text&&void 0!==e.text.mouseOver?e.text.mouseOver:""}},{key:"getImageTag",value:function(t,n,a,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=n.image.displayMode;if("left"===o||"right"===o||"initial"===o){var s=G.extractDisabled(t),c=G.extractVisited(t),l=e.getProperResourcePath(e.chooseImageOrColorVariant(n.image,s,a,c),r);if(void 0!==l){var u=Object.assign({float:o,opacity:s?.3:1},i);return v.a.createElement("img",{src:l,alt:"",style:u})}}}},{key:"buildStyleByIndexPath",value:function(t,n,a,r,i){var o=i.componentStateManager.findOrBuildStateForPathId(t,i),s=i.recommendationsManager.isRecommended(t);return e.buildStyleByState(o,n,a,r,s,i)}},{key:"buildAbsoluteStyleFromConfig",value:function(e,t,n){var a,r=e.position,i=G.extractPosition(n),o=t||"left";return a={position:"absolute"},Object(N.a)(a,o,"".concat(i.x,"px")),Object(N.a)(a,"top","".concat(i.y,"px")),Object(N.a)(a,"width","".concat(r.width,"px")),Object(N.a)(a,"height","".concat(r.height,"px")),a}},{key:"buildStyleByState",value:function(t,n,a,r,i,o){var s,c=n.position,l=n.font,u=n.state,d=n.cursor,g=void 0===c.padding?void 0:"padding";e.checkPosition(c),e.checkFont(l),e.checkState(u);var f=Object.assign(J.buildStyleForAutoLayout(n,r,t),(s={},Object(N.a)(s,g,"".concat(c.padding,"px")),Object(N.a)(s,"outline","none"),Object(N.a)(s,"visibility",G.extractHidden(t)?"hidden":"visible"),Object(N.a)(s,"fontFamily","'".concat(l.name,"', Geneva, sans-serif")),Object(N.a)(s,"fontSize",l.size),Object(N.a)(s,"fontWeight",l.bold?"bold":"normal"),Object(N.a)(s,"fontStyle",l.italic?"italic":"normal"),Object(N.a)(s,"textDecoration",l.underlined?"underline":"none"),Object(N.a)(s,"textAlign",l.alignmentHorizontal),s)),p=G.extractDisabled(t),h=G.extractVisited(t);e.setStyleAttribute(f,"color",e.chooseImageOrColorVariant(n.color.text,p,a,h)),e.setStyleAttribute(f,"cursor",e.getCursorValue(d,o)),e.setBorderStyleAttributes(f,n.border,p,a,h),e.setBackgroundStyleAttributes(f,n,p,a,h,i,o);var v=n.transform.rotate,m=void 0!==n.transform.translateX?n.transform.translateX:0,y=void 0!==n.transform.translateY?n.transform.translateY:0;void 0!==v&&e.setStyleAttribute(f,"transform","translate( ".concat(m,"px, ").concat(y,"px) rotate(  ").concat(v,"deg)"));var b=n.transform.transformOrigin;return void 0!==b&&e.setStyleAttribute(f,"transformOrigin","".concat(b.x,"% ").concat(b.y,"%")),f}},{key:"buildCustomFontsCss",value:function(t,n){var a="";return t.forEach(function(t){a+="@font-face {\n                font-family: '".concat(t.fontFamilyName,"';\n                src: url('").concat(e.getProperResourcePath(t.fontFileName,n),"');\n      }")}),a}},{key:"buildStyleSvg",value:function(t,n,a){var r=G.extractDisabled(t),i=G.extractVisited(t),o={};return e.setStyleAttribute(o,"fill",e.chooseImageOrColorVariant(n.color.background,r,a,i)),e.setStyleAttribute(o,"stroke",e.chooseImageOrColorVariant(n.border.color,r,a,i)),e.setStyleAttributeWithUnits(o,"strokeWidth",n.border.width,"px"),o}},{key:"buildPointsString",value:function(e){return e.reduce(function(e,t,n){return"".concat(e," ").concat(t.x,",").concat(t.y)},"")}},{key:"getDynamicValueFromStatemachineAndMapper",value:function(e,t){var n=t.taskManager,a=t.variableManager,r=t.valueMapper,i=n.getCurrentStatePathRoot(),o=a.getVariable(i,e.variable);if(void 0!==o)return void 0===e.valueMap?"".concat(o):r.getMappedValue(e.valueMap,o)}},{key:"combine",value:function(e,t,n){return void 0!==e?e:void 0!==t?t:n}},{key:"setStyleAttribute",value:function(e,t,n){void 0!==n&&(e[t]=n)}},{key:"setBorderStyleAttributes",value:function(t,n,a,r,i){e.setStyleAttribute(t,"borderStyle",n.style),e.setStyleAttributeWithUnits(t,"borderWidth",n.width,"px"),e.setStyleAttributeWithUnits(t,"borderRadius",n.radius,"px"),e.setStyleAttribute(t,"borderColor",e.chooseImageOrColorVariant(n.color,a,r,i)),void 0!==n.north&&(e.setStyleAttribute(t,"borderTopStyle",n.north.style),e.setStyleAttribute(t,"borderTopColor",n.north.color),e.setStyleAttributeWithUnits(t,"borderTopWidth",n.north.width,"px")),void 0!==n.south&&(e.setStyleAttribute(t,"borderBottomStyle",n.south.style),e.setStyleAttribute(t,"borderBottomColor",n.south.color),e.setStyleAttributeWithUnits(t,"borderBottomWidth",n.south.width,"px")),void 0!==n.west&&(e.setStyleAttribute(t,"borderLeftStyle",n.west.style),e.setStyleAttribute(t,"borderLeftColor",n.west.color),e.setStyleAttributeWithUnits(t,"borderLeftWidth",n.west.width,"px")),void 0!==n.east&&(e.setStyleAttribute(t,"borderRightStyle",n.east.style),e.setStyleAttribute(t,"borderRightColor",n.east.color),e.setStyleAttributeWithUnits(t,"borderRightWidth",n.east.width,"px"))}},{key:"setBackgroundStyleAttributes",value:function(t,n,a,r,i,o,s){var c,l=n.image.displayMode,u=void 0!==n.image&&void 0!==n.image.dynamic?e.getDynamicValueFromStatemachineAndMapper(n.image.dynamic,s):void 0,d=void 0===u||0===u.length?e.chooseImageOrColorVariant(n.image,a,r,i):u;"overlay"===l&&(c=void 0===d?"none":"url(".concat(e.getProperResourcePath(d,s),")"));var g=c?n.image.overlayType:void 0;if(e.setStyleAttribute(t,"backgroundColor",!0===o?_.getRecommendationColor():e.chooseImageOrColorVariant(n.color.background,a,r,i)),e.setStyleAttribute(t,"backgroundImage",c),c||g)switch(g){case"stretch":e.setStyleAttribute(t,"backgroundRepeat","no-repeat"),e.setStyleAttribute(t,"backgroundPosition","center"),e.setStyleAttribute(t,"backgroundSize","100% 100%");break;case"center":e.setStyleAttribute(t,"backgroundRepeat","no-repeat"),e.setStyleAttribute(t,"backgroundPosition","center"),e.setStyleAttribute(t,"backgroundSize","contain");break;case"left":e.setStyleAttribute(t,"backgroundRepeat","no-repeat"),e.setStyleAttribute(t,"backgroundPosition","left"),e.setStyleAttribute(t,"backgroundSize","contain")}}},{key:"setStyleAttributeWithUnits",value:function(e,t,n,a){void 0!==n&&(e[t]=n+a)}},{key:"chooseImageOrColorVariant",value:function(t,n,a,r){if(void 0!==t){var i=e.pickVariantPropertyFromEntry(t,n,a,r);return e.isBlockDefaultValue(i)?void 0:d.withDefault(i,t.default)}}},{key:"pickVariantPropertyFromEntry",value:function(e,t,n,a){return t?e.disabled:n?e.selected:a?e.visited:e.default}},{key:"isBlockDefaultValue",value:function(e){return void 0!==e&&d.isEmptyObject(e)}},{key:"getCursorValue",value:function(e,t){if(void 0!==e)return void 0!==e.standard?e.standard:void 0!==e.image?"url(".concat(this.getProperResourcePath(e.image,t),"), auto"):void 0}},{key:"getProperResourcePath",value:function(t,n){return e.getProperResourcePathWithFlag(t,"resource",n)}},{key:"getProperResourcePathWithFlag",value:function(e,t,n){if(void 0!==e&&0!==e.length){var a=n.taskManager,r="";switch(t){case"resource":r=a.getResourcePath();break;case"external":r=a.getExternalResourcePath();break;default:console.error("Unknown resource path flag ".concat(t,", defaulting to 'resource'")),r=a.getResourcePath()}return"".concat(r,"/").concat(e)}}},{key:"getProperResourcePathExternalResources",value:function(t,n){return void 0===t?void 0:t.toLowerCase().startsWith("http")?t:e.getProperResourcePathWithFlag(t,"external",n)}},{key:"getCssClassNamesValue",value:function(e,t){var n=e.cssClassNames||[];return[].concat(Object(i.a)(n),[t]).join(" ")}}]),e}(),X=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"getUserDefPathForIndexPath",value:function(t,n){if(void 0!==t){var a=j.getPageSegmentArray(t);if(0!==a.length){for(var r=e.getUserDefIdForPageSegment(a[0],n),i=q.buildUserDefIdPath(j.getPageAreaTypeFromPath(t),j.getPageAreaNameFromPath(t),r),o=1;o<a.length;o+=1){var s=e.getUserDefIdForPageSegment(a[o],n);if(void 0===s)return;i=q.appendUserDefIdToPath(i,s)}return i}}}},{key:"getIndexPathForUserDefPath",value:function(e,t){var n=j.appendPageSegmentToPathRoot(t.taskManager.getCurrentStatePathRoot(),q.getPageAreaTypeFromPath(e),q.getPageAreaNameFromPath(e),"");return q.forEachUserDefIdInPath(e,function(e){var a=t.pageConfigurationsManager.findPageSegmentForUserDefId(e);n=j.appendPageSegmentsToPath(n,a)}),n}},{key:"getIndexPathForTextBlockPath",value:function(e,t){var n=j.appendPageSegmentToPathRoot(t.taskManager.getCurrentStatePathRoot(),q.getPageAreaTypeFromPath(e),q.getPageAreaNameFromPath(e),""),a=q.dropUserDefIdFromPath(e),r=q.getLastUserDefIdFromPath(e),i=t.pageConfigurationsManager.findPageSegmentForTextBlockOwner(r);if(void 0!==i)return void 0!==a&&q.forEachUserDefIdInPath(a,function(e){var a=t.pageConfigurationsManager.findPageSegmentForUserDefId(e);n=j.appendPageSegmentsToPath(n,a)}),n=j.appendPageSegmentsToPath(n,i)}},{key:"getUserDefIdForPageSegment",value:function(e,t){var n=t.pageConfigurationsManager.findConfigurationForPageSegment(e);if(void 0!==n)return Y.getUserDefinedId(n.config)}}]),e}(),Z=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"dumpSnapshotToTrace",value:function(e){var t=e.taskManager,n=e.presenterStateManager,a=e.incidentsAccumulator,r=e.clipboardManager,i=e.statemachinesManager,o=e.calculatorsManager,s=e.variableManager,c=t.getCurrentTestTaskItemNames(),l=c.test,u=c.item,d=c.task,g=t.getCurrentStatePathRoot(),f=new Date;return e.traceLogBuffer.reportEvent("Snapshot",f,{components:$.buildComponentsSnapshot(l,u,d,e),presentation:n.getTaskState(g),incidents:a.getAllValuesForTask(g,f.getTime()),clipboard:r.getStateForTracing(),statemachine:{current:{states:i.getCurrentStateMachineLeafStates()},history:i.getHistoryStatemachineData()},calculator:o.getStateForTask(g),variables:s.buildVariablesInfoArrayForTask(g)}),f}},{key:"dumpFullStateToTrace",value:function(e){var t=e.taskManager;e.traceLogBuffer.reportEvent("FullState",new Date,t.getAllTasksState())}},{key:"dumpStateChangeToTrace",value:function(e,t,n){n.reportEvent("StateChange",new Date,{stateType:e,stateDelta:t})}},{key:"dumpRenderTriggeredToTrace",value:function(e,t,n){t.reportEvent("RenderTriggered",new Date,{indexPath:e,replayStepId:n.getCurrentReplayStepId()})}},{key:"dumpContextMenuTriggeredToTrace",value:function(e,t,n,a){var r=t?e.entries:void 0,i=t?{clientX:e.event.clientX,clientY:e.event.clientY,type:e.event.type}:void 0;n.reportEvent("ContextMenu",new Date,{event:i,entries:r,shouldOpen:t,replayStepId:a.getCurrentReplayStepId()})}},{key:"dumpScrollTriggeredToTrace",value:function(e,t,n,a,r){a.reportEvent("ScrollTriggered",new Date,{path:e,scrollLeft:t,scrollTop:n,replayStepId:r.getCurrentReplayStepId()})}},{key:"traceScrollWrap",value:function(){return function(t,n,a,r){e.traceScroll(a,r,t,n)}}},{key:"traceScroll",value:function(t,n,a,r){var i=e.buildScrollTraceDetails(a,r);i&&(Re.traceUserInteraction("ScrollbarMove",t,i,void 0,void 0,n),n.replayStepMonitor.incrementReplayStep(),e.dumpScrollTriggeredToTrace(t,a.scrollLeft,a.scrollTop,n.traceLogBuffer,n.replayStepMonitor))}},{key:"buildScrollTraceDetails",value:function(t,n){var a=e.computeScrollPosition(t),r=a.horizontal,i=a.vertical,o={orientation:n.orientation,direction:n.direction};return(r||0===r)&&(o.horizontalScroll=r),(i||0===i)&&(o.verticalScroll=i),n.orientation||n.direction?o:null}},{key:"computeScrollOrientation",value:function(e,t){if(!e||!t)return{direction:null,orientation:null};var n=e.scrollTop!==t.scrollTop,a=n?"vertical":"horizontal";return{direction:n?e.scrollTop<t.scrollTop?"up":"down":e.scrollLeft<t.scrollLeft?"left":"right",orientation:a}}},{key:"computeScrollPosition",value:function(e){var t=e.scrollTop,n=e.scrollLeft,a=e.scrollHeight,r=e.scrollWidth,i=e.clientHeight,o=e.clientWidth;return{vertical:Math.round(t/(a-i)*100),horizontal:Math.round(n/(r-o)*100)}}},{key:"getScrollDataFromEvent",value:function(e){var t=e.target;return{scrollTop:t.scrollTop,scrollLeft:t.scrollLeft,scrollHeight:t.scrollHeight,scrollWidth:t.scrollWidth,clientHeight:t.clientHeight,clientWidth:t.clientWidth}}}]),e}(),Q=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"onMount",value:function(t){void 0!==t.props.path?e.doRegistrations(t,t.props.path):console.warn("Rendering helper cannot register component without index path",t.props)}},{key:"onUnmount",value:function(t){void 0!==t.props.path?e.doDeregistrations(t,t.props.path):console.warn("Rendering helper cannot deregister component without index path",t.props)}},{key:"onReceiveProps",value:function(t,n){void 0!==t.props.path?void 0!==n.path?t.props.path!==n.path&&(e.doDeregistrations(t,t.props.path),e.doRegistrations(t,n.path)):console.warn("Rendering helper cannot update to props without index path",n):console.warn("Rendering helper cannot update from props without index path",t.props)}},{key:"doRegistrations",value:function(t,n){var a=t.props,r=a.runtime,i=a.config;r.componentDirectory.registerComponent(n,t),Y.getObservedStatemachineVariableNames(i).forEach(function(e){r.variableManager.addVariableChangeObserver(n,e)}),e.applyRegisteredActions(t,n,r)}},{key:"doDeregistrations",value:function(e,t){var n=e.props.runtime;n.componentDirectory.deregisterComponent(t),n.variableManager.dropChangeObserverForPath(t)}},{key:"triggerRenderingViaUserDefPath",value:function(t,n){e.triggerRenderingViaPath(X.getIndexPathForUserDefPath(t,n),n)}},{key:"triggerRenderingViaPath",value:function(t,n){var a=n.componentDirectory.findComponent(t);void 0!==a?e.triggerRendering(a):console.log("Receiver not mounted: ".concat(t))}},{key:"triggerRendering",value:function(t){var n=t.props,a=n.path,r=n.runtime;Z.dumpRenderTriggeredToTrace(a,r.traceLogBuffer,r.replayStepMonitor),t.setState(function(t){return e.buildCounterState(t)})}},{key:"buildCounterState",value:function(t){var n=null===t?0:t.updateCount;return{updateCount:e.incrementCount(n)}}},{key:"incrementCount",value:function(e){return void 0===e||e>1e4?1:e+1}},{key:"extractMultilineText",value:function(t){return t.split("\r\n").map(function(t,n){return v.a.createElement("span",{key:t.length>32?"".concat(n,"_").concat(e.hash64(t)):"".concat(n,"_").concat(t)},t,v.a.createElement("br",null))})}},{key:"hashFnv32a",value:function(e){for(var t=2166136261,n=0;n<e.length;n+=1)t^=e.charCodeAt(n),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return"0000000".concat((t>>>0).toString(16)).substr(-8)}},{key:"hash64",value:function(t){var n=e.hashFnv32a(t);return n+e.hashFnv32a(n+t)}},{key:"applyRegisteredActions",value:function(e,t,n){n.actionRegister.hasActionsRegisteredForPath(t)&&(n.actionRegister.getRegisteredActionsForPath(t).forEach(function(t){return e[t].call()}),n.actionRegister.clearRegisteredActionsForPath(t))}}]),e}(),$=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"getState",value:function(e){return e.props.runtime.componentStateManager.findOrBuildStateForPathId(e.props.path,e.props.runtime)}},{key:"registerState",value:function(e,t){var n=e.props.runtime;n.componentStateManager.registerStateByPathId(e.props.path,t,n)}},{key:"getStateAttributeByUserDefPath",value:function(e,t,n){return e(n.componentStateManager.findOrBuildStateByUserDefPath(t,n))}},{key:"getStateAttributeByPathId",value:function(e,t,n){return e(n.componentStateManager.findOrBuildStateForPathId(t,n))}},{key:"updateStateAttribute",value:function(e,t,n,a,r,i){var o=r.componentStateManager,s=o.findOrBuildStateForPathId(a,r);e(s)!==n&&(t(s,n),o.registerStateByPathId(a,s,r),i&&Q.triggerRenderingViaPath(a,r))}},{key:"updateStateAttributeByUserDefPath",value:function(e,t,n,a,r,i){var o=r.componentStateManager,s=o.findOrBuildStateByUserDefPath(a,r);e(s)!==n&&(t(s,n),o.registerStateByUserDefPath(a,s,r),i&&Q.triggerRenderingViaUserDefPath(a,r))}},{key:"buildComponentsSnapshot",value:function(t,n,a,r){var i=r.componentStateManager,o=r.componentDirectory;return e.formatSnapshotDump(i.getTaskSnapshot(t,n,a,o),r)}},{key:"findIndexPathsInCurrentTaskOfComponentWithType",value:function(t,n){var a=n.componentStateManager,r=n.taskManager.getCurrentStatePathRoot();return a.filterExistingPathIds(function(a){return j.getRootFromPath(a)===r&&e.getComponentTypeForIndexPath(a,n)===t})}},{key:"findIndexPathsOfDescendants",value:function(e,t){var n="".concat(e,"/");return t.componentStateManager.filterExistingPathIds(function(e){return e.startsWith(n)})}},{key:"formatSnapshotDump",value:function(t,n){return Object.entries(t).map(function(t){return e.formatEntryForSnapshotDump(t,n)})}},{key:"formatEntryForSnapshotDump",value:function(t,n){var a=Object(L.a)(t,2),r=a[0],i=a[1];i.deepCopy=void 0;var o=X.getUserDefPathForIndexPath(r,n);return{indexPath:r,userDefIdPath:o,userDefId:q.getLastUserDefIdFromPath(o),componentType:e.getComponentTypeForIndexPath(r,n),componentState:i}}},{key:"getComponentTypeForIndexPath",value:function(e,t){var n=j.getLastPageSegmentFromPath(e);if(void 0!==n){var a=t.pageConfigurationsManager.findConfigurationForPageSegment(n);return void 0===a?void 0:a.type}}}]),e}(),ee=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"goBack",value:function(t,n){var a=e.getHistoryState(t,n);e.currentCanGoBack(a)&&(e.getRelevantPagesState(a).current-=1,e.setHistoryState(a,t,n))}},{key:"goForward",value:function(t,n){var a=e.getHistoryState(t,n);e.currentCanGoForward(a)&&(e.getRelevantPagesState(a).current+=1,e.setHistoryState(a,t,n))}},{key:"canGoBack",value:function(t,n){return e.currentCanGoBack(e.getHistoryState(t,n))}},{key:"canGoForward",value:function(t,n){return e.currentCanGoForward(e.getHistoryState(t,n))}},{key:"currentCanGoBack",value:function(t){if(e.isHistoryModeWithTabs(t)||e.isHistoryModeNoTabs(t)){var n=e.getRelevantPagesState(t);return void 0!==n&&void 0!==n.current&&e.getRelevantPagesState(t).current>0}return!1}},{key:"currentCanGoForward",value:function(t){if(e.isHistoryModeWithTabs(t)||e.isHistoryModeNoTabs(t)){var n=e.getRelevantPagesState(t);return void 0!==n&&void 0!==n.current&&n.current<n.pages.length-1}return!1}},{key:"goHome",value:function(t,n){var a=e.getHistoryState(t,n);if(e.isHistoryModeWithTabs(a)||e.isHistoryModeNoTabs(a)){var r=e.getRelevantPagesState(a);void 0!==r&&void 0!==r.current&&(r.current=0,e.setHistoryState(a,t,n))}}},{key:"getPage",value:function(t,n){var a=e.getHistoryState(t,n);return e.isHistoryModeWithTabs(a)||e.isHistoryModeNoTabs(a)?e.getCurrentPageFromPagesState(e.getRelevantPagesState(a)):e.isHistoryModeSinglePage(a)?a.history.page:void 0}},{key:"getCurrentPageFromPagesState",value:function(e){return void 0===e||void 0===e.current?void 0:e.pages[e.current]}},{key:"getRelevantPagesState",value:function(t){if(e.isHistoryModeWithTabs(t)){var n=t.history.currentTab;return void 0===n?void 0:t.history.withTabs[n]}return e.isHistoryModeNoTabs(t)?t.history.noTabs:void 0}},{key:"getTab",value:function(t,n){var a=e.getHistoryState(t,n);return e.isHistoryModeWithTabs(a)?a.history.currentTab:void 0}},{key:"getAllTabs",value:function(t,n){var a=e.getHistoryState(t,n);return e.isHistoryModeWithTabs(a)?a.history.allTabs:[]}},{key:"getImageForTab",value:function(t,n,a){var r=e.getCurrentPageInfoForTab(t,n,a);return void 0===r?void 0:r.image}},{key:"switchTab",value:function(t,n,a){var r=e.getHistoryState(n,a);e.isHistoryModeWithTabs(r)&&void 0!==r.history.withTabs[t]&&(r.history.currentTab=t,e.setHistoryState(r,n,a))}},{key:"closeTab",value:function(t,n,a){var r=e.getHistoryState(n,a);if(e.isHistoryModeWithTabs(r)&&void 0!==r.history.withTabs[t]){var i=r.history.allTabs.indexOf(t);if(0!==i)e.getTab(n,a)===t&&(r.history.currentTab=r.history.allTabs[i-1]),r.history.allTabs.splice(i,1),delete r.history.withTabs[t],e.setHistoryState(r,n,a);else console.log("Closing first tab not possible")}}},{key:"addPage",value:function(t,n,a,r,i){var o=e.getHistoryState(r,i),s=a.image;switch(void 0===o&&console.error("History state missing when trying to add page ".concat(t," to state of ").concat(r)),o.historyMode){case e.Modes.withTabsMode:e.addPageToWithTabsHistory(t,n,a,o);break;case e.Modes.noTabsMode:e.addPageToNoTabsHistory(t,n,s,o);break;case e.Modes.singlePageMode:o.history.page={name:t,url:n,image:s};break;default:console.error("Invalid mode type ".concat(o.historyMode))}e.setHistoryState(o,r,i)}},{key:"addPageToWithTabsHistory",value:function(t,n,a,r){var i=r.history,o=a.name,s=a.image,c=a.closable,l=a.width;i.currentTab=o,void 0===i.withTabs&&(i.withTabs={}),void 0===i.allTabs&&(i.allTabs=[]);var u=i.withTabs;void 0===u[o]?(u[o]=e.createPagesState(t,n,s,c,l),i.allTabs.push(o)):(u[o].closable=c,u[o].tabWidth=l,e.addPageToPagesState(t,n,s,u[o]))}},{key:"addPageToNoTabsHistory",value:function(t,n,a,r){void 0===r.history.noTabs?r.history.noTabs=e.createPagesState(t,n,a,!1,0):e.addPageToPagesState(t,n,a,r.history.noTabs)}},{key:"createPagesState",value:function(e,t,n){return{current:0,closable:!(arguments.length>3&&void 0!==arguments[3])||arguments[3],tabWidth:arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,pages:[{name:e,url:t,image:n}]}}},{key:"addPageToPagesState",value:function(t,n,a,r){var i,o=e.getCurrentPageFromPagesState(r);if(void 0===o||o.name!==t||o.url!==n||o.image!==a)for(void 0===r.current&&(r.current=-1),void 0===r.pages&&(r.pages=[]),r.current+=1,r.pages[r.current]={name:t,url:n,image:a},i=r.pages.length-1;i>r.current;i-=1)r.pages.pop()}},{key:"getInfoForTab",value:function(t,n,a){var r=e.getHistoryState(n,a);if(e.isHistoryModeWithTabs(r))return r.history.withTabs[t]}},{key:"getCurrentPageInfoForTab",value:function(t,n,a){var r=e.getInfoForTab(t,n,a);return void 0===r?void 0:r.pages[r.current]}},{key:"isHistoryModeSinglePage",value:function(t){return void 0!==t&&t.historyMode===e.Modes.singlePageMode}},{key:"isHistoryModeNoTabs",value:function(t){return void 0!==t&&t.historyMode===e.Modes.noTabsMode}},{key:"isHistoryModeWithTabs",value:function(t){return void 0!==t&&t.historyMode===e.Modes.withTabsMode}},{key:"hasStateWithoutPageHistory",value:function(e,t){var n=t.componentStateManager.findOrBuildStateForPathId(e,t);return void 0!==n&&void 0===n.pageHistory}},{key:"getHistoryState",value:function(t,n){return e.getFullState(t,n).pageHistory}},{key:"initializeHistoryState",value:function(t,n,a){var r=e.getHistoryModeKey(t,n),i={historyMode:r};switch(r){case e.Modes.withTabsMode:i.history={currentTab:void 0,allTabs:[],withTabs:{}};break;case e.Modes.noTabsMode:i.history={noTabs:{}};break;case e.Modes.singlePageMode:i.history={page:void 0};break;default:console.error("Invalid mode type ".concat(r))}a.pageHistory=i}},{key:"getHistoryModeKey",value:function(t,n){return t?n?e.Modes.withTabsMode:e.Modes.noTabsMode:e.Modes.singlePageMode}},{key:"setHistoryState",value:function(t,n,a){var r=e.getFullState(n,a);r.pageHistory=t,e.setFullState(r,n,a)}},{key:"getFullState",value:function(e,t){return t.componentStateManager.findOrBuildStateForPathId(e,t)}},{key:"setFullState",value:function(e,t,n){return n.componentStateManager.registerStateByPathId(t,e,n)}}]),e}();ee.Modes={withTabsMode:"withTabs",noTabsMode:"noTabs",singlePageMode:"singlePage"};var te=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"addBookmark",value:function(t,n,a,r,i,o,s,c){var l=e.getBookmarkState(t,c),u=l.bookmarkEntries;void 0===u.find(function(e){return e.pageName===n})&&(u.push({pageName:n,pageUrl:a,pageTab:r,pageImage:i}),e.setBookmarkState(l,t,c),e.trace(o,"add",s,t,n,a,r,c))}},{key:"dropBookmark",value:function(t,n,a,r,i){var o=e.getBookmarkState(t,i),s=o.bookmarkEntries,c=s.findIndex(function(e){return e.pageName===n});if(-1!==c){var l=s[c];s.splice(c,1),e.setBookmarkState(o,t,i),e.trace(a,"drop",r,t,l.pageName,l.pageUrl,l.pageTab,i)}}},{key:"getBookmarks",value:function(t,n){return e.getBookmarkState(t,n).bookmarkEntries.map(function(e){return e})}},{key:"getBookmarkState",value:function(t,n){var a=e.getFullState(t,n);return void 0===a.bookmarkState&&e.initializeBookmarkState(a),a.bookmarkState}},{key:"initializeBookmarkState",value:function(e){e.bookmarkState={bookmarkEntries:[]}}},{key:"setBookmarkState",value:function(t,n,a){var r=e.getFullState(n,a);r.bookmarkState=t,e.setFullState(r,n,a)}},{key:"getFullState",value:function(e,t){return t.componentStateManager.findOrBuildStateForPathId(e,t)}},{key:"setFullState",value:function(e,t,n){return n.componentStateManager.registerStateByPathId(t,e,n)}},{key:"trace",value:function(e,t,n,a,r,i,o,s){var c=X.getUserDefPathForIndexPath(n,s),l=X.getUserDefPathForIndexPath(a,s);s.traceLogBuffer.reportEvent("Bookmark",new Date,{triggerType:e,triggerIndexPath:n,triggerUserDefIdPath:c,triggerUserDefId:q.getLastUserDefIdFromPath(c),operation:t,ownerIndexPath:a,ownerUserDefIdPath:l,ownerUserDefId:q.getLastUserDefIdFromPath(l),pageName:r,pageUrl:i,tab:o})}}]),e}(),ne=(n(380),function(e){var t=e.tabName,n=e.closeTab,a=e.isActive,r=e.onClick,i=e.icon,o=e.width,s=e.closable,c="webTab ".concat(a?"active":""),l={width:o};return v.a.createElement("div",{title:t,className:c,onClick:r,style:l},void 0===i?void 0:v.a.createElement("img",{src:i,alt:"",height:"100%",width:"auto"}),v.a.createElement("span",null,t),v.a.createElement("i",{className:s?"show":"hide",onClick:n}))});ne.defaultProps={icon:void 0};var ae=ne,re=(n(381),function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"getNextTopUpTab",value:function(e,t,n){var a=t[0],r=e.indexOf(a)-1,i=-1!==r?e[r]:void 0,o=t[t.length-1],s=e.indexOf(o)+1,c=0===s?void 0:e[s];return(n?i||c:c||i)||null}},{key:"isCurrentInFirstHalf",value:function(e,t){return e.indexOf(t)<e.length/2}},{key:"topUpTabs",value:function(e,t,n,a,r,i){var o=r+a;return t.splice(t.indexOf(n),1),e[i](n),o}},{key:"exceedsMaxTabsWidth",value:function(e,t){return e.reduce(function(e,t){return t.tabWidth+e},0)>t}},{key:"topUpDisplayTabs",value:function(t,n,a,r,i,o){for(var s=t.reduce(function(e,t){return e+i[t].width},0),c=e.isCurrentInFirstHalf(a,r);o>s&&n.length>0;){var l=e.getNextTopUpTab(a,t,c),u=l&&i[l].width;if(!(l&&-1!==n.indexOf(l)&&o>u+s))break;var d=a.indexOf(l)<a.indexOf(t[0])?"unshift":"push";s=e.topUpTabs(t,n,l,u,s,d)}return{displayTabs:t,hiddenTabs:n}}},{key:"buildDisplayTabs",value:function(t,n,a,r){var i,o,s=[],c=[],l=[],u=t.indexOf(n);t.reduce(function(e,t){var n=e+a[t].width;return l.push(n),n},0);var d=l[u];return e.isCurrentInFirstHalf(t,n)?(i=d-a[n].width,o=i+r):(o=d,i=d-r),l.forEach(function(e,n){e-a[t[n]].width<i||e>o?c.push(t[n]):s.push(t[n])}),{hiddenTabs:c,displayTabs:s}}}]),e}());re.showMoreButtonWidth=40,re.containerMarginWidth=10,re.buildTabDictionary=function(e,t){var n={};return e.forEach(function(e,a){n[e]={width:t[a].tabWidth,index:a}}),n},re.getAllTabsInfo=function(e,t,n){return e.map(function(e){return ee.getInfoForTab(e,t,n)})};var ie=n(88),oe=(n(382),function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(E.a)(this,Object(x.a)(t).call(this))).state={entries:[]},e.onMenuHide=function(){var t=e.props.runtime;t.replayStepMonitor.incrementReplayStep(),Z.dumpContextMenuTriggeredToTrace({},!1,t.traceLogBuffer,t.replayStepMonitor)},e.contextTrigger=v.a.createRef(),e}return Object(I.a)(t,e),Object(r.a)(t,[{key:"openMenuItemTree",value:function(e){var t=this,n=this.props.runtime;this.setState({entries:e.entries},function(){t.contextTrigger.current.handleContextClick(e.event)}),Z.dumpContextMenuTriggeredToTrace(e,!0,n.traceLogBuffer,n.replayStepMonitor)}},{key:"openMenuItemTreeWithDynamicConfig",value:function(e){e.event.persist();var n={event:e.event,entries:t.transformDynamicEntries(e.entries)};this.openMenuItemTree(n)}},{key:"handleItemClick",value:function(e,t){var n=this.props.runtime;e.action(t),Re.sendEvent(e.event,n)}},{key:"buildEntries",value:function(e){var t=this,n=this.props.runtime;return e.map(function(e,a){var r="".concat(e.type,"-").concat(e.label,"-").concat(a),i={title:e.mouseOver,style:{display:"flex",alignItems:"center",minHeight:"15px"}},o=e.icon?Y.getProperResourcePath(e.icon,n):null;switch(e.type){case"action":return v.a.createElement(ie.c,{key:r,onClick:function(n){return t.handleItemClick(e,n)},attributes:i,disabled:e.disabled},v.a.createElement(se,{disabled:e.disabled,imagePath:o,altText:"".concat(e.label,"-icon")}),e.label);case"separator":return v.a.createElement(ie.c,{key:r,divider:!0});case"submenu":return v.a.createElement(ie.d,{key:r,title:e.label,disabled:e.disabled},t.buildEntries(e.submenu));default:return null}})}},{key:"render",value:function(){var e=this.state.entries;return v.a.createElement("div",{className:"contextMenu ".concat(0===e.length?"hidden":"")},v.a.createElement(ie.b,{id:"contextMenu",ref:this.contextTrigger},v.a.createElement("div",null)),v.a.createElement(ie.a,{id:"contextMenu",onHide:this.onMenuHide},this.buildEntries(e)))}}],[{key:"buildTriggerBoundingRect",value:function(e){return("SPAN"===e.target.nodeName?e.target.parentNode:e.target).getBoundingClientRect()}},{key:"closeMenuItemTree",value:function(){Object(ie.e)()}},{key:"transformDynamicEntries",value:function(e){var n=[];return e.forEach(function(e){switch(e.type){case"dynamicItems":t.expandDynamicEntry(e).forEach(function(e){n.push(e)});break;case"submenu":var a={};Object.keys(e).forEach(function(t){a[t]=e[t]}),a.submenu=t.transformDynamicEntries(e.submenu),n.push(a);break;default:n.push(e)}}),n}},{key:"expandDynamicEntry",value:function(e){return e.provider(e.providerParam)}}]),t}(h.Component));function se(e){var t=e.imagePath,n=e.disabled,a=e.altText;if(!t)return null;var r={maxHeight:"100%",maxWidth:"100%",margin:"auto",opacity:n?.5:1};return v.a.createElement("div",{style:{width:"25px",height:"25px",marginRight:"5px",display:"flex",alignItems:"center"}},v.a.createElement("img",{src:t,style:r,alt:a}))}se.defaultProps={imagePath:""};var ce=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(E.a)(this,Object(x.a)(t).call(this))).closeTab=function(t,n){t.preventDefault(),t.stopPropagation();var a=e.props,r=a.parentPath,i=a.runtime,o=a.parentWidth;ee.closeTab(n,r,i);var s=o-re.containerMarginWidth,c=ee.getTab(r,i),l=ee.getAllTabs(r,i),u=re.getAllTabsInfo(l,r,i),d=re.buildTabDictionary(l,u);e.displayTabs.splice(e.displayTabs.indexOf(n),1),re.topUpDisplayTabs(e.displayTabs,e.hiddenTabs,l,c,d,s),e.triggerRendering()},e.switchTab=function(t,n){var a=e.props,r=a.parentPath,i=a.runtime;ee.getTab(r,i)!==n&&(ve.switchTab(r,n,t,i),e.triggerRendering())},e.switchHiddenTab=function(t,n){return function(t){e.switchTab(t,n)}},e.handleShowMoreTabs=function(t){var n=e.props,a=n.runtime,r=n.parentPath,i=oe.buildTriggerBoundingRect(t),o=e.hiddenTabs.map(function(n){return{type:"action",label:n,action:e.switchHiddenTab(t,n),disabled:!1,icon:ee.getImageForTab(n,r,a)}});t.clientX=i.left,t.clientY=i.bottom,a.contextMenu.openMenuItemTreeWithDynamicConfig({entries:o,event:t})},e.triggerRendering=function(){var t=e.props,n=t.parentPath,a=t.runtime;Q.triggerRendering(Object(O.a)(Object(O.a)(e))),Q.triggerRenderingViaPath(n,a)},e.getTabIconResource=function(t){var n=e.props,a=n.parentPath,r=n.runtime,i=ee.getImageForTab(t,a,r);return Y.getProperResourcePath(i,r)},e.renderTabs=function(t,n){var a=e.props,r=a.parentPath,i=a.runtime,o=ee.getAllTabs(r,i)[0];return n.map(function(n){var a=ee.getInfoForTab(n,r,i),s=a.tabWidth,c=a.closable;return n===o&&(c=!1),v.a.createElement(ae,{key:n,tabName:n,isActive:n===t,closeTab:function(t){return e.closeTab(t,n)},onClick:function(t){return e.switchTab(t,n)},icon:e.getTabIconResource(n),closable:c,width:s})})},e.displayTabs=[],e.hiddenTabs=[],e}return Object(I.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props,t=e.parentPath,n=e.runtime,a=e.parentWidth,r=ee.getTab(t,n),i=ee.getAllTabs(t,n),o=re.getAllTabsInfo(i,t,n),s=a-re.containerMarginWidth,c=re.exceedsMaxTabsWidth(o,s),l=re.buildTabDictionary(i,o);if(c){if(!this.displayTabs.includes(r)){var u=s-re.showMoreButtonWidth,d=re.buildDisplayTabs(i,r,l,u);this.displayTabs=d.displayTabs,this.hiddenTabs=d.hiddenTabs,re.topUpDisplayTabs(this.displayTabs,this.hiddenTabs,i,r,l,u)}}else this.displayTabs=i;return v.a.createElement("div",{className:"webtoolbar-wrap"},v.a.createElement("div",{className:"webtoolbar-inner"},v.a.createElement("div",{ref:this.tabContainerRef,className:"webtoolbar-tab-container"},this.renderTabs(r,this.displayTabs),v.a.createElement("div",{className:"webtoolbar-show-more"},v.a.createElement("i",{className:c?"show":"",onClick:this.handleShowMoreTabs})))))}}]),t}(h.Component),le=n(52),ue=n(329),de=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"handleKeyDown",value:function(t,n,a,r,i){var o=(t=t||window.event).keyCode||t.which,s=37,c=38,l=39,u=40;if(i){var d=a.row,g=a.column;if(t.ctrlKey)switch(o){case s:e.emitAutoFocusAndPreventDefault(n,r,d,g-1,t);break;case l:e.emitAutoFocusAndPreventDefault(n,r,d,g+1,t)}switch(o){case c:e.emitAutoFocusAndPreventDefault(n,r,d-1,g,t);break;case u:e.emitAutoFocusAndPreventDefault(n,r,d+1,g,t)}}}},{key:"emitAutoFocusAndPreventDefault",value:function(e,t,n,a,r){e.eventEmitter.emit("".concat(t,"-autoFocus"),n,a),r.preventDefault()}},{key:"handleCellFocus",value:function(e,t,n){n&&e.eventEmitter.emit("".concat(t,"-removeOldSelection"))}},{key:"isInt",value:function(e){return Number(e)===e&&e%1===0}},{key:"isFloat",value:function(e){return void 0!==(e=Number.parseFloat(e))&&!Number.isNaN(e)&&(Number(e)===e&&e%1!==0)}},{key:"buildTablePath",value:function(e){var t=j.dropIndexFromPageSegment(e);return j.dropIndexFromPageSegment(t)}},{key:"isFormula",value:function(e){return void 0!==e&&"="===e.slice(0,1)}},{key:"isOldSelected",value:function(e,t){var n=$.getStateAttributeByUserDefPath(G.extractSelectedCell,e,t),a=$.getStateAttributeByUserDefPath(G.extractOldSelectedCell,e,t);return n.row===a.row&&n.column===a.column}}]),e}(),ge=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).getSelectedIdFromState=function(){var e,t=n.props,a=t.runtime,r=t.path,i=t.config,o=a.componentStateManager;return i.items.forEach(function(t,n,i){var s=j.appendIndexToPageSegment(r,n),c=o.findOrBuildStateForPathId(s,a);pe.extractSelectedState(c,s,a)&&(void 0===e?e=parseInt(n,10):console.warn("Multiple selections in a combo box are not supported yet!"))}),e},n.setSelectedIdInState=function(e){var t=n.props,a=t.runtime,r=t.path,i=a.componentStateManager,o=$.getState(Object(O.a)(Object(O.a)(n))),s=G.extractSelectGroupControllerState(o),c=j.appendIndexToPageSegment(r,e),l=i.findOrBuildStateForPathId(c,a);void 0===s?(console.warn("Multiple select combo boxes are not supported yet!"),G.setSelected(l,!0),i.registerStateByPathId(c,l,a)):pe.delegateSetSelectedToController(!0,pe.comboBoxGroup(),r,c,l,!0,!1,a)},n.onChangeHandler=function(e){var a=n.props,r=a.runtime,i=a.config,o=a.path,s=a.isInEditMode,c=n.getSelectedIdFromState(),l=parseInt(n.hasVisibleItemCount()?e.value:e.target.value,10),u=i.items[c],d=i.items[l];n.updateStateAndTriggerRendering(l),s||Re.traceUserInteractionPerConfig(i,o,t.buildTraceDetailsAddOn(u,c,d,l),e,r),Re.sendStandardEvent(d,r);var g=Re.getDefaultLinkReceiver(Object(O.a)(Object(O.a)(n)));Re.doPageSwitch(d.link,r,g,o)},n.onClickHandler=function(e){var t=n.props,a=t.runtime,r=t.path;Re.doBasicOnClick(e,r,a),n.scrollCurrentOptionIntoViewIfVisibleItemCountOne()},n.onContextMenuHandler=function(e){n.scrollCurrentOptionIntoViewIfVisibleItemCountOne(),Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.onKeyDownHandler=function(e){var t=n.props,a=t.config,r=t.path,i=t.runtime,o=t.isInEditMode;de.handleKeyDown(e,i,a,de.buildTablePath(r),o)},n.onFocusHandler=function(){var e=n.props,t=e.path,a=e.runtime,r=e.isInEditMode;de.handleCellFocus(a,de.buildTablePath(t),r)},n.updateStateAndTriggerRendering=function(e){var t=n.props,a=t.runtime,r=t.config,i=t.path,o=t.isInEditMode,s=t.onBlur;if(n.setSelectedIdInState(e),o){var c=r.row,l=r.column;a.eventEmitter.emit("".concat(de.buildTablePath(i),"-contentUpdate"),r.items[e].text,c,l,!0),s()}Q.triggerRenderingViaPath(i,a)},n.checkForInvalidItems=function(){var e=n.props.config.items;return!Array.isArray(e)||Array.isArray(e)&&0===e.length},n.generateOptions=function(e){return e.map(function(e,t){return v.a.createElement("option",{key:t,value:t},e.text)})},n.generateOptionsForSelect=function(e){var t=[];return e.map(function(e,n){return t.push({value:n,label:e.text})}),t},n.focus=function(){n.comboRef.current.focus()},n.hasVisibleItemCount=function(){var e=n.props.config,t=e.visibleItemCount,a=e.items;return void 0!==t&&t>0&&t<a.length},n.scrollCurrentOptionIntoViewIfVisibleItemCountOne=function(){if(1===n.props.config.visibleItemCount)try{var e=n.getSelectedIdFromState(),t=Object(i.a)(document.querySelectorAll('[class^="css-"]')).filter(function(e){return"div"===e.localName}).find(function(e){return e.firstChild.className.includes("-menu")});if(t.firstChild.className.includes("-menu")){var a=t.firstChild.firstChild;a&&a.children[e].scrollIntoView()}}catch(r){console.log("Something went wrong on CBAComboBox",r)}},n.comboRef=v.a.createRef(),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this),this.props.isInEditMode&&this.focus()}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"render",value:function(){if(this.checkForInvalidItems())return v.a.createElement("div",null,"Invalid item configuration in combo box.");var e=this.props,t=e.config,n=e.path,a=e.runtime,r=e.orientation,i=e.onBlur,o=e.isInEditMode,s=t.visibleItemCount,c=t.position,l=Y.buildStyleByIndexPath(n,t,!1,r,a),u=$.getState(this),d=this.getSelectedIdFromState(),g=this.generateOptions(t.items);if(o&&Object.assign(l,{boxShadow:"inset rgb(79, 124, 177) 0px 0px 4px"}),this.hasVisibleItemCount()){g=this.generateOptionsForSelect(t.items);var f=s*c.height,p={menu:function(e){return Object(le.a)({},e,{marginTop:2})},menuList:function(e){return Object(le.a)({},e,{padding:0,width:l.width,backgroundColor:l.backgroundColor})},option:function(e,t){var n;return n=t.isSelected?"blue":t.isFocused?"grey":"inherit",Object(le.a)({},e,{width:"auto",height:l.height,padding:0,lineHeight:l.height,color:t.isSelected?"white":l.color,fontSize:l.fontSize,fontFamily:l.fontFamily,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",backgroundColor:n})},control:function(e,t){return Object(le.a)({},e,{backgroundColor:l.backgroundColor,minHeight:"auto",boxShadow:"rgb(79, 124, 177) 0px 0px 0px",borderColor:l.borderColor,borderWidth:l.borderWidth,borderRadius:l.borderRadius,borderStyle:l.borderStyle,height:l.height,cursor:l.cursor})},container:function(e,t){return Object(le.a)({},e,l,{borderWidth:"0px"})},valueContainer:function(e){return Object(le.a)({},e,{padding:"0 3px",height:"100%",position:"static"})},singleValue:function(e,t){return Object(le.a)({},e,{maxWidth:"calc(100% - 21px)",width:"100%",textAlign:l.textAlign,color:l.color})},indicatorsContainer:function(e){return Object(le.a)({},e,{height:"100%"})},dropdownIndicator:function(e){return Object(le.a)({},e,{color:"#808080",":hover":{color:"#000"},padding:0})},indicatorSeparator:function(e){return Object(le.a)({},e,{display:"none"})}};return v.a.createElement("div",{onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,className:"overflow-hidden"},v.a.createElement(ue.a,{styles:p,title:Y.buildTitle(t),value:g[d],isDisabled:G.extractDisabled(u),onChange:this.onChangeHandler,onBlur:function(e){return i(e,t.items[d].text,!0)},onKeyDown:this.onKeyDownHandler,onFocus:this.onFocusHandler,options:g,maxMenuHeight:f,menuPortalTarget:document.body,tabIndex:t.tabIndex,className:Y.getCssClassNamesValue(t,"CbaComboBox overflow-hidden")}))}return v.a.createElement("select",{ref:this.comboRef,style:l,"data-cba-id":t.pageEditId,title:Y.buildTitle(t),value:d,disabled:G.extractDisabled(u),onChange:this.onChangeHandler,onBlur:function(e){return i(e,t.items[d].text,!0)},onContextMenu:this.onContextMenuHandler,onKeyDown:this.onKeyDownHandler,onFocus:this.onFocusHandler,onClick:this.onClickHandler,tabIndex:t.tabIndex,className:Y.getCssClassNamesValue(t,"CbaComboBox")},g)}}],[{key:"getItemType",value:function(){return"ComboBoxItem"}},{key:"buildComboBoxItemsArray",value:function(e){return e.map(function(e,n,a){var r=z.deepCopy(e),i={};return G.setSelected(i,0===parseInt(n,10)),G.setDisabled(i,!1),G.setHidden(i,!1),r.state=i,{type:t.getItemType(),config:r}})}},{key:"buildTraceDetailsAddOn",value:function(e,t,n,a){return{oldSelected:t,oldSelectedUserDefId:e.userDefinedId,newSelected:a,newSelectedUserDefId:n.userDefinedId}}}]),t}(h.Component);ge.defaultProps={isInEditMode:!1,onBlur:function(){}};var fe=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"addPropagationGroupControllerState",value:function(e,t){var n=t.propagationGroups;if(void 0!==n){var a=n.map(function(e,t,n){return{name:e.name,memberIndexPaths:void 0===e.memberIndexPaths?[]:Object(i.a)(e.memberIndexPaths)}});G.setPropagationGroupControllerState(e,a)}}},{key:"applyToPropagationGroup",value:function(t,n,a,r){e.getMatchingPropagationGroups(t,n,r).forEach(function(n){e.applyActionToGroupMembers(t,n,a)})}},{key:"applySimpleSetter",value:function(t,n,a,r,i,o,s){if(void 0===n)$.updateStateAttributeByUserDefPath(a,r,i,t,s,!0);else{var c=X.getIndexPathForUserDefPath(t,s);e.applyToPropagationGroup(c,n,function(e){$.updateStateAttribute(a,r,i,e,s,o)},s)}}},{key:"getMatchingPropagationGroups",value:function(e,t,n){var a=n.componentStateManager.findOrBuildStateForPathId(e,n),r=G.extractPropagationGroupControllerState(a);return void 0===r?(console.log("Ignored request to propagate some action for a component that isn't a propagation-group controller: ".concat(e)),[]):r.filter(function(e){return e.name===t})}},{key:"applyActionToGroupMembers",value:function(e,t,n){t.memberIndexPaths.forEach(function(t){var a=j.appendPageSegmentsToPath(j.dropPageSegmentFromPath(e),t);n(a)})}}]),e}(),pe=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"extractSelectedState",value:function(t,n,a){var r=G.extractSelectGroupMemberInfo(t);if(void 0===r)return G.extractSelected(t);var i=G.extractSelectGroupControllerState(a.componentStateManager.findOrBuildStateForPathId(r.controllerPathId,a)),o=e.extractMatchingGroupState(i,r.groupName);return void 0!==o&&o.singleSelectActive?j.getLastPageSegmentFromPath(n)===o.currentlySelected:G.extractSelected(t)}},{key:"isSelectGroupMember",value:function(e){return void 0!==G.extractSelectGroupMemberInfo(e)}},{key:"isSingleSelectControlled",value:function(t,n){var a=G.extractSelectGroupMemberInfo(t);if(void 0===a)return!1;var r=G.extractSelectGroupControllerState(n.componentStateManager.findOrBuildStateForPathId(a.controllerPathId,n)),i=e.extractMatchingGroupState(r,a.groupName);return void 0!==i&&i.singleSelectActive}},{key:"setSelectedForPossiblyControlledComponent",value:function(t,n,a,r,i,o){var s=G.extractSelectGroupMemberInfo(a);if(void 0===s)e.doStandardSelectFlagSetting(t,n,a,o);else{var c=G.extractSelectGroupControllerState(o.componentStateManager.findOrBuildStateForPathId(s.controllerPathId,o)),l=e.extractMatchingGroupState(c,s.groupName);if(void 0!==l&&!l.selectionChangesBlocked)if(e.isSingleSelectControlled(a,o)){var u=s.controllerPathId,d=s.groupName;e.delegateSetSelectedToController(t,d,u,n,a,r,i,o)}else e.doStandardSelectFlagSetting(t,n,a,o)}}},{key:"delegateSetSelectedToController",value:function(t,n,a,r,i,o,s,c){var l=c.componentStateManager.findOrBuildStateForPathId(a,c);e.handleSelectedChildChanges(t,n,r,l,a,o,s,c),c.componentStateManager.registerStateByPathId(a,l,c),void 0!==r&&void 0!==i&&c.componentStateManager.registerStateByPathId(r,i,c),Q.triggerRenderingViaPath(a,c)}},{key:"doPageSwitchOrLetTheContainerDoIt",value:function(t,n){e.isSingleSelectControlled(n,t.props.runtime)||Re.doPageSwitchForComponent(t)}},{key:"addSelectGroupMemberInfo",value:function(t,n,a,r){var i=e.getSelectGroupMemberPerConfig(a,r);if(e.isControlledType(n)&&void 0!==i){var o=i.controllerPathId;if(void 0!==r.pageConfigurationsManager.findConfigurationForPageSegment(o).config.selectGroups){var s={controllerPathId:j.appendPageSegmentsToPath(j.dropPageSegmentFromPath(a),o),groupName:i.groupName,selectGroupMemberName:i.selectGroupMemberName};G.setSelectGroupMemberInfo(t,s)}}else if(e.isComboBoxItem(n)){var c=j.getLastPageSegmentFromPath(a),l=j.dropIndexFromPageSegment(c),u={controllerPathId:j.appendPageSegmentsToPath(j.dropPageSegmentFromPath(a),l),groupName:e.comboBoxGroup()};G.setSelectGroupMemberInfo(t,u)}}},{key:"addSelectGroupControllerState",value:function(t,n,a,r){var i=r.selectGroups;if(void 0!==i){var o=i.map(function(e,t,n){return{name:e.name,selectionChangesBlocked:e.blockSelectionChanges,singleSelectActive:e.enforceSingleSelect,currentlySelected:e.initiallySelected,allowDeselect:e.allowDeselect,deselectTarget:e.deselectTarget}});G.setSelectGroupControllerState(t,o)}else if(e.isComboBox(n)){var s=void 0===r.selectedEntry?0:r.selectedEntry,c=j.appendIndexToPageSegment(j.getLastPageSegmentFromPath(a),s),l=[{name:e.comboBoxGroup(),selectionChangesBlocked:!1,singleSelectActive:!0,currentlySelected:c,allowDeselect:!0,deselectTarget:c}];G.setSelectGroupControllerState(t,l)}}},{key:"setSelectionChangesBlockedForController",value:function(t,n,a,r){e.setStateAttributeForControllerByUserDefPath(t,n,function(e){e.selectionChangesBlocked=a},r)}},{key:"setSingleSelectActiveForController",value:function(t,n,a,r){e.setStateAttributeForControllerByUserDefPath(t,n,function(e){e.singleSelectActive=a},r)}},{key:"setAllowDeselectForController",value:function(t,n,a,r){e.setStateAttributeForControllerByUserDefPath(t,n,function(e){e.allowDeselect=a},r)}},{key:"getComboboxSelectedItem",value:function(t,n){var a=n.pageConfigurationsManager.findConfigurationForPageSegment(j.getLastPageSegmentFromPath(t)).config.items,r="";return a.forEach(function(a,i){var o=j.appendIndexToPageSegment(t,i),s=n.componentStateManager.findOrBuildStateForPathId(o,n);if(e.extractSelectedState(s,o,n)){var c=X.getUserDefPathForIndexPath(o,n);r=q.getLastUserDefIdFromPath(c)}}),r}},{key:"getListSelectedItems",value:function(e,t){var n=t.componentStateManager.findOrBuildStateForPathId(e,t),a=G.extractSelectedIds(n)||[],r=[];return a.forEach(function(n){var a=j.appendIndexToPageSegment(e,n),i=X.getUserDefPathForIndexPath(a,t);r.push(q.getLastUserDefIdFromPath(i))}),r.join(",")}},{key:"getNonSelectGroupSelectedChildren",value:function(t,n){var a=n.pageConfigurationsManager,r=[],i=a.findConfigurationForPageSegment(j.getLastPageSegmentFromPath(t)).config.cbaChildren;return void 0!==i&&i.forEach(function(a,i){var o=j.appendIndexToPageSegment(t,i),s=e.getSelectionIdentificationWhenSelected(o,n);""===s||r.includes(s)||r.push(s)}),r.join(",")}},{key:"getSelectGroupSelectedChildren",value:function(t,n,a){var r=[];return fe.getMatchingPropagationGroups(t,n,a).forEach(function(n){n.memberIndexPaths.forEach(function(n){var i=j.appendPageSegmentsToPath(j.dropPageSegmentFromPath(t),n),o=e.getSelectionIdentificationWhenSelected(i,a);""===o||r.includes(o)||r.push(o)})}),r.join(",")}},{key:"getSelectionIdentificationWhenSelected",value:function(t,n){var a=n.componentStateManager.findOrBuildStateForPathId(t,n);if(e.extractSelectedState(a,t,n)){if(e.isSelectGroupMember(a)){var r=e.getSelectGroupMemberPerConfig(t,n),i=d.withDefault(r.selectGroupMemberName,"");if(""!==i)return i}return q.getLastUserDefIdFromPath(X.getUserDefPathForIndexPath(t,n))}return""}},{key:"extractMatchingGroupState",value:function(e,t){var n=e.filter(function(e){return e.name===t});return n.length>0?n[0]:void 0}},{key:"setStateAttributeForControllerByUserDefPath",value:function(t,n,a,r){var i=X.getIndexPathForUserDefPath(t,r);e.setStateAttributeForControllerByIndexPath(i,n,a,r)}},{key:"setStateAttributeForControllerByIndexPath",value:function(t,n,a,r){var i=r.componentStateManager,o=i.findOrBuildStateForPathId(t,r),s=G.extractSelectGroupControllerState(o);if(void 0!==s){var c=e.extractMatchingGroupState(s,n),l=c.singleSelectActive,u=c.currentlySelected;a(c);var d=c.singleSelectActive;d!==l&&(!1===d?e.applyToMembers(t,function(e,t){G.setSelected(e,u===t)},r):(c.currentlySelected=void 0,e.applyToMembers(t,function(e,t){G.setSelected(e,!1)},r))),i.registerStateByPathId(t,o,r)}else console.log("Ignored request to set controller mode for a component that isn't a select-group controller: ".concat(t))}},{key:"applyToMembers",value:function(e,t,n){var a=n.componentStateManager;$.findIndexPathsOfDescendants(e,n).forEach(function(r){var i=j.getLastPageSegmentFromPath(r);if(void 0!==n.pageConfigurationsManager.findConfigurationForPageSegment(i,!0)){var o=a.findOrBuildStateForPathId(r,n),s=G.extractSelectGroupMemberInfo(o);void 0!==s&&s.controllerPathId===e&&(t(o,i),a.registerStateByPathId(r,o,n))}})}},{key:"handleSelectedChildChanges",value:function(t,n,a,r,i,o,s,c){var l=G.extractSelectGroupControllerState(r),u=e.extractMatchingGroupState(l,n),d=e.calculateNewSelectedIndex(t,u,j.getLastPageSegmentFromPath(a),s);!1===d.noChange&&(u.currentlySelected=d.newMember,G.setSelectGroupControllerState(r,l)),void 0!==u.currentlySelected&&o&&e.doPageSwitchForSelectedSwitcher(i,u.currentlySelected,c)}},{key:"calculateNewSelectedIndex",value:function(e,t,n,a){if(!0===e)return t.currentlySelected===n?{noChange:!0}:{noChange:!1,newMember:n};if(t.currentlySelected!==n)return{noChange:!0};var r=t.allowDeselect,i=t.deselectTarget;return r||a?void 0!==i?i===n?{noChange:!0}:{noChange:!1,newMember:i}:{noChange:!1,newMember:void 0}:{noChange:!0}}},{key:"doPageSwitchForSelectedSwitcher",value:function(e,t,n){if(void 0!==t){var a=j.appendPageSegmentsToPath(j.dropPageSegmentFromPath(e),t),r=n.componentStateManager.findOrBuildStateForPathId(a,n),i=G.extractDefaultLinkReceiver(r),o=n.pageConfigurationsManager.findConfigurationForPageSegment(t);Re.doPageSwitch(o.config.link,n,i,e)}}},{key:"doStandardSelectFlagSetting",value:function(e,t,n,a){G.setSelected(n,e),a.componentStateManager.registerStateByPathId(t,n,a),Q.triggerRenderingViaPath(t,a)}},{key:"isControlledType",value:function(e){return"CbaRadioButton"===e||"CbaCheckbox"===e||"CbaButton"===e||"CbaLink"===e||"CbaRichTextField"===e||"CbaPolygon"===e||"CbaRegionMap"===e}},{key:"isComboBoxItem",value:function(e){return e===ge.getItemType()}},{key:"isComboBox",value:function(e){return"CbaComboBox"===e}},{key:"comboBoxGroup",value:function(){return"comboGroup"}},{key:"getSelectGroupMemberPerConfig",value:function(e,t){var n=j.getLastPageSegmentFromPath(e);return t.pageConfigurationsManager.findConfigurationForPageSegment(n).config.selectGroupMember}}]),e}();function he(e){var t,n=e.onClick,a=e.onContextMenu,r=e.orientation,i=e.embeddedPageName,o=e.hasTabs,s=e.tabsBar,c=e.position,l=e.config,u=e.scrollableAreaRef,d=e.path,g=e.runtime,f=g.pageConfigurationsManager.findPage(i);if(void 0===f)return v.a.createElement("div",{style:Y.buildStyleByState(c,l,!1,r,!1,g)},"Cannot find page with name ".concat(i));if(function(e){return j.getPageSegmentArray(e).length>=15}(d))return v.a.createElement("div",{style:Y.buildStyleByState(c,l,!1,r,!1,g)},"Page nesting exceeds maximum nesting depth.");var p=(t={position:"absolute"},Object(N.a)(t,r,0),Object(N.a)(t,"top",o?30:0),Object(N.a)(t,"width","100%"),Object(N.a)(t,"height","100%"),Object(N.a)(t,"overflow","auto"),t),h=j.appendPageSegmentsToPath(d,j.buildPageSegment(i));return v.a.createElement("div",{onClick:n,onContextMenu:a,title:Y.buildTitle(l),style:Y.buildStyleByState(c,l,!1,r,!1,g),"data-cba-id":l.pageEditId,role:"presentation",className:Y.getCssClassNamesValue(l)},o&&s,v.a.createElement("div",{style:p,onScroll:Re.traceUserScroll(h,g),ref:u},v.a.createElement(gn,{config:f.content,path:h,runtime:g,orientation:r})))}var ve=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.onClickHandler=n.onClickHandler.bind(Object(O.a)(Object(O.a)(n))),n.scrollableAreaRef=v.a.createRef(),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"onClickHandler",value:function(e){Re.doStandardOnClick(e,void 0,this)}},{key:"scroll",value:function(e,t){var n=this.scrollableAreaRef.current;n&&d.doScrollOnHTMLElement(e,t,n,n)}},{key:"render",value:function(){var e=this.props,n=e.config,a=e.runtime,r=e.path,i=e.orientation,o=t.getEmbeddedPageName(r,n,a),s=$.getState(this),c={};G.setPosition(c,G.extractPosition(s));var l="withTabs"===n.historyMode;return v.a.createElement(he,{onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,orientation:i,embeddedPageName:o,hasTabs:l,tabsBar:v.a.createElement(ce,{parentPath:r,runtime:a,parentWidth:n.position.width}),path:r,position:c,config:n,scrollableAreaRef:this.scrollableAreaRef,runtime:a})}}],[{key:"addAttributesToInitialState",value:function(e,t){var n=t.historyMode,a=t.page;e.pageName=a,ee.initializeHistoryState("singlePage"!==n,"withTabs"===n,e)}},{key:"setPageName",value:function(e,n,a,r,i){if(ee.hasStateWithoutPageHistory(e,i))console.warn("Set page name call for a component that is not a CbaPageArea: ".concat(e));else{var o=j.getLastPageSegmentFromPath(e),s=i.pageConfigurationsManager.findConfigurationForPageSegment(o).config,c=ee.getPage(e,i);if(void 0===c||c.name!==a){var l=t.getSafeReceiverTabDetails(n);ee.addPage(a,r,l,e,i),t.updatePageIndicators(e,s,a,i),t.updatePageHistoryDependents(e,s,i)}}}},{key:"buildIndicatorIndexPath",value:function(e,t){return j.appendPageSegmentsToPath(e,t.indicatorPath)}},{key:"getSafeReceiverTabDetails",value:function(e){return void 0===e?{name:"",image:void 0,width:100,closable:!0}:{name:void 0===e.name?"":e.name,width:void 0===e.width?100:e.width,image:e.image,closable:!!e.closable}}},{key:"isIndicatorNotHidden",value:function(e,n,a){var r=t.buildIndicatorIndexPath(n,e),i=a.componentStateManager.findOrBuildStateForPathId(r,a);return!1===G.extractHidden(i)}},{key:"findPreferredIndicator",value:function(e,n,a,r){if(void 0!==n){var i=n.filter(function(t){return t.pageName===e});if(0!==i.length){if(1===i.length)return i[0];var o=i.find(function(e){return t.isIndicatorNotHidden(e,a,r)});return void 0===o?i[0]:o}}}},{key:"updatePageIndicators",value:function(e,n,a,r){var i=n.currentPageIndicators,o=j.dropPageSegmentFromPath(e),s=t.findPreferredIndicator(a,i,o,r);if(void 0!==s){var c=t.buildIndicatorIndexPath(o,s),l=r.componentStateManager.findOrBuildStateForPathId(c,r);pe.setSelectedForPossiblyControlledComponent(!0,c,l,!1,!1,r)}}},{key:"doHistoryMove",value:function(e,n,a){if(ee.hasStateWithoutPageHistory(e,a))console.warn("Do history move call for a component that is not a CbaPageArea: ".concat(e));else{var r=j.getLastPageSegmentFromPath(e),i=a.pageConfigurationsManager.findConfigurationForPageSegment(r).config,o=X.getUserDefPathForIndexPath(e,a);switch(n){case"home":ee.goHome(e,a),t.updatePageHistoryDependents(e,i,a);break;case"forward":ee.goForward(e,a),t.updatePageHistoryDependents(e,i,a);break;case"back":ee.goBack(e,a),t.updatePageHistoryDependents(e,i,a);break;default:console.warn("Unknown type of history move : ".concat(n," for component path ").concat(e))}a.traceLogBuffer.reportEvent("PageSwitchEmbedded",new Date,{indexPath:e,userDefIdPath:o,userDefId:q.getLastUserDefIdFromPath(o),newPageName:ee.getPage(e,a).name,tab:ee.getTab(e,a),historyMove:n})}}},{key:"historyMoveEnabled",value:function(e,t,n){if(ee.hasStateWithoutPageHistory(e,n))return console.warn("Enabled history move inquiry for a component that is not a CbaPageArea: ".concat(e)),!1;switch(t){case"home":return!0;case"forward":return ee.canGoForward(e,n);case"back":return ee.canGoBack(e,n);default:return console.warn("Unknown type of history move : ".concat(t," for component path ").concat(e)),!1}}},{key:"switchTab",value:function(e,n,a,r){var i=j.getLastPageSegmentFromPath(e),o=r.pageConfigurationsManager.findConfigurationForPageSegment(i).config;a.stopPropagation(),ee.switchTab(n,e,r),t.updatePageHistoryDependents(e,o,r),Re.traceUserInteraction("BrowserTab",e,{page:ee.getPage(e,r).name,tab:ee.getTab(e,r)},a,null,r)}},{key:"updatePageHistoryDependents",value:function(e,t,n){var a=t.forwardSwitchers,r=t.backwardSwitchers,i=t.locationDisplays,o=j.dropPageSegmentFromPath(e);if(void 0!==a){var s=ee.canGoForward(e,n);a.forEach(function(e){var t=j.appendPageSegmentsToPath(o,e);$.updateStateAttribute(G.extractDisabled,G.setDisabled,!s,t,n,!0)})}if(void 0!==r){var c=ee.canGoBack(e,n);r.forEach(function(e){var t=j.appendPageSegmentsToPath(o,e);$.updateStateAttribute(G.extractDisabled,G.setDisabled,!c,t,n,!0)})}if(void 0!==i){var l=ee.getPage(e,n),u=d.getPropUndefinedSafe(l,"url","");i.forEach(function(e){var t=j.appendPageSegmentsToPath(o,e);$.updateStateAttribute(G.extractTextValue,G.setTextValue,u,t,n,!0)})}}},{key:"addBookmark",value:function(e,n,a,r){var i=j.getLastPageSegmentFromPath(e),o=r.pageConfigurationsManager.findConfigurationForPageSegment(i).config,s=t.getEmbeddedPageEntry(e,o,r);if(void 0!==s){var c=ee.getTab(e,r);te.addBookmark(e,s.name,s.url,c,s.image,n,a,r)}}},{key:"dropBookmark",value:function(e,t,n,a,r){te.dropBookmark(e,t,n,a,r)}},{key:"getBookmarks",value:function(e,t){return te.getBookmarks(e,t)}},{key:"getEmbeddedPageName",value:function(e,n,a){var r=t.getEmbeddedPageEntry(e,n,a);return void 0===r?void 0:r.name}},{key:"getEmbeddedPageEntry",value:function(e,n,a){if(void 0!==n.historyMode){var r=ee.getPage(e,a);if(void 0===r){var i=n.page,o=n.pageUrl,s=t.getSafeReceiverTabDetails(n.initialTab);ee.addPage(i,o,s,e,a),r=ee.getPage(e,a)}return r}console.error("Invalid config structure for CbaPageArea: ".concat(e),n)}}]),t}(h.Component);function me(e,t,n){var a=function(e){var t=new Map;return e.forEach(function(e){var n=t.get(e.class),a=void 0===n?1:n+1;t.set(e.class,a)}),t}(t);return n||0===t.length?"":v.a.createElement("div",null,e,v.a.createElement("table",{className:"details"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",null,"!"),v.a.createElement("th",null,"Name"),v.a.createElement("th",null,"Weight"),v.a.createElement("th",null,"Class"),v.a.createElement("th",null,"Result text"))),v.a.createElement("tbody",null,t.map(function(e,t){var n,r=a.get(e.class)>1;return v.a.createElement("tr",{key:e.name,style:(n=r,n?{color:"red"}:{})},v.a.createElement("td",{className:"cbaColWidth05"},r?"!":""),v.a.createElement("td",{className:"cbaColWidth25"},e.name),v.a.createElement("td",{className:"cbaColWidth05"},e.weight),v.a.createElement("td",{className:"cbaColWidth30"},e.class),v.a.createElement("td",{className:"cbaColWidth35"},e.resultText))}))),v.a.createElement("br",null))}function ye(e,t,n){return(a=e,a.sort(function(e,t){return function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}(e,t)})).map(function(e,a){return v.a.createElement("tr",{key:e.name},v.a.createElement("td",{className:"cbaColWidth25"},e.name),v.a.createElement("td",{className:n?"cbaColWidth30":"cbaColWidth05"},e.value),!n&&v.a.createElement("td",{className:"cbaColWidth05"},void 0===(r=e.result)?"":r?"true":"false"),n&&v.a.createElement("td",{className:"cbaColWidth30"},function(e,t){console.log("hitMissName is ".concat(e,", hitMissResultsList contains names ").concat(t.map(function(e){return e.name}).join()));var n=t.find(function(t){return t.name===e});return void 0===n?"":n.resultText}(e.value,t)),v.a.createElement("td",{className:"cbaColWidth30"},e.comment));var r});var a}function be(e,t,n,a){return 0===t.length?"":v.a.createElement("div",null,"".concat(e," (").concat(a?"first active member":"accumulated weights","):"),v.a.createElement("table",{className:"details"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",null,"Name"),v.a.createElement("th",null,a?"First Active":"Weight"),v.a.createElement("th",null,a?"Result Text":"Result"),v.a.createElement("th",null,"Comment"))),v.a.createElement("tbody",null,ye(t,n,a))),v.a.createElement("br",null))}var ke=function(e){var t=e.currentModalContent,n="firstActive"===t.classScoringModeHit,a="firstActive"===t.classScoringModeMiss;return v.a.createElement("div",{className:"cba-modal-content"},v.a.createElement("table",{className:"summary"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",null,"Score result:"),v.a.createElement("td",null,t.result?"true":"false"),v.a.createElement("th",null,"Execution Time:"),v.a.createElement("td",null,t.execTime),v.a.createElement("th",null,"Total hits/Total Weight:"),v.a.createElement("td",null,"".concat(t.nbHits,"/").concat(t.hitWeight)))),v.a.createElement("tbody",null,v.a.createElement("tr",null,v.a.createElement("th",null,"Credit Class:"),v.a.createElement("td",null,t.creditClass),v.a.createElement("th",null,"Reaction Time:"),v.a.createElement("td",null,t.reactionTime),v.a.createElement("th",null,"Total misses/Total Weight:"),v.a.createElement("td",null,"".concat(t.nbMisses,"/").concat(t.missWeight))),v.a.createElement("tr",null,v.a.createElement("th",null,"Credit Weight:"),v.a.createElement("td",null,t.creditWeight),v.a.createElement("th",null,"Nb. of Interactions:"),v.a.createElement("td",null,t.nbInteractions)),v.a.createElement("tr",null,v.a.createElement("th",null,"Result text:"),v.a.createElement("td",null,t.resultText),v.a.createElement("th",null),v.a.createElement("td",null)))),v.a.createElement("br",null),v.a.createElement("div",{className:"detailsWrapper"},me("Hits:",t.hitRows,n),me("Misses:",t.missRows,a),be("Hit Classes",t.hitClassRows,t.hitRows,n),be("Miss Classes",t.missClassRows,t.missRows,a)))},Se=function(e){var t=e.currentModalContent;return v.a.createElement("div",{className:"cba-modal-content"},v.a.createElement("div",{className:"detailsWrapper"},v.a.createElement("table",{className:"details"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",null,"Variable Name"),v.a.createElement("th",null,"Current Value"))),v.a.createElement("tbody",null,t.variables.map(function(e){return v.a.createElement("tr",{key:e.name},v.a.createElement("td",null,e.name),v.a.createElement("td",null,e.value))}))),v.a.createElement("p",null),v.a.createElement("table",{className:"details"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",null,"Current State Name"))),v.a.createElement("tbody",null,t.states.map(function(e){return v.a.createElement("tr",{key:e},v.a.createElement("td",null,e))}))),v.a.createElement("p",null),v.a.createElement("table",{className:"details"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",null,"Visited State Name"))),v.a.createElement("tbody",null,t.visitedStates.map(function(e){return v.a.createElement("tr",{key:e},v.a.createElement("td",null,e))}))),v.a.createElement("p",null),v.a.createElement("table",{className:"details"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",null,"Raised Event Name"))),v.a.createElement("tbody",null,t.raisedEvents.map(function(e){return v.a.createElement("tr",{key:e},v.a.createElement("td",null,e))})))))},Ce=function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).truncateTraceLog=function(){n.props.currentModalContent.popEntries(),n.updateTraceLogState()},n.updateTraceLogState=function(){var e=n.props.currentModalContent;n.setState({tracingDetails:e.peekEntries()})};var r=n.props.currentModalContent;return n.state={tracingDetails:r.peekEntries()},n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.state.tracingDetails;return v.a.createElement("div",{className:"cba-modal-content"},"Tracing data not transferred to server yet:",v.a.createElement("div",{className:"detailsWrapper"},v.a.createElement("table",{className:"details"},v.a.createElement("thead",null),v.a.createElement("tbody",null,Object(i.a)(e).map(function(e){return v.a.createElement("tr",{key:"".concat(e.entryId," - ").concat(e.timestamp)},v.a.createElement("td",null,e.entryId),v.a.createElement("td",null,e.timestamp),v.a.createElement("td",null,e.type),Object.keys(e.details).map(function(n,a){return v.a.createElement("td",{key:n},"".concat(n,":").concat(t.dumpAsStringAndTruncate(e.details[n])))}))})))),v.a.createElement("div",{className:"cba-trace-modal-buttons"},v.a.createElement("button",{type:"button",onClick:this.truncateTraceLog}," Truncate Log "),v.a.createElement("button",{type:"button",onClick:this.updateTraceLogState}," Refresh ")))}}],[{key:"dumpAsStringAndTruncate",value:function(e){var t=JSON.stringify(e);return t.length>1e3?"".concat(t.substring(0,1e3),"..."):t}}]),t}(h.Component),Te=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).okButtonClicked=function(){var e=n.props.content,t=e.pageAreaIndexPath,a=e.requestingComponentPath,r=e.testPresenter,i=e.runtime;console.info("delete called for bookmarks ".concat(n.toBeDeleted.join())),n.toBeDeleted.forEach(function(e){ve.dropBookmark(t,e,"contextMenu",a,i)}),r.handleClose()},n.cancelButtonClicked=function(){n.props.content.testPresenter.handleClose()},n.setBookmarkAsToBeDeleted=function(e){n.toBeDeleted.push(e)},n.toBeDeleted=[],n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props.content,t=e.pageAreaIndexPath,n=e.labelConfiguration,a=e.runtime,r=n.deleteColumnHeader,i=n.bookmarkColumnHeader,o=n.okButton,s=n.cancelButton,c=ve.getBookmarks(t,a),l=this.toBeDeleted;return v.a.createElement("div",{className:"cba-modal-content",style:{fontSize:"12px"}},v.a.createElement("div",{className:"detailsWrapper"},v.a.createElement("table",{className:"details"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",{className:"cbaColWidth15"},r),v.a.createElement("th",{className:"cbaColWidth85"},i))),v.a.createElement("tbody",null,c.map(function(e){return v.a.createElement("tr",{key:e.pageName},v.a.createElement("td",{className:"cbaColWidth15"},v.a.createElement("input",{id:e.pageName,type:"checkbox",onChange:function(){return l.push(e.pageName)}})),v.a.createElement("td",{className:"cbaColWidth85"},e.pageUrl?e.pageUrl:""))})))),v.a.createElement("div",{className:"cba-bookmarks-modal-buttons"},v.a.createElement("button",{type:"button",onClick:this.okButtonClicked},o),v.a.createElement("button",{type:"button",onClick:this.cancelButtonClicked},s)))}}]),t}(h.Component),Pe=n(143),Ee=n.n(Pe),xe=function(e){var t={x:window.innerWidth/2-300,y:window.innerHeight/2-250},n=e.isOpen,a=e.currentModal,r=e.currentModalTitle,i=e.closeDialog;return v.a.createElement("div",{className:"cba-modal-container cba-modal cba-system-modal"},n&&v.a.createElement(Ee.a,{title:r,modal:!0,isResizable:!0,isDraggable:!0,hasCloseIcon:!0,closeOnEscape:!0,width:600,height:500,position:t,onClose:i},v.a.createElement(Ie,Object.assign({currentModal:a},e))))},Ie=function(e){var t=e.currentModalContent;switch(e.currentModal){case"Scoring":return v.a.createElement(ke,e);case"Tracing":return v.a.createElement(Ce,e);case"State Machine":return v.a.createElement(Se,e);case"ManageBookmarks":return v.a.createElement(Te,{content:t});default:return null}},Oe=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"cut",value:function(e,t,n){n.clipboardManager.cut(e,t,n)}},{key:"cutEnabled",value:function(e){return e.clipboardManager.cutEnabled()}},{key:"copy",value:function(e,t,n){n.clipboardManager.copy(e,t,n)}},{key:"copyEnabled",value:function(e){return e.clipboardManager.copyEnabled()}},{key:"paste",value:function(e,t,n){n.clipboardManager.paste(e,t,n)}},{key:"pasteEnabled",value:function(e){return e.clipboardManager.pasteEnabled()}},{key:"nextTask",value:function(e){e.taskManager.switchTaskNext()}},{key:"nextTaskEnabled",value:function(e){return e.taskManager.nextTaskAvailable()}},{key:"backTask",value:function(e){e.taskManager.switchTaskPrevious()}},{key:"backTaskEnabled",value:function(e){return e.taskManager.previousTaskAvailable()}},{key:"cancelTask",value:function(e){e.taskManager.cancelTask()}},{key:"startFullscreen",value:function(e){e.pageEventsObserver.handleFullScreen(!0),d.openFullScreen(document.documentElement)}},{key:"stopFullscreen",value:function(e){e.pageEventsObserver.handleFullScreen(!1),d.closeFullScreen()}},{key:"close",value:function(e,t){var n=j.getPageAreaTypeFromPath(e);if("main"!==n){var a={pageAreaName:j.getPageAreaNameFromPath(e),type:n};t.dialogPresenter.closeDialog(a)}else console.log("Cannot close a non-dialog page area.",e)}},{key:"back",value:function(t,n,a){e.doHistoryMoveOnAncestor(t,"back",n,a)}},{key:"backEnabled",value:function(t,n,a){return e.historyMoveEnabled(t,"back",n,a)}},{key:"forward",value:function(t,n,a){e.doHistoryMoveOnAncestor(t,"forward",n,a)}},{key:"forwardEnabled",value:function(t,n,a){return e.historyMoveEnabled(t,"forward",n,a)}},{key:"home",value:function(t,n,a){e.doHistoryMoveOnAncestor(t,"home",n,a)}},{key:"addBookmark",value:function(t,n,a,r){var i=e.getPageAreaPath(n,a.receiverPath);void 0!==i?ve.addBookmark(i,t,n,r):console.log("Cannot add bookmark: No receiving page area found. Receiver path in action: ".concat(a.receiverPath,", requesting component path: ").concat(n))}},{key:"manageBookmark",value:function(t,n,a,r){var i=e.getPageAreaPath(n,a.receiverPath),o=X.getUserDefPathForIndexPath(n,r),s=X.getUserDefPathForIndexPath(i,r);if(void 0!==i){var c={pageAreaIndexPath:i,requestingComponentPath:n,runtime:r,labelConfiguration:a,testPresenter:r.testPresenter};r.testPresenter.openDialog("ManageBookmarks",a.windowTitle,c),r.traceLogBuffer.reportEvent("Bookmark",new Date,{triggerType:t,triggerIndexPath:n,triggerUserDefIdPath:o,triggerUserDefId:q.getLastUserDefIdFromPath(o),operation:"manage",ownerIndexPath:i,ownerUserDefIdPath:s,ownerUserDefId:q.getLastUserDefIdFromPath(s)})}else console.log("Cannot open manage bookmark dialog: No receiving page area found. Receiver path in action: ".concat(a.receiverPath,", requesting component path: ").concat(n))}},{key:"incrementScale",value:function(t,n,a,r){var i=e.buildScaleValueInput(t,n);r.eventEmitter.emit("".concat(i,"-incrementScale"),a)}},{key:"doHistoryMoveOnAncestor",value:function(t,n,a,r){var i=e.getPageAreaPath(t,a.receiverPath);void 0!==i?r.taskManager.doHistoryMove(i,n):console.log("Cannot switch ".concat(n," in page history: No receiving page area found. Receiver path in action: ").concat(a.receiverPath,", requesting component path: ").concat(t))}},{key:"historyMoveEnabled",value:function(t,n,a,r){var i=e.getPageAreaPath(t,a.receiverPath);return void 0!==i&&ve.historyMoveEnabled(i,n,r)}},{key:"getPageAreaPath",value:function(e,t){return void 0===t?j.findPageAreaAncestorPath(e):j.appendPageSegmentsToPath(j.dropPageSegmentFromPath(e),t)}},{key:"buildScaleValueInput",value:function(e,t){var n=j.dropPageSegmentFromPath(e);return j.appendPageSegmentsToPath(n,t)}}]),e}(),Me=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"buildMenuTreeItemConfiguration",value:function(t,n,a,r,i){return{entries:e.transformEntries(t.entries,a,r,i),event:n}}},{key:"transformEntries",value:function(t,n,a,r){var i=[];return t.forEach(function(t,o){i.push(e.transformEntry(t,n,a,r))}),i}},{key:"transformEntry",value:function(t,n,a,r){switch(t.type){case"separator":return e.transformSeparatorEntry(t);case"submenu":return e.transformSubmenuEntry(t,n,a,r);case"action":return e.transformActionEntry(t,n,r);case"link":return e.transformLinkEntry(t,n,a,r);case"provided":return e.transformProvidedEntry(t,n,r);default:return console.error("Invalid context menu configuration entry type: ".concat(t.type),t),{type:"separator"}}}},{key:"transformSeparatorEntry",value:function(e){return{type:"separator"}}},{key:"transformSubmenuEntry",value:function(t,n,a,r){return{type:"submenu",label:t.label,icon:t.icon,disabled:!1,submenu:e.transformEntries(t.submenu,n,a,r)}}},{key:"transformActionEntry",value:function(t,n,a){return{type:"action",label:t.label,mouseOver:t.mouseOver,icon:t.icon,event:t.event,action:e.buildActionMethod(t.action,t.actionParam,n,a),disabled:e.isActionDisabled(t.action,t.actionParam,n,a,t.event)}}},{key:"buildActionMethod",value:function(e,t,n,a){switch(e){case"cut":return function(){Oe.cut("contextMenu",n,a)};case"copy":return function(){Oe.copy("contextMenu",n,a)};case"paste":return function(){Oe.paste("contextMenu",n,a)};case"next_task":return function(){Oe.nextTask(a)};case"back_task":return function(){Oe.backTask(a)};case"cancel_task":return function(){Oe.cancelTask(a)};case"startFullscreen":return function(){Oe.startFullscreen(a)};case"stopFullscreen":return function(){Oe.stopFullscreen(a)};case"close":return function(){Oe.close(n,a)};case"back":return function(){Oe.back(n,t,a)};case"forward":return function(){Oe.forward(n,t,a)};case"home":return function(){Oe.home(n,t,a)};case"addBookmark":return function(){Oe.addBookmark("contextMenu",n,t,a)};case"manageBookmark":return function(){Oe.manageBookmark("contextMenu",n,t,a)};case"none":return function(){console.log("Menu button without action activated: ".concat(n))};default:return console.error("Unknown action type: ".concat(e)),function(){console.error("Cannot process unknown action type: ".concat(e))}}}},{key:"isActionDisabled",value:function(e,t,n,a,r){switch(e){case"cut":return!Oe.cutEnabled(a);case"copy":return!Oe.copyEnabled(a);case"paste":return!Oe.pasteEnabled(a);case"next_task":return!Oe.nextTaskEnabled(a);case"back_task":return!Oe.backTaskEnabled(a);case"back":return!Oe.backEnabled(n,t,a);case"forward":return!Oe.forwardEnabled(n,t,a);case"none":return void 0===r;default:return!1}}},{key:"transformLinkEntry",value:function(e,t,n,a){return{type:"action",label:e.label,mouseOver:e.mouseOver,icon:e.icon,event:e.event,action:function(){Re.doPageSwitch(e.link,a,n,t)},disabled:!1}}},{key:"transformProvidedEntry",value:function(t,n,a){var r=void 0===t.providerParam?j.findPageAreaAncestorPath(n):j.appendPageSegmentsToPath(j.dropPageSegmentFromPath(n),t.providerParam),i=ve.getBookmarks(r,a).map(function(t){var i=t.pageUrl?t.pageUrl:"",o=void 0===t.pageTab?void 0:{name:t.pageTab,image:t.pageImage};return{type:"action",label:i,mouseOver:"Switch browser to ".concat(i),icon:t.pageImage,disabled:!1,action:function(){e.trace(n,r,t.pageName,t.pageUrl,t.pageTab,a),a.taskManager.switchEmbeddedPage(r,t.pageName,t.pageUrl,o)}}});return{type:"dynamicItems",provider:function(){return i},providerParam:void 0}}},{key:"trace",value:function(e,t,n,a,r,i){var o=X.getUserDefPathForIndexPath(e,i),s=X.getUserDefPathForIndexPath(t,i);i.traceLogBuffer.reportEvent("Bookmark",new Date,{triggerType:"contextMenu",triggerIndexPath:e,triggerUserDefIdPath:o,triggerUserDefId:q.getLastUserDefIdFromPath(o),operation:"select",ownerIndexPath:t,ownerUserDefIdPath:s,ownerUserDefId:q.getLastUserDefIdFromPath(s),pageName:n,pageUrl:a,tab:r})}}]),e}(),we=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).getDialogsFromPresenterStateManager=function(){var e=n.props,t=e.runtime,a=e.findPageForPageName,r=t.taskManager.getCurrentStatePathRoot(),i=t.presenterStateManager.getTaskState(r).dialogs.filter(function(e){return e.visible});return n.checkAndSetFocus(i).map(function(e){var n=a(e.pageName,t).content.config.position,r=n.width,i=n.height;return e.position||(e.position={x:window.innerWidth/2-r/2,y:window.innerHeight/2-i/2}),{type:e.type,position:e.position,focused:e.focused,pageAreaName:e.pageAreaName,pageName:e.pageName,visible:e.visible}})},n.checkAndSetFocus=function(e){for(var t=0;t<e.length;t+=1){if(e[t].focused)return e;t===e.length-1&&(e[t].focused=!0)}return e},n.handleFocusAndDrag=function(e,t){var a=n.props.runtime,r=a.taskManager.getCurrentStatePathRoot(),i=n.getCurrentDialogPosition(t);a.presenterStateManager.updatePositionAndFocusDialog(t.pageAreaName,t.type,r,i,a),Q.triggerRendering(Object(O.a)(Object(O.a)(n)))},n.getCurrentDialogPosition=function(e){var a=y.a.findDOMNode(n.refs[t.buildDialogRefKey(e)]).getElementsByClassName("ui-dialog")[0].style.transform.match(/\(([^)]+)\)/)[1].split(",");return{x:parseInt(a[0],10),y:parseInt(a[1],10)}},n.buildDialogs=function(){var e=n.props,a=e.runtime,r=e.findPageForPageName,i=a.taskManager.getCurrentStatePathRoot();return n.getDialogsFromPresenterStateManager().map(function(e,o){var s="modal"===e.type,c=r(e.pageName,a),l=c.orientation?"right":"left",u=c.content.config.position,d=u.width,g=u.height,f=t.buildDialogIndexPath(i,e);return v.a.createElement("div",{key:t.buildDialogRefKey(e),className:"".concat(s?"cba-modal":"cba-dialog"," ").concat(e.focused?"focused":""," ").concat(c.closable?"":"not-closable"),onClick:function(t){n.handleFocusAndDrag(t,e)}},v.a.createElement(Ee.a,{modal:s,isResizable:!1,isDraggable:c.closable,hasCloseIcon:c.closable,closeOnEscape:c.closable,width:d,height:g+25,onClose:function(){return n.closeDialog(e)},position:e.position,ref:t.buildDialogRefKey(e)},v.a.createElement("div",{className:"dialog-page"},v.a.createElement(gn,{runtime:a,path:f,config:c.content,orientation:l}))))})},n.closeDialog=function(e){var t=n.props.runtime,a=t.taskManager.getCurrentStatePathRoot();t.presenterStateManager.hideDialog(e.pageAreaName,e.type,a,t),Q.triggerRendering(Object(O.a)(Object(O.a)(n)))},e.runtime.dialogPresenter=Object(O.a)(Object(O.a)(n)),n}return Object(I.a)(t,e),Object(r.a)(t,null,[{key:"buildDialogIndexPath",value:function(e,t){return j.appendPageSegmentToPathRoot(e,t.type,t.pageAreaName,j.buildPageSegment(t.pageName))}},{key:"buildDialogRefKey",value:function(e){var t=e.pageAreaType,n=e.pageAreaName,a=e.pageName;return"/type=".concat(t,"/areaName=").concat(n,"/pageName=").concat(a)}},{key:"isDialogParentInPath",value:function(e){if(void 0!==e){var t=j.getPageAreaTypeFromPath(e);return void 0!==t&&("dialog"===t||"modal"===t)}return!1}},{key:"closeParentDialogFromPath",value:function(e,n){if(t.isDialogParentInPath(n)){var a=j.getPageAreaTypeFromPath(n),r=j.getPageAreaNameFromPath(n),i=e.taskManager.getCurrentStatePathRoot();e.presenterStateManager.hideDialog(r,a,i,e)}else console.warn("Dialog is not in path - ",n)}}]),Object(r.a)(t,[{key:"render",value:function(){return v.a.createElement("div",null,this.buildDialogs())}}]),t}(h.Component),Re=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"doStandardOnClick",value:function(t,n,a){var r=a.props,i=r.config,o=r.path,s=r.runtime;e.doBasicOnClick(t,o,s),e.traceUserInteractionPerConfig(i,o,n,t,s),e.doPageSwitchForComponent(a),e.sendStandardEvent(i,s)}},{key:"doBasicOnClick",value:function(t,n,a){a.replayStepMonitor.incrementReplayStep(),e.stopEventPropagation(t),e.signalFocusChangeToClipboardManager(n,a)}},{key:"stopEventPropagation",value:function(e){void 0!==e&&e.stopPropagation()}},{key:"signalFocusChangeToClipboardManager",value:function(e,t){t.clipboardManager.registerFocus(e)}},{key:"traceUserInteractionPerConfig",value:function(t,n,a,r,i){e.traceUserInteractionPerTraceConfig(t.trace,n,a,r,i)}},{key:"traceUserInteractionPerTraceConfig",value:function(t,n,a,r,i){if(void 0===t.skipTrace||!0!==t.skipTrace){var o={};e.extendTraceDetailsObject(o,t.addOn),e.extendTraceDetailsObject(o,a),e.traceUserInteraction(t.type,n,o,r,void 0,i)}}},{key:"traceUserInteraction",value:function(t,n,a,r,i,o){var s=e.buildTraceLogDetails(n,a,r,o),c=new Date;o.incidentsAccumulator.userInteraction(c.getTime(),i,o),o.traceLogBuffer.reportEvent(t,c,s)}},{key:"traceUserScroll",value:function(e,t,n,a){var r,i,o,s,c=K()(Z.traceScrollWrap(),500,{leading:!1});return function(l){var u;if(l.stopPropagation(),r=i,i=Z.getScrollDataFromEvent(l),n){var d=l.target.className.includes("Pane1");u=a?d?n:e:d?e:n}else u=e;o=s,s=Z.computeScrollOrientation(i,r),o&&o.direction&&o.direction!==s.direction&&Z.traceScroll(u,t,i,s),c(i,s,u,t)}}},{key:"buildTraceLogDetails",value:function(t,n,a,r){var i=X.getUserDefPathForIndexPath(t,r),o={indexPath:t,userDefIdPath:i,userDefId:q.getLastUserDefIdFromPath(i)};return e.addMouseEventDetails(a,o),e.extendTraceDetailsObject(o,n),o}},{key:"extendTraceDetailsObject",value:function(e,t){void 0!==t&&Object.keys(t).forEach(function(n){e[n]=t[n]})}},{key:"addMouseEventDetails",value:function(e,t){void 0!==e&&(t.clientX=e.clientX,t.clientY=e.clientY,t.pageX=e.pageX,t.pageY=e.pageY,t.screenX=e.screenX,t.screenY=e.screenY)}},{key:"buildOldSelectedTraceLogValueObject",value:function(e){return{oldSelected:e}}},{key:"sendStandardOrAlternateEvent",value:function(t,n,a){t?e.sendAlternateEvent(n,a):e.sendStandardEvent(n,a)}},{key:"sendStandardEvent",value:function(e,t){var n=e.event.standard;void 0!==n&&t.statemachinesManager.triggerEvent(n)}},{key:"sendEvent",value:function(e,t){void 0!==e&&t.statemachinesManager.triggerEvent(e)}},{key:"sendAlternateEvent",value:function(e,t){var n=void 0===e.event.alternate?e.event.standard:e.event.alternate;void 0!==n&&t.statemachinesManager.triggerEvent(n)}},{key:"doStandardOnFocus",value:function(e){var t=e.props,n=t.config,a=t.runtime,r=n.event.onFocusIn;void 0!==r&&a.statemachinesManager.triggerEvent(r)}},{key:"doStandardOnBlur",value:function(e){var t=e.props,n=t.config,a=t.runtime,r=n.event.onFocusOut;void 0!==r&&a.statemachinesManager.triggerEvent(r)}},{key:"doPageSwitchForComponent",value:function(t){var n=e.getDefaultLinkReceiver(t);e.doPageSwitch(t.props.config.link,t.props.runtime,n,t.props.path)}},{key:"doPageSwitch",value:function(t,n,a,r){var i=e.buildTargetReceiver(t,a,r),o=t.page,s=t.conditional,c=t.pageUrl,l=t.historyMove;(void 0!==o||void 0!==s||void 0!==i&&void 0!==l)&&(void 0!==r&&we.isDialogParentInPath(r)&&we.closeParentDialogFromPath(n,r),n.taskManager.switchPage(o,s,c,null==t.pageAreaType?j.getPageAreaTypeFromPath(r):t.pageAreaType,null==t.pageAreaName?j.getPageAreaNameFromPath(r):t.pageAreaName,i,t.receiverTab,t.historyMove,void 0))}},{key:"getTopComponentPosition",value:function(e,t){var n=t.findPage(e);if(void 0!==n){var a=n.content;if(void 0!==a){if(void 0!==a.config){var r=n.content.config.position;return{x:r.x,y:r.y}}console.error("Could not find config for content in page ".concat(e,": ").concat(a))}else console.error("Could not find content in configuration of page ".concat(e,": ").concat(n))}else console.error("Could not find configuration for page: ".concat(e))}},{key:"getDefaultLinkReceiver",value:function(e){if(void 0!==e.props){var t=$.getState(e);return G.extractDefaultLinkReceiver(t)}console.error("Component without props detected: ".concat(e))}},{key:"doContextMenuOpen",value:function(t,n){var a=t.props;if(void 0!==a&&void 0!==a.runtime&&void 0!==a.config){var r=a.runtime,i=a.config,o=a.path,s=i.contextMenu;void 0!==s&&(n.stopPropagation(),r.contextMenu.openMenuItemTreeWithDynamicConfig(Me.buildMenuTreeItemConfiguration(s,n,o,e.getDefaultLinkReceiver(t),r)))}else console.error("Cannot open context menu for component.",a)}},{key:"processSelectedTextForCutAndPaste",value:function(e,t,n,a,r,i){var o=t.target,s=o.selectionStart,c=o.selectionEnd,l=o.value,u="".concat(l.substring(s,c));void 0===u||0===u.length?i.clipboardManager.deregisterSelection(e):i.clipboardManager.registerSelection(e,function(e){return e&&!n&&void 0!==a&&a(r,s,c,""),u},function(){return n})}},{key:"buildTargetReceiver",value:function(t,n,a){return void 0===n?t.receiver:e.linkTargetsOtherPageArea(t,a)?t.receiver:void 0===t.receiver?n:j.appendPageSegmentsToPath(n,t.receiver)}},{key:"linkTargetsOtherPageArea",value:function(e,t){return void 0!==e.pageAreaName&&void 0!==e.pageAreaType&&(e.pageAreaType!==j.getPageAreaTypeFromPath(t)||e.pageAreaName!==j.getPageAreaNameFromPath(t))}}]),e}(),De=n(789),Ne=n(788),Ae=n(11),Fe=n(321),je=n.n(Fe),Le=(n(552),n(553),n(554),n(126),function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"calculateActualPosition",value:function(t,n,a,r,i,o,s){var c=e.calculateCurrentPositionOffset(t,n,a,r,i,o),l=t.config.position,u=e.calculateBlockKey(l.blockKey,c.blockOffset,s);return void 0===u&&console.error("Actual block key undefined for ".concat(t.config.userDefinedId)),{blockKey:u,offset:l.offset+c.characterOffset}}},{key:"calculateBlockKey",value:function(e,t,n){var a,r=n.getCurrentContent(),i=e;for(a=0;a<t;a+=1)i=r.getKeyAfter(i);return i}},{key:"calculateCurrentPositionOffset",value:function(t,n,a,r,i,o){var s=t.config.position.blockKey,c=r.filter(function(n,r,c){var l=e.getModifierStateInEditorState(r,o,i);return(e.isEvaluatedInject(n)?""!==l.injectText:l.active)&&e.inBlock(n,s)&&e.beforePosition(n,t,a)}).filter(function(t,n,a){return e.hasMoreThanOneBlock(t)}),l=c.reduce(function(e,t){return e+t.config.blocks.length-1},0),u=e.getLastModifierPerOffset(c),d=void 0===u?0:u.config.position.offset,g=void 0===u?0:u.config.position.index,f=void 0===u?0:e.getLastBlockOfFragment(u).text.length-u.config.position.offset;return{blockOffset:l,characterOffset:r.map(function(n,r,c){return e.afterPositionInSameBlock(n,s,d,g)&&e.beforePosition(n,t,a)?e.isDynamicFragment(n)?e.getModifierStateInEditorState(r,o,i).active?n.config.blocks[0].text:"":e.isEvaluatedInject(n)?e.getModifierStateInEditorState(r,o,i).injectText:"":""}).reduce(function(e,t){return e+t.length},f)}}},{key:"isDynamicFragment",value:function(e){return"DynamicFragment"===e.type}},{key:"isEvaluatedInject",value:function(e){return"EvaluatedInject"===e.type}},{key:"hasMoreThanOneBlock",value:function(t){return e.isDynamicFragment(t)&&t.config.blocks.length>1}},{key:"beforePosition",value:function(e,t,n){var a=e.config.position,r=t.config.position,i=n[a.blockKey],o=n[r.blockKey];return i<o||!(i>o)&&(a.offset<r.offset||!(a.offset>r.offset)&&a.index<r.index)}},{key:"afterPositionInSameBlock",value:function(e,t,n,a){var r=e.config.position;return r.blockKey===t&&(r.offset>n||r.offset===n&&r.index>a)}},{key:"inBlock",value:function(e,t){return e.config.position.blockKey===t}},{key:"getLastBlockOfFragment",value:function(e){var t=e.config.blocks;return t.length<1?void 0:t[t.length-1]}},{key:"getLastModifierPerOffset",value:function(t){var n;return t.forEach(function(t,a,r){(void 0===n||e.isGreaterPositionOffset(t.config.position,n.config.position))&&(n=t)}),n}},{key:"isGreaterPositionOffset",value:function(e,t){return e.offset>t.offset||!(t.offset>e.offset)&&e.index>t.index}},{key:"getModifierStateInEditorState",value:function(e,t,n){var a=n[j.appendIndexToPageSegment(t,e)];return void 0===a?{injectText:"",active:!1}:a}}]),e}()),Ve=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"replaceTextInBlock",value:function(t,n,a,r,i,o){return Ae.EditorState.push(t,Ae.Modifier.replaceText(t.getCurrentContent(),e.buildDraftSelectionState(n,a,r,i),o),"insert-characters")}},{key:"replaceWithBlocks",value:function(t,n,a,r,i,o,s){var c={blocks:o,entityMap:s},l=Object(Ae.convertFromRaw)(c).getBlockMap();return Ae.EditorState.push(t,Ae.Modifier.replaceWithFragment(t.getCurrentContent(),e.buildDraftSelectionState(n,a,r,i),l),"insert-fragment")}},{key:"removeBlocks",value:function(t,n,a,r,i){return Ae.EditorState.push(t,Ae.Modifier.removeRange(t.getCurrentContent(),e.buildDraftSelectionState(n,a,r,i),"forward"),"remove-range")}},{key:"applyInlineStyles",value:function(t,n,a,r,i,o){var s=t;if(void 0!==o){var c=e.buildDraftSelectionState(n,a,r,i);o.forEach(function(e,t,n){s=Ae.EditorState.push(s,Ae.Modifier.applyInlineStyle(s.getCurrentContent(),c,e),"change-inline-style")})}return s}},{key:"applyEntities",value:function(t,n,a,r,i,o){var s=t;if(void 0!==o){var c=e.buildDraftSelectionState(n,a,r,i);o.forEach(function(e,t,n){s=Ae.EditorState.push(s,Ae.Modifier.applyEntity(s.getCurrentContent(),c,e),"apply-entity")})}return s}},{key:"forceSelection",value:function(t,n,a,r,i){return Ae.EditorState.forceSelection(t,e.buildDraftSelectionState(n,a,r,i))}},{key:"toggleEditorStateStyleOnSelection",value:function(t,n){var a=n.startKey,r=n.startOffset,i=n.endKey,o=n.endOffset,s=n.highlightKey,c=e.forceSelection(t,a,r,i,o);return c=Ae.RichUtils.toggleInlineStyle(c,s)}},{key:"buildDraftSelectionState",value:function(e,t,n,a){return Ae.SelectionState.createEmpty("notUsed").merge({anchorKey:e,anchorOffset:t,focusKey:n,focusOffset:a})}}]),e}(),Ue=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onClickHandler=n.onClickHandler.bind(Object(O.a)(Object(O.a)(n))),n.getData=n.getData.bind(Object(O.a)(Object(O.a)(n))),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,n=e.runtime,a=e.parentPath;n.componentDirectory.registerComponent(t.buildMyPath(a,this.getData()),this)}},{key:"componentWillUnmount",value:function(){var e=this.props,n=e.runtime,a=e.parentPath;n.componentDirectory.deregisterComponent(t.buildMyPath(a,this.getData()))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var n=this.props,a=n.runtime,r=n.parentPath;r!==e.parentPath&&(a.componentDirectory.deregisterComponent(t.buildMyPath(r,this.getData())),a.componentDirectory.registerComponent(t.buildMyPath(e.parentPath,e.contentState.getEntity(e.entityKey).getData()),this))}},{key:"onClickHandler",value:function(e){var n=this.props,a=n.runtime,r=n.parentPath,i=n.linkReceiver,o=n.fullRichTextPath;if(!$.getStateAttributeByPathId(G.extractDisabled,o,a)){var s=this.getData(),c=t.buildMyPath(r,s);Re.doBasicOnClick(e,c,a),Re.traceUserInteraction("EmbeddedLink",c,void 0,e,void 0,a);var l=t.getOrBuildState(r,s,a);l.selected=!0,t.persistState(l,r,s,a),Re.doPageSwitch(s.link,a,i,r)}}},{key:"handleKeyDown",value:function(e){32===e.keyCode&&this.onClickHandler(e)}},{key:"handleMouseDown",value:function(e){e.currentTarget.contentEditable=!0,e.currentTarget.contentEditable=!1}},{key:"getData",value:function(){var e=this.props,t=e.contentState,n=e.entityKey;return t.getEntity(n).getData()}},{key:"render",value:function(){var e=this,n=this.props,a=n.runtime,r=n.parentPath,i=n.children,o=n.tabIndex,s=this.getData(),c=t.getOrBuildState(r,s,a),l=t.buildStyle(c,s);Y.setStyleAttribute(l,"display","inline-block"),Y.setStyleAttribute(l,"lineHeight","1");var u=void 0!==l.color?"cba-link":"";return v.a.createElement("span",{className:"CbaLink ".concat(u),style:l,onClick:this.onClickHandler,onKeyDown:function(t){return e.handleKeyDown(t)},onMouseDown:function(t){return e.handleMouseDown(t)},tabIndex:o},i)}}],[{key:"getOrBuildState",value:function(e,n,a){return a.componentStateManager.findOrBuildStateForPathId(t.buildMyPath(e,n),a)}},{key:"persistState",value:function(e,n,a,r){r.componentStateManager.registerStateByPathId(t.buildMyPath(n,a),e,r)}},{key:"buildMyPath",value:function(e,t){return j.appendIndexToPageSegment(e,t.id)}},{key:"buildStyle",value:function(e,t){return{color:e.selected?t.color.visited:t.color.notVisited,cursor:"pointer"}}}]),t}(v.a.Component),Be=function(e,t,n){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&"LINK"===n.getEntity(t).getType()},t)};Ue.defaultProps={linkReceiver:void 0,tabIndex:-1};var He=function(e){var t=e.src,n=e.style;return v.a.createElement("audio",null,v.a.createElement("track",{kind:"captions",controls:!0,src:t,style:n}))},We=function(e){var t=e.src,n=e.style;return v.a.createElement("img",{src:t,style:n,alt:t})},Ke=function(e){var t=e.src,n=e.style;return v.a.createElement("video",null,v.a.createElement("track",{kind:"captions",controls:!0,src:t,style:n}))},qe=function(e){return function(t){var n,a=t.contentState.getEntity(t.block.getEntityAt(0)),r=a.getData(),i=r.src,o=r.style,s=a.getType(),c=Y.getProperResourcePath(i,e);return"audio"===s?n=v.a.createElement(He,{src:c,style:o}):"image"===s?n=v.a.createElement(We,{src:c,style:o}):"video"===s&&(n=v.a.createElement(Ke,{src:c,style:o})),n}},Ge=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).getStyle=function(){var e=n.props,t=e.contentState,a=e.entityKey;return t.getEntity(a).getData().style},n.getBullet=function(){var e=n.props.children[0].props.text,t="";if(0===e.indexOf("num-")){var a=e.split("-");t=Object(L.a)(a,2)[1]}else switch(e){case"a":t=String.fromCharCode("0x25CF");break;case"b":t=String.fromCharCode("0x25CB");break;case"c":t=String.fromCharCode("0x25A0");break;case"d":t=String.fromCharCode("0x25A1");break;default:t=String.fromCharCode("0x25CF")}return t},n.style=n.getStyle(),n.bullet=n.getBullet(),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return v.a.createElement("span",{suppressContentEditableWarning:"true",className:"cbaListBullet",style:this.style,contentEditable:"false"},this.bullet)}}]),t}(v.a.Component),ze=function(e,t,n){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&"LIST-BULLET"===n.getEntity(t).getType()},t)},_e=function(e){function t(){return Object(a.a)(this,t),Object(E.a)(this,Object(x.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.MathJax||(this.interval=window.setInterval(function(){window.MathJax&&(e.setState(function(e){return{update:e+1}}),clearInterval(e.interval))},100),window.setTimeout(function(){window.MathJax||(console.error("MathJax not found, check item dependency library"),clearInterval(e.interval))},1e4))}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){var e=window.MathJax,t=this.props.tex;if(!e)return v.a.createElement("span",null,"MathJax Not loaded");e.texReset();var n=e.tex2chtml(t);return e.startup.document.clear(),e.startup.document.updateDocument(),v.a.createElement("span",{dangerouslySetInnerHTML:{__html:n.innerHTML}})}}]),t}(h.Component),Je=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(E.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(i)))).getPropertyData=function(e){var t=n.props,a=t.contentState,r=t.entityKey;return a.getEntity(r).getData()[e]},n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e={fontSize:this.getPropertyData("fontSize"),color:this.getPropertyData("fontColor")};return v.a.createElement("span",{style:e,suppressContentEditableWarning:"true",contentEditable:"false"},v.a.createElement(_e,{tex:this.getPropertyData("tex")}))}}]),t}(v.a.Component),Ye=function(e,t,n){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&"TEX"===n.getEntity(t).getType()},t)},Xe=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).focus=function(){n.editor.focus()},n.onClickHandler=function(e){var t=n.props,a=t.runtime,r=t.config,i=t.path,o=t.onParentClick,s=t.checkSelectable;if(void 0===s||s()){var c=$.getState(Object(O.a)(Object(O.a)(n))),l=pe.extractSelectedState(c,i,a),u=r.fromSecond,d=r.toSecond;if(Re.doBasicOnClick(e,i,a),void 0!==u){var g={from:u,to:d};Re.traceUserInteractionPerConfig(r,i,g,e,a)}else Re.traceUserInteractionPerConfig(r,i,Re.buildOldSelectedTraceLogValueObject(l),e,a);"none"!==r.toggleType&&n.updateStateAndTriggerRendering(c),void 0!==o&&o(e),pe.doPageSwitchOrLetTheContainerDoIt(Object(O.a)(Object(O.a)(n)),c),Re.sendStandardOrAlternateEvent(l,r,a)}else Re.stopEventPropagation(e)},n.debouncedDoHighlightActions=w()(function(e){n.doHighlightActions(e)},2e3),n.onChange=function(e){var t=$.getState(Object(O.a)(Object(O.a)(n))),a=G.extractEditorState(t),r=G.extractSelections(t),i=G.extractHighlightable(t),o=G.extractDisabled(t),s=n.props,c=s.config,l=s.runtime,u=Ze.getListOfBlockKeysInBlockOrder(c.value.blocks),d=!1;if(Ze.contentStateEqual(a,e)?n.saveEditorStateInPathState(e):d=!0,d||o||!i)n.editor&&n.editor.blur();else if(Ze.isSelection(e))"mouse"===n.lastUserEvent?n.doHighlightActions(e):n.debouncedDoHighlightActions(e);else{var g=Ze.getSelectionHitByClick(e.getSelection(),r,u);void 0!==g&&(e=n.removeClickedSelection(g,e,r))}"touch"!==n.lastUserEvent||d||n.saveEditorStateInPathState(e),l.replayStepMonitor.incrementReplayStep(),Q.triggerRendering(Object(O.a)(Object(O.a)(n)))},n.doHighlightActions=function(e){var t=n.props.config,a=Ze.getListOfBlockKeysInBlockOrder(t.value.blocks),r=$.getState(Object(O.a)(Object(O.a)(n))),i=n.getHighlightColorKey(r);n.processHighlightClick(e,a,i),Q.triggerRendering(Object(O.a)(Object(O.a)(n)))},n.removeClickedSelection=function(e,t,a){var r=e.startKey,i=e.startOffset,o=e.endKey,s=e.endOffset,c=e.highlightKey,l=Ve.forceSelection(t,r,i,o,s);l=Ae.RichUtils.toggleInlineStyle(l,c),l=Ae.EditorState.moveFocusToEnd(l);var u=Ze.removeSelectionFromSelectionsArray(a,e);return n.saveEditorStateInPathState(l),n.saveSelectionsInPathState(u),n.triggerHighlightEvent(),l},n.processHighlightClick=function(e,t,a){var r=$.getState(Object(O.a)(Object(O.a)(n))),i=G.extractSelections(r),o=Ze.getSelection(e,a,t),s=[];i.forEach(function(e){switch(Ze.getIntersect(o,e,t).type){case"left":s.push(Ze.buildSelection(e.startKey,o.endKey,e.startOffset,o.endOffset,e.highlightKey));break;case"right":s.push(Ze.buildSelection(o.startKey,e.endKey,o.startOffset,e.endOffset,e.highlightKey));break;case"inside":s.push(Object.assign({},o,{highlightKey:e.highlightKey}));break;case"cover":s.push(Object.assign({},e))}}),s.forEach(function(t){e=Ve.toggleEditorStateStyleOnSelection(e,t)}),e=Ve.toggleEditorStateStyleOnSelection(e,o);var c=Ze.calculateSelectionsArray(e,t);e=Ae.EditorState.moveFocusToEnd(e),n.saveEditorStateInPathState(e),n.saveSelectionsInPathState(c),n.triggerHighlightEvent()},n.triggerHighlightEvent=function(){var e=n.props,t=e.config,a=e.runtime,r=t.highlightChangeEvent;void 0!==r&&a.statemachinesManager.triggerEvent(r)},n.saveModifiersStateInPathState=function(e){var t=$.getState(Object(O.a)(Object(O.a)(n)));G.setModifiersInEditorState(t,e);var a=n.props,r=a.runtime,i=a.path;r.componentStateManager.registerStateByPathId(i,t,r)},n.saveEditorStateInPathState=function(e){var a=$.getState(Object(O.a)(Object(O.a)(n)));G.setEditorState(a,e),G.setTextValue(a,t.calculateTextValue(e));var r=n.props,i=r.runtime,o=r.path;i.componentStateManager.registerStateByPathId(o,a,i)},n.saveSelectionsInPathState=function(e){var a=n.props,r=a.runtime,i=a.path,o=$.getState(Object(O.a)(Object(O.a)(n))),s=G.extractSelections(o);t.traceHighlightChange(i,s,e,r),G.setSelections(o,e),r.componentStateManager.registerStateByPathId(i,o,r)},n.myBlockStyleFn=function(e){var t=e.getType();return"cba"===t.substr(0,3)?t.replace(/_/g," "):"atomic"===t?"cbaImageLeft":"atomic_rtl"===t?"cbaImageRight":"empty_block"===t?"cbaClearImage":""},n.mediaBlockRenderer=function(e){var t=n.props.runtime;return"atomic"===e.getType()||"atomic_rtl"===e.getType()?{component:qe(t),editable:!1}:null},n.getStylesMap=function(){var e=n.props,a=e.config,r=e.runtime.taskManager.getTopLevelConfiguration().highlightColors,i=t.findStylesMapInConfig(a),o=r.reduce(function(e,n){return e[t.convertHighlightValueToKey(n)]={backgroundColor:n},e},{});return Object.assign({},i,o)},n.getHighlightColor=function(e){var t=n.props,a=t.runtime,r=t.config;if(G.extractHighlightable(e))return a.taskManager.getTopLevelConfiguration().itemHighlightColor||r.stylesMap.HIGHLIGHT.backgroundColor||void 0},n.getHighlightColorKey=function(e){var a=n.getHighlightColor(e),r=t.convertHighlightValueToKey(a);return n.getStylesMap()[r]?r:"HIGHLIGHT"},n.generateSelectionStyle=function(e,t,n,a){var r=e&&!a?t:"transparent";return v.a.createElement("style",{dangerouslySetInnerHTML:{__html:"\n            #".concat(n," .DraftEditor-root span::selection  { background-color: ").concat(r,"; }\n            #").concat(n," .DraftEditor-root span::-moz-selection  { background-color: ").concat(r,"; }\n            ").concat(e?"":"#".concat(n,"{ caret-color: transparent }"),"\n            ").concat(a?"#".concat(n," span { color: inherit!important; }"):"","\n            ").concat(a?"#".concat(n," .cbaImageRight, #").concat(n," .cbaImageLeft { opacity: 0.4 }"):"","\n          ")}})},n.lastUserEvent=d.isTouchDevice()?"touch":"mouse",n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this);var e=this.props,n=e.config,a=e.path,r=e.row,i=e.column,o=e.runtime,s=this;t.forEachContentModifier(n,a,function(e,t){s.props.runtime.componentDirectory.registerComponent(t,s)}),void 0!==r&&void 0!==i&&o.eventEmitter.addListener("".concat(de.buildTablePath(a),"-removeLastSelection-[").concat(r,",").concat(i,"]"),this.onRemoveLastSelection.bind(this)),void 0!==n.fromSecond&&(o.eventEmitter.addListener("currentTimeUpdate",this.onCurrentTimeUpdate.bind(this)),o.eventEmitter.addListener("clearFlashTexts",this.onClearFlashTexts.bind(this)))}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this);var e=this.props,n=e.config,a=e.path,r=this;t.forEachContentModifier(n,a,function(e,t){r.props.runtime.componentDirectory.deregisterComponent(t)})}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e);var n=this,a=this.props,r=a.config,i=a.path;t.forEachContentModifier(r,i,function(e,t){n.props.runtime.componentDirectory.deregisterComponent(t)});var o=e.config,s=e.path;t.forEachContentModifier(o,s,function(e,t){n.props.runtime.componentDirectory.registerComponent(t,n)})}},{key:"onRemoveLastSelection",value:function(){var e=$.getState(this);this.updateStateAndTriggerRendering(e,!1)}},{key:"onCurrentTimeUpdate",value:function(e){var t=this.props,n=t.config,a=t.runtime,r=n.fromSecond,i=n.toSecond,o=$.getState(this);e>=r&&e<=i?(a.eventEmitter.emit("clearFlashTexts"),G.setHidden(o,!1)):G.setHidden(o,!0),$.registerState(this,o),Q.triggerRendering(this)}},{key:"onClearFlashTexts",value:function(){var e=$.getState(this);G.setHidden(e,!0),$.registerState(this,e),Q.triggerRendering(this)}},{key:"highlightColorChanged",value:function(){var e=$.getState(this),t=G.extractEditorState(e),n=Ae.EditorState.forceSelection(t,t.getSelection());this.saveEditorStateInPathState(n),Q.triggerRendering(this)}},{key:"updateStateAndTriggerRendering",value:function(e,t){var n=this.props,a=n.runtime,r=n.path,i=pe.extractSelectedState(e,r,a);G.setVisited(e,!0),pe.setSelectedForPossiblyControlledComponent(!i,r,e,!0,!1,a)}},{key:"handleKeyDown",value:function(e){32===e.keyCode&&this.onClickHandler(e)}},{key:"render",value:function(){var e=this,n=this.props,a=n.runtime,r=n.path,i=n.config,o=n.orientation,s=$.getState(this),c=this.getHighlightColor(s),l=G.extractHighlightable(s),u=G.extractDisabled(s),d=pe.extractSelectedState(s,r,a),g=j.getValidCssIdFromPath(r),f=Y.buildStyleByIndexPath(r,i,d,o,a);"upDown"===i.toggleType&&Y.setStyleAttribute(f,"borderStyle",d?"inset":"outset");var p=this.getStylesMap(),h=G.extractEditorState(s),m=G.extractModifiersInEditorState(s),y=t.applyContentModifiers(h,m,r,i,a),b=Object(L.a)(y,2),k=b[0],S=b[1];this.saveEditorStateInPathState(k),this.saveModifiersStateInPathState(S);var C=Re.getDefaultLinkReceiver(this),T=[{strategy:Be,component:Ue,props:{linkReceiver:C,parentPath:t.addLinkIndex(r),runtime:a,tabIndex:i.tabIndex,fullRichTextPath:r}},{strategy:ze,component:Ge},{strategy:Ye,component:Je}];return v.a.createElement("div",{id:g,style:f,className:Y.getCssClassNamesValue(i),title:Y.buildTitle(i),"data-cba-id":i.pageEditId,onClick:this.onClickHandler,onKeyDown:function(t){return e.handleKeyDown(t)},onMouseDown:function(){e.lastUserEvent="mouse"},onTouchStart:function(){e.lastUserEvent="touch"}},this.generateSelectionStyle(l,c,g,u),v.a.createElement(je.a,{runtime:a,blockStyleFn:this.myBlockStyleFn,blockRendererFn:this.mediaBlockRenderer,blockRenderMap:Ae.DefaultDraftBlockRenderMap,handleBeforeInput:function(){return"handled"},handlePastedText:function(){return!0},keyBindingFn:function(){return"not-handled-command"},customStyleMap:p,editorState:k,decorators:T,onChange:this.onChange,plugins:this.plugins,ref:function(t){e.editor=t},tabIndex:i.tabIndex}))}}],[{key:"addAttributesToInitialState",value:function(e,n){var a=t.findStylesMapInConfig(n);G.setDeepCopy(e,!1),G.setComponentClassName(e,"CbaRichTextField"),e.editorState=t.buildInitialEditorState(n),e.selections=[],e.defaultHighlightColor=void 0===a?"rgba(0,0,0,0)":a.HIGHLIGHT.backgroundColor,e.modifiersInEditorState={},G.setTextValue(e,t.calculateTextValue(e.editorState)),G.setHighlightable(e,n.highlightText)}},{key:"buildInitialEditorState",value:function(e){var t=Object(Ae.convertFromRaw)(e.value);return Ae.EditorState.createWithContent(t)}},{key:"addLinkIndex",value:function(e){return j.appendIndexToPageSegment(e,1)}},{key:"addContentModifierIndex",value:function(e){return j.appendIndexToPageSegment(e,2)}},{key:"buildLinkConfigurationsArray",value:function(e){var n=[];return t.insertLinkConfigurationsFromEntityMap(e.value.entityMap,n),void 0!==e.contentModifiers&&e.contentModifiers.forEach(function(e){"DynamicFragment"===e.type&&t.insertLinkConfigurationsFromEntityMap(e.config.entityMap,n)}),n}},{key:"insertLinkConfigurationsFromEntityMap",value:function(e,t){Object.values(e).forEach(function(e){"LINK"===e.type&&(t[e.data.id]={type:"RichTextEmbeddedLink",config:{state:{disabled:!1,selected:!1,hidden:!1}}})})}},{key:"convertHighlightKeyToValue",value:function(e,t,n){var a=$.getStateAttributeByPathId(G.extractDefaultHighlightColor,t,n),r=e.split("_").slice(1),i="rgba(".concat(r.join(","),")");return"HIGHLIGHT"!==e?i:a.replace(/\s+/g,"")}},{key:"convertHighlightValueToKey",value:function(e){var t=e.substring(5,e.length-1).replace(/\s+/g,"").split(",");return"HIGHLIGHT_".concat(t.join("_"))}},{key:"toSnapshot",value:function(e,n){var a={};return Object.entries(n).forEach(function(e){var n=Object(L.a)(e,2),r=n[0],i=n[1];switch(r){case"editorState":a[r]=t.toSnapshotForEditorState(i);break;default:a[r]=z.deepCopy(i)}}),a}},{key:"fromSnapshot",value:function(e,n){var a={};return Object.entries(n).forEach(function(e){var n=Object(L.a)(e,2),r=n[0],i=n[1];switch(r){case"editorState":a[r]=t.fromSnapshotForEditorState(i);break;default:a[r]=z.deepCopy(i)}}),a}},{key:"toSnapshotForEditorState",value:function(e){return Object(Ae.convertToRaw)(e.getCurrentContent())}},{key:"fromSnapshotForEditorState",value:function(e){return Ae.EditorState.createWithContent(Object(Ae.convertFromRaw)(e))}},{key:"applyContentModifiers",value:function(e,n,a,r,i){var o=r.contentModifiers,s=e,c=z.deepCopy(n),l=r.value.blocks,u=Ze.getBlockKeysToBlockIndexMap(Ze.getListOfBlockKeysInBlockOrder(l));return t.forEachContentModifier(r,a,function(e,n,a){var r=i.componentStateManager.findOrBuildStateForPathId(n,i);void 0===c[n]&&(c[n]=t.buildNonActiveModifierInEditorState(e.type));var d,g=Le.calculateActualPosition(e,l,u,o,c,a,s),f=c[n];switch(e.type){case"EvaluatedInject":var p=t.applyEvaluatedInjectModifier(s,r,f,e.config,g,i),h=Object(L.a)(p,2);s=h[0],d=h[1];break;case"DynamicFragment":var v=t.applyDynamicFragmentModifier(s,r,f,e.config,g,i),m=Object(L.a)(v,2);s=m[0],d=m[1];break;default:console.error("Unknown modifier type: ".concat(e.type))}c[n]=d}),[s,c]}},{key:"buildNonActiveModifierInEditorState",value:function(e){return"EvaluatedInject"===e?{injectText:""}:{active:!1}}},{key:"applyEvaluatedInjectModifier",value:function(e,t,n,a,r,i){var o=!0===t.selected?"".concat(bt.evaluateTerm(a.insertString,i,[],"inject")):"",s=n.injectText;if(s===o)return[e,n];var c=z.deepCopy(n);c.injectText=o;var l=Ve.replaceTextInBlock(e,r.blockKey,r.offset,r.blockKey,r.offset+s.length,o);return l=Ve.applyInlineStyles(l,r.blockKey,r.offset,r.blockKey,r.offset+o.length,a.inlineStyles),[l=Ve.applyEntities(l,r.blockKey,r.offset,r.blockKey,r.offset+o.length,a.entities),c]}},{key:"applyDynamicFragmentModifier",value:function(e,t,n,a,r,i){if(t.selected===n.active)return[e,n];var o,s=z.deepCopy(n);if(s.active=t.selected,!0===t.selected)o=Ve.replaceWithBlocks(e,r.blockKey,r.offset,r.blockKey,r.offset,a.blocks,a.entityMap);else{var c=a.blocks.length-1;o=Ve.removeBlocks(e,r.blockKey,r.offset,Le.calculateBlockKey(r.blockKey,c,e),(0===c?r.offset:0)+a.blocks[c].text.length)}return[o,s]}},{key:"forEachContentModifier",value:function(e,n,a){var r=e.contentModifiers;if(void 0!==r){var i=t.addContentModifierIndex(n);r.forEach(function(e,t,n){var r=j.appendIndexToPageSegment(i,t);a(e,r,i)})}}},{key:"calculateTextValue",value:function(e){return e.getCurrentContent().getPlainText("").replace(/\s/g," ")}},{key:"traceHighlightChange",value:function(e,t,n,a){var r=Ze.TransformSelectionsToTraceSelectionsDTO(t,e,a),i=Ze.TransformSelectionsToTraceSelectionsDTO(n,e,a);Re.traceUserInteraction("RichTextHighlight",e,{oldSelections:r,newSelections:i},void 0,void 0,a)}},{key:"findStylesMapInConfig",value:function(e){return void 0===e.stylesMap?e.value.stylesMap:e.stylesMap}}]),t}(v.a.Component);Xe.defaultProps={row:void 0,column:void 0,onParentClick:void 0,checkSelectable:void 0,fromSecond:void 0,toSecond:void 0};var Ze=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"isSelection",value:function(e){var t=e.getSelection(),n=t.getStartKey(),a=t.getEndKey();return t.getStartOffset()!==t.getEndOffset()||n!==a}},{key:"areEqual",value:function(e,t){return e.startKey===t.startKey&&e.startKey===t.startKey&&e.endKey===t.endKey&&e.startOffset===t.startOffset&&e.endOffset===t.endOffset&&e.currentHighlightKey===t.currentHighlightKey}},{key:"getSelection",value:function(t,n,a){for(var r=t.getSelection(),i=t.getCurrentContent(),o=Object(Ae.convertToRaw)(i),s=e.buildSelection(r.getStartKey(),r.getEndKey(),r.getStartOffset(),r.getEndOffset(),n);o.blocks[s.startKey].text.length===s.startOffset;){var c=a.indexOf(s.startKey);if(!a[c+1])break;s.startOffset=0,s.startKey=a[c+1]}return s}},{key:"buildSelection",value:function(e,t,n,a,r){return{startKey:e,endKey:t,startOffset:n,endOffset:a,highlightKey:r}}},{key:"getIntersect",value:function(e,t,n){var a="",r=!0,i=n.indexOf(e.startKey),o=n.indexOf(t.startKey),s=n.indexOf(e.endKey),c=n.indexOf(t.endKey),l=s===c,u=i===c,d=s===o,g=i<o||i===o&&e.startOffset<t.startOffset,f=s<o||d&&e.endOffset<t.startOffset,p=i>c||u&&e.startOffset>t.endOffset,h=s>c||l&&e.endOffset>t.endOffset;return g&&h&&(a="cover"),g||h||(a="inside"),g&&!h&&(a="left"),!g&&h&&(a="right"),(!a||g&&f||p&&h)&&(a="none",r=!1),{type:a,isIntersect:r}}},{key:"removeSelectionFromSelectionsArray",value:function(e,t){return e.slice().filter(function(e){return!(t.startOffset===e.startOffset&&t.endOffset===e.endOffset&&t.startKey===e.startKey&&t.endKey===e.endKey&&t.highlightKey===e.highlightKey)})}},{key:"getSelectionHitByClick",value:function(t,n,a){var r={rowKey:t.getStartKey(),pos:t.getStartOffset()},i=n.filter(function(t){return function(t){return e.isMultipleRow(t)?e.isSelectionHitByClickOnMultipleRows(r,t,a):e.isSelectionHitByClickInsideOneRow(r,t)||e.isSelectionHitByClickOnOneCharacter(r,t)}(t)}),o=i.length;return o>0?i[o-1]:void 0}},{key:"clearSelection",value:function(e){var t=e.getFocusKey(),n=e.getStartOffset(),a=e.getEndOffset(),r=Ae.SelectionState.createEmpty(t);return e.getIsBackward()?r.merge({focusOffset:n,anchorOffset:n}):r.merge({focusOffset:a,anchorOffset:a})}},{key:"getListOfBlockKeysInBlockOrder",value:function(e){return e.map(function(e){return e.key})}},{key:"getBlockKeysToBlockIndexMap",value:function(e){var t={};return e.forEach(function(e,n){t[e]=n}),t}},{key:"TransformSelectionsToTraceSelectionsDTO",value:function(e,t,n){var a=[];return e.forEach(function(e){var r=e.startKey,i=e.endKey,o=e.startOffset,s=e.endOffset,c=e.highlightKey;a.push({startKey:r,endKey:i,startOffset:o,endOffset:s,highlightColor:Xe.convertHighlightKeyToValue(c,t,n)})}),a}},{key:"mergeRowSelections",value:function(t,n,a){for(var r=e.getBlockKeysToBlockIndexMap(a),i=d.deepCopy(t),o=0;o<i.length-1;o+=1){var s=i[o],c=i[o+1],l=s.endOffset===n[s.endKey],u=r[s.endKey]+1===r[c.startKey]&&0===c.startOffset;if(s.highlightKey===c.highlightKey&&l&&u){var g={startKey:s.startKey,endKey:c.endKey,startOffset:s.startOffset,endOffset:c.endOffset,highlightKey:s.highlightKey};i[o]=g,i.splice(o+1,1),o-=1}}return i}},{key:"isSelectionHitByClickOnMultipleRows",value:function(t,n,a){return e.isTopRowClick(t,n)||e.isBottomRowClick(t,n)||e.isMiddleRowClick(t,n,a)}},{key:"isMiddleRowClick",value:function(e,t,n){for(var a=n.indexOf(t.startKey),r=n.indexOf(t.endKey),i=a+1;i<r;i+=1)if(n[i]===e.rowKey)return!0;return!1}},{key:"isTopRowClick",value:function(e,t){return e.rowKey===t.startKey&&e.pos>t.startOffset}},{key:"isBottomRowClick",value:function(e,t){return e.rowKey===t.endKey&&e.pos<t.endOffset}},{key:"isSelectionHitByClickInsideOneRow",value:function(e,t){return e.pos>t.startOffset&&e.pos<t.endOffset&&e.rowKey===t.startKey}},{key:"isSelectionHitByClickOnOneCharacter",value:function(e,t){return e.rowKey===t.startKey&&t.endOffset-t.startOffset===1&&(e.pos===t.startOffset||e.pos===t.endOffset)}}]),e}();Ze.contentStateEqual=function(e,t){for(var n=Object(Ae.convertToRaw)(e.getCurrentContent()),a=Object(Ae.convertToRaw)(t.getCurrentContent()),r=0;r<n.blocks.length;r+=1)if(n.blocks[r].key!==a.blocks[r].key||n.blocks[r].text!==a.blocks[r].text)return!1;return!0},Ze.calculateSelectionsArray=function(e,t){var n=e.getCurrentContent(),a=Object(Ae.convertToRaw)(n);return Ze.calculateSelectionsArrayFromContentState(a,t)},Ze.calculateSelectionsArrayFromContentState=function(e,t){var n={blockTextLengths:{},rawSelections:[]};return e.blocks.forEach(function(e,a){n.blockTextLengths[e.key]=e.text.length,e.inlineStyleRanges.forEach(function(e){e.style&&e.style.includes("HIGHLIGHT")&&n.rawSelections.push({startKey:t[a],endKey:t[a],startOffset:e.offset,endOffset:e.offset+e.length,highlightKey:e.style})})}),Ze.mergeRowSelections(n.rawSelections,n.blockTextLengths,t)},Ze.isMultipleRow=function(e){return e.startKey!==e.endKey};var Qe=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"isSelectionContainsNonBlank",value:function(t,n){if(void 0===n.value)return console.warn("Invalid configuration found in rich text field!"),!1;var a=n.value.blocks;if(void 0===a)return!1;var r=e.buildBlockKeyToIndexMap(n),i=e.getSpansFromSelections(t);return e.spanArrayContainsNonBlank(i,a,r)}},{key:"isTextBlockSelected",value:function(t,n,a,r){if(void 0===a.value)return console.warn("Invalid configuration found in rich text field!"),!1;var i=a.value.blocks;if(void 0===i)return!1;if(void 0===a.textBlocks)return console.warn("Text block with name ".concat(t," not found in rich text field ").concat(Y.getIdentifyingInfoForLogMessage(a)," (no text blocks there)")),!1;var o=e.findBlockConfigForBlockName(t,a.textBlocks);if(void 0===o)return console.warn("Text block with name ".concat(t," not found in rich text field ").concat(Y.getIdentifyingInfoForLogMessage(a)," (no such block)")),!1;var s=e.getSpansFromSelections(n),c=e.buildBlockKeyToIndexMap(a),l=o.spans;return r?void 0!==l.find(function(t){return e.selectionsCoverANonBlankInSpan(s,t,i,c)}):l.every(function(t){return e.selectionsCoverNonBlanksInSpan(s,t,i,c)})}},{key:"findBlockConfigForBlockName",value:function(e,t){return t.find(function(t){return t.name===e})}},{key:"buildBlockKeyToIndexMap",value:function(e){return Ze.getBlockKeysToBlockIndexMap(Ze.getListOfBlockKeysInBlockOrder(e.value.blocks))}},{key:"getSpansFromSelections",value:function(t){return t.selections.map(function(t){return e.getSpanFromSelection(t)})}},{key:"getSpanFromSelection",value:function(e){return{start:{blockKey:e.startKey,offset:e.startOffset},end:{blockKey:e.endKey,offset:e.endOffset}}}},{key:"selectionsCoverANonBlankInSpan",value:function(t,n,a,r){return void 0!==t.find(function(t,i,o){return e.selectionCoversANonBlankInSpan(t,n,a,r)})}},{key:"selectionCoversANonBlankInSpan",value:function(t,n,a,r){var i=e.getOverlap(t,n,r);return void 0!==i&&e.spanContainsNonBlank(i,a,r)}},{key:"selectionsCoverNonBlanksInSpan",value:function(t,n,a,r){var i=e.calculateUncoveredAreas(t,n,r);return!e.spanArrayContainsNonBlank(i,a,r)}},{key:"calculateUncoveredAreas",value:function(t,n,a){var r=[n];return t.forEach(function(t,n,i){r=e.calculateUncoveredAreasBySingleSelection(t,r,a)}),r}},{key:"calculateUncoveredAreasBySingleSelection",value:function(t,n,a){var r,i=n,o=!1;for(r=0;!o&&r<i.length;r+=1){var s=i[r],c=e.punch(t,s,a);void 0!==c&&(o=!0,i=e.replaceEntryByArray(i,r,c))}return i}},{key:"dumpObject",value:function(e){return JSON.stringify(e)}},{key:"replaceEntryByArray",value:function(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t+1))}},{key:"spanArrayContainsNonBlank",value:function(t,n,a){var r,i=!1;for(r=0;!i&&r<t.length;r+=1)e.spanContainsNonBlank(t[r],n,a)&&(i=!0);return i}},{key:"spanContainsNonBlank",value:function(t,n,a){var r=a[t.start.blockKey],i=a[t.end.blockKey];if(r===i)return e.stringContainsNonBlank(n[r].text.substring(t.start.offset,t.end.offset));var o,s=e.stringContainsNonBlank(n[r].text.substring(t.start.offset));for(o=r+1;!s&&o<i;o+=1)s=e.stringContainsNonBlank(n[o].text);return s||(s=e.stringContainsNonBlank(n[i].text.substring(0,t.end.offset))),s}},{key:"stringContainsNonBlank",value:function(e){return/\S/.test(e)}},{key:"punch",value:function(t,n,a){var r=e.max(t.start,n.start,a),i=e.min(t.end,n.end,a);if(e.isLessOrEqual(r,i,a)){var o=[];return e.isLess(n.start,r,a)&&o.push({start:n.start,end:r}),e.isGreater(n.end,i,a)&&o.push({start:i,end:n.end}),o}}},{key:"getOverlap",value:function(t,n,a){var r=e.max(t.start,n.start,a),i=e.min(t.end,n.end,a);return e.isLessOrEqual(r,i,a)?{start:r,end:i}:void 0}},{key:"max",value:function(t,n,a){return e.isLess(t,n,a)?n:t}},{key:"min",value:function(t,n,a){return e.isLess(t,n,a)?t:n}},{key:"isLessOrEqual",value:function(t,n,a){return e.isEqual(t,n)||e.isLess(t,n,a)}},{key:"isGreater",value:function(t,n,a){return!e.isLessOrEqual(t,n,a)}},{key:"isLess",value:function(t,n,a){return e.isLessBlockKey(t.blockKey,n.blockKey,a)||t.blockKey===n.blockKey&&t.offset<n.offset}},{key:"isEqual",value:function(e,t){return e.blockKey===t.blockKey&&e.offset===t.offset}},{key:"isLessBlockKey",value:function(e,t,n){return n[e]<n[t]}}]),e}(),$e=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"addAttributesToInitialState",value:function(e,t){G.setTextValue(e,void 0===t.text.label?"":t.text.label)}},{key:"isValidText",value:function(e,t){if(void 0===t)return!0;try{return new RegExp("".concat(t),"m").test(e)}catch(n){return console.log("Invalid regular expression ".concat(t," on input field -> accepting input without check.")),!0}}},{key:"onChangeHandler",value:function(t,n,a,r){var i=$.getState(t),o=G.extractTextValue(i),s=n.target.value,c=t.props,l=c.path,u=c.config,d=c.runtime,g=c.isInEditMode,f=u.validationPattern,p=u.validationFailEvent,h=u.sourceInputPath,v=e.isValidText(s,f),m=v?s:o,y="ValueInputModified"===a?{newValue:s}:{oldTextValue:o,newTextValue:m,origin:"keyboard",validationPattern:f,invalidTextValue:v?void 0:s};if(g||Re.traceUserInteraction(a,l,y,n,{type:r,value:l},d),u.isVariableValueInput){if(""===s||"-"===s)t.blockedDynamicUpdateText=s;else if(t.blockedDynamicUpdateText=void 0,e.isValidText(s,"^[\\-]?[0-9]+$")){var b=d.taskManager,k=d.variableManager,S=b.getCurrentStatePathRoot(),C=u.text.dynamic.variable,T=parseInt(s,10);k.setVariable(S,C,T,"integer",d)}}else G.setTextValue(i,m),void 0!==h&&d.eventEmitter.emit("inputFieldUpdated-".concat(h),m);G.setVisited(i,!0),$.registerState(t,i),Q.triggerRendering(t),v||Re.sendEvent(p,d)}},{key:"onClickHandler",value:function(t,n){var a=t.props,r=a.runtime,i=a.config,o=a.path,s=a.isInEditMode,c=void 0!==i.readOnly&&i.readOnly;Re.processSelectedTextForCutAndPaste(o,n,c,e.updateTextValue,t,r),e.registerAsInsertPosition(t,n);var l=$.getState(t),u=G.extractTextValue(l),d=!0===i.isVariableValueInput?{}:{currentTextValue:u};if(s){var g=i.row,f=i.column,p=de.buildTablePath(o),h=X.getUserDefPathForIndexPath(p,r),v=de.isOldSelected(h,r),m={tableUserDefIdPath:h,tableUserDefId:q.getLastUserDefIdFromPath(h),row:g,column:f,oldSelected:v},y=j.dropIndexFromPageSegment(o);Re.traceUserInteractionPerConfig(i,y,m,n,r),Re.stopEventPropagation(n)}else Re.doStandardOnClick(n,d,t)}},{key:"onContextMenuHandler",value:function(e,t){Re.doContextMenuOpen(e,t)}},{key:"onSelectionHandler",value:function(t,n){var a=t.props,r=a.runtime,i=a.path,o=a.config,s=void 0!==o.readOnly&&o.readOnly;Re.processSelectedTextForCutAndPaste(i,n,s,e.updateTextValue,t,r),e.registerAsInsertPosition(t,n),Re.stopEventPropagation(n)}},{key:"onBlurHandler",value:function(e){Re.doStandardOnBlur(e)}},{key:"onFocusHandler",value:function(e){Re.doStandardOnFocus(e)}},{key:"onCutCopyPaste",value:function(e,t){return t.preventDefault(),!1}}]),e}();$e.registerAsInsertPosition=function(e,t){var n=e.props,a=n.runtime,r=n.path,i=n.config,o=t.target,s=o.selectionStart,c=o.selectionEnd;void 0!==i.readOnly&&i.readOnly||a.clipboardManager.registerInsertPosition(r,function(t){return $e.updateTextValue(e,s,c,t)})},$e.updateTextValue=function(e,t,n,a){var r=$.getState(e),i=G.extractTextValue(r),o="".concat(i.substring(0,t)).concat(a).concat(i.substring(n)),s=e.props,c=s.config,l=s.runtime,u=s.path,d=s.isInEditMode,g=c.validationPattern,f=c.validationFailEvent,p=c.trace,h=$e.isValidText(o,g),v="SingleLineInputField"===p.type?"SingleLineInputFieldModified":"InputFieldModified";d||Re.traceUserInteraction(v,u,{oldTextValue:i,newTextValue:h?o:i,origin:"cutAndPaste",validationPattern:g,invalidTextValue:h?void 0:o},void 0,void 0,l),h?(G.setTextValue(r,o),$.registerState(e,r),Q.triggerRendering(e)):Re.sendEvent(f,l)};var et=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).focus=function(){n.inputRef.current.focus()},n.onKeyDownHandler=function(e){var t=n.props,a=t.path,r=t.runtime,i=t.config,o=t.isInEditMode;de.handleKeyDown(e,r,i,de.buildTablePath(a),o)},n.onFocusHandler=function(){var e=n.props,t=e.path,a=e.runtime,r=e.isInEditMode;$e.onFocusHandler(Object(O.a)(Object(O.a)(n))),de.handleCellFocus(a,de.buildTablePath(t),r)},n.onKeyPressOnInput=function(e){var t=n.props,a=t.runtime,r=t.config,i=t.path,o=t.isInEditMode,s=t.onBlur;if(o){var c=r.row,l=r.column;"Enter"===e.key&&(a.eventEmitter.emit("".concat(de.buildTablePath(i),"-contentUpdate"),e.target.value,c,l,!1),s(e),e.preventDefault())}},n.inputRef=v.a.createRef(),n.blockedDynamicUpdateText=void 0,n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this);var e=this.props,t=e.runtime,n=e.config,a=e.path,r=e.isInEditMode;n.isSpreadsheet&&(t.eventEmitter.addListener("".concat(de.buildTablePath(a),"-inputContentUpdate"),this.onContentUpdate.bind(this)),r&&this.focus())}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"onContentUpdate",value:function(e,t,n){var a=this.props.config,r=a.row,i=a.column;if(r===t&&i===n){var o=$.getState(this);G.setTextValue(o,e),G.setVisited(o,!0),$.registerState(this,o)}}},{key:"render",value:function(){var e=this,t=this.props,n=t.config,a=t.path,r=t.runtime,i=t.orientation,o=t.isInEditMode,s=t.onBlur,c=t.title,l=$.getState(this),u=G.extractSelected(l),d=Y.buildStyleByIndexPath(a,n,u,i,r);if(o){var g=G.extractTextValue(l);if(void 0!==g&&g===n.text.label&&de.isFormula(g)){var f=j.dropIndexFromPageSegment(a),p=r.componentStateManager.findOrBuildStateForPathId(f,r),h=G.extractTextValue(p);G.setTextValue(l,h)}Y.setStyleAttribute(d,"zIndex",1),Y.setStyleAttribute(d,"boxShadow","inset rgb(79, 124, 177) 0px 0px 4px")}var m=void 0===this.blockedDynamicUpdateText?Y.buildDisplayText(n,l,r):this.blockedDynamicUpdateText;this.blockedDynamicUpdateText=void 0;var y=n.isVariableValueInput?"ValueInputModified":"SingleLineInputFieldModified",b=n.isVariableValueInput?"ValueInputField_onChange":"CbaSingleLineInputField_onChange";return v.a.createElement("input",{ref:this.inputRef,type:"text",title:o?c:Y.buildTitle(n),style:d,"data-cba-id":n.pageEditId,readOnly:n.readOnly,disabled:G.extractDisabled(l),value:m,onClick:function(t){return $e.onClickHandler(e,t)},onContextMenu:function(t){return $e.onContextMenuHandler(e,t)},onChange:function(t){return $e.onChangeHandler(e,t,y,b)},onSelect:function(t){return $e.onSelectionHandler(e,t)},onBlur:function(t){return o?s(t,G.extractTextValue(l),!1):$e.onBlurHandler(e)},onFocus:this.onFocusHandler,onKeyPress:this.onKeyPressOnInput,onKeyDown:this.onKeyDownHandler,onCut:function(t){return $e.onCutCopyPaste(e,t)},onCopy:function(t){return $e.onCutCopyPaste(e,t)},onPaste:function(t){return $e.onCutCopyPaste(e,t)},tabIndex:n.tabIndex,className:Y.getCssClassNamesValue(n,"CbaSingleLineInputField"),spellCheck:n.spellCheck})}}]),t}(h.Component);et.defaultProps={isInEditMode:!1,onBlur:function(){},title:""};var tt=function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).initializeSpreadsheet=function(){var e=n.props,t=e.config,a=e.path,r=e.runtime,i=t.row,o=t.column,s=t.isReadOnly;n.registerEventListeners(i,o);var c=$.getState(Object(O.a)(Object(O.a)(n))),l=G.extractCellHadFocus(c),u=j.getPagePath(a);1!==i||1!==o||l||r.focusRegister.hasActionsRegisteredForPath(u)||(window.setTimeout(function(){n.onCellFocused(i,o,s)},100),G.setCellHadFocus(c,!0),$.registerState(Object(O.a)(Object(O.a)(n)),c),n.updateStateAndTriggerRender(!0))},n.onClickHandler=function(e,t){var a=n.props,r=a.config,i=a.runtime,o=a.path,s=r.row,c=r.column,l=r.isSpreadsheet,u=r.readOnly,d=$.getState(Object(O.a)(Object(O.a)(n))),g=G.extractSelected(d);if(l)if(0!==s&&0!==c)n.onCellFocused(s,c,u),n.updateStateAndTriggerRender(!0);else{if(0===s)return n.eventEmitter.emit("".concat(n.buildTableIndexPath(),"-autoFocus"),s+1,c),void Re.stopEventPropagation(e);if(0===c)return n.eventEmitter.emit("".concat(n.buildTableIndexPath(),"-autoFocus"),s,c+1),void Re.stopEventPropagation(e)}else{var f=i.componentStateManager.findOrBuildStateForPathId(n.buildTableIndexPath(),i);G.extractSelectable(f)&&(r.isMultiSelectEnabled||n.onCellFocused(s,c,u),n.updateStateAndTriggerRender())}var p=n.buildTableIndexPath(),h=X.getUserDefPathForIndexPath(p,i),v={tableUserDefIdPath:h,tableUserDefId:q.getLastUserDefIdFromPath(h),row:s,column:c,oldSelected:g};Re.traceUserInteractionPerConfig(r,o,v,e,i),Re.stopEventPropagation(e),0===s||t||n.eventEmitter.emit("".concat(n.buildTableIndexPath(),"-cell-mouse-leave-").concat(s),s)},n.checkSelectable=function(){var e=n.props,t=e.config,a=e.runtime;if(t.isSpreadsheet)return!0;var r=a.componentStateManager.findOrBuildStateForPathId(n.buildTableIndexPath(),a);return G.extractSelectable(r)},n.updateStateAndTriggerRender=function(e,t){var a=$.getState(Object(O.a)(Object(O.a)(n))),r=n.props,i=r.runtime,o=r.path;if(!e){var s=G.extractSelected(a);G.setSelected(a,void 0!==t?t:!s)}G.setVisited(a,!0),$.registerState(Object(O.a)(Object(O.a)(n)),a),Q.triggerRenderingViaPath(o,i)},n.onSelectionChange=function(e,t,a){if(void 0!==t){var r=$.getState(Object(O.a)(Object(O.a)(n))),i=G.extractTextValue(r),o=n.props.config;if(t!==i){var s=o.row,c=o.column;n.eventEmitter.emit("".concat(n.buildTableIndexPath(),"-contentUpdate"),t,s,c,a)}}n.updateStateAndTriggerRender(!1,!0),n.setState({isInEditMode:!1})},n.buildLabel=function(e,t){var n=G.extractTextValue(t),a=e.text;return n=void 0===n?a.label:n,de.isInt(n)&&(n=Number.parseInt(n,10)),de.isFloat(n)&&(-1!==e.numberOfDecimalPlaces?n=Number.parseFloat(n).toFixed(e.numberOfDecimalPlaces):0!==e.defaultNumberOfDecimalPlaces&&(n=Number.parseFloat(n).toFixed(e.defaultNumberOfDecimalPlaces))),n},n.buildTitle=function(e,t){var n;if(G.extractCellHasError(t)){var a=G.extractCellTitle(t);n=void 0!==a?a:""}else e.hasStandardTooltip&&(void 0!==(n=Y.buildTitle(e))&&""!==n||(n=e.address));return n},n.buildTableCell=function(e,a,r,i,o){var s,c=e.isSpreadsheet,l=e.tabIndex,u=n.state.isInEditMode,d=$.getState(Object(O.a)(Object(O.a)(n))),g={maxHeight:"100%",maxWidth:"100%"};if(c){if(s=v.a.createElement("div",{className:Y.getCssClassNamesValue(e,"CbaSpreadsheetCell"),style:o,"data-cba-id":e.pageEditId,onClick:n.onClickHandler,onDoubleClick:n.onDoubleClickCaptureHandler,title:n.buildTitle(e,d),onMouseEnter:function(){return n.onMouseEnter()},onMouseLeave:function(){return n.onMouseLeave()},onKeyDown:function(e){return n.onKeyDownHandler(e)},tabIndex:l},e.imageReference&&v.a.createElement("img",{src:Y.getProperResourcePath(e.imageReference,r),style:g,alt:""}),n.buildLabel(e,d)),u){var f={config:e};if(void 0!==e.items){var p=t.createCellCopy(f,a,"CbaComboBox");s=v.a.createElement(ge,{config:p.config,path:p.path,runtime:r,orientation:i,title:n.buildTitle(e,d),onBlur:n.onSelectionChange,isInEditMode:u}),G.setCellType(d,"combo")}else{var h=t.createCellCopy(f,a,"CbaSingleLineInputField");s=v.a.createElement(et,{config:h.config,path:h.path,runtime:r,orientation:i,title:n.buildTitle(e,d),onBlur:n.onSelectionChange,isInEditMode:u}),G.setCellType(d,"text")}$.registerState(Object(O.a)(Object(O.a)(n)),d)}}else{var m=e.cbaChildren.map(function(t,o){var s=j.appendIndexToPageSegment(a,o),c=z.deepCopy(t);return c.config.color=e.color,c.config.toggleType="colorChange",c.config.tabIndex=e.tabIndex,v.a.createElement(Xe,{key:s,config:c.config,path:s,runtime:r,orientation:i,row:e.row,column:e.column,parentTableUserDefId:e.parentTableUserDefId,onParentClick:n.onClickHandler,checkSelectable:n.checkSelectable})});o.boxSizing="border-box",s=v.a.createElement("div",{className:Y.getCssClassNamesValue(e,"CbaTableCell"),style:o,"data-cba-id":e.pageEditId,onClick:n.onClickHandler,title:Y.buildTitle(e),tabIndex:m.length?"-1":l,onKeyDown:function(e){return n.onKeyDownHandler(e)}},e.imageReference&&v.a.createElement("img",{src:Y.getProperResourcePath(e.imageReference,r),style:g,alt:""}),m)}return s};var r=n.props,i=r.runtime,o=r.config;return n.eventEmitter=i.eventEmitter,n.state={isInEditMode:o.isInEditMode,hasHover:!1},n.onCellFocused=n.onCellFocused.bind(Object(O.a)(Object(O.a)(n))),n.onClickHandler=n.onClickHandler.bind(Object(O.a)(Object(O.a)(n))),n.buildTableIndexPath=n.buildTableIndexPath.bind(Object(O.a)(Object(O.a)(n))),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this);var e=this.props.config;e.isSpreadsheet&&this.initializeSpreadsheet(),this.eventEmitter.addListener("".concat(this.buildTableIndexPath(),"-removeLastSelection-[").concat(e.row,",").concat(e.column,"]"),this.onRemoveLastSelection.bind(this))}},{key:"registerEventListeners",value:function(e){this.eventEmitter.addListener("".concat(this.buildTableIndexPath(),"-rowHeaderUpdate"),this.onRowHeaderUpdate.bind(this)),this.eventEmitter.addListener("".concat(this.buildTableIndexPath(),"-columnHeaderUpdate"),this.onColumnHeaderUpdate.bind(this)),this.eventEmitter.addListener("".concat(this.buildTableIndexPath(),"-cell-mouse-enter-").concat(e),this.onCellMouseEnter.bind(this)),this.eventEmitter.addListener("".concat(this.buildTableIndexPath(),"-cell-mouse-leave-").concat(e),this.onCellMouseLeave.bind(this)),this.eventEmitter.addListener("".concat(this.buildTableIndexPath(),"-updateCellValue"),this.onUpdateValue.bind(this)),this.eventEmitter.addListener("".concat(this.buildTableIndexPath(),"-autoFocus"),this.onAutoFocus.bind(this))}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"onUpdateValue",value:function(e,t,n,a,r,i){var o=this.props.config;if(e.row===o.row&&e.column===o.column){this.eventEmitter.emit("".concat(this.buildTableIndexPath(),"-inputContentUpdate"),t,e.row,e.column),this.updateStateAndTriggerRender(!0);var s=$.getState(this),c=G.extractTextValue(s),l=G.extractFormula(s);void 0!==n&&G.setCellHasError(s,n),void 0!==r&&G.setCellTitle(s,r),G.setTextValue(s,t),G.setFormula(s,a),G.setVisited(s,!0),$.registerState(this,s),i||void 0===c||c===t||this.traceCellModified(void 0,c,t,l,a,r),this.setState({isInEditMode:!1})}}},{key:"onAutoFocus",value:function(e,t){var n=this.props.config,a=n.row,r=n.column;a===e&&r===t&&this.onClickHandler(void 0,!0)}},{key:"onCellFocused",value:function(e,t,n){var a=this.props.config;this.eventEmitter.emit("".concat(this.buildTableIndexPath(),"-cellFocused"),e,t,a.address,n),this.setState({isInEditMode:!0})}},{key:"onRowHeaderUpdate",value:function(e,t){var n=this.props.config;n.row!==e&&n.row!==t||e===t||0!==n.column||this.updateStateAndTriggerRender()}},{key:"onColumnHeaderUpdate",value:function(e,t){var n=this.props.config;n.column!==e&&n.column!==t||e===t||0!==n.row||this.updateStateAndTriggerRender()}},{key:"onRemoveLastSelection",value:function(){this.updateStateAndTriggerRender(!1,!1)}},{key:"onMouseEnter",value:function(){var e=this.props.config.row;0!==e&&this.eventEmitter.emit("".concat(this.buildTableIndexPath(),"-cell-mouse-enter-").concat(e),e)}},{key:"onCellMouseEnter",value:function(e){var t=this.props.config;t.row===e&&0!==t.column&&this.setState({hasHover:!0})}},{key:"onMouseLeave",value:function(){var e=this.props.config.row;0!==e&&this.eventEmitter.emit("".concat(this.buildTableIndexPath(),"-cell-mouse-leave-").concat(e),e)}},{key:"onCellMouseLeave",value:function(e){var t=this.props.config;t.row===e&&0!==t.column&&this.setState({hasHover:!1})}},{key:"onKeyDownHandler",value:function(e){32===e.keyCode&&this.onClickHandler(e)}},{key:"buildTableIndexPath",value:function(){var e=this.props.path;return j.dropIndexFromPageSegment(e)}},{key:"traceCellModified",value:function(e,t,n,a,r,i){var o,s=this.props,c=s.config,l=s.path,u=s.runtime,d=c.row,g=c.column,f=$.getState(this),p=this.buildTableIndexPath(),h=X.getUserDefPathForIndexPath(p,u),v=G.extractCellType(f),m=de.isFormula(r)?"formula":v,y=de.isFormula(a)?"formula":v,b=Number.isNaN(Number.parseFloat(t));"formula"!==y?(a=t,t=void 0):b&&(t=void 0),i&&(n=void 0),"formula"===m?o={tableUserDefIdPath:h,tableUserDefId:q.getLastUserDefIdFromPath(h),row:d,column:g,oldValue:a,newValue:r,cellType:m,oldEvaluatedValue:t,newEvaluatedValue:n,errorInFormula:i}:(r=n,o={tableUserDefIdPath:h,tableUserDefId:q.getLastUserDefIdFromPath(h),row:d,column:g,oldValue:a,newValue:r,cellType:m,oldEvaluatedValue:t}),Re.traceUserInteraction("TableCellModified",l,o,e,void 0,u)}},{key:"render",value:function(){var e=this.props,t=e.runtime,n=e.config,a=e.path,r=e.orientation,i=this.state.hasHover,o=$.getState(this),s=G.extractSelected(o),c=Y.buildStyleByIndexPath(a,n,s,r,t);return n.isSpreadsheet&&(i?Y.setStyleAttribute(c,"background","-webkit-gradient(linear, 0% 0%, 0% 100%, from(rgb(235, 235, 235)), to(rgb(213, 213, 213)))"):s?Y.setStyleAttribute(c,"background",n.color.background.selected):Y.setStyleAttribute(c,"background",n.color.background.default),Y.setStyleAttribute(c,"textOverflow","ellipsis"),Y.setStyleAttribute(c,"whiteSpace","nowrap"),Y.setStyleAttribute(c,"overflow","hidden")),this.buildTableCell(n,a,t,r,c)}}],[{key:"createCellCopy",value:function(e,t,n){var a=z.deepCopy(e);return a.config.userDefinedId=void 0,a.type=n,a.path=j.appendIndexToPageSegment(t,0),a}},{key:"getFormulaOrValue",value:function(e,t,n){var a=n.componentStateManager.findOrBuildStateByUserDefPath(t,n);return"formula"===e?G.extractFormula(a):G.extractTextValue(a)}}]),t}(h.Component);function nt(e){var t=e.column,n=t.mouseOver,a=t.label,r=t.font,i={textAlign:r?r.alignmentHorizontal:""},o=Object(h.useRef)(null),s=Object(Ne.a)({accept:"".concat(t.parentPath,"-header"),drop:function(e){ct.handleColumnMove(t,e.id)},canDrop:function(e){return e.id!==t.key},collect:function(e){return{dragIsOver:e.isOver(),dragCanDrop:e.canDrop()}}}),c=Object(L.a)(s,2),l=c[0],u=c[1],d=Object(De.a)({item:{id:t.key,type:"".concat(t.parentPath,"-header")},canDrag:function(){return t.moveable}});return(0,Object(L.a)(d,2)[1])(u(o)),St.addCanDropStyleAttributes(i,l),v.a.createElement("div",{title:n,className:"CbaTreeHeaderInner",style:i,ref:o},v.a.createElement("span",null,a))}nt.defaultProps={column:{label:"default",key:""}};var at=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"traceSort",value:function(t,n,a,r){var i,o;ct.getTreeDataByPath(t,r).treeColumns.forEach(function(e,t){e.key===n&&(i=e.label,o=t)});var s={columnName:i,columnIndex:o,sortDirection:e.getSortDirectionForTrace(a)};Re.traceUserInteraction("TreeViewSort",t,s,void 0,void 0,r)}},{key:"getSortDirectionForTrace",value:function(e){switch(e){case"ASC":return"ascending";case"DESC":return"descending";case"NONE":return"none";default:return"<unknown: ".concat(e,">")}}},{key:"traceNodeAction",value:function(t,n,a,r,i,o,s){var c,l,u=a.isTreeView,d=a.treeViewPath,g=a.nodeType,f=a.nodePathId,p=a.nodeTypes,h=u?"TreeViewNode":"TreeNode",v=u?d:n;if(o||i||s||(l=ct.getNodeName(a)),g&&p){var m=ct.getNodeType(p,g).deleteEvent;c=e.isTriggeredEventRequired(m,t)?m:void 0}var y={operation:t,nodeName:l,oldValue:i,newValue:o,columnName:s,nodeType:g,nodePathId:f,triggeredEvent:c};Re.traceUserInteraction(h,v,y,void 0,void 0,r)}}]),e}();at.isTriggeredEventRequired=function(e,t){return void 0!==e&&""!==e&&"delete"===t};var rt=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"openContextMenu",value:function(t,n,a){t.persist();var r=n.runtime,i=e.buildContextMenuEntries(n,a);i.length&&r.contextMenu.openMenuItemTree({event:t,entries:i})}},{key:"buildContextMenuActionEntry",value:function(t,n,a){var r=Object.assign({},t),i=t.action;switch(i){case"CUT":r.action=function(){return e.buildContextMenuAction(i,n,ct.doTreeCut)},r.disabled=!1;break;case"COPY":r.action=function(){return e.buildContextMenuAction(i,n,ct.doTreeCopy)},r.disabled=!1;break;case"PASTE":r.action=function(){return e.buildContextMenuAction(i,n,ct.doTreePaste)},r.disabled=e.handlePasteDisabled(n);break;case"DELETE":r.action=function(){return e.buildContextMenuAction(i,n,ct.doTreeDelete)},r.disabled=!1;break;case"RENAME":r.action=function(){return ct.startRenameOperation(n,a)},r.disabled=!1;break;case"NEW":r.action=function(){return e.buildContextMenuAction(i,n,ct.doTreeNew,r.label)},r.disabled=!1;break;default:console.error("Invalid context menu config in tree",n)}return r}}]),e}();rt.buildContextMenuEntries=function(e,t){var n=e.nodeType,a=e.nodeTypes;return ct.getNodeType(a,n).contextMenuCommands.map(function(n){var a=Object.assign({},n);switch(n.type){case"action":a=rt.buildContextMenuActionEntry(a,e,t);break;case"submenu":a=Object.assign(a,{submenu:a.submenu.map(function(n){return rt.buildContextMenuActionEntry(n,e,t)}),disabled:!a.submenu.length});break;default:console.error("Invalid context menu config in tree",e)}return a})},rt.buildContextMenuAction=function(e,t,n,a){var r=t.path,i=t.treePath,o=t.runtime,s=t.isTreeView,c=t.treeViewPath;at.traceNodeAction(e.toLowerCase(),i,t,o),n(i,r,o,a,s,c)},rt.handlePasteDisabled=function(e){var t=e.treePath,n=e.runtime,a=e.path,r=e.nodeType,i=ct.getTreeDataByPath(t,n),o=i.treeState,s=i.nodeTypes,c=o.copiedNode,l=o.currentlyCutNodePath,u=ct.getNodeType(s,r);if(!o.copiedNode)return!0;if(!u.childTypes.includes(c.nodeType))return!0;if(c&&l){var d=[];if(c.nodes.length&&(d=ct.flattenNodes(c.nodes)),d.push(c),d.find(function(e){return e.path===a}))return!0}return!1};var it=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).handleContextMenuClick=function(e,t){var a=n.props,r=a.rowData,i=a.column,o=r.onRowSelect,s=r.runtime,c=r.isReadOnly;s.contextMenu||console.error("Context menu not found in tree row",r),t&&o(e,r),c||rt.openContextMenu(e,r,i.key),Re.stopEventPropagation(e)},n.handleRenameCell=function(){setTimeout(function(){n.setState({isRenameState:!0,cellEditedValue:n.getInitialState().cellEditedValue},function(){var e=n.props.rowData,t=e.treePath,a=e.runtime.componentDirectory.findComponent(t),r=$.getState(a),i=G.extractTreeState(r)||{};i.currentRenameNode=null,G.setTreeState(r,i),$.registerState(a,r),n.inputRef.current.focus()})},0)},n.handleCellInputFocus=function(e){e.target.select()},n.handleCellInputBlur=function(e){var t=n.props,a=t.rowData,r=t.column,i=n.state.cellEditedValue;n.getInitialState().cellEditedValue!==i&&ct.doTreeRename(a,r.key,i),n.setState(n.getInitialState())},n.handleCellInputKeyDown=function(e){e.stopPropagation(),d.keyCodes.Enter===e.keyCode&&n.inputRef.current.blur(),d.keyCodes.Escape===e.keyCode&&n.setState(n.getInitialState())},n.handleCellInputChange=function(e){e.stopPropagation();var t=e.target.value;return n.setState(function(){return{cellEditedValue:t}}),!1},n.onDoubleClick=function(e,t,n,a){e.stopPropagation();var r=a.treePath,i=a.runtime;at.traceNodeAction("doubleClick",r,a,i),t||n(e,a)},n.getCellData=function(){var e=n.props,t=e.rowData,a=e.column;return t.cells.find(function(e){return e.columnId===a.key})||{}},n.getInitialState=function(){var e=n.getCellData();return{isRenameState:!1,cellEditedValue:e?e.label:""}},n.state=n.getInitialState(),n.inputRef=v.a.createRef(),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e,t=this,n=this.props,a=n.rowData,r=n.idx,i=n.column,o=this.state,s=o.isRenameState,c=o.cellEditedValue,l=a.expanded,u=a.nodes,d=a.imagePath,g=a.depth,f=a.isLeaf,p=a.onRowExpandClick,h=a.onRowSelect,m=a.updateOnSingleClick,y=a.isTreeView,b=a.path,k=a.runtime,S=a.treePath,C=this.getCellData(),T=0!==u.length,P=C.label||"",E=C.mouseOver||"",x={paddingLeft:"".concat(16*(g-1),"px")},I={backgroundImage:d?"url(".concat(d,")"):null},O={width:i.width,height:a.height,left:i.left},M=ct.buildTreeCellStyle(C);e=y?f:m;var w=ct.getTreeDataByPath(S,k).treeState.currentRenameNode;return w&&w.cellPath===ct.buildCellPath(b,i.key)&&w.isTreeView===y&&this.handleRenameCell(),v.a.createElement("div",{className:"react-grid-Cell",style:O},v.a.createElement("div",{className:"CbaTreeCellInner",onClick:function(t){return e?h(t,a):t.stopPropagation()},onDoubleClick:function(n){return t.onDoubleClick(n,e,h,a)},onContextMenu:function(n){return t.handleContextMenuClick(n,e)},title:E,style:M},0===r&&v.a.createElement("div",{className:"CbaTreeCellInner-rowStart",style:x},v.a.createElement("div",{className:"CbaTreeCellInner-expander ".concat(l?"expanded":""," ").concat(T?"hasSubRows":""),onClick:function(e){return p(e,a)}}),v.a.createElement("div",{className:"CbaTreeCellInner-image",style:I})),!s&&v.a.createElement("div",{className:"CbaTreeCellInner-value",title:P},P),s&&v.a.createElement("input",{ref:this.inputRef,type:"text",value:c,onBlur:this.handleCellInputBlur,onFocus:this.handleCellInputFocus,onKeyDown:this.handleCellInputKeyDown,onChange:this.handleCellInputChange})))}}]),t}(h.Component);it.defaultProps={column:{label:"default"}};var ot=function(e){var t,n=e.row,a=e.columns,r=e.idx,i=e.height,o=n.nodeTypes,s=n.nodeType,c=n.treePath,l=n.runtime,u=n.isReadOnly,d=ct.getTreeDataByPath(c,l).treeState,g=d.currentNode,f=d.currentlyCutNodePath,p=g===n.path?"selected":"",m=f===n.path?"cut":"",y=r%2?"react-grid-Row--even":"react-grid-Row--odd",b={height:i,width:a.map(function(e){return e.width}).reduce(function(e,t){return e+t},0)},k=ct.getNodeType(o,s),S=ct.getTreeDragDropAction(c,l),C=0,T=Object(h.useRef)(null),P=Object(Ne.a)({accept:o.map(function(e){return"".concat(c,"-").concat(e.name)}),hover:function(){1===(C+=1)&&(t=new Date);var e=new Date-t;e>1400&&e<1600&&n.onRowExpandClick(null,n,!0)},drop:function(e){switch(S){case"DROP_COPY":ct.doTreeCopyAction(c,e.path,n.path,l);break;case"DROP_MOVE":ct.doTreeMoveAction(c,e.path,n.path,l);break;case"DROP_SWITCH":case"DROP_NONE":break;default:console.error("Invalid Tree drag&dropMode",c)}at.traceNodeAction("drop",c,n,l,void 0)},canDrop:function(e){return ct.canNodeTypeDrop(k,c,l,e.nodeType,u)},collect:function(e){return{dragIsOver:e.isOver(),dragCanDrop:e.canDrop()}}}),E=Object(L.a)(P,2),x=E[0],I=E[1],O=Object(De.a)({item:{path:n.path,type:"".concat(c,"-").concat(s),nodePathId:n.nodePathId,nodeType:n.nodeType,runtime:l},canDrag:function(){return ct.canNodeTypeDrag(k,c,l,u)},begin:function(){at.traceNodeAction("drag",c,n,l,void 0)}});return(0,Object(L.a)(O,2)[1])(I(T)),St.addCanDropStyleAttributes(b,x),v.a.createElement("div",{ref:T,style:b,className:" react-grid-Row ".concat(p," ").concat(m," ").concat(y)},a.map(function(e,t){return v.a.createElement(it,{key:e.key,column:e,rowData:n,idx:t})}))},st=function(e){function t(){return Object(a.a)(this,t),Object(E.a)(this,Object(x.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return v.a.createElement(ot,this.props)}}]),t}(h.PureComponent),ct=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"initTreeNodes",value:function(t,n,a,r,i){return t=d.deepCopy(t),e.resetPathsToNodes(t,a),e.parseNodes(t,function(t){var o=e.getNodeType(n,t.nodeType);return t.cells=t.cells.map(function(t,n){return t.columnId=e.buildColumnId(a,n),t}),t.isLeaf=0===o.childTypes.length,t.imagePath=Y.getProperResourcePath(o.image,r),t.expanded=e.isNodeExpandedAtInit(t,o,i.startCollapsed),t.children=t.nodes.length-1,!0}),t}},{key:"initTreeColumns",value:function(t,n){return 0===(t=d.deepCopy(t)).length&&t.push(e.const.DEFAULT_COLUMN),t.map(function(t,a){return t.key=e.buildColumnId(n,a),t.name=t.label,0===t.width&&delete t.width,t})}},{key:"initTreeState",value:function(e){var t={};return e.forEach(function(e,n){t[e.key]={order:n,width:e.width}}),{modifiedColumns:t}}},{key:"handleColumnResize",value:function(e,t,n){var a=$.getState(n),r=G.extractTreeState(a)||{};r.modifiedColumns[e].width=t,G.setTreeState(a,r),$.registerState(n,a)}},{key:"handleColumnMove",value:function(t,n){var a=t.runtime,r=t.key,i=t.parentPath,o=e.getTreePathFromColumnPath(r),s=a.componentDirectory.findComponent(i),c=$.getState(s),l=G.extractTreeState(c)||{},u=l.modifiedColumns,d=u[n],g=u[t.key],f=d.order>g.order;Object.keys(u).map(function(e){var t=u[e];return e===n?{key:e,order:g.order}:f&&t.order>=g.order&&t.order<d.order?{key:e,order:t.order+1}:!f&&t.order>d.order&&t.order<=g.order?{key:e,order:t.order-1}:{key:e,order:t.order}}).forEach(function(e){u[e.key].order=e.order}),G.setTreeState(c,l),$.registerState(s,c),e.emitTreeEvent(a.eventEmitter,o,a.replayStepMonitor)}},{key:"getDisplayColumns",value:function(t,n,a,r,i){return(t=d.deepCopy(t)).map(function(e){return e.sortable=n,e.headerRenderer=v.a.createElement(nt,{column:e}),e.parentPath=r,e.runtime=i,a&&a[e.key]&&a[e.key].width&&(e.width=a[e.key].width),e}).sort(e.sortAscendingByParameter("order",function(e){return a[e.key].order}))}},{key:"isDefaultColumn",value:function(e){return 1===e.length&&e[0].isDefault}},{key:"getTreeDisplayNodes",value:function(t,n,a){t=d.deepCopy(t);var r=[];return e.parseNodes(t,function(e){return e.isLeaf&&a||r.push(e),e.expanded}),r.sort(e.sortAscendingByIndexHierarchy(n)),r.map(function(e){return e.depth=j.extractTreeChildPathFromTreePath(n,e.path).split("/").length-1,e}),r}},{key:"getTreeViewDisplayNodes",value:function(t,n,a,r,i){var o=d.deepCopy(t),s=!r,c=e.getNode(o,r),l=(!s&&c?c.isLeaf?e.getParentNode(o,c.path).nodes:c.nodes:o).map(function(e){return e.expanded=!1,e.depth=1,e.nodes=[],e}),u=function(e,t){var n=e.cells.find(function(e){return e.columnId===i.column});return n?n[t]:""};switch(i.type){case"NONE":l.sort(e.sortAscendingByIndexHierarchy(n));break;case"ASC":l.sort(e.sortAscendingByParameter("label",u));break;case"DESC":l.sort(e.sortDescendingByParameter("label",u));break;default:l.sort(e.sortAscendingByIndexHierarchy(n))}return a?l.filter(function(e){return e.isLeaf&&a}):l}},{key:"resetPathsToNodes",value:function(t,n){t.forEach(function(t,a){t.path=j.appendIndexToPageSegment(n,a),t.nodes.length>0&&e.resetPathsToNodes(t.nodes,t.path)})}},{key:"flattenNodes",value:function(t){var n=[];return e.parseNodes(t,function(e){return n.push(e)}),n}},{key:"parseNodes",value:function(t,n){t.forEach(function(t){var a=n(t);t.nodes.length>0&&a&&e.parseNodes(t.nodes,n)})}},{key:"isNodeExpandedAtInit",value:function(e,t,n){return 0!==e.nodes.length&&(!n&&!t.startCollapsed)}},{key:"getNodeType",value:function(e,t){return e.filter(function(e){return e.name===t})[0]}},{key:"createNodeFromNodeType",value:function(t,n,a,r){return{cells:d.deepCopy(t.cellInitSettings).map(function(e,t){return Object.assign(e,{columnId:n[t].key})}),contentPage:t.contentPage,event:t.event,expanded:!1,imagePath:Y.getProperResourcePath(t.image,r),isLeaf:0===t.childTypes.length,link:t.link,nodePathId:e.generateNodePathId(t,a),nodeType:t.name,nodes:[],path:null,tooltip:t.tooltip,children:-1,userDefinedId:t.userDefId}}},{key:"getNode",value:function(t,n){var a;return e.parseNodes(t,function(e){return e.path!==n||(a=e,!1)}),a}},{key:"getNodeName",value:function(e){if(void 0!==e){var t=e.cells.find(function(e){return e.isPrimary});if(void 0!==t)return t.label}}},{key:"getParentNode",value:function(t,n){var a=j.dropIndexFromPageSegment(n),r=e.getNode(t,a);return r||{root:!0,nodes:t}}},{key:"buildTreeCellStyle",value:function(e){if(!e)return{};var t={fontFamily:"".concat(e.font.name,", Geneva, sans-serif"),fontSize:e.font.size,fontWeight:e.font.bold?"bold":"normal",fontStyle:e.font.italic?"italic":"normal",textDecoration:e.font.underlined?"underline":"none",textAlign:e.font.alignmentHorizontal};return Y.setStyleAttribute(t,"color",Y.chooseImageOrColorVariant(e.color.text,!1,!1,!1)),t}},{key:"selectNodeAction",value:function(t,n){var a=n.runtime,r=n.path,i=n.contentPage,o=e.getTreeDataByPath(t,a),s=o.treeState,c=o.treeNodes,l=e.getNode(c,r);s.currentNode=r,s.currentPage=i,l.visited=!0,at.traceNodeAction("selection",t,n,a),e.setTreeDataByPath(t,a,c,s,null,null),e.emitTreeEvent(a.eventEmitter,t,a.replayStepMonitor)}},{key:"emitTreeEvent",value:function(t,n,a){a.incrementReplayStep(),t.emit(e.getTreeEventChangeName(n))}},{key:"getVisitedPathIds",value:function(t,n){return e.getTreeFlatNodesFromUserDefIdPath(t,n).filter(function(e){return e.visited}).map(function(e){return e.nodePathId})}},{key:"getNodePathIds",value:function(t,n){return e.getTreeFlatNodesFromUserDefIdPath(t,n).map(function(e){return e.nodePathId})}},{key:"getCurrentNodePathId",value:function(t,n){var a=X.getIndexPathForUserDefPath(t,n),r=e.getTreeDataByPath(a,n),i=r.treeState,o=r.treeNodes,s=e.flattenNodes(o),c=i.currentNode,l=s.find(function(e){return e.path===c});return l?l.nodePathId:null}},{key:"getColumnValuesMap",value:function(t,n,a){var r=e.getTreeFlatNodesFromUserDefIdPath(t,a),i=new Map;return n.forEach(function(e){var t=r.find(function(t){return t.nodePathId===e}).cells.map(function(e){return e.label});i.set(e,t)}),i}},{key:"treeMoveCurrentNode",value:function(t,n,a){e.treeActionCurrentNode(t,n,a,e.doTreeMoveAction)}},{key:"treeCopyCurrentNode",value:function(t,n,a){e.treeActionCurrentNode(t,n,a,e.doTreeCopyAction)}},{key:"treeActionCurrentNode",value:function(t,n,a,r){var i=X.getIndexPathForUserDefPath(t,a),o=e.getTreeDataByPath(i,a),s=o.treeState,c=o.treeNodes,l=s.currentNode,u=e.flattenNodes(c).find(function(e){return e.nodePathId===n});u&&!u.isLeaf&&s.currentNode&&r(i,l,u.path,a)}},{key:"doTreeMoveAction",value:function(t,n,a,r){a.includes(n)?console.error("Could not move tree node from parent to child",n,a):(e.doTreeCut(t,n,r),e.doTreePaste(t,a,r))}},{key:"doTreeCopyAction",value:function(t,n,a,r){e.doTreeCopy(t,n,r),e.doTreePaste(t,a,r)}},{key:"doTreeCopy",value:function(t,n,a,r){var i=e.getTreeDataByPath(t,a),o=i.treeNodes,s=i.treeState,c=e.getNode(o,n);r||(s.currentlyCutNodePath=null),s.copiedNode=d.deepCopy(c),s.copiedNode=e.collapseNode(s.copiedNode),e.setTreeDataByPath(t,a,null,s,null),e.emitTreeEvent(a.eventEmitter,t,a.replayStepMonitor)}},{key:"doTreePaste",value:function(t,n,a){var r=e.getTreeDataByPath(t,a),i=r.treeNodes,o=r.treeState,s=e.getNode(i,n),c=o,l=c.copiedNode,u=c.currentlyCutNodePath;if(l){if(u){e.doTreeDelete(t,u,a,!0);var d=e.getTreeDataByPath(t,a);i=d.treeNodes,o=d.treeState,s=e.getNode(i,n),o.currentlyCutNodePath=null,o.copiedNode=null}l.nodePathId=e.generateNodePathId(l,s),e.parseNodes(l.nodes,function(t){var n=e.getParentNode(l.nodes,t.path);return n.root&&(n=l),t.nodePathId=e.generateNodePathIdChild(t,n),!0}),s.nodes.push(l),s.children+=1,e.resetPathsToNodes(i,t),e.setTreeDataByPath(t,a,i,o,null),e.emitTreeEvent(a.eventEmitter,t,a.replayStepMonitor)}else console.error("Tree context menu error, no node to paste")}},{key:"doTreeDelete",value:function(t,n,a,r){var i=e.getTreeDataByPath(t,a),o=i.treeNodes,s=i.treeState,c=i.nodeTypes,l=e.getParentNode(o,n),u=e.getNode(o,n),d=e.getNodeType(c,u.nodeType);r||!d.deleteEvent?(e.parseNodes(o,function(t){var a=[];if(t.path===n){(a=e.flattenNodes(t.nodes)).push(t);var r=!!a.find(function(e){return s.currentNode===e.path}),i=!!a.find(function(e){return s.currentlyCutNodePath===e.path});return r&&(s.currentNode=null),i&&(s.currentlyCutNodePath=null,s.copiedNode=null),!1}return!0}),l.root?o=o.filter(function(e){return e.path!==n}):l.nodes=l.nodes.filter(function(e){return e.path!==n}),e.setTreeDataByPath(t,a,o,s),e.emitTreeEvent(a.eventEmitter,t,a.replayStepMonitor)):Re.sendEvent(d.deleteEvent,a)}},{key:"startRenameOperation",value:function(t,n){var a=t.treePath,r=t.path,i=t.runtime,o=t.isTreeView,s=e.getTreeDataByPath(a,i).treeState;s.currentRenameNode={isTreeView:o,cellPath:e.buildCellPath(r,n)},e.setTreeDataByPath(a,i,null,s,null,null),e.emitTreeEvent(i.eventEmitter,a,i.replayStepMonitor)}},{key:"doTreeRename",value:function(t,n,a){var r=t.treePath,i=t.path,o=t.runtime,s=e.getTreeDataByPath(r,o),c=s.treeNodes,l=s.treeColumns,u=e.getNode(c,i).cells.find(function(e){return e.columnId===n}),d=l.find(function(e){return e.key===n}),g=u.label;u.label=a,e.setTreeDataByPath(r,o,c,null,null,null),e.emitTreeEvent(o.eventEmitter,r,o.replayStepMonitor),at.traceNodeAction("rename",r,t,o,g,a,d.name)}},{key:"doTreeNew",value:function(t,n,a,r,i,o){var s=e.getTreeDataByPath(t,a),c=s.treeNodes,l=s.treeColumns,u=s.nodeTypes,d=e.getNode(c,n),g=e.getNodeType(u,r),f=e.createNodeFromNodeType(g,l,d,a);d.expanded=!0,d.nodes.push(f),d.children+=1,e.resetPathsToNodes(c,t),e.setTreeDataByPath(t,a,c,null,null,null);var p=f.cells.find(function(e){return e.isPrimary}).columnId,h=Object.assign({runtime:a,treePath:t,isTreeView:i,treeViewPath:o},f);e.selectNodeAction(t,h),e.startRenameOperation(h,p)}}]),e}();ct.const={COLUMN_HEIGHT:34,ROW_HEIGHT:25,DEFAULT_COLUMN:{label:"default",isPrimary:!0,isDefault:!0}},ct.buildCellPath=function(e,t){return"".concat(e,"_").concat(t)},ct.buildColumnId=function(e,t){return"".concat(e,"--").concat(t)},ct.generateNodePathId=function(e,t){return"".concat(t.nodePathId,"_").concat(e.userDefinedId,"-").concat(t.children+1)},ct.generateNodePathIdChild=function(e,t){return"".concat(t.nodePathId,"_").concat(e.nodePathId.split("_").slice(-1).pop())},ct.getTreeEventChangeName=function(e){return"".concat(e,"-TreeChangeEvent")},ct.getTreePathFromColumnPath=function(e){return e.split("--")[0]},ct.sortAscendingByParameter=function(e,t){return function(n,a){var r=t?t(n,e):n[e],i=t?t(a,e):a[e],o=0;return r>i?o=1:r<i&&(o=-1),o}},ct.sortDescendingByParameter=function(e,t){return function(n,a){var r=t?t(n,e):n[e],i=t?t(a,e):a[e],o=0;return r<i?o=1:r>i&&(o=-1),o}},ct.sortAscendingByIndexHierarchy=function(e){return function(t,n){for(var a=j.extractTreeChildPathFromTreePath(e,t.path),r=j.extractTreeChildPathFromTreePath(e,n.path),i=a.split("/index="),o=r.split("/index="),s=Math.min(i.length,o.length),c=0;c<s;c+=1){var l=parseInt(i[c],10),u=parseInt(o[c],10);if(l>u)return 1;if(l<u)return-1}return i.length>o.length?1:i.length<o.length?-1:0}},ct.collapseNode=function(e){return e.expanded=!1,!e.isLeaf&&e.nodes.length&&ct.parseNodes(e.nodes,function(e){return e.expanded=!1,!0}),e},ct.getTreeDragDropAction=function(e,t){var n=t.componentDirectory.findComponent(e);return n?n.props.config["drag&dropMode"]:""},ct.canNodeTypeDrag=function(e,t,n,a){var r=n.componentDirectory.findComponent(t).props.config.dragSource,i=e.dragSource;return!a&&r&&i},ct.canNodeTypeDrop=function(e,t,n,a,r){var i=n.componentDirectory.findComponent(t).props.config.dropTarget,o=e.dropTarget;return!r&&i&&o&&e.childTypes.includes(a)},ct.getTreeInstanceFromChildComponent=function(e){var t=e.runtime,n=e.config,a=e.path,r=n.treePathId,i=ct.getTreePathFromChildComponent(r,a);return t.componentDirectory.findComponent(i)},ct.getTreePathFromChildComponent=function(e,t){return j.dropPageSegmentFromPath(t)+e},ct.getTreeFromUserDefIdPath=function(e,t){return t.componentDirectory.findComponent(X.getIndexPathForUserDefPath(e,t))},ct.getTreeFlatNodesFromUserDefIdPath=function(e,t){var n=X.getIndexPathForUserDefPath(e,t),a=ct.getTreeDataByPath(n,t);return ct.flattenNodes(a.treeNodes)},ct.getTreeDataByPath=function(e,t){return{treeNodes:$.getStateAttributeByPathId(G.extractTreeNodes,e,t)||[],treeState:$.getStateAttributeByPathId(G.extractTreeState,e,t)||{},treeColumns:$.getStateAttributeByPathId(G.extractTreeColumns,e,t)||[],nodeTypes:$.getStateAttributeByPathId(G.extractNodeTypes,e,t)||[],treeReadOnly:$.getStateAttributeByPathId(G.extractTreeReadOnly,e,t)||!1}},ct.setTreeDataByPath=function(e,t,n,a,r,i){if(n){var o=G.extractTreeNodes,s=G.setTreeNodes;$.updateStateAttribute(o,s,n,e,t,!1)}if(a){var c=G.extractTreeState,l=G.setTreeState;$.updateStateAttribute(c,l,a,e,t,!1)}if(r){var u=G.extractTreeColumns,d=G.setTreeColumns;$.updateStateAttribute(u,d,r,e,t,!1)}if(i){var g=G.extractNodeTypes,f=G.setNodeTypes;$.updateStateAttribute(g,f,i,e,t,!1)}},ct.doTreeCut=function(e,t,n){var a=ct.getTreeDataByPath(e,n).treeState;a.currentlyCutNodePath=t,ct.setTreeDataByPath(e,n,null,a,null),ct.doTreeCopy(e,t,n,!0)};var lt={DE:{decimal:",",grouping:"."},EN:{decimal:".",grouping:","}};var ut=function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.handleTreeChange=function(){Q.triggerRendering(Object(O.a)(Object(O.a)(n)))};var r=n.props.runtime;return n.scrollableAreaRef=v.a.createRef(),n.eventEmitter=r.eventEmitter,n.onClickHandler=n.onClickHandler.bind(Object(O.a)(Object(O.a)(n))),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this);var e=this.props,t=e.path,n=e.config.treePathId,a=ct.getTreePathFromChildComponent(n,t);this.subscription=this.eventEmitter.addListener(ct.getTreeEventChangeName(a),this.handleTreeChange)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this),this.subscription.remove()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"onClickHandler",value:function(e){Re.doStandardOnClick(e,void 0,this)}},{key:"scroll",value:function(e,t){var n=this.scrollableAreaRef.current;n&&d.doScrollOnHTMLElement(e,t,n,n)}},{key:"render",value:function(){var e=this,n=this.props,a=n.config,r=n.runtime,i=n.path,o=n.orientation,s=t.getEmbeddedPageName(i,a,r),c=Y.buildStyleByIndexPath(i,a,!1,o,r),l=$.getState(this),u={};return G.setPosition(u,G.extractPosition(l)),void 0===s?v.a.createElement("div",{style:c,"data-cba-id":a.pageEditId,onClick:function(t){return Re.doStandardOnClick(t,void 0,e)},title:Y.buildTitle(a),className:Y.getCssClassNamesValue(a)}):v.a.createElement(he,{onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,orientation:o,embeddedPageName:s,hasTabs:!1,tabsBar:v.a.createElement("span",null),path:i,position:u,config:a,scrollableAreaRef:this.scrollableAreaRef,runtime:r})}}],[{key:"getEmbeddedPageName",value:function(e,t,n){var a=t.treePathId,r=ct.getTreePathFromChildComponent(a,e);return ct.getTreeDataByPath(r,n).treeState.currentPage||void 0}}]),t}(h.PureComponent),dt=n(323),gt=(n(560),function(e){var t=e.type,n=e.stream,a=e.style,r=e.pauseRecording,i=e.resumeRecording,o=e.shouldPause,s=Object(h.useRef)();return Object(h.useEffect)(function(){s.current&&n&&(s.current.srcObject=n),null!==s.current&&void 0!==s.current&&o&&s.current.pause()},[n,o]),n?"video"===t?v.a.createElement("video",{ref:s,style:a,onPause:r,onPlay:i,autoPlay:!0,controls:!0}):v.a.createElement("div",{style:a},v.a.createElement("audio",{ref:s,onPause:r,onPlay:i,autoPlay:!0,controls:!0,className:"audio"}),!o&&v.a.createElement("span",{className:"recording"})):null});gt.defaultProps={stream:null};var ft=gt,pt="play",ht="pause",vt="stop",mt="ended",yt=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onClickHandler=function(e){Re.doStandardOnClick(e,void 0,Object(O.a)(Object(O.a)(n)))},n.onClickCapture=function(e){},n.onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.onPlayHandler=function(e){var t=n.props,a=t.config,r=t.runtime;n.isTaskPlayerPausePlay?n.isTaskPlayerPausePlay=!1:(n.saveInStateLastOperation(pt),n.traceMedia(pt,n.isStatemachineTriggered,e),Re.sendEvent(a.startEvent,r),n.isStatemachineTriggered=!1)},n.onPauseHandler=function(e){var t=n.props,a=t.config,r=t.runtime,i=n.getMediaPlayer();if(i.duration===i.currentTime||n.isPauseHandled||n.isTaskPlayerPausePlay)return n.isPauseHandled=!1,void(n.isTaskPlayerPausePlay=!1);n.saveInStateLastOperation(ht),n.traceMedia(ht,n.isStatemachineTriggered,e),Re.sendEvent(a.pauseEvent,r),n.isStatemachineTriggered=!1},n.onStopHandler=function(){var e=n.props,t=e.config,a=e.runtime,r=$.getState(Object(O.a)(Object(O.a)(n)));G.extractLastOperation(r)!==vt&&(n.saveInStateLastOperation(vt),n.traceMedia(vt,n.isStatemachineTriggered,void 0),Re.sendEvent(t.stopEvent,a)),n.isStatemachineTriggered=!1},n.onEndedHandler=function(e){var t=n.props,a=t.config,r=t.runtime;n.saveInStateLastOperation(mt),n.increasePlayNumberAndCheckMaxPlay(),n.traceMedia(mt,!1,e),Re.sendEvent(a.endEvent,r)},n.handleTaskPauseOrResume=function(e){var t=n.getMediaPlayer();if(!t)return null;var a=G.extractLastOperation($.getState(Object(O.a)(Object(O.a)(n))));return e&&a===pt&&(n.shouldPlayOnResume=!0,n.isTaskPlayerPausePlay=!0,t.pause()),!e&&n.shouldPlayOnResume&&(t.play(),n.shouldPlayOnResume=!1,n.isTaskPlayerPausePlay=!0),null},n.onVolumeChange=function(){var e=$.getState(Object(O.a)(Object(O.a)(n))),t=n.getMediaPlayer();G.setMediaVolume(e,parseInt(10*t.volume,10)),$.registerState(Object(O.a)(Object(O.a)(n)),e)},n.onTimeUpdate=function(){var e=n.props.runtime,t=$.getState(Object(O.a)(Object(O.a)(n))),a=n.getMediaPlayer(),r=parseInt(a.currentTime,10);G.extractCurrentTime(t)!==r&&(G.setCurrentTime(t,r),e.eventEmitter.emit("currentTimeUpdate",r)),$.registerState(Object(O.a)(Object(O.a)(n)),t)},n.getMediaPlayer=function(){var e=n.mediaRef.current;return null===e||void 0===e?(console.info("The player is not there (anymore); probably max play number was reached or there is nothing to play."),null):e},n.endRecording=function(e){var t=n.props,a=t.runtime,r=t.config,i=t.path,o=$.getState(Object(O.a)(Object(O.a)(n))),s=G.extractRecordNumber(o);G.setMediaBlob(o,e),$.registerState(Object(O.a)(Object(O.a)(n)),o);var c=a.taskManager.getCurrentTestTaskItemNames(),l=X.getUserDefPathForIndexPath(i,a);a.recordingBuffer.reportRecording(r.userDefinedId,n.startRecordingTime,s,e,c,l),n.isRecording=!1,n.shouldPause=!1,Q.triggerRendering(Object(O.a)(Object(O.a)(n)))},n.debouncedEndRecording=w()(n.endRecording,500),n.mediaRef=v.a.createRef(),n.isStatemachineTriggered=!1,n.startRecordingTime=void 0,n.shouldPlayOnResume=!1,n.shouldSendStartRecordingEvent=!0,n.isPauseHandled=!1,n.isTaskPlayerPausePlay=!1,n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this);var e=this.props,t=e.runtime,n=e.config,a=e.path;void 0!==n.src&&void 0!==n.src.dynamic&&t.variableManager.addVariableChangeObserver(a,n.src.dynamic.variable),this.setVolumeFromState()}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this);var e=this.props,t=e.runtime,n=e.config,a=e.path;void 0!==n.src&&void 0!==n.src.dynamic&&t.variableManager.dropVariableChangeObserver(a,n.src.dynamic.variable)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"componentDidUpdate",value:function(){this.setVolumeFromState()}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.props.config.recording,n=$.getState(this),a=G.extractMaxRecord(n),r=G.extractRecordNumber(n);if(t){if(a>0&&r===a)return void console.info("The max record number was reached!");this.isRecording=!0,this.startRecordingTime=S()().format(),this.resumeRecording&&this.resumeRecording(),G.setRecordNumber(n,r+1),$.registerState(this,n),Q.triggerRendering(this)}else{var i=this.getMediaPlayer();if(!i)return;this.isStatemachineTriggered=e,i.play()}}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.stopRecording)this.stopRecording();else{var t=this.getMediaPlayer();if(!t)return;this.isStatemachineTriggered=e,this.isPauseHandled=!0,t.pause(),t.currentTime=0,this.onStopHandler()}}},{key:"pause",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.pauseRecording)this.pauseRecording(),Q.triggerRendering(this);else{var t=this.getMediaPlayer();if(!t)return;this.isStatemachineTriggered=e,t.pause()}}},{key:"saveInStateLastOperation",value:function(e){var t=$.getState(this);G.setLastOperation(t,e),$.registerState(this,t)}},{key:"setVolumeFromState",value:function(){var e=$.getState(this),n=G.extractMediaVolume(e),a=void 0!==n?t.convertToMediaRefVolume(n):void 0;void 0!==a&&null!==this.mediaRef.current&&(this.mediaRef.current.volume=a)}},{key:"increasePlayNumberAndCheckMaxPlay",value:function(){var e=$.getState(this),t=G.extractMaxPlay(e),n=G.extractPlayNumber(e)+1;G.setPlayNumber(e,n),$.registerState(this,e),n===t&&(G.setHideControls(e,!0),$.registerState(this,e),Q.triggerRendering(this))}},{key:"traceMedia",value:function(e,n,a){var r=this.props,i=r.config,o=r.path,s=r.runtime,c=i.trace,l=$.getState(this),u=G.extractAutomaticStart(l),d=G.extractMaxPlay(l),g=G.extractHideControls(l),f=z.deepCopy(i.trace);void 0!==c.type&&"ValueDisplay"!==c.type&&(f.type="".concat(c.type,"Control")),Re.traceUserInteractionPerTraceConfig(f,o,"ValueDisplay"===c.type?{}:{operation:e,maxPlay:d,currentPlayNo:G.extractPlayNumber(l),automaticStart:u,hideControls:g,volumeLevel:t.computeVolumeInPercentage(G.extractMediaVolume(l)),isStatemachineTriggered:n},"ValueDisplay"===c.type?a:void 0,s)}},{key:"createMediaRecorder",value:function(e,t,n,a){var r=this;return v.a.createElement(dt.ReactMediaRecorder,{audio:!0,video:"video"===e,render:function(i){var o=i.status,s=i.startRecording,c=i.stopRecording,l=i.pauseRecording,u=i.resumeRecording,d=i.mediaBlobUrl,g=i.previewStream;return r.stopRecording=function(){Re.sendEvent(n.stopRecordingEvent,a),c(),r.shouldSendStartRecordingEvent=!0},r.pauseRecording=function(){Re.sendEvent(n.pauseRecordingEvent,a),l(),r.shouldPause=!0,r.shouldSendStartRecordingEvent=!0},r.resumeRecording=function(){r.shouldSendStartRecordingEvent&&(Re.sendEvent(n.startRecordingEvent,a),r.shouldSendStartRecordingEvent=!1),u(),r.shouldPause=!1,"audio"===e&&Q.triggerRendering(r)},"idle"===o&&s(),"stopped"===o&&d&&r.debouncedEndRecording(d),v.a.createElement(ft,{type:e,stream:"recording"===o?g:null,style:t,pauseRecording:r.pauseRecording,resumeRecording:r.resumeRecording,shouldPause:r.shouldPause})}})}},{key:"render",value:function(){var e,t=this.props,n=t.config,a=t.runtime,r=t.path,i=t.orientation,o=n.type,s=n.imageReference,c=$.getState(this),l=G.extractMediaVolume(c)<=0,u=G.extractAutomaticStart(c),d=G.extractHideControls(c),g=G.extractMediaBlob(c),f=Y.buildStyleByIndexPath(r,n,!1,i,a),p=void 0!==n.src&&void 0!==n.src.dynamic?Y.getDynamicValueFromStatemachineAndMapper(n.src.dynamic,a):void 0,h=g||Y.getProperResourcePath(void 0===p||0===p.length?n.src.mediaReference:p,a),m=n.src.mediaAlternateRef?Y.getProperResourcePath(n.src.mediaAlternateRef,a):void 0,y=n.src.mediaReferenceExternal,b=n.src.mediaAlternateRefExternal,k=void 0===s||0===s.length?void 0:Y.getProperResourcePath(s,a),S=void 0!==h&&null!==h&&h.length>0||void 0!==m&&m.length>0||void 0!==y&&y.length>0||void 0!==b&&b.length>0||this.isRecording,C=h,T={width:"100%",height:"100%"},P=void 0!==n.cbaChildren?n.cbaChildren.map(function(e,t){var n=j.appendIndexToPageSegment(r,t);return v.a.createElement(gn,{key:n,config:e,path:n,runtime:a,orientation:i})}):void 0;return this.isRecording?e=this.createMediaRecorder(o,T,n,a):"audio"===o?e=v.a.createElement("audio",{ref:this.mediaRef,key:C,style:T,controls:!d,autoPlay:u,muted:l,controlsList:"nodownload",onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,onPlay:this.onPlayHandler,onPause:this.onPauseHandler,onEnded:this.onEndedHandler,onVolumeChange:this.onVolumeChange,title:Y.buildTitle(n),tabIndex:n.tabIndex},v.a.createElement("source",{src:h}),m&&v.a.createElement("source",{src:m}),y&&v.a.createElement("source",{src:y}),b&&v.a.createElement("source",{src:b}),"Your browser does not support the audio element."):"video"===o&&(e=v.a.createElement("video",{ref:this.mediaRef,key:C,style:T,controls:!d,autoPlay:u,muted:l,poster:k,controlsList:"nodownload nofullscreen noremoteplayback noplaybackrate",disablePictureInPicture:!0,onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,onPlay:this.onPlayHandler,onPause:this.onPauseHandler,onEnded:this.onEndedHandler,onVolumeChange:this.onVolumeChange,onTimeUpdate:this.onTimeUpdate,title:Y.buildTitle(n),tabIndex:n.tabIndex},v.a.createElement("source",{src:h,type:"video/mp4"}),m&&v.a.createElement("source",{src:m,type:"video/mp4"}),y&&v.a.createElement("source",{src:y,type:"video/mp4"}),b&&v.a.createElement("source",{src:b,type:"video/mp4"}),"Your browser does not support the video element.")),v.a.createElement("div",{style:f,"data-cba-id":n.pageEditId,onClick:S?void 0:this.onClickHandler,onClickCapture:this.onClickCapture,className:Y.getCssClassNamesValue(n)},S&&e,P)}}],[{key:"convertToMediaRefVolume",value:function(e){return e<0?e=0:e>10&&(e=10),e/10}},{key:"computeVolumeInPercentage",value:function(e){return parseInt(10*e,10)}},{key:"addAttributesToInitialState",value:function(e,t){e.volume=t.useAudio?1:0,e.lastOperation=void 0,e.playNumber=0,e.hideControls=t.hideControls,e.automaticStart=t.automaticStart,e.hideControls=t.hideControls,e.maxPlay=t.maxPlay,e.maxRecord=t.maxRecord,e.recordNumber=0}},{key:"createDelegateComponent",value:function(e,t,n){var a=z.deepCopy(e);return a.config.userDefinedId=void 0,a.type=n,{delegatePath:j.appendIndexToPageSegment(t,0),delegateComponent:a}}}]),t}(h.Component),bt=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"contextValue",value:function(e,t,n){var a=n[e.valueIndex];if(void 0===e.attributes)return a;var r=a;return e.attributes.forEach(function(e){r=void 0===r?void 0:r[e]}),r}},{key:"and",value:function(e,t){return void 0!==e.paramsArray?e.paramsArray.reduce(function(e,t,n,a){return e&&t},!0):e.left&&e.right}},{key:"or",value:function(e,t){return void 0!==e.paramsArray?e.paramsArray.reduce(function(e,t,n,a){return e||t},!1):e.left||e.right}},{key:"not",value:function(e,t){return!e.value}},{key:"ifThenElse",value:function(e,t){return e.if?e.then:e.else}},{key:"ifGuard",value:function(e,t){return e.activeBranch}},{key:"equal",value:function(e,t){return e.left===e.right}},{key:"notEqual",value:function(e,t){return e.left!==e.right}},{key:"greater",value:function(e,t){return e.left>e.right}},{key:"greaterEqual",value:function(e,t){return e.left>=e.right}},{key:"less",value:function(e,t){return e.left<e.right}},{key:"lessEqual",value:function(e,t){return e.left<=e.right}},{key:"max",value:function(e,t){return void 0!==e.paramsArray?e.paramsArray.sort(function(e,t){return t-e})[0]:e.left>e.right?e.left:e.right}},{key:"maxNamed",value:function(e,t){var n,a;return Object.keys(e).forEach(function(t){var r=e[t];(void 0===n||n<r)&&(n=r,a=t)}),a}},{key:"matches",value:function(e){try{return RegExp(e.pattern,"m").test(e.candidate)}catch(t){return console.log("Invalid regular expression in matches operator: ".concat(e.pattern," -> evaluate matches call to 'false'")),!1}}},{key:"arrayLength",value:function(e,t){return e.value.length}},{key:"union",value:function(e,t){var n=e.left,a=e.right,r=[];return n.forEach(function(e){r.includes(e)||r.push(e)}),a.forEach(function(e){r.includes(e)||r.push(e)}),r}},{key:"intersection",value:function(e,t){var n=e.left,a=e.right,r=[];return n.forEach(function(e){a.includes(e)&&!r.includes(e)&&r.push(e)}),r}},{key:"add",value:function(e,t){return void 0!==e.paramsArray?e.paramsArray.reduce(function(e,t,n,a){return e+t},0):e.left+e.right}},{key:"subtract",value:function(e,t){return e.left-e.right}},{key:"multiply",value:function(e,t){return void 0!==e.paramsArray?e.paramsArray.reduce(function(e,t,n,a){return e*t},1):e.left*e.right}},{key:"divide",value:function(e,t){return e.left/e.right}},{key:"modulo",value:function(e,t){return e.left%e.right}},{key:"floor",value:function(e,t){return Math.floor(e.value)}},{key:"ceil",value:function(e,t){return Math.ceil(e.value)}},{key:"trunc",value:function(e,t){return Math.trunc(e.value)}},{key:"round",value:function(e,t){return Math.round(e.value)}},{key:"stringFormat",value:function(e,t){var n=e.expression;return e.valuesArray.forEach(function(e,t){var a="%".concat(t+1,"[$]s"),r=new RegExp(a,"g");n=n.replace(r,e)}),n}},{key:"concatenate",value:function(e,t){return e.left+e.right}},{key:"boolToString",value:function(e,t){return e.cond.toString()}},{key:"numberToString",value:function(e,t){return e.expression.toString()}},{key:"contains",value:function(e,t){var n=e.container;return e.candidates.every(function(e){return n.includes(e)})}},{key:"getCurrentTest",value:function(e,t){return t.taskManager.getCurrentTestTaskItemNames().test}},{key:"getCurrentTask",value:function(e,t){return t.taskManager.getCurrentTestTaskItemNames().task}},{key:"getCurrentItem",value:function(e,t){return t.taskManager.getCurrentTestTaskItemNames().item}},{key:"getCurrentPage",value:function(e,t){switch(e.pageType){case"standard":return t.taskManager.getCurrentPageNames().standardPage;case"xPage":return t.taskManager.getCurrentPageNames().xPage;default:return void console.error("Illegal page type in getCurrentPage call: ".concat(e.pageType))}}},{key:"getEmbeddedPage",value:function(e,t){var n=X.getIndexPathForUserDefPath(e.absoluteUserDefId,t),a=t.pageConfigurationsManager.findPageSegmentForUserDefId(q.getLastUserDefIdFromPath(e.absoluteUserDefId)),r=t.pageConfigurationsManager.findConfigurationForPageSegment(a);if(void 0!==r)switch(r.type){case"CbaPageArea":return ve.getEmbeddedPageName(n,r.config,t);case"CbaTreeChildArea":return ut.getEmbeddedPageName(n,r.config,t);default:return void console.error("Not supported component type ".concat(r.type," in getEmbeddedPage call with reference: ").concat(e.absoluteUserDefId))}else console.error("Illegal page area reference in getEmbeddedPage call: ".concat(e.absoluteUserDefId))}},{key:"switchPage",value:function(e,t){var n=void 0===e.receiver?void 0:j.trimRootAndPageAreaFromPath(X.getIndexPathForUserDefPath(e.receiver,t)),a=void 0===e.receiverTabName?void 0:{name:e.receiverTabName,image:e.receiverTabImage},r=void 0===e.x||void 0===e.y?void 0:{x:e.x,y:e.y};t.taskManager.switchPage(e.pageName,void 0,e.pageUrl,e.pageAreaType,e.pageAreaName,n,a,void 0,r)}},{key:"closeDialog",value:function(e,t){var n=t.dialogPresenter;void 0!==n&&n.closeDialog({pageAreaName:e.pageAreaName,type:e.pageAreaType})}},{key:"saveTaskResults",value:function(e,t){t.taskManager.saveCurrentTaskResults()}},{key:"previousTask",value:function(e,t){t.taskManager.switchTaskPrevious()}},{key:"nextTask",value:function(e,t){t.taskManager.switchTaskNext()}},{key:"cancelTask",value:function(e,t){t.taskManager.cancelTask()}},{key:"switchTaskInTest",value:function(e,t){t.taskManager.switchFirstMatchingTaskIntraTest(e.taskName)}},{key:"switchTaskAndTest",value:function(e,t){t.taskManager.switchFirstMatchingTaskInterTest(e.testName,e.taskName)}},{key:"recommend",value:function(e,t){t.recommendationsManager.setRecommendations(e.recommendations)}},{key:"nbUserInteractions",value:function(e,t){return t.incidentsAccumulator.nbUserInteractions(t.taskManager.getCurrentStatePathRoot())}},{key:"nbUserInteractionsTotal",value:function(e,t){return t.incidentsAccumulator.nbUserInteractionsTotal(t.taskManager.getCurrentStatePathRoot())}},{key:"firstReactionTime",value:function(e,t){return t.incidentsAccumulator.firstReactionTime(t.taskManager.getCurrentStatePathRoot())}},{key:"firstReactionTimeTotal",value:function(e,t){return t.incidentsAccumulator.firstReactionTimeTotal(t.taskManager.getCurrentStatePathRoot())}},{key:"taskExecutionTime",value:function(e,t){return t.incidentsAccumulator.taskExecutionTime(t.taskManager.getCurrentStatePathRoot(),(new Date).getTime())}},{key:"taskExecutionTimeTotal",value:function(e,t){return t.incidentsAccumulator.taskExecutionTimeTotal(t.taskManager.getCurrentStatePathRoot())}},{key:"focus",value:function(t,n){var a=e.findComponentByAbsoluteUserDefId(t.absoluteUserDefId,n),r=X.getIndexPathForUserDefPath(t.absoluteUserDefId,n),i=j.getPagePath(r);void 0!==a?a.focus():n.actionRegister.registerAction(r,"focus"),n.focusRegister.registerFocus(i)}},{key:"getDisabled",value:function(e,t){return $.getStateAttributeByUserDefPath(G.extractDisabled,e.absoluteUserDefId,t)}},{key:"setDisabled",value:function(e,t){var n=e.value,a=e.absoluteUserDefId,r=e.groupName;fe.applySimpleSetter(a,r,G.extractDisabled,G.setDisabled,n,!0,t)}},{key:"getSelected",value:function(e,t){var n=X.getIndexPathForUserDefPath(e.absoluteUserDefId,t),a=t.componentStateManager.findOrBuildStateForPathId(n,t);return pe.extractSelectedState(a,n,t)}},{key:"setSelected",value:function(e,t){var n=X.getIndexPathForUserDefPath(e.absoluteUserDefId,t),a=t.componentStateManager.findOrBuildStateForPathId(n,t);pe.setSelectedForPossiblyControlledComponent(e.value,n,a,!1,!0,t)}},{key:"getHidden",value:function(e,t){return $.getStateAttributeByUserDefPath(G.extractHidden,e.absoluteUserDefId,t)}},{key:"setHidden",value:function(e,t){var n=e.value,a=e.absoluteUserDefId,r=e.groupName;fe.applySimpleSetter(a,r,G.extractHidden,G.setHidden,n,!0,t)}},{key:"getVisited",value:function(e,t){return $.getStateAttributeByUserDefPath(G.extractVisited,e.absoluteUserDefId,t)}},{key:"setVisited",value:function(e,t){$.updateStateAttributeByUserDefPath(G.extractVisited,G.setVisited,e.value,e.absoluteUserDefId,t,!0)}},{key:"getTextValue",value:function(e,t){var n=e.selector;return n?tt.getFormulaOrValue(n,e.absoluteUserDefId,t):$.getStateAttributeByUserDefPath(G.extractTextValue,e.absoluteUserDefId,t)}},{key:"setTextValue",value:function(t,n){var a=$.getStateAttributeByUserDefPath(G.extractTextValue,t.absoluteUserDefId,n),r=e.caluculateTextInsert(a,t.value,t.insertPosition,t.dropLength),i={indexPath:X.getIndexPathForUserDefPath(t.absoluteUserDefId,n),userDefIdPath:t.absoluteUserDefId,userDefId:q.getLastUserDefIdFromPath(t.absoluteUserDefId),oldTextValue:a,newTextValue:r,insertedValue:t.value,insertPosition:t.insertPosition,dropLength:t.dropLength};n.traceLogBuffer.reportEvent("OperatorSetTextValue",new Date,i),$.updateStateAttributeByUserDefPath(G.extractTextValue,G.setTextValue,r,t.absoluteUserDefId,n,!0)}},{key:"caluculateTextInsert",value:function(e,t,n,a){return(n<0?e:e.substr(0,n))+t+(n<0||a<0?"":e.substr(n+a))}},{key:"setHighlightable",value:function(e,t){$.updateStateAttributeByUserDefPath(G.extractHighlightable,G.setHighlightable,e.value,e.absoluteUserDefId,t,!0)}},{key:"isSelectedComponentOrTextBlock",value:function(e,t){var n=e.absolutePath,a=X.getIndexPathForTextBlockPath(n,t);if(void 0===a){var r=X.getIndexPathForUserDefPath(n,t),i=t.componentStateManager.findOrBuildStateForPathId(r,t);return pe.extractSelectedState(i,r,t)}var o=e.partial,s=t.componentStateManager.findOrBuildStateForPathId(a,t),c=q.getLastUserDefIdFromPath(n),l=t.pageConfigurationsManager.findPageSegmentForTextBlockOwner(c),u=t.pageConfigurationsManager.findConfigurationForPageSegment(l);return Qe.isTextBlockSelected(c,s,u.config,o)}},{key:"isHighlighted",value:function(e,t){var n=t.componentStateManager.findOrBuildStateByUserDefPath(e.absoluteUserDefId,t),a=t.pageConfigurationsManager.findPageSegmentForUserDefId(q.getLastUserDefIdFromPath(e.absoluteUserDefId)),r=t.pageConfigurationsManager.findConfigurationForPageSegment(a);return Qe.isSelectionContainsNonBlank(n,r.config)}},{key:"getIntegerValue",value:function(t,n){var a=t.absoluteUserDefId,r=t.roundingMode,i=t.defaultValue,o=String($.getStateAttributeByUserDefPath(G.extractTextValue,a,n));if(void 0===o||0===o.length)return i;var s=e.integerValueFromString(o,r);return void 0===s?i:s}},{key:"integerValueFromString",value:function(t,n){var a=e.parseDecimalString(t);if(void 0!==a){var r=a.wholeValue,i=a.fractionClass,o=r>=0?r+1:r-1;switch(n){case"up":return"zero"===i?r:o;case"down":return r;case"half_up":return"five"===i||"greaterThanFive"===i?o:r;case"half_down":return"greaterThanFive"===i?o:r;default:return void console.warn("Invalid rounding mode: ".concat(n))}}}},{key:"parseDecimalString",value:function(e){var t=e.indexOf("."),n=-1===t?e:e.substr(0,t),a=-1===t?"0":e.substr(t+1),r=parseInt(n,10),i=parseInt(a,10);if(String(r)===n){for(var o=a;o.startsWith("0");)o=o.substr(1);if(0===o.length&&(o="0"),String(i)===o)if(!(i<0))return{wholeValue:r,fractionClass:0===i?"zero":"0"===a[0]||i<5?"lessThanFive":i>5?"greaterThanFive":"five"}}}},{key:"setMediaPlayerVolume",value:function(e,t){e.value>=0&&e.value<=10&&$.updateStateAttributeByUserDefPath(G.extractMediaVolume,G.setMediaVolume,e.value,e.absoluteUserDefId,t,!0)}},{key:"setMediaPlayer",value:function(t,n){var a=e.findComponentByAbsoluteUserDefId(t.absoluteUserDefId,n);if(void 0!==a){var r=t.value.toLowerCase();switch(r){case"start":a.play(!0);break;case"stop":a.stop(!0);break;case"pause":a.pause(!0);break;default:e.logMessage("invalid operation ".concat(r))}}}},{key:"initMediaPlayer",value:function(e,t){var n=e.absoluteUserDefId,a=e.automaticStart,r=e.hideControls,i=e.maxPlay;$.updateStateAttributeByUserDefPath(G.extractAutomaticStart,G.setAutomaticStart,a,n,t,!0),$.updateStateAttributeByUserDefPath(G.extractHideControls,G.setHideControls,r,n,t,!0),$.updateStateAttributeByUserDefPath(G.extractMaxPlay,G.setMaxPlay,i,n,t,!0)}},{key:"setDragAndDropMode",value:function(e,t){var n=e.isSender,a=e.isReceiver,r=e.absoluteUserDefId,i={isSender:n,isReceiver:a};$.updateStateAttributeByUserDefPath(G.extractDragAndDrop,G.setDragAndDrop,i,r,t,!0)}},{key:"setSingleSelectMode",value:function(e,t){var n=e.value,a=e.absoluteUserDefId,r=e.groupName;pe.setSingleSelectActiveForController(a,r,n,t)}},{key:"setAllowDeselect",value:function(e,t){var n=e.value,a=e.absoluteUserDefId,r=e.groupName;pe.setAllowDeselectForController(a,r,n,t)}},{key:"setSelectable",value:function(e,t){var n=e.value,a=e.absoluteUserDefId;$.updateStateAttributeByUserDefPath(G.extractSelectable,G.setSelectable,n,a,t,!1)}},{key:"setSelectChangeBlockMode",value:function(e,t){var n=e.value,a=e.absoluteUserDefId,r=e.groupName,i=t.componentStateManager.findOrBuildStateByUserDefPath(e.absoluteUserDefId,t);void 0===G.extractSelectable(i)?pe.setSelectionChangesBlockedForController(a,r,n,t):$.updateStateAttributeByUserDefPath(G.extractSelectable,G.setSelectable,!n,a,t,!1)}},{key:"evaluateNamedCalculation",value:function(t,n,a){var r=n.taskManager.getCurrentTestTaskItemNames().task,i=n.calculationsConfigurationManager.findCalculationByTaskName(r,t.calculationName);if(void 0!==a&&void 0!==a[0]&&!0===a[0].useExistingCalculationResults&&void 0!==a[0].taskPath){var o=n.taskResultsManager.getResult(a[0].taskPath,t.calculationName);if(void 0!==o)return o}return e.evaluateTerm(i,n,a,t.calculationName)}},{key:"getCalculationResult",value:function(t,n){if(n.taskManager.getCurrentTestTaskItemNames().task===t.taskName)return e.evaluateNamedCalculation({calculationName:t.calculationName},n);var a=n.taskManager.getStatePathRootForTask(t.taskName);return n.taskResultsManager.getResult(a,t.calculationName)}},{key:"getVariable",value:function(e,t){var n=t.taskManager,a=t.variableManager,r=n.getCurrentStatePathRoot();return a.getVariable(r,e.name)}},{key:"setVariable",value:function(e,t){var n=t.taskManager,a=t.variableManager,r=n.getCurrentStatePathRoot();a.setVariable(r,e.name,e.value,e.type,t)}},{key:"switchVariables",value:function(e,t){var n=e.left,a=e.right,r=t.taskManager,i=t.variableManager,o=r.getCurrentStatePathRoot(),s=i.getVariable(o,n,!0),c=s.value,l=s.type,u=i.getVariable(o,a,!0),d=u.value,g=u.type;i.setVariable(o,n,d,g,t),i.setVariable(o,a,c,l,t)}},{key:"getImplicitVariable",value:function(t,n){var a=t.groupName,r=t.absoluteUserDefId,i=t.selector,o=X.getIndexPathForUserDefPath(r,n),s=$.getComponentTypeForIndexPath(o,n);switch(s){case"CbaInputField":case"CbaSingleLineInputField":return $.getStateAttributeByUserDefPath(G.extractTextValue,r,n);case"CbaTableCell":return i?tt.getFormulaOrValue(i,r,n):$.getStateAttributeByUserDefPath(G.extractTextValue,r,n);case"CbaComboBox":return pe.getComboboxSelectedItem(o,n);case"CbaList":return pe.getListSelectedItems(o,n);case"CbaTree":var c=ct.getCurrentNodePathId(r,n);return null===c?"":c;case"CbaMedia":var l=$.getStateAttributeByUserDefPath(G.extractLastOperation,r,n);return l===pt?"mp_start":l===ht?"mp_pause":l===vt?"mp_stop":l===mt?"mp_end":"";case"CbaContainer":return void 0===a?pe.getNonSelectGroupSelectedChildren(o,n):pe.getSelectGroupSelectedChildren(o,a,n);case"CbaCheckbox":case"CbaRadioButton":case"CbaButton":case"CbaLink":case"CbaRichTextField":return e.getSelected(t,n);case"CbaTimer":var u=n.pageConfigurationsManager,d=n.statemachinesManager,g=u.findConfigurationForPageSegment(j.getLastPageSegmentFromPath(o)).config.timerEvent;if(void 0!==g){var f=d.getTimerData(g).remainingTime;return f?Math.ceil(f/1e3):0}return 0;default:return console.log("Unknown component type: ".concat(s,". We will do nothing!")),""}}},{key:"raiseEvent",value:function(e,t){t.statemachinesManager.triggerEvent(e.event)}},{key:"postponeTaskSwitch",value:function(e,t){t.statemachinesManager.setPostponedTaskSwitch(e.switchCall.deferred)}},{key:"setTimedEventInterval",value:function(e,t){var n=e.eventName,a=e.interval;t.statemachinesManager.setTimedEventInterval(n,a,t)}},{key:"setStatemachineAssignedPage",value:function(e,t){var n=e.state,a=e.pageName,r=e.pageAreaType,i=e.pageAreaName;t.statemachinesManager.setStatePageAssignment(n,a,r,i)}},{key:"getNbStatemachineEventsRaised",value:function(e,t){return t.statemachinesManager.getTotalNbOfRaisedEvents()}},{key:"getCurrentLeafStates",value:function(e,t){return t.statemachinesManager.getCurrentStateMachineLeafStates()}},{key:"getRaisedStatemachineEvents",value:function(e,t){return t.statemachinesManager.getRaisedEvents()}},{key:"getVisitedStates",value:function(e,t){return t.statemachinesManager.getVisitedStates()}},{key:"getRaisedEventsInState",value:function(e,t){return t.statemachinesManager.getRaisedEventsInState(e.state)}},{key:"getStatemachineVariableValues",value:function(e,t){return t.statemachinesManager.getValuesOfVariable(e.variable)}},{key:"traceText",value:function(t,n){return e.traceTextInternal("OperatorTraceText",t,n),!0}},{key:"traceSnapshot",value:function(t,n){return e.traceTextInternal("OperatorTraceSnapshot",t,n),Z.dumpSnapshotToTrace(n),!0}},{key:"traceTextInternal",value:function(t,n,a){var r=e.evaluateTerm(n.expression,a,[],"text_".concat(t)),i={type:void 0===n.type?void 0:e.evaluateTerm(n.type,a,[],"type_".concat(t)),text:r};a.traceLogBuffer.reportEvent(t,new Date,i)}},{key:"calcGetMem",value:function(t,n){return n.calculatorsManager.calcGetMem(e.evaluateTerm(t.expression,n,[],"calcGetMem"))}},{key:"calcOp",value:function(t,n){var a=void 0!==t.expression?e.evaluateTerm(t.expression,n,[],"calcOp".concat(t.operation)):void 0;n.calculatorsManager.calcOp(t.operation,a)}},{key:"calcOpnd",value:function(t,n){var a=void 0!==t.expression?e.evaluateTerm(t.expression,n,[],"calcOpnd".concat(t.operation)):void 0;n.calculatorsManager.calcOpnd(t.operation,a)}},{key:"calcSettings",value:function(t,n){var a={},r=t.scale,i=t.displayWidth,o=t.withThousandSeparator,s=t.includeOperandInHistory,c=t.angle,l=t.format;void 0!==r&&(a.scale=r),void 0!==i&&(a.displayWidth=i),void 0!==o&&(a.withThousandSeparator=o),void 0!==s&&(a.includeOperandInHistory=s),void 0!==c&&(a.angle=c),void 0!==l&&(a.format=e.getValueFormatForCalculator(t.format)),n.calculatorsManager.calcSettings(a)}},{key:"currentTimestamp",value:function(e,t){return(new Date).getTime()}},{key:"consoleLog",value:function(e,t){console.log(e.message)}},{key:"setGlobalPropertyHighlightColor",value:function(e,t){var n=t.presenterStateManager.getTaskState(t.taskManager.getCurrentStatePathRoot());n.itemHighlightColor=e.value,t.presenterStateManager.saveTaskState(t.taskManager.getCurrentStatePathRoot(),n,t),t.componentDirectory.findByComponentType(Xe).forEach(function(e){e.highlightColorChanged()})}},{key:"scrollEmbeddedPage",value:function(e,t){var n=e.absoluteUserDefId,a=e.xPosition,r=e.yPosition,i=e.xPositionType,o=e.yPositionType,s=X.getIndexPathForUserDefPath(n,t),c=t.componentDirectory.findComponent(s);if(c){var l="".concat(a).concat("%"===i?i:""),u="".concat(r).concat("%"===o?o:"");c.scroll(l,u)}else console.warn("Term Evaluator - scrollEmbeddedPage - component is not currently on screen or can't be found")}},{key:"scrollTopLevelPage",value:function(e,t){var n=e.isXPage,a=e.xPosition,r=e.yPosition,i=e.xPositionType,o=e.yPositionType,s=t.taskManager.getCurrentPageNames(),c=n?"xPage":"standard",l=n?s.xPage:s.standardPage;if(c&&l){var u=j.appendPageSegmentToPathRoot(t.taskManager.getCurrentStatePathRoot(),"main",c,j.buildPageSegment(l)),g=t.componentDirectory.findComponent(u),f=g&&g instanceof Tt&&g.containerRendererRef.current;if(f){var p=s.xPage?f.parentNode.parentNode:f.parentNode,h="".concat(a).concat("%"===i?i:""),v="".concat(r).concat("%"===o?o:"");d.doScrollOnHTMLElement(h,v,f,p)}}else!l&&n?console.warn("Term Evaluator - scrollTopLevelPage - xPage is either not currently on screen or can't be found"):console.warn("Term Evaluator - scrollTopLevelPage - unknown page tried scrolling")}},{key:"containerMembersFormLocalGroup",value:function(t,n){var a=t.container,r=t.minDistance,i=t.maxDistance,o=t.anchorPointType,s=t.groupMembers,c=t.checkNonMembers,l=X.getIndexPathForUserDefPath(a,n),u=e.getIndexPathsForUserDefIds(s,n);if(!e.checkChildhood(l,u))return console.warn("Some group members in containerMembersFormLocalGroup call are not children of the given container -> returning false."),!1;var d=e.getComparePointSets(l,"comparesPosition",o,u,n),g=d.memberComparePoints,f=d.nonMemberComparePoints;return e.checkLocalGroup(r,i,g,!1===c?[]:f)}},{key:"containerRangeContainsMembers",value:function(t,n){var a=t.container,r=t.minX,i=t.maxX,o=t.minY,s=t.maxY,c=t.anchorPointType,l=t.rangeMembers,u=t.checkNonMembers,d=X.getIndexPathForUserDefPath(a,n),g=e.getIndexPathsForUserDefIds(l,n);if(!e.checkChildhood(d,g))return console.warn("Some group members in containerRangeContainsMembers call are not children of the given container -> returning false."),!1;var f=e.getComparePointSets(d,"comparesPosition",c,g,n),p=f.memberComparePoints,h=f.nonMemberComparePoints;return e.checkInRange(r,i,o,s,p,!1===u?[]:h)}},{key:"isInBookmarksList",value:function(e,t){var n=e.pageName;return void 0!==$.findIndexPathsInCurrentTaskOfComponentWithType("CbaPageArea",t).find(function(e){return void 0!==te.getBookmarks(e,t).find(function(e){return e.pageName===n})})}},{key:"callExternalPageFrame",value:function(e,t){var n=e.absoluteUserDefId,a=e.values,r=t.componentDirectory.findComponent(X.getIndexPathForUserDefPath(n,t));if(void 0!==r){var i=r.getFrameWindow(),o=r.getFrameContentUrl();if(void 0!==i&&void 0!==o)new Promise(function(e,t){try{i.postMessage(JSON.stringify(a),o.origin)}catch(n){throw console.error("Cannot call external page frame via postMessage",n),new Error("Cannot call external page frame via postMessage")}}).then()}}},{key:"evaluateTerm",value:function(t,n,a,r){return e.evaluateTermInternal(t,n,a,"<".concat(void 0===r?"":r,">"))}},{key:"evaluateTermInternal",value:function(t,n,a,r){void 0===n&&e.logMessage("Runtime undefined for ".concat(r));var i=typeof t;if("string"===i||"boolean"===i||"number"===i)return e.logCalculation("".concat(r,"=>").concat(t)),t;if(e.isTermComplete(t,r)){var o=t.operator;if(void 0===o)return e.logCalculation("".concat(r,"=>").concat(JSON.stringify(t))),t;var s=e.operators[o];if(void 0===s)return e.logMessage("Unknown operator ".concat(o," in term in ").concat(r)),void e.logCalculation("".concat(r,"=> undefined"));var c={};if(s===e.ifThenElse){var l=t.params.findIndex(function(e){return"if"===e.name});if(-1===l)e.logMessage("Missing if parameter in if-then-else in ".concat(r)),c.if=!1;else{var u=e.evaluateParam(t.params[l],l,n,a,o,r);c[u.name]=u.value}var d=!0===c.if?"then":"else",g=t.params.findIndex(function(e){return e.name===d});if(-1!==g){var f=e.evaluateParam(t.params[g],g,n,a,o,r);c[f.name]=f.value}}else if(s===e.ifGuard){var p=t.params.findIndex(function(e){return"branches"===e.name});if(-1===p)e.logMessage("Missing branches parameter in guarded-if in ".concat(r));else{var h=t.params[p].value;if(void 0!==h&&Array.isArray(h)){var v=h.find(function(t,i){return void 0===t.guard||void 0===t.branch?(e.logMessage("Ignored incomplete guarded branch at index ".concat(i," in guarded-if in ").concat(r)),!1):e.evaluateTermInternal(t.guard,n,a,o,r)});void 0===v?e.logMessage("No active branch in guarded-if in ".concat(r)):c.activeBranch=e.evaluateTermInternal(v.branch,n,a,o,r)}else e.logMessage("Branches parameter in guarded-if does not contain an array as value in ".concat(r))}}else t.params.forEach(function(t,i){var s=e.evaluateParam(t,i,n,a,o,r);c[s.name]=s.value});var m=s(c,n,a);return e.logCalculation("".concat(r,"=>").concat(m)),m}e.logCalculation("".concat(r,"=> undefined"))}},{key:"isTermComplete",value:function(t,n){return void 0===t?(e.logMessage("Undefined term in ".concat(n)),!1):void 0===t.operator||(void 0!==t.params||(e.logMessage("Undefined parameters for operator ".concat(t.operator," in term in ").concat(n)),!1))}},{key:"evaluateParam",value:function(t,n,a,r,i,o){if(void 0===t)return e.logMessage("Undefined parameter at index ".concat(n," in term in ").concat(o)),void e.logCalculation("".concat(o,"=> undefined"));if(void 0===t.name)return e.logMessage("Parameter without name at index ".concat(n," in term in ").concat(o)),void e.logCalculation("".concat(o,"=> undefined"));var s=Array.isArray(t.value)?t.value.map(function(n,s,c){return e.evaluateTermInternal(n,a,r,"".concat(o,"-> parameter ").concat(t.name,"[").concat(s,"] for operator ").concat(i))}):e.evaluateTermInternal(t.value,a,r,"".concat(o,"-> parameter ").concat(t.name," for operator ").concat(i));return{name:t.name,value:s}}},{key:"logMessage",value:function(e){console.warn(e)}},{key:"logCalculation",value:function(e){}},{key:"getValueFormatForCalculator",value:function(e){switch(e){case"EN":return lt.EN;case"DE":default:return lt.DE}}},{key:"checkLocalGroup",value:function(t,n,a,r){var i=a.filter(function(r,i){return!e.keepsDistanceToGroup(r,a,t,n,i)}),o=r.filter(function(r){return e.keepsDistanceToGroup(r,a,t,n,void 0)});return 0===i.length&&0===o.length}},{key:"keepsDistanceToGroup",value:function(t,n,a,r,i){return 0===n.filter(function(n,o){return i!==o&&!e.keepDistance(t,n,a,r)}).length}},{key:"keepDistance",value:function(e,t,n,a){var r=e.x-t.x,i=e.y-t.y,o=Math.sqrt(r*r+i*i);return n<o&&o<a}},{key:"checkInRange",value:function(t,n,a,r,i,o){var s=e.filterInRange(t,n,a,r,i),c=e.filterOutOfRange(t,n,a,r,o);return 0===s.length&&0===c.length}},{key:"filterInRange",value:function(e,t,n,a,r){return r.filter(function(r){return e>r.x||r.x>t||n>r.y||r.y>a})}},{key:"filterOutOfRange",value:function(e,t,n,a,r){return r.filter(function(r){return e<=r.x&&r.x<=t&&n<=r.y&&r.y<=a})}},{key:"checkChildhood",value:function(e,t){return 0===t.filter(function(t){return!t.startsWith(e)}).length}},{key:"getComparePointSets",value:function(t,n,a,r,i){var o=e.getIndexPathsForChildrenWithClassifier(t,n,i).filter(function(e){return!r.includes(e)});return{memberComparePoints:e.getComparePointsForIndexPaths(r,a,i),nonMemberComparePoints:e.getComparePointsForIndexPaths(o,a,i)}}},{key:"getIndexPathsForChildrenWithClassifier",value:function(e,t,n){var a=n.pageConfigurationsManager,r=[],i=a.findConfigurationForPageSegment(j.getLastPageSegmentFromPath(e)).config.cbaChildren;return void 0!==i&&i.forEach(function(n,a){void 0!==n.config.classifiers&&n.config.classifiers.includes(t)&&r.push(j.appendIndexToPageSegment(e,a))}),r}},{key:"getIndexPathsForUserDefIds",value:function(e,t){return e.map(function(e){return X.getIndexPathForUserDefPath(e,t)})}},{key:"getComparePointsForIndexPaths",value:function(t,n,a){return t.map(function(t){return e.getComparePointForIndexPath(t,n,a)})}},{key:"getComparePointForIndexPath",value:function(t,n,a){var r=a.componentStateManager,i=a.pageConfigurationsManager;return e.getComparePoint(G.extractPosition(r.findOrBuildStateForPathId(t,a)),i.findConfigurationForPageSegment(j.getLastPageSegmentFromPath(t)).config.position,n)}},{key:"getComparePoint",value:function(e,t,n){switch(n){case"topLeft":return{x:e.x,y:e.y};case"bottomLeft":return{x:e.x,y:e.y+t.height};case"topRight":return{x:e.x+t.width,y:e.y};case"bottomRight":return{x:e.x+t.width,y:e.y+t.height};case"center":return{x:e.x+t.width/2,y:e.y+t.height/2};default:return console.error("Unknown anchor point type ".concat(n," -> use upper left corner instead.")),{x:e.x,y:e.y}}}},{key:"findComponentByAbsoluteUserDefId",value:function(e,t){return t.componentDirectory.findComponent(X.getIndexPathForUserDefPath(e,t))}},{key:"currentNode",value:function(e,t){return ct.getCurrentNodePathId(e.absoluteUserDefId,t)}},{key:"getVisitedNodes",value:function(e,t){return ct.getVisitedPathIds(e.absoluteUserDefId,t)}},{key:"matchNodes",value:function(t,n){var a=t.absoluteUserDefId,r=t.regularExpressions,i=[],o=ct.getNodePathIds(a,n);return r.forEach(function(t){o.forEach(function(n){e.matches({pattern:t,candidate:n})&&!i.includes(n)&&i.push(n)})}),i}},{key:"matchNodesWithColumns",value:function(t,n){var a=t.absoluteUserDefId,r=t.regularExpressions,i=[];if(r.length>0){var o=e.matchNodes({absoluteUserDefId:a,regularExpressions:[r[0]]},n),s=ct.getColumnValuesMap(a,o,n);r.shift(),s.forEach(function(t,n){e.columnsMatch(r,t)&&i.push(n)})}else console.log("Empty list of regular expressions!");return i}},{key:"treeAction",value:function(t,n,a){var r=t.absoluteUserDefId,i=t.targetNode,o=e.matchNodes({absoluteUserDefId:r,regularExpressions:[i]},n);1===o.length&&a(r,o[0],n)}},{key:"treeCopy",value:function(t,n){e.treeAction(t,n,ct.treeCopyCurrentNode)}},{key:"treeMove",value:function(t,n){e.treeAction(t,n,ct.treeMoveCurrentNode)}}]),e}();bt.operators={contextValue:bt.contextValue,and:bt.and,or:bt.or,not:bt.not,ifThenElse:bt.ifThenElse,ifGuard:bt.ifGuard,equal:bt.equal,notEqual:bt.notEqual,greater:bt.greater,greaterEqual:bt.greaterEqual,less:bt.less,lessEqual:bt.lessEqual,max:bt.max,maxNamed:bt.maxNamed,matches:bt.matches,arrayLength:bt.arrayLength,union:bt.union,intersection:bt.intersection,add:bt.add,subtract:bt.subtract,multiply:bt.multiply,divide:bt.divide,modulo:bt.modulo,floor:bt.floor,ceil:bt.ceil,trunc:bt.trunc,round:bt.round,stringFormat:bt.stringFormat,concatenate:bt.concatenate,boolToString:bt.boolToString,numberToString:bt.numberToString,contains:bt.contains,getCurrentTest:bt.getCurrentTest,getCurrentTask:bt.getCurrentTask,getCurrentItem:bt.getCurrentItem,getCurrentPage:bt.getCurrentPage,getEmbeddedPage:bt.getEmbeddedPage,switchPage:bt.switchPage,closeDialog:bt.closeDialog,saveTaskResults:bt.saveTaskResults,previousTask:bt.previousTask,nextTask:bt.nextTask,cancelTask:bt.cancelTask,switchTaskInTest:bt.switchTaskInTest,switchTaskAndTest:bt.switchTaskAndTest,recommend:bt.recommend,nbUserInteractions:bt.nbUserInteractions,nbUserInteractionsTotal:bt.nbUserInteractionsTotal,firstReactionTime:bt.firstReactionTime,firstReactionTimeTotal:bt.firstReactionTimeTotal,taskExecutionTime:bt.taskExecutionTime,taskExecutionTimeTotal:bt.taskExecutionTimeTotal,focus:bt.focus,getDisabled:bt.getDisabled,setDisabled:bt.setDisabled,getSelected:bt.getSelected,setSelected:bt.setSelected,getHidden:bt.getHidden,setHidden:bt.setHidden,getVisited:bt.getVisited,setVisited:bt.setVisited,getTextValue:bt.getTextValue,setTextValue:bt.setTextValue,setHighlightable:bt.setHighlightable,isSelectedComponentOrTextBlock:bt.isSelectedComponentOrTextBlock,isHighlighted:bt.isHighlighted,getIntegerValue:bt.getIntegerValue,setMediaPlayerVolume:bt.setMediaPlayerVolume,setMediaPlayer:bt.setMediaPlayer,initMediaPlayer:bt.initMediaPlayer,setDragAndDropMode:bt.setDragAndDropMode,setSingleSelectMode:bt.setSingleSelectMode,setAllowDeselect:bt.setAllowDeselect,setSelectable:bt.setSelectable,setSelectChangeBlockMode:bt.setSelectChangeBlockMode,evaluateNamedCalculation:bt.evaluateNamedCalculation,getCalculationResult:bt.getCalculationResult,getVariable:bt.getVariable,setVariable:bt.setVariable,switchVariables:bt.switchVariables,getImplicitVariable:bt.getImplicitVariable,raiseEvent:bt.raiseEvent,postponeTaskSwitch:bt.postponeTaskSwitch,setTimedEventInterval:bt.setTimedEventInterval,setStatemachineAssignedPage:bt.setStatemachineAssignedPage,getNbStatemachineEventsRaised:bt.getNbStatemachineEventsRaised,getCurrentLeafStates:bt.getCurrentLeafStates,getRaisedStatemachineEvents:bt.getRaisedStatemachineEvents,getVisitedStates:bt.getVisitedStates,getRaisedEventsInState:bt.getRaisedEventsInState,getStatemachineVariableValues:bt.getStatemachineVariableValues,traceText:bt.traceText,traceSnapshot:bt.traceSnapshot,calcGetMem:bt.calcGetMem,calcOp:bt.calcOp,calcOpnd:bt.calcOpnd,calcSettings:bt.calcSettings,currentNode:bt.currentNode,getVisitedNodes:bt.getVisitedNodes,matchNodes:bt.matchNodes,matchNodesWithColumns:bt.matchNodesWithColumns,treeMove:bt.treeMove,treeCopy:bt.treeCopy,scrollEmbeddedPage:bt.scrollEmbeddedPage,scrollTopLevelPage:bt.scrollTopLevelPage,currentTimestamp:bt.currentTimestamp,consoleLog:bt.consoleLog,setGlobalPropertyHighlightColor:bt.setGlobalPropertyHighlightColor,containerMembersFormLocalGroup:bt.containerMembersFormLocalGroup,containerRangeContainsMembers:bt.containerRangeContainsMembers,isInBookmarksList:bt.isInBookmarksList,callExternalPageFrame:bt.callExternalPageFrame},bt.columnsMatch=function(e,t){var n=!0;if(void 0===e||null===e||0===e.length)return n;for(var a=0;a<e.length;a+=1)if(!bt.matches({pattern:e[a],candidate:t[a]})){n=!1;break}return n};var kt={VALUE_DISPLAY:"valueDisplay"},St=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"addDrag",value:function(t,n,a,r,i){return Object(De.a)({item:{type:r},begin:function(o){var s=Y.getDragAndDrop(t).sender,c=s.data,l=s.traceType,u=s.event,d={type:r,previewData:i,indexPath:n,senderData:c,traceType:l,startPosition:o.getInitialClientOffset()};return e.triggerStatemachineEvent(u,a),d},canDrag:function(r){return e.isDragAndDropSender({config:t,runtime:a,path:n})},collect:function(e){return{idDragging:e.isDragging()}}})}},{key:"addDrop",value:function(t,n,a,r,i){return Object(Ne.a)({accept:r,drop:function(r,i){var o=r,s=Y.getDragAndDrop(t).receiver,c=s.actionTerms,l=s.traceType,u=s.event,d=i.getClientOffset();a.replayStepMonitor.incrementReplayStep();var g=e.evaluateActionTerms(c,o,a);e.relocateIfNecessary(g,d,o,a),e.triggerStatemachineEvent(u,a),e.logAction(o,n,d,l,g,a)},canDrop:function(r,o){if(i){var s=r.indexPath;if(n!==j.dropIndexFromPageSegment(s))return!1}return e.isDragAndDropReceiver({config:t,runtime:a,path:n})},collect:function(e){return{dragIsOver:e.isOver({shallow:!0}),dragCanDrop:e.canDrop()}}})}},{key:"addCanDropStyleAttributes",value:function(e,t){var n=t.dragIsOver,a=t.dragCanDrop;n&&a&&Y.setStyleAttribute(e,"boxShadow","0 0 8px 0 rgba(0, 0, 0, 0.5) inset")}},{key:"addIsDraggingStyleAttributes",value:function(e,t){t.isDragging&&Y.setStyleAttribute(e,"boxShadow","0 0 8px 0 rgba(0, 0, 0, 0.5) inset")}},{key:"isDragAndDropSender",value:function(e){var t=e.config,n=e.runtime,a=e.path,r=Y.getDragAndDrop(t);if(void 0===r)return!1;if(void 0===r.sender)return!1;var i=n.componentStateManager.findOrBuildStateForPathId(a,n);return G.extractDragAndDrop(i).isSender}},{key:"isDragAndDropReceiver",value:function(e){var t=e.config,n=e.runtime,a=e.path,r=Y.getDragAndDrop(t);if(void 0===r)return!1;if(void 0===r.receiver)return!1;var i=n.componentStateManager.findOrBuildStateForPathId(a,n);return G.extractDragAndDrop(i).isReceiver}},{key:"evaluateActionTerms",value:function(e,t,n){var a;return void 0!==e&&e.forEach(function(e,r){a=bt.evaluateTerm(e,n,[t],"drag&drop[".concat(r,"]"))}),a}},{key:"relocateIfNecessary",value:function(e,t,n,a){if("relocate"===e){var r=n.startPosition;if(void 0!==t&&null!==t&&void 0!==r&&null!==r){var i=t.x-r.x,o=t.y-r.y,s=a.componentStateManager,c=n.indexPath,l=s.findOrBuildStateForPathId(c,a),u=G.extractPosition(l);u.x+=i/a.app.state.scaleValue,u.y+=o/a.app.state.scaleValue,G.setPosition(l,u),s.registerStateByPathId(c,l,a),Q.triggerRenderingViaPath(c,a)}else console.warn("Drag and drop without proper coordinates! -> We do not move the component instance.")}}},{key:"triggerStatemachineEvent",value:function(e,t){void 0!==e&&t.statemachinesManager.triggerEvent(e)}},{key:"logAction",value:function(e,t,n,a,r,i){var o=new Date,s=X.getUserDefPathForIndexPath(t,i),c=X.getUserDefPathForIndexPath(e.indexPath,i);i.incidentsAccumulator.userInteraction(o.getTime(),void 0,i),i.traceLogBuffer.reportEvent("DragAndDropReceive",o,{senderIndexPath:e.indexPath,senderUserDefIdPath:c,senderUserDefId:q.getLastUserDefIdFromPath(c),receiverIndexPath:t,receiverUserDefIdPath:s,receiverUserDefId:q.getLastUserDefIdFromPath(s),startPosition:e.startPosition,endPosition:n,sendingType:e.traceType,receivingType:a,operation:r})}}]),e}(),Ct=v.a.forwardRef(function(e,t){var n=e.onClick,a=e.onContextMenu,r=e.title,i=e.style,o=e.className,s=e.onScroll,c=e.children,l=e.config,u=e.path,g=e.runtime,f=St.addDrop(l,u,g,kt.VALUE_DISPLAY,!0),p=Object(L.a)(f,2),h=p[0];(0,p[1])(t);var m=d.safeDeepCopy(i);return St.addCanDropStyleAttributes(m,h),v.a.createElement("div",{ref:t,onClick:n,onContextMenu:a,title:r,style:m,"data-cba-id":l.pageEditId,className:o,onScroll:s},c)}),Tt=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.onClickHandler=n.onClickHandler.bind(Object(O.a)(Object(O.a)(n))),n.containerRendererRef=v.a.createRef(),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"onClickHandler",value:function(e){Re.doStandardOnClick(e,void 0,this)}},{key:"render",value:function(){var e=this.props,t=e.config,n=e.runtime,a=e.path,r=e.orientation,i=$.getState(this),o=G.extractSelected(i),s=t.cbaChildren.map(function(e,t){var i=j.appendIndexToPageSegment(a,t);return v.a.createElement(gn,{key:i,config:e,path:i,runtime:n,orientation:r})}),c=Y.buildStyleByIndexPath(a,t,o,r,n);return v.a.createElement(Ct,{onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,title:Y.buildTitle(t),style:c,className:Y.getCssClassNamesValue(t,"overflow-hidden"),onScroll:function(e){return e.stopPropagation()},config:t,path:a,runtime:n,ref:this.containerRendererRef},s)}}]),t}(h.Component),Pt=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.lineOnClickHandler=n.lineOnClickHandler.bind(Object(O.a)(Object(O.a)(n))),n.containerOnClickHandler=n.containerOnClickHandler.bind(Object(O.a)(Object(O.a)(n))),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"lineOnClickHandler",value:function(e){this.props.config.blockEvents||Re.doStandardOnClick(e,void 0,this)}},{key:"containerOnClickHandler",value:function(e){this.props.config.blockEvents&&(e.stopPropagation(),Re.doStandardOnClick(e,void 0,this))}},{key:"buildLineDiv",value:function(e,t){return v.a.createElement("div",{onClick:this.lineOnClickHandler,onContextMenu:this.onContextMenuHandler,title:Y.buildTitle(t),style:e,className:"overflow-hidden"})}},{key:"render",value:function(){var e=this.props,t=e.config,n=e.runtime,a=e.path,r=e.orientation,i=$.getState(this),o=G.extractSelected(i),s=Y.buildStyleByIndexPath(a,t,o,r,n),c=t.lineWidth,l=t.pageEditId,u=Object.assign({},s,{backgroundColor:"rgba(255, 255, 255, 0)",cursor:void 0}),d="".concat(c,"px"),g={position:"absolute",backgroundColor:s.backgroundColor,width:d,height:d,cursor:s.cursor},f=Object.assign({},g,{top:0,left:0,width:"100%"}),p=Object.assign({},g,{top:0,right:0,height:"100%"}),h=Object.assign({},g,{bottom:0,left:0,width:"100%"}),m=Object.assign({},g,{top:0,left:0,height:"100%"});return v.a.createElement("div",{style:u,"data-cba-id":l,className:Y.getCssClassNamesValue(t),onClick:this.containerOnClickHandler},this.buildLineDiv(f,t),this.buildLineDiv(h,t),this.buildLineDiv(p,t),this.buildLineDiv(m,t))}}]),t}(h.Component),Et=n(278);function xt(e){var t=e.onClick,n=e.onContextMenu,a=e.onSelect,r=e.title,i=e.style,o=e.value,s=e.className,c=e.config,l=e.path,u=e.runtime,g=Object(h.useRef)(null),f=St.addDrag(c,l,u,kt.VALUE_DISPLAY,{title:r,style:i,value:o}),p=Object(L.a)(f,3),m=p[0],y=p[1];(0,p[2])(Object(Et.a)(),{captureDraggingState:!0});var b=St.addDrop(c,l,u,kt.VALUE_DISPLAY,!1),k=Object(L.a)(b,2),S=k[0];y((0,k[1])(g));var C=d.safeDeepCopy(i);return St.addIsDraggingStyleAttributes(C,m),St.addCanDropStyleAttributes(C,S),c.renderAsDiv?(Y.setStyleAttribute(C,"whiteSpace","pre-wrap"),Y.setStyleAttribute(C,"overflow","auto"),v.a.createElement("div",{ref:g,readOnly:!0,onClick:t,onContextMenu:n,onSelect:a,title:r,style:C,"data-cba-id":c.pageEditId,className:s},o)):v.a.createElement("textarea",{ref:g,readOnly:!0,onClick:t,onContextMenu:n,onSelect:a,title:r,style:C,"data-cba-id":c.pageEditId,value:o,className:s})}var It=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(E.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(i)))).onInputFieldUpdate=function(e){var t=$.getState(Object(O.a)(Object(O.a)(n)));G.setTextValue(t,e),$.registerState(Object(O.a)(Object(O.a)(n)),t),Q.triggerRendering(Object(O.a)(Object(O.a)(n)))},n.onClickHandler=function(e){var t=n.props,a=t.runtime,r=t.path;t.config.renderAsDiv||Re.processSelectedTextForCutAndPaste(r,e,!0,void 0,void 0,a),Re.doStandardOnClick(e,void 0,Object(O.a)(Object(O.a)(n)))},n.onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.onSelectionHandler=function(e){var t=n.props,a=t.runtime,r=t.path;t.config.suppressSelections?e.target.selectionStart=e.target.selectionEnd:Re.processSelectedTextForCutAndPaste(r,e,!0,void 0,void 0,a)},n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.config,n=e.runtime,a=t.textInputReferencePath;void 0!==a&&n.eventEmitter.addListener("inputFieldUpdated-".concat(a),this.onInputFieldUpdate.bind(this)),Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"render",value:function(){var e=this.props,t=e.config,n=e.runtime,a=e.path,r=e.orientation,i=t.suppressSelections?"hide-selection":"",o=$.getState(this),s=Y.buildDisplayText(t,o,n),c=Y.buildStyleByIndexPath(a,t,!1,r,n);return Y.setStyleAttribute(c,"resize","none"),void 0===t.position.padding&&Y.setStyleAttribute(c,"padding","0px"),v.a.createElement(xt,{onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,onSelect:this.onSelectionHandler,title:Y.buildTitle(t),style:c,value:s,className:Y.getCssClassNamesValue(t,i),config:t,path:a,runtime:n})}}],[{key:"addAttributesToInitialState",value:function(e,t,n){var a=t.textInputReferencePath;if(void 0!==a){var r=n.componentStateManager.filterExistingPathIds(function(e){return j.getLastPageSegmentFromPath(e)===a});if(r.length>0)e.textValue=$.getStateAttributeByPathId(G.extractTextValue,r[0],n);else{var i=n.pageConfigurationsManager.findConfigurationForPageSegment(a).config.text;e.textValue=i.label}}}}]),t}(h.Component),Ot=(n(561),function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onMouseDown=function(e){var t=n.props,a=t.config,r=t.runtime,i=t.path;if("upDown"===a.toggleType){var o=d.isEmptyObject(a.image.selected)?"none":a.image.selected;n.backgroundImage.pressed=o,Q.triggerRenderingViaPath(i,r)}return!1},n.onMouseUp=function(e){var t=n.props,a=t.config,r=t.runtime,i=t.path;return"upDown"===a.toggleType&&(n.backgroundImage.pressed="",Q.triggerRenderingViaPath(i,r)),!1},n.onMouseEnter=function(e){var t=n.props,a=t.config,r=t.runtime,i=t.path,o=$.getState(Object(O.a)(Object(O.a)(n))),s=G.extractDisabled(o);return a.image.hover&&!s&&(n.backgroundImage.hover=a.image.hover,Q.triggerRenderingViaPath(i,r)),!1},n.onMouseLeave=function(e){var t=n.props,a=t.config,r=t.runtime,i=t.path,o=$.getState(Object(O.a)(Object(O.a)(n))),s=G.extractDisabled(o);return(a.image.hover&&!s||n.backgroundImage.pressed)&&(n.backgroundImage.hover="",n.backgroundImage.pressed="",Q.triggerRenderingViaPath(i,r)),!1},n.getBackgroundImage=function(){var e=n.props.runtime;return"none"===n.backgroundImage.pressed?"none":n.backgroundImage.pressed?"url(".concat(Y.getProperResourcePath(n.backgroundImage.pressed,e),")"):n.backgroundImage.hover?"url(".concat(Y.getProperResourcePath(n.backgroundImage.hover,e),")"):""},n.onClickHandler=function(e){var a=n.props,r=a.config,i=a.runtime,o=a.path,s=$.getState(Object(O.a)(Object(O.a)(n))),c=pe.extractSelectedState(s,o,i);Re.stopEventPropagation(e),t.isClipboardManagerAction(r.selectionHandlerType)||Re.signalFocusChangeToClipboardManager(o,i);var l=Re.buildOldSelectedTraceLogValueObject(c);void 0!==r.subtype&&(l.subtype=r.subtype),Re.traceUserInteractionPerConfig(r,o,l,e,i),i.replayStepMonitor.incrementReplayStep(),n.updateStateAndTriggerRendering(s);var u=r.selectionHandlerParam,d=r.attachedScale,g=r.increment,f=n.props.path,p=oe.buildTriggerBoundingRect(e);switch(r.selectionHandlerType){case"none":pe.doPageSwitchOrLetTheContainerDoIt(Object(O.a)(Object(O.a)(n)),s);break;case"switchPage":i.taskManager.switchPage(u.page,void 0,void 0,u.pageAreaType,u.pageAreaName,void 0,void 0,void 0,void 0);break;case"switchTask":i.taskManager.switchTaskIntraItem(u.task);break;case"switchTest":i.taskManager.switchTaskInterTest(u.test,u.item,u.task);break;case"logTaskResult":console.log("=== current task result: ===",i.taskManager.getCurrentTaskResults());break;case"recommend":i.recommendationsManager.setRecommendations([{testName:u.test,taskName:u.task}]);break;case"cut":Oe.cut("button",f,i);break;case"copy":Oe.copy("button",f,i);break;case"paste":Oe.paste("button",f,i);break;case"next_task":Oe.nextTask(i);break;case"back_task":Oe.backTask(i);break;case"cancel_task":Oe.cancelTask(i);break;case"startFullscreen":Oe.startFullscreen(i);break;case"stopFullscreen":Oe.stopFullscreen(i);break;case"close":Oe.close(f,i);break;case"closeAndNextTask":Oe.close(f,i),Oe.nextTask(i);break;case"menu":e.clientX=p.left,e.clientY=p.bottom,i.contextMenu.openMenuItemTreeWithDynamicConfig(Me.buildMenuTreeItemConfiguration(u.contextMenu,e,f,G.extractDefaultLinkReceiver(s),i),i);break;case"back":Oe.back(f,{},i);break;case"forward":Oe.forward(f,{},i);break;case"home":Oe.home(f,{},i);break;case"addBookmark":Oe.addBookmark("button",f,{},i);break;case"manageBookmarks":Oe.manageBookmark("button",f,u,i);break;case"debugOperator":bt.evaluateTerm(u,i,[],"callViaDebugButton");break;default:void 0!==r.selectionHandlerType&&console.error("Unknown selection handler type in button: ".concat(r.selectionHandlerType))}void 0!==d&&Oe.incrementScale(f,d,g,i),Re.sendStandardOrAlternateEvent(c,r,i)},n.onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.updateStateAndTriggerRendering=function(e){var t=n.props,a=t.runtime,r=t.config,i=t.path,o=pe.extractSelectedState(e,i,a);G.setVisited(e,!0),"none"!==r.toggleType?pe.setSelectedForPossiblyControlledComponent(!o,i,e,!0,!1,a):(a.componentStateManager.registerStateByPathId(i,e,a),Q.triggerRenderingViaPath(i,a))},n.addFlexTextAlignmentToStyles=function(e,t){var n="";switch(t.font.alignmentHorizontal){case"left":n="flex-start";break;case"center":n="center";break;case"right":n="flex-end";break;default:n="center"}return Object.assign(e,{display:"flex",alignItems:"center",justifyContent:n})},n.buildStyleForMask=function(e){return{position:"absolute",width:e.width,height:e.height,top:e.top,left:e.left,right:e.right}},n.backgroundImage={hover:"",pressed:""},n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"render",value:function(){var e=this.props,t=e.runtime,n=e.config,a=e.path,r=e.orientation,i=$.getState(this),o=pe.extractSelectedState(i,a,t),s=this.addFlexTextAlignmentToStyles(Y.buildStyleByIndexPath(a,n,o,r,t),n),c=G.extractDisabled(i),l=n.toggleType,u=n.highlight,d=n.position;"upDown"===l&&Y.setStyleAttribute(s,"borderStyle",o?"inset":"outset");var g="";switch(u){case"up":g="CbaButton-highlight-up";break;case"down":g="CbaButton-highlight-down";break;default:g="CbaButton"}var f=Q.extractMultilineText(Y.buildDisplayText(n,i,t));c&&(this.backgroundImage.hover="",this.backgroundImage.pressed="");var p=this.getBackgroundImage();return p&&Y.setStyleAttribute(s,"backgroundImage",p),v.a.createElement(v.a.Fragment,null,v.a.createElement("button",{className:Y.getCssClassNamesValue(n,g),onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,title:Y.buildTitle(n),style:s,"data-cba-id":n.pageEditId,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,type:"button",disabled:c,tabIndex:n.tabIndex},Y.getImageTag(i,n,o,t),v.a.createElement("span",{style:{maxHeight:d.height}},f)),c&&v.a.createElement("div",{className:"CbaButton-mask",onContextMenu:function(e){return e.preventDefault()},style:this.buildStyleForMask(s)}))}}],[{key:"isClipboardManagerAction",value:function(e){return"cut"===e||"copy"===e||"paste"===e||"menu"===e}}]),t}(h.Component)),Mt=n(147),wt=n.n(Mt),Rt=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.onClickHandler=n.onClickHandler.bind(Object(O.a)(Object(O.a)(n))),n.updateStateAndTriggerRendering=n.updateStateAndTriggerRendering.bind(Object(O.a)(Object(O.a)(n))),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"onClickHandler",value:function(e){var t=this.props,n=t.config,a=t.runtime,r=t.path,i=$.getState(this),o=pe.extractSelectedState(i,r,a);Re.doBasicOnClick(e,r,a),Re.traceUserInteractionPerConfig(n,r,Re.buildOldSelectedTraceLogValueObject(o),e,a),this.updateStateAndTriggerRendering(i),pe.doPageSwitchOrLetTheContainerDoIt(this,i),Re.sendStandardOrAlternateEvent(o,n,a)}},{key:"updateStateAndTriggerRendering",value:function(e){var t=this.props,n=t.runtime,a=t.path,r=pe.extractSelectedState(e,a,n);G.setVisited(e,!0),pe.setSelectedForPossiblyControlledComponent(!r,a,e,!0,!1,n)}},{key:"render",value:function(){var e=this.props,n=e.runtime,a=e.path,r=e.config,i=e.orientation,o=$.getState(this),s=pe.extractSelectedState(o,a,n),c=Y.buildDisplayText(r,o,n),l=Q.extractMultilineText(c),u=r.label,d=r.textWrap,g=r.controlIconSize,f=u.position,p=u.distance,h=Y.buildStyleByIndexPath(a,r,s,i,n);Y.setStyleAttribute(h,"backgroundImage","none");var m="left"===f,y={whiteSpace:d?"initial":"noWrap",marginLeft:m?0:20,marginRight:m?20:0,justifyContent:m?"flex-end":"flex-start"},b={left:m?"auto":2.5,right:m?2.5:"auto",cursor:"inherit"},k=p-10,S={marginLeft:m?0:k,marginRight:m?k:0,display:c?"inline":"none"},C={order:m?1:0};t.hasImage(r)&&(S.marginLeft=0,S.marginRight=0,m?(C.paddingRight=5,C.marginRight=k):(C.paddingRight=0,C.marginRight=0,C.paddingLeft=5,C.marginLeft=k));var T=wt.a.generate();return v.a.createElement("div",{style:h,"data-cba-id":r.pageEditId,title:Y.buildTitle(r),onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,className:Y.getCssClassNamesValue(r,"inputWrapper overflow-hidden")},v.a.createElement("div",{className:"radioWrap"},v.a.createElement("label",{style:{cursor:"inherit"},htmlFor:T,className:"label",onClick:function(e){e.stopPropagation()}},v.a.createElement("span",{style:y},Y.getImageTag(o,r,s,n,C),v.a.createElement("span",{style:S,className:"inputTextWrap"},l))),v.a.createElement("input",{className:"radioCheckBoxSize".concat(g||13),name:T,style:b,id:T,type:"radio",checked:s,disabled:G.extractDisabled(o),onChange:function(){},tabIndex:r.tabIndex})))}}],[{key:"hasImage",value:function(e){return"none"!==e.image.displayMode}}]),t}(h.Component),Dt=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.onClickHandler=n.onClickHandler.bind(Object(O.a)(Object(O.a)(n))),n.updateStateAndTriggerRendering=n.updateStateAndTriggerRendering.bind(Object(O.a)(Object(O.a)(n))),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"onClickHandler",value:function(e){var t=this.props,n=t.config,a=t.runtime,r=t.path,i=$.getState(this),o=pe.extractSelectedState(i,r,a);Re.doBasicOnClick(e,r,a),Re.traceUserInteractionPerConfig(n,r,Re.buildOldSelectedTraceLogValueObject(o),e,a),this.updateStateAndTriggerRendering(i),pe.doPageSwitchOrLetTheContainerDoIt(this,i),Re.sendStandardOrAlternateEvent(o,n,a)}},{key:"updateStateAndTriggerRendering",value:function(e){var t=this.props,n=t.runtime,a=t.path,r=pe.extractSelectedState(e,a,n);G.setVisited(e,!0),pe.setSelectedForPossiblyControlledComponent(!r,a,e,!0,!1,n)}},{key:"render",value:function(){var e=this.props,t=e.config,n=e.runtime,a=e.path,r=e.orientation,i=$.getState(this),o=pe.extractSelectedState(i,a,n),s=Q.extractMultilineText(Y.buildDisplayText(t,i,n)),c=t.label,l=t.textWrap,u=t.controlIconSize,d=c.position,g=c.distance,f=Y.buildStyleByIndexPath(a,t,o,r,n),p="left"===d,h={whiteSpace:l?"initial":"nowrap",marginLeft:p?0:20,marginRight:p?20:0,justifyContent:p?"flex-end":"flex-start"},m={left:p?"auto":2.5,right:p?2.5:"auto",cursor:"inherit"},y=g-10,b={marginLeft:p?0:y,marginRight:p?y:0,display:s?"inline":"none"},k=wt.a.generate();return v.a.createElement("div",{style:f,"data-cba-id":t.pageEditId,title:Y.buildTitle(t),onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,className:Y.getCssClassNamesValue(t,"inputWrapper overflow-hidden")},v.a.createElement("div",{className:"checkBoxWrap"},v.a.createElement("label",{style:{cursor:"inherit"},htmlFor:k,className:"label",onClick:function(e){e.stopPropagation()}},v.a.createElement("span",{style:h},v.a.createElement("span",{style:b,className:"inputTextWrap"},s))),v.a.createElement("input",{className:"radioCheckBoxSize".concat(u||13),style:m,id:k,type:"checkbox",checked:o,disabled:G.extractDisabled(i),onChange:function(){},tabIndex:t.tabIndex})))}}]),t}(h.Component),Nt=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.onClickHandler=n.onClickHandler.bind(Object(O.a)(Object(O.a)(n))),n.updateStateAndTriggerRendering=n.updateStateAndTriggerRendering.bind(Object(O.a)(Object(O.a)(n))),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"onClickHandler",value:function(e){var t=this.props,n=t.config,a=t.runtime,r=t.path,i=$.getState(this),o=pe.extractSelectedState(i,r,a);Re.doBasicOnClick(e,r,a),Re.traceUserInteractionPerConfig(n,r,Re.buildOldSelectedTraceLogValueObject(o),e,a),this.updateStateAndTriggerRendering(i),pe.doPageSwitchOrLetTheContainerDoIt(this,i),Re.sendStandardOrAlternateEvent(o,n,a)}},{key:"updateStateAndTriggerRendering",value:function(e){var t=this.props,n=t.runtime,a=t.path,r=pe.extractSelectedState(e,a,n);G.setVisited(e,!0),pe.setSelectedForPossiblyControlledComponent(!r,a,e,!0,!1,n)}},{key:"onKeyDown",value:function(e){32===e.keyCode&&this.onClickHandler(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.config,a=t.runtime,r=t.path,i=t.orientation,o=$.getState(this),s=pe.extractSelectedState(o,r,a),c=Q.extractMultilineText(Y.buildDisplayText(n,o,a)),l=Y.buildStyleByIndexPath(r,n,s,i,a);return v.a.createElement("div",{style:l,"data-cba-id":n.pageEditId,title:Y.buildTitle(n),className:Y.getCssClassNamesValue(n,"CbaLink")},v.a.createElement("span",{onClick:this.onClickHandler,onKeyDown:function(t){return e.onKeyDown(t)},onContextMenu:this.onContextMenuHandler,tabIndex:n.tabIndex},Y.getImageTag(o,n,!1,a),c))}}]),t}(h.Component),At=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.onClickHandler=n.onClickHandler.bind(Object(O.a)(Object(O.a)(n))),n.updateStateAndTriggerRendering=n.updateStateAndTriggerRendering.bind(Object(O.a)(Object(O.a)(n))),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"onClickHandler",value:function(e){var t=this.props,n=t.config,a=t.runtime,r=t.path,i=$.getState(this),o=pe.extractSelectedState(i,r,a);Re.doBasicOnClick(e,r,a),Re.traceUserInteractionPerConfig(n,r,Re.buildOldSelectedTraceLogValueObject(o),e,a);var s=pe.extractSelectedState(i,r,a);this.updateStateAndTriggerRendering(i,s),pe.doPageSwitchOrLetTheContainerDoIt(this,i),Re.sendStandardOrAlternateEvent(o,n,a)}},{key:"updateStateAndTriggerRendering",value:function(e,t){var n=this.props,a=n.runtime,r=n.path;G.setVisited(e,!0),pe.setSelectedForPossiblyControlledComponent(!t,r,e,!0,!1,a)}},{key:"onKeyDown",value:function(e){32===e.keyCode&&this.onClickHandler(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.config,a=t.path,r=t.runtime,i=t.orientation,o=$.getState(this),s=pe.extractSelectedState(o,a,r),c=Y.buildStyleSvg(o,n,s,i,r),l=Y.buildPointsString(n.bendPoints),u=Y.buildTitle(n);return v.a.createElement("polygon",{points:l,style:c,onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,tabIndex:n.tabIndex,onKeyDown:function(t){return e.onKeyDown(t)},className:Y.getCssClassNamesValue(n)},""!==u&&v.a.createElement("title",null,u))}}]),t}(h.Component),Ft=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.onClickHandler=n.onClickHandler.bind(Object(O.a)(Object(O.a)(n))),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"onClickHandler",value:function(e){Re.doStandardOnClick(e,void 0,this)}},{key:"render",value:function(){var e=this.props,t=e.runtime,n=e.path,a=e.config,r=e.orientation,i=a.regions.map(function(e,a){"CbaPolygon"!==e.type&&console.warn("Unexpected region type: ".concat(e.type));var i=j.appendIndexToPageSegment(n,a);return v.a.createElement(At,{key:i,config:e.config,path:i,orientation:r,runtime:t})});return v.a.createElement("div",{title:Y.buildTitle(a),style:Y.buildStyleByIndexPath(n,a,!1,r,t),"data-cba-id":a.pageEditId,onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,className:Y.getCssClassNamesValue(a,"CbaRegionMap")},v.a.createElement("svg",{height:"100%",width:"100%"},i))}}]),t}(h.Component),jt=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.onClickHandler=n.onClickHandler.bind(Object(O.a)(Object(O.a)(n))),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"onClickHandler",value:function(e){Re.doStandardOnClick(e,void 0,this)}},{key:"render",value:function(){var e=this.props,n=e.runtime,a=e.config,r=e.path,i=e.orientation,o=Y.buildStyleByIndexPath(r,a,!1,i,n);return v.a.createElement("div",{dangerouslySetInnerHTML:t.sanitizeHtml(a.innerHtml),onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,title:Y.buildTitle(a),style:o,"data-cba-id":a.pageEditId})}}],[{key:"sanitizeHtml",value:function(e){return{__html:e}}}]),t}(h.Component),Lt=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).saveIframeState=function(){var e=n.iframeRef.current.contentWindow;if(void 0!==e&&null!==e)try{if(void 0!==e.getState){var a=e.getState(),r=$.getState(Object(O.a)(Object(O.a)(n)));G.setExternalContentState(r,a),$.registerState(Object(O.a)(Object(O.a)(n)),r)}else console.log("No getState method found. ".concat(n.reactionMessage(!0)))}catch(o){t.isPermissionDeniedException(o)?console.log("We don't save state of code running in IFrame from another orgin. URL in IFrame is ".concat(n.iframeRef.current.src)):console.error("Exception while trying to save state. ".concat(n.reactionMessage(!0)),o)}else{var i=n.props.path;console.error("No window in IFrame! -> We don't save state of code running in IFrame at path ".concat(i,"."))}},n.restoreIframeState=function(){var e=$.getState(Object(O.a)(Object(O.a)(n))),a=G.extractExternalContentState(e);void 0!==a&&(null!=n.currentSaveTimer&&(clearTimeout(n.currentSaveTimer),n.currentSaveTimer=null),n.currentSaveTimer=setTimeout(function(){return t.processSaveTimeout(Object(O.a)(Object(O.a)(n)),a,100)},20))},n.reactionMessage=function(e){var t=n.props,a=t.path,r=t.runtime,i=X.getUserDefPathForIndexPath(a,r),o=void 0===i?"":" (user defined ID path: ".concat(i,")");return" -> We don't ".concat(e?"save":"restore"," state of code running in IFrame at index path ").concat(a).concat(o,".")},n.getFrameWindow=function(){return n.iframeRef.current.contentWindow},n.getFrameContentUrl=function(){var e=n.props,t=e.config,a=e.runtime,r=Y.getProperResourcePathExternalResources(t.pageAddress,a);return r.startsWith("http")?new URL(r):new URL(r,window.location)},n.onClick=function(e){var t=n.props,a=t.config,r=t.path,i=t.runtime;Re.doBasicOnClick(e,r,i),Re.traceUserInteractionPerConfig(a,r,void 0,e,i)},n.onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.scroll=function(e,t){var a=n.iframeRef.current;if(a)try{var r=a.contentDocument?a.contentDocument:a.contentWindow.document,i=a.contentWindow;d.doScrollOnHTMLElement(e,t,r.querySelector("html"),i,a)}catch(o){console.warn("Could not scroll external page \n",o)}},n.iframeRef=v.a.createRef(),n.currentSaveTimer=null,n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this),this.restoreIframeState()}},{key:"componentWillUnmount",value:function(){null!==this.currentSaveTimer&&(clearTimeout(this.currentSaveTimer),this.currentSaveTimer=null),this.saveIframeState(),Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"updateStateInComponentStateManager",value:function(){this.saveIframeState()}},{key:"render",value:function(){var e=this.props,n=e.path,a=e.config,r=e.runtime,i=e.orientation,o=Y.buildStyleByIndexPath(n,a,!1,i,r);Y.setStyleAttribute(o,"resize","none");var s="".concat(a.pageAddress,"-").concat((new Date).getTime()),c=t.buildIframeUrl(a.pageAddress,n,r);return v.a.createElement("iframe",{ref:this.iframeRef,title:s,src:c,style:o,"data-cba-id":a.pageEditId,onClick:this.onClick,onContextMenu:this.onContextMenuHandler,className:Y.getCssClassNamesValue(a)})}}],[{key:"addAttributesToInitialState",value:function(e,t){G.setVolatile(e,!0),G.setComponentClassName(e,"CbaExternalPageFrame")}},{key:"processSaveTimeout",value:function(e,n,a){e.currentSaveTimer=null;var r=e.iframeRef.current.contentWindow;if(void 0!==r&&null!==r)try{void 0!==r.setState?r.setState(n):a>0?e.currentSaveTimer=setTimeout(function(){return t.processSaveTimeout(e,n,a-1)},20):console.log("No setState method found. ".concat(e.reactionMessage(!1)))}catch(i){t.isPermissionDeniedException(i)?console.log("We don't restore state of code running in IFrame from another orgin. URL in IFrame is ".concat(e.iframeRef.current.src)):console.error("Exception while trying to restore state ".concat(e.reactionMessage(!1)),i)}else console.error("No window in IFrame! ".concat(e.reactionMessage(!1)))}},{key:"isPermissionDeniedException",value:function(e){return e.message.startsWith("Permission denied to access property")}},{key:"buildIframeUrl",value:function(e,t,n){var a=Y.getProperResourcePathExternalResources(e,n);if(e.startsWith("http"))return n.postMessageReceiver.registerAcceptableUrlForExternalPageFrameEvent(a),a;var r=X.getUserDefPathForIndexPath(t,n),i=-1!==a.indexOf("?");return"".concat(a+(i?"&":"?"),"indexPath=").concat(t,"&userDefIdPath=").concat(r)}}]),t}(h.Component),Vt=n(148),Ut=n.n(Vt),Bt=(n(571),function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onRowExpandClick=function(e,t,a){e&&(e.preventDefault(),e.stopPropagation());var r=n.props,i=r.path,o=r.runtime,s=$.getState(Object(O.a)(Object(O.a)(n))),c=G.extractTreeNodes(s),l=ct.getNode(c,t.path);if(!l.isLeaf||0!==l.nodes.length){var u=l.expanded;if(l.expanded=a||!l.expanded,u!==l.expanded){o.replayStepMonitor.incrementReplayStep();var d=l.expanded?"expandNode":"collapseNode";at.traceNodeAction(d,i,t,o),$.registerState(Object(O.a)(Object(O.a)(n)),s),n.triggerRendering()}}},n.onRowSelect=function(e,t){e.preventDefault(),e.stopPropagation();var a=n.props.path;ct.selectNodeAction(a,t)},n.onClickHandler=function(e){var t=n.props,a=t.path,r=t.runtime;at.traceNodeAction("emptySelection",a,{isTreeView:!1,cells:[]},r),Re.stopEventPropagation(e)},n.onContextMenuHandler=function(e){var t=n.props,a=t.path,r=t.runtime;at.traceNodeAction("emptySelection",a,{isTreeView:!1,cells:[]},r)},n.addRowReferences=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.props,a=t.config,r=t.runtime,i=t.path,o=a.updateOnSingleClick,s=a.nodeTypes;return e.onRowExpandClick=n.onRowExpandClick,e.onRowSelect=n.onRowSelect,e.updateOnSingleClick=o,e.isTreeView=!1,e.runtime=r,e.nodeTypes=s,e.treePath=i,e.isReadOnly=a.readOnly,e},n.triggerRendering=function(){Q.triggerRendering(Object(O.a)(Object(O.a)(n)))};var r=e.path,i=e.runtime;return n.eventEmitter=i.eventEmitter,n.subscription=n.eventEmitter.addListener(ct.getTreeEventChangeName(r),n.triggerRendering),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){this.subscription.remove(),Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.config,a=t.runtime,r=t.path,i=t.orientation,o=n.hideLeaves,s=$.getState(this),c=Y.buildStyleByIndexPath(r,n,!1,i,a),l=s.treeNodes,u=s.treeColumns,d=G.extractTreeState(s)||{},g=n.hideColumns||ct.isDefaultColumn(u)?"hideColumns":"",f=ct.getTreeDisplayNodes(l,r,o),p=ct.getDisplayColumns(u,!1,d.modifiedColumns,r,a);return n.hideColumns&&(p.length=1,delete p[0].width),v.a.createElement("div",{style:c,"data-cba-id":n.pageEditId,className:Y.getCssClassNamesValue(n,g),onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,onScroll:function(e){return e.stopPropagation()},title:Y.buildTitle(n)},v.a.createElement(Ut.a,{columns:p,headerRowHeight:ct.const.COLUMN_HEIGHT,rowHeight:ct.const.ROW_HEIGHT,rowGetter:function(t){return e.addRowReferences(f[t])},rowsCount:f.length,rowRenderer:st,onColumnResize:function(t,n){return ct.handleColumnResize(p[t].key,n,e)}}))}}],[{key:"addAttributesToInitialState",value:function(e,t,n,a){var r=ct.initTreeNodes(t.nodes,t.nodeTypes,n,a,{startCollapsed:t.startCollapsed}),i=ct.initTreeColumns(t.columns,n),o=ct.initTreeState(i),s=d.deepCopy(t.nodeTypes),c=d.deepCopy(t.readOnly);G.setTreeNodes(e,r),G.setTreeColumns(e,i),G.setTreeState(e,o),G.setNodeTypes(e,s),G.setTreeReadOnly(e,c)}}]),t}(h.Component)),Ht=function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).handleTreeChange=function(){Q.triggerRendering(Object(O.a)(Object(O.a)(n)))},n.onRowSelect=function(e,t){e.preventDefault(),e.stopPropagation();var a=n.props,r=a.path,i=a.config.treePathId,o=ct.getTreePathFromChildComponent(i,r);ct.selectNodeAction(o,t)},n.handleGridSort=function(e,t){var a=n.props,r=a.path,i=a.runtime,o=$.getState(Object(O.a)(Object(O.a)(n)));G.setTreeViewSort(o,{type:t,column:e}),i.replayStepMonitor.incrementReplayStep(),at.traceSort(r,e,t,i),$.registerState(Object(O.a)(Object(O.a)(n)),o),Q.triggerRendering(Object(O.a)(Object(O.a)(n)))},n.onClickHandler=function(e){var t=n.props,a=t.path,r=t.runtime;at.traceNodeAction("emptySelection",void 0,{isTreeView:!0,treeViewPath:a,cells:[]},r),Re.stopEventPropagation(e)},n.onContextMenuHandler=function(e){var t=n.props,a=t.path,r=t.runtime;at.traceNodeAction("emptySelection",void 0,{isTreeView:!0,treeViewPath:a,cells:[]},r)},n.addRowReferences=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.props,a=t.runtime,r=t.path,i=t.config.treePathId,o=ct.getTreePathFromChildComponent(i,r),s=ct.getTreeDataByPath(o,a),c=s.nodeTypes,l=s.treeReadOnly;return e.onRowSelect=n.onRowSelect,e.updateOnSingleClick=!1,e.isTreeView=!0,e.onRowExpandClick=function(){},e.runtime=a,e.nodeTypes=c,e.treePath=o,e.treeViewPath=r,e.isReadOnly=l,e};var r=n.props.runtime;return n.eventEmitter=r.eventEmitter,n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.path,n=e.config.treePathId,a=ct.getTreePathFromChildComponent(n,t);this.subscription=this.eventEmitter.addListener(ct.getTreeEventChangeName(a),this.handleTreeChange),Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this),this.subscription.remove()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.config,a=t.runtime,r=t.path,i=t.orientation,o=n.filterLeaves,s=n.sortable,c=n.treePathId,l=ct.getTreePathFromChildComponent(c,r),u=$.getState(this),d=G.extractTreeViewSort(u)||{type:"NONE",column:null},g=Y.buildStyleByIndexPath(r,n,!1,i,a),f=ct.getTreeDataByPath(l,a),p=f.treeNodes,h=f.treeColumns,m=f.treeState.currentNode,y=G.extractTreeState(u);y||(y=ct.initTreeState(h),G.setTreeState(u,y),$.registerState(this,u));var b=ct.getTreeViewDisplayNodes(p,l,o,m,d)||[],k=ct.getDisplayColumns(h,s,y.modifiedColumns,r,a)||[],S=ct.isDefaultColumn(h);return v.a.createElement("div",{style:g,"data-cba-id":n.pageEditId,onClick:this.onClickHandler,onContextMenu:this.onContextMenuHandler,onScroll:function(e){return e.stopPropagation()},title:Y.buildTitle(n),className:Y.getCssClassNamesValue(n,S?"hideColumns":"")},v.a.createElement(Ut.a,{columns:k,headerRowHeight:ct.const.COLUMN_HEIGHT,rowHeight:ct.const.ROW_HEIGHT,rowGetter:function(t){return e.addRowReferences(b[t])},rowsCount:b.length,rowRenderer:st,onGridSort:this.handleGridSort,sortColumn:d.column,sortDirection:d.type,onColumnResize:function(t,n){return ct.handleColumnResize(k[t].key,n,e)}}))}}]),t}(h.Component),Wt=n(324);function Kt(e){return{error:e,result:null}}function qt(e,t,n,a){var r=n.row+1,i=n.col+1;if(r<1||i<1)return Kt("#N/A");if(r>t.row||i>t.col)return Kt("#N/A");if(void 0!==a.find(function(e){return e.row===n.row&&e.col===n.col}))return Kt("#REF!");var o=e[r][i];if(!de.isFormula(o))return{error:null,result:o};var s=o.slice(1),c=a.slice();c.push(n);var l=new Wt.Parser;return l.on("callCellValue",function(n,a){var r=qt(e,t,{row:n.row.index,col:n.column.index},c);if(null!==r.error)throw new Error(r.error);return a(r.result)}),l.on("callRangeValue",function(n,a,r){for(var i=[],o=n.row.index;o<=a.row.index;o+=1){for(var s=[],l=n.column.index;l<=a.column.index;l+=1){var u=qt(e,t,{row:o,col:l},c);if(null!==u.error)throw new Error(u.error);s.push(u.result)}i.push(s)}return r(i)}),l.setFunction("SUMME",function(e){return function e(t){if("number"===typeof t)return t;if("string"===typeof t){var n=Number.parseFloat(t);if(Number.isNaN(n))throw new Error("#NUM!");return n}return Array.isArray(t)?t.reduce(function(t,n){return t+e(n)},0):0}(e)}),l.parse(s)}var Gt=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onCellFocused=function(e,t,a,r){var i=n.props,o=i.config,s=i.path,c=i.runtime,l=$.getState(Object(O.a)(Object(O.a)(n))),u=G.extractSelectedCell(l),d=z.deepCopy(u);if(o.isSpreadsheet){var g=G.extractTableData(l),f=n.executeFormulaInternal(g,e,t),p=f.cellToUpdate,h=f.valueToUpdate,v=f.formulaToShow,m=f.isNotValidFormula,y=f.errorMessageToShow;n.notifyShowAddress(a),n.notifyShowContent(v,m,r,y),n.notifyUpdateCellValue(p,h,m,v,y)}var b=n.handleHeaderSelection(u,e,t,d);u=b.currentSelection,d=b.oldSelection,G.setOldSelectedCell(l,d),u.row===d.row&&u.column===d.column||n.notifyRemoveLastSelection(d),G.setOldSelectedCell(l,d),G.setSelectedCell(l,u);var k=G.extractSelected(l);G.setSelected(l,!k),c.componentStateManager.registerStateByPathId(s,l,c),Q.triggerRenderingViaPath(s,c)},n.runAllAvailableFormulas=n.runAllAvailableFormulas.bind(Object(O.a)(Object(O.a)(n))),n.notifyUpdateCellValue=n.notifyUpdateCellValue.bind(Object(O.a)(Object(O.a)(n))),n.notifyShowContent=n.notifyShowContent.bind(Object(O.a)(Object(O.a)(n))),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this);var e=this.props,t=e.config,n=e.path,a=e.runtime;a.eventEmitter.addListener("".concat(n,"-cellFocused"),this.onCellFocused.bind(this)),t.isSpreadsheet&&(a.eventEmitter.addListener("".concat(n,"-contentUpdate"),this.onContentUpdate.bind(this)),a.eventEmitter.addListener("".concat(n,"-removeOldSelection"),this.onRemoveOldSelection.bind(this)),this.runAllAvailableFormulas(!0))}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this),this.props.runtime.eventEmitter.removeAllListeners()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"onContentUpdate",value:function(e,t,n,a){var r=$.getState(this),i=G.extractTableData(r),o=!1;if(void 0!==t&&void 0!==n)void 0!==e&&i[t][n]!==e&&(o=!0,i[t][n]=e,this.executeFormulaAndNotifyOthers(i,t,n,a));else{var s=G.extractSelectedCell(r);void 0!==s&&void 0!==e&&i[s.row][s.column]!==e&&(o=!0,i[s.row][s.column]=e,this.executeFormulaAndNotifyOthers(i,s.row,s.column,a))}G.setTableData(r,i),$.registerState(this,r),o&&this.runAllAvailableFormulas()}},{key:"runAllAvailableFormulas",value:function(e){for(var t=$.getState(this),n=G.extractTableData(t),a=1;a<n.length;a+=1)for(var r=1;r<n[a].length;r+=1)if(de.isFormula(n[a][r])){var i=this.executeFormulaInternal(n,a,r),o=i.valueToUpdate,s=i.isNotValidFormula,c=i.formulaToShow,l=i.errorMessageToShow;this.notifyUpdateCellValue({row:a,column:r},o,s,c,l,e)}}},{key:"executeFormulaAndNotifyOthers",value:function(e,t,n,a){var r=this.executeFormulaInternal(e,t,n),i=r.cellToUpdate,o=r.valueToUpdate,s=r.formulaToShow,c=r.isNotValidFormula,l=r.errorMessageToShow;this.notifyUpdateCellValue(i,o,c,s,l),this.notifyShowContent(s,c,a,l)}},{key:"executeFormulaInternal",value:function(e,n,a){var r={row:n,column:a},i=e[n][a];if(!de.isFormula(i))return{cellToUpdate:r,formulaToShow:i,valueToUpdate:i,isNotValidFormula:!1,errorMessageToShow:void 0};var o=this.props.config,s=qt(e,{row:o.rows-1,col:o.columns-1},{row:n-1,col:a-1},[]),c=null!==s.error;return{cellToUpdate:r,formulaToShow:i,valueToUpdate:t.buildResultString(c,s.result),isNotValidFormula:c,errorMessageToShow:c?this.buildErrorMessage(s.error):void 0}}},{key:"buildErrorMessage",value:function(e){var t=this.props.config,n=t.divByZeroError,a=t.naNError,r=t.syntaxError,i=t.circularError;switch(e){case"#DIV/0!":return n;case"#VALUE!":return a;case"#REF!":return i;default:return r}}},{key:"onRemoveOldSelection",value:function(){var e=$.getState(this),t=G.extractOldSelectedCell(e);this.notifyRemoveLastSelection(t)}},{key:"notifyRemoveLastSelection",value:function(e){var t=this.props,n=t.path;t.runtime.eventEmitter.emit("".concat(n,"-removeLastSelection-[").concat(e.row,",").concat(e.column,"]"))}},{key:"notifyShowAddress",value:function(e){var t=this.props,n=t.path;t.runtime.eventEmitter.emit("".concat(n,"-showAddress"),e)}},{key:"notifyShowContent",value:function(e,t,n,a){var r=this.props,i=r.path;r.runtime.eventEmitter.emit("".concat(i,"-showContent"),e,t,n,a)}},{key:"notifyUpdateCellValue",value:function(e,t,n,a,r,i){var o=this.props,s=o.path;o.runtime.eventEmitter.emit("".concat(s,"-updateCellValue"),e,t,n,a,r,i)}},{key:"handleHeaderSelection",value:function(e,t,n,a){return void 0===e&&void 0!==t&&void 0!==n?(this.notifyRowHeaderUpdate(void 0,t),this.notifyColumnHeaderUpdate(void 0,n),a=e={row:t,column:n}):e.row!==t&&e.column!==n?(this.notifyRowHeaderUpdate(e.row,t),this.notifyColumnHeaderUpdate(e.column,n),e={row:t,column:n}):e.row!==t?(this.notifyRowHeaderUpdate(e.row,t),e.row=t):e.column!==n&&(this.notifyColumnHeaderUpdate(e.column,n),e.column=n),{currentSelection:e,oldSelection:a}}},{key:"notifyColumnHeaderUpdate",value:function(e,t){var n=this.props,a=n.path;n.runtime.eventEmitter.emit("".concat(a,"-columnHeaderUpdate"),e,t)}},{key:"notifyRowHeaderUpdate",value:function(e,t){var n=this.props,a=n.runtime,r=n.path;a.eventEmitter.emit("".concat(r,"-rowHeaderUpdate"),e,t)}},{key:"render",value:function(){var e=this.props,t=e.runtime,n=e.config,a=e.path,r=e.orientation;return v.a.createElement(Tt,{config:n,path:a,runtime:t,orientation:r})}}],[{key:"addAttributesToInitialState",value:function(e,n){G.setSelectable(e,n.selectable),n.isSpreadsheet&&(e.tableData=t.buildInitialData(n),G.setComponentClassName(e,"CbaTable"))}},{key:"buildInitialData",value:function(e){for(var t=[],n=0;n<e.rows;n+=1)t.push([]);return e.cbaChildren.map(function(e,n){return t[e.config.row].push(void 0!==e.config.text.label?e.config.text.label:""),!1}),t}},{key:"buildResultString",value:function(e,t){return e?"###":t===1/0?"####":t}}]),t}(h.Component),zt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(E.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(i)))).onChangeHandler=function(e){n.updateContent(e.target.value)},n.onClickHandler=function(e){Re.stopEventPropagation(e)},n.onAddressUpdate=function(e){var t=$.getState(Object(O.a)(Object(O.a)(n)));G.setCellEditorAddress(t,e),$.registerState(Object(O.a)(Object(O.a)(n)),t),Q.triggerRendering(Object(O.a)(Object(O.a)(n)))},n.onContentUpdate=function(e,t,a,r){n.updateContent(e,t,a,r)},n.onKeyPressOnInput=function(e){var t=n.props.runtime;"Enter"===e.key&&(t.eventEmitter.emit("".concat(n.buildAttachedTableIndexPath(),"-contentUpdate"),e.target.value),e.preventDefault())},n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this);var e=this.props.runtime;e.eventEmitter.addListener("".concat(this.buildAttachedTableIndexPath(),"-showAddress"),this.onAddressUpdate),e.eventEmitter.addListener("".concat(this.buildAttachedTableIndexPath(),"-showContent"),this.onContentUpdate)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"updateContent",value:function(e,t,n,a){var r=$.getState(this);void 0!==t&&G.setCellEditorIsNotValid(r,t),void 0!==a&&G.setCellEditorErrorMessage(r,a),void 0!==n&&G.setCellEditorContentIsReadOnly(r,n),G.setCellEditorContent(r,e),$.registerState(this,r),Q.triggerRendering(this)}},{key:"buildAttachedTableIndexPath",value:function(){var e=this.props,t=e.config,n=e.path,a=j.dropPageSegmentFromPath(n);return j.appendPageSegmentsToPath(a,t.attachedTable)}},{key:"render",value:function(){var e=this.props,t=e.config,n=e.path,a=e.runtime,r=e.orientation,i=t.adressTitle,o=t.contentTitle,s=$.getState(this),c=G.extractCellEditorAddress(s),l=G.extractCellEditorContent(s),u=G.extractCellEditorContentIsReadOnly(s),g=Y.buildStyleByIndexPath(n,t,!1,r,a),f=100*t.cellAddressRelWidth,p=100-f,h=d.deepCopy(g);h.left=0,h.top=0,h.width="".concat(f,"%"),h.height="100%",h.boxSizing="border-box",h.lineHeight=g.height,h.textAlign="center";var m={position:"absolute",top:0,left:"".concat(f,"%"),width:"".concat(p,"%"),height:"100%",boxSizing:"border-box"},y=G.extractCellEditorIsNotValid(s),b=G.extractCellEditorErrorMessage(s),k={position:"absolute",top:"-2px",right:"0",width:"7px",height:"8px",fontSize:"8px",lineHeight:"8px",backgroundColor:"#d8424f",color:"#fff",display:y?"block":"none"};return v.a.createElement("div",{style:g,"data-cba-id":t.pageEditId,className:Y.getCssClassNamesValue(t,"CbaTableCellEditor")},v.a.createElement("div",{style:h,title:i},void 0!==c?c:"",v.a.createElement("span",{style:k,title:b},"\xd7")),v.a.createElement("input",{style:m,title:o,onChange:this.onChangeHandler,onKeyPress:this.onKeyPressOnInput,onClick:this.onClickHandler,type:"text",value:void 0!==l?l:"",readOnly:u,tabIndex:t.tabIndex}))}}]),t}(h.Component),_t=function(e){function t(){return Object(a.a)(this,t),Object(E.a)(this,Object(x.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"render",value:function(){var e=this.props,n=e.config,a=e.runtime,r=e.path,i=e.orientation,o=G.extractTextValue($.getState(this)),s=t.getSimpleTextFieldPath(r),c=a.componentStateManager.findOrBuildStateForPathId(s,a);G.setTextValue(c,o),a.componentStateManager.registerStateByPathId(s,c,a);var l=z.deepCopy(n);return l.userDefinedId=void 0,v.a.createElement(It,{runtime:a,path:s,config:l,orientation:i})}}],[{key:"getSimpleTextFieldPath",value:function(e){return j.appendIndexToPageSegment(e,0)}},{key:"setDisplayValueInState",value:function(e,t){var n=$.getState(e);G.setTextValue(n,t),$.registerState(e,n)}}]),t}(h.Component),Jt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(E.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(i)))).keydown=function(e){return!e.ctrlKey&&(e.preventDefault(),n.props.runtime.calculatorsManager.keypress(e.key),!0)},n.paste=function(e){e.preventDefault(),n.props.runtime.calculatorsManager.paste(e.clipboardData.getData("Text").toString())},n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this),!0===this.props.config.catchKeyboardInputEvents&&(t.keyboardShortcutsRegistered||(document.addEventListener("keydown",this.keydown,!1),document.addEventListener("paste",this.paste,!1)),t.keyboardShortcutsRegistered+=1)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this),!0===this.props.config.catchKeyboardInputEvents&&(t.keyboardShortcutsRegistered-=1,t.keyboardShortcutsRegistered||(document.removeEventListener("keydown",this.keydown),document.removeEventListener("paste",this.paste)))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"render",value:function(){var e=this.props,n=e.config,a=e.runtime,r=e.path,i=e.orientation,o=G.extractTextValue($.getState(this)),s=t.createDelegateComponent({config:n},r,"CbaSimpleTextField"),c=s.delegatePath,l=s.delegateComponent,u=a.componentStateManager.findOrBuildStateForPathId(c,a);return G.setTextValue(u,o),a.componentStateManager.registerStateByPathId(c,u,a),v.a.createElement(It,{runtime:a,path:c,config:l.config,orientation:i})}}],[{key:"getSimpleTextFieldPath",value:function(e){return j.appendIndexToPageSegment(e,0)}},{key:"createDelegateComponent",value:function(e,n,a){var r=z.deepCopy(e);return r.config.userDefinedId=void 0,r.type=a,{delegatePath:t.getSimpleTextFieldPath(n),delegateComponent:r}}},{key:"setDisplayValueInState",value:function(e,t){var n=$.getState(e);G.setTextValue(n,t),$.registerState(e,n)}}]),t}(h.Component);Jt.keyboardShortcutsRegistered=0;var Yt=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).focus=function(){n.inputRef.current.focus()},n.inputRef=v.a.createRef(),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.config,a=t.path,r=t.runtime,i=t.orientation,o=$.getState(this),s=G.extractSelected(o),c=Y.buildStyleByIndexPath(a,n,s,i,r);return void 0===n.position.padding&&Y.setStyleAttribute(c,"padding","0px"),Y.setStyleAttribute(c,"resize","none"),v.a.createElement("textarea",{style:c,"data-cba-id":n.pageEditId,ref:this.inputRef,title:Y.buildTitle(n),disabled:G.extractDisabled(o),value:G.extractTextValue(o),onClick:function(t){return $e.onClickHandler(e,t)},onContextMenu:function(t){return $e.onContextMenuHandler(e,t)},onChange:function(t){return $e.onChangeHandler(e,t,"InputFieldModified","InputField_onChange")},onSelect:function(t){return $e.onSelectionHandler(e,t)},onFocus:function(t){return $e.onFocusHandler(e,t)},onBlur:function(t){return $e.onBlurHandler(e,t)},onCut:function(t){return $e.onCutCopyPaste(e,t)},onCopy:function(t){return $e.onCutCopyPaste(e,t)},onPaste:function(t){return $e.onCutCopyPaste(e,t)},readOnly:n.readOnly,tabIndex:n.tabIndex,className:Y.getCssClassNamesValue(n,"CbaInputField"),spellCheck:n.spellCheck})}}]),t}(h.Component),Xt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(E.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(i)))).state={counterValue:S()(new Date(0,0,0,0,0,0))},n.setCounterValueToState=function(){var e=n.state.counterValue,t=$.getState(Object(O.a)(Object(O.a)(n)));G.setCounterValue(t,e),$.registerState(Object(O.a)(Object(O.a)(n)),t)},n.reinitialiseState=function(){var e=$.getState(Object(O.a)(Object(O.a)(n))),t=G.extractCounterValue(e),a=t?S()(t):null;a&&n.setState(function(e){var t=e.counterValue;return t.add(a.hours(),"hours"),t.add(a.minutes(),"minutes"),t.add(a.seconds(),"seconds"),{counterValue:t}})},n.startTimer=function(){return setInterval(function(){n.setState(function(e){var t=e.counterValue;return t.add(1,"seconds"),{counterValue:t}})},1e3)},n.formatTime=function(e){return e.hours()?e.format("HH:mm:ss"):e.format("mm:ss")},n.handleTaskPauseOrResume=function(e){window.clearInterval(n.timer),e||(n.timer=n.startTimer())},n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this),this.reinitialiseState(),this.timer=this.startTimer()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer),this.setCounterValueToState(),Q.onUnmount(this)}},{key:"render",value:function(){var e=this.props,t=e.runtime,n=e.config,a=e.path,r=e.orientation,i=this.state.counterValue,o=$.getState(this),s=G.extractSelected(o),c=Y.buildStyleByIndexPath(a,n,s,r,t);return v.a.createElement("div",{className:Y.getCssClassNamesValue(n,"centerVerticalHorizontal"),title:Y.buildTitle(n),style:c,"data-cba-id":n.pageEditId},this.formatTime(i))}}]),t}(h.Component),Zt=n(325),Qt=n.n(Zt),$t=(n(575),function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).onClickHandler=function(e){if($.getState(Object(O.a)(Object(O.a)(n))).disabled)Re.stopEventPropagation(e);else{var t=n.props,a=t.config,r=t.path,i=t.runtime;Re.doBasicOnClick(e,r,i),Re.traceUserInteractionPerConfig(a,r,void 0,e,i),Re.doPageSwitchForComponent(Object(O.a)(Object(O.a)(n)))}},n.onChangeCompleteHandler=function(){var e=n.props,t=e.config,a=e.runtime;Re.sendStandardEvent(t,a)},n.onChangeHandler=function(e){var t=n.props,a=t.config,r=t.runtime,i=$.getState(Object(O.a)(Object(O.a)(n)));if(e=n.validateValue(e),!i.disabled&&!Number.isNaN(e)){var o=r.taskManager,s=r.variableManager,c=r.replayStepMonitor,l=o.getCurrentStatePathRoot(),u=a.text.dynamic.variable;s.getVariable(l,u)!==e&&(s.setVariable(l,u,e,"integer",r),c.incrementReplayStep(),Q.triggerRendering(Object(O.a)(Object(O.a)(n))))}},n.onKeyDownHandler=function(e){var t=n.props,a=t.config,r=t.runtime,i=a.pageIncrement,o=a.minValue,s=a.maxValue,c=a.text.dynamic.variable,l=r.taskManager,u=r.variableManager,d=l.getCurrentStatePathRoot(),g=u.getVariable(d,c,!1);if(33===e.keyCode){var f=g+i;f=f>s?s:f,n.onChangeHandler(f),n.onChangeCompleteHandler(),e.preventDefault()}if(34===e.keyCode){var p=g-i;p=p<o?o:p,n.onChangeHandler(p),n.onChangeCompleteHandler(),e.preventDefault()}37!==e.keyCode&&38!==e.keyCode&&39!==e.keyCode&&40!==e.keyCode||n.onChangeCompleteHandler()},n.onIncrementScale=function(e){var t=n.props,a=t.config,r=t.runtime,i=a.minValue,o=a.maxValue,s=a.text.dynamic.variable,c=r.taskManager,l=r.variableManager,u=c.getCurrentStatePathRoot(),d=l.getVariable(u,s,!1)+e,g=d>o?o:d;g=g<i?i:g,n.onChangeHandler(g)},n.validateValue=function(e,t,n){var a=parseInt(e,10);return a=(a=a<t?t:a)>n?n:a},n.scaleValueInput=v.a.createRef(),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.path,n=e.runtime;Q.onMount(this),this.subscription=n.eventEmitter.addListener("".concat(t,"-incrementScale"),this.onIncrementScale.bind(this)),this.scaleValueInput.current&&(this.scaleValueInput.current.querySelector(".rangeslider__handle").tabIndex=-1)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this),this.subscription.remove()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"render",value:function(){var e=this.props,t=e.config,n=e.path,a=e.runtime,r=e.orientation,i=t.minValue,o=t.maxValue,s=t.stepIncrement,c=t.thumbSize,l=t.isHorizontal,u=$.getState(this),d=Y.buildStyleByIndexPath(n,t,!1,r,a),g=Y.buildDisplayText(t,u,a);g=this.validateValue(g,i,o);var f="rangeslider-horizontal sliderHandleWidth".concat(c),p="rangeslider-vertical sliderHandleHeight".concat(c),h="".concat(l?f:p," ").concat(u.disabled?"disabled":"");return v.a.createElement("div",{style:d,"data-cba-id":t.pageEditId,title:u.disabled?void 0:Y.buildTitle(t),onKeyDown:this.onKeyDownHandler,onClickCapture:this.onClickHandler,ref:this.scaleValueInput,className:Y.getCssClassNamesValue(t)},v.a.createElement(Qt.a,{className:h,min:i,max:o,tooltip:!1,step:s,value:g,orientation:l?"horizontal":"vertical",onChange:this.onChangeHandler,onChangeComplete:this.onChangeCompleteHandler}))}}]),t}(h.Component)),en=n(326),tn=n.n(en),nn=n(327),an=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(E.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(i)))).onClickHandler=function(e){$.getState(Object(O.a)(Object(O.a)(n))).disabled?Re.stopEventPropagation(e):Re.doStandardOnClick(e,void 0,Object(O.a)(Object(O.a)(n)))},n.onChangeHandlerDebounced=Object(nn.debounce)(function(e){n.onChangeHandler(e)},2e3),n.onChangeHandler=function(e){var t=n.props,a=t.config,r=t.runtime,i=a.minValue,o=a.maxValue;if(null!==e){var s=r.taskManager,c=r.variableManager,l=r.replayStepMonitor,u=s.getCurrentStatePathRoot(),d=a.text.dynamic.variable;l.incrementReplayStep(),e=n.validateValue(e,i,o),c.setVariable(u,d,e,"integer",r)}Q.triggerRendering(Object(O.a)(Object(O.a)(n)))},n.onInvalidHandler=function(e,t,a){if(void 0!==e){var r=n.props,i=r.config,o=r.runtime,s=i.text.dynamic.variable,c=o.taskManager,l=o.variableManager,u=c.getCurrentStatePathRoot(),d=l.getVariable(u,s,!1);n.onChangeHandler(d)}},n.onKeyDownHandler=function(e){var t=n.props,a=t.config,r=t.runtime,i=a.pageIncrement,o=a.minValue,s=a.maxValue,c=a.text.dynamic.variable,l=r.taskManager,u=r.variableManager,d=l.getCurrentStatePathRoot(),g=u.getVariable(d,c,!1),f=g;33===e.keyCode&&(f=(f=g+i)>s?s:f),34===e.keyCode&&(f=(f=g-i)<o?o:f),38===e.keyCode&&(f=(f=g+1)>s?s:f),40===e.keyCode&&(f=(f=g-1)<o?o:f),33!==e.keyCode&&34!==e.keyCode&&38!==e.keyCode&&40!==e.keyCode||(n.onChangeHandler(f),e.preventDefault())},n.onInputHandler=function(e){var t=e.target.value;/(-)?[0-9]*\.?[0-9]*/g.test(t)&&n.onChangeHandlerDebounced(t)},n.validateValue=function(e,t,n){var a=parseInt(e,10);return a=(a=a<t?t:a)>n?n:a},n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"render",value:function(){var e=this.props,t=e.config,n=e.path,a=e.runtime,r=e.orientation,i=t.minValue,o=t.maxValue,s=t.stepIncrement,c=$.getState(this),l=Y.buildStyleByIndexPath(n,t,!1,r,a),u=Y.buildDisplayText(t,c,a);u=this.validateValue(u,i,o);return v.a.createElement("div",{style:l,"data-cba-id":t.pageEditId,title:Y.buildTitle(t),onKeyDown:this.onKeyDownHandler,onClickCapture:this.onClickHandler,className:Y.getCssClassNamesValue(t)},v.a.createElement(tn.a,{style:{wrap:{position:"unset",display:"unset"},input:{width:"100%",height:"100%",backgroundColor:"inherit",fontFamily:"inherit",fontSize:"inherit",fontWeight:"inherit",fontStyle:"inherit",color:"inherit"}},disabled:c.disabled,min:i,max:o,value:u,step:s,onChange:this.onChangeHandlerDebounced,onInvalid:this.onInvalidHandler,tabIndex:t.tabIndex,onInput:this.onInputHandler}))}}]),t}(h.Component),rn=(n(576),"row"),on="column-reverse",sn=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,cn=window.cancelAnimationFrame||window.mozCancelAnimationFrame,ln=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(E.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(i)))).state={value:"0%"},n.timerAnimation=function(){var e=n.props,t=e.runtime,a=e.config,r=a.timerEvent,i=a.runForward,o=t.statemachinesManager.getTimerData(r);if(n.timer){var s=n.computeTimerPercentage(o,i);n.setState({value:"".concat(s,"%")}),sn(n.timerAnimation)}},n.setTimerType=function(){var e=n.props.config,t=e.verticalOrientation,a=e.runForward;n.timerType=n.computeTimerType(t,a)},n.computeTimerType=function(e){return e?on:e?(console.error("Timer Flags not ok",e),null):rn},n.computeTimerValue=function(e){return{seconds:e?Math.ceil(e/1e3):0,miliseconds:e?e%1e3:null}},n.computeTimerPercentage=function(e,t){var n,a=e.totalTime,r=e.remainingTime;return n=e.isRunning||r?100*r/a:0,t&&(n=100-n),n.toFixed(2)},n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this),this.setTimerType(),this.timer=sn(this.timerAnimation)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"componentWillUnmount",value:function(){cn(this.timer),this.timer=null,Q.onUnmount(this)}},{key:"render",value:function(){var e=this.props,t=e.runtime,n=e.config,a=e.path,r=e.orientation,i=this.state.value,o=$.getState(this),s=G.extractSelected(o),c=Y.buildStyleByIndexPath(a,n,s,r,t),l=n.timerEvent,u=n.showSecondsLabel,d=this.timerType===rn?"width":"height",g=Object(N.a)({},d,i),f=t.statemachinesManager.getTimerData(l),p=this.computeTimerValue(f.remainingTime);return v.a.createElement("div",{className:Y.getCssClassNamesValue(n,"cba-timer-wrap ".concat(this.timerType)),style:c,"data-cba-id":n.pageEditId,title:Y.buildTitle(n)},v.a.createElement("div",{className:"cba-timer-animation",style:g}),u?v.a.createElement("span",{className:"cba-timer-secondsLabel"},p.seconds):null)}}]),t}(h.Component);n(279);var un=function(e){var t=e.config,n=e.selectedIds,a=e.index,r=e.itemHeight,i=e.onClickHandler,o=e.parentTabIndex,s=n.includes(a)?"listItemNoHover":"listItem";return v.a.createElement("div",{className:Y.getCssClassNamesValue(t,s),style:{height:r,background:n.includes(a)?"-webkit-gradient(linear, 0% 0%, 0% 100%, from(rgb(88, 130, 181)), to(rgb(65, 102, 147))), rgb(0, 88, 159)":t.background},onClick:function(e){return i(e,a)},onKeyDown:function(e){return function(e){32===e.keyCode&&i(e,a)}(e)},tabIndex:o},v.a.createElement("div",{className:"listItemChild"},t.text))},dn=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).getDisabledFromState=function(){var e=$.getState(Object(O.a)(Object(O.a)(n)));return G.extractDisabled(e)},n.getSelectedIdsFromState=function(){var e=$.getState(Object(O.a)(Object(O.a)(n)));return G.extractSelectedIds(e)||[]},n.setSelectedIdInState=function(e,t){var a=$.getState(Object(O.a)(Object(O.a)(n))),r=G.extractSelectedIds(a)||[],i=G.extractSelectGroupControllerState(a);t||(r=[]),void 0===i||!i.singleSelectActive&&t?r.includes(e)?r=r.filter(function(t){return t!==e}):r.push(e):r[0]=e,G.setSelectedIds(a,r),$.registerState(Object(O.a)(Object(O.a)(n)),a)},n.onClickHandler=function(e,a){var r=n.props,i=r.runtime,o=r.config,s=r.path;if(!1===n.getDisabledFromState()){var c=n.getSelectedIdsFromState(),l=c[c.length-1],u=parseInt(a,10),d=o.items[l],g=o.items[u];i.replayStepMonitor.incrementReplayStep(),n.updateStateAndTriggerRendering(u,e),Re.traceUserInteractionPerConfig(o,s,t.buildTraceDetailsAddOn(d,l,g,u),e,i),Re.sendStandardEvent(g,i);var f=Re.getDefaultLinkReceiver(Object(O.a)(Object(O.a)(n)));Re.doPageSwitch(g.link,i,f,s)}e.stopPropagation()},n.onContextMenuHandler=function(e){Re.doContextMenuOpen(Object(O.a)(Object(O.a)(n)),e)},n.updateStateAndTriggerRendering=function(e,t){var a=n.props,r=a.runtime,i=a.path;n.setSelectedIdInState(e,t.ctrlKey),Q.triggerRenderingViaPath(i,r)},n.checkForInvalidItems=function(){var e=n.props.config.items;return!Array.isArray(e)||Array.isArray(e)&&0===e.length},n.generateOptions=function(e,t,a,r,i){return e.map(function(e,o){var s=j.appendIndexToPageSegment(r,o);return v.a.createElement(un,{key:s,config:e,selectedIds:t,itemHeight:a,onClickHandler:n.onClickHandler,index:o,parentTabIndex:i})})},n.comboRef=v.a.createRef(),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){Q.onMount(this)}},{key:"componentWillUnmount",value:function(){Q.onUnmount(this)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){Q.onReceiveProps(this,e)}},{key:"render",value:function(){if(this.checkForInvalidItems())return v.a.createElement("div",null,"Invalid item configuration for list.");var e=this.props,t=e.config,n=e.path,a=e.runtime,r=e.orientation,i=Y.buildStyleByIndexPath(n,t,!1,r,a),o=this.getSelectedIdsFromState()||[],s=this.generateOptions(t.items,o,1.9*t.font.size,n,t.tabIndex);return v.a.createElement("div",{className:Y.getCssClassNamesValue(t,"list-container"),style:i,"data-cba-id":t.pageEditId,title:Y.buildTitle(t)},v.a.createElement("div",{className:"list"},s))}}],[{key:"getItemType",value:function(){return"ListItem"}},{key:"buildListItemsArray",value:function(e){return e.map(function(e,n,a){var r=z.deepCopy(e),i={};return G.setSelected(i,!1),G.setDisabled(i,!1),G.setHidden(i,!1),r.state=i,{type:t.getItemType(),config:r}})}},{key:"buildTraceDetailsAddOn",value:function(e,t,n,a){return{oldSelected:t,oldSelectedUserDefId:void 0!==e?e.userDefinedId:void 0,newSelected:a,newSelectedUserDefId:n.userDefinedId}}}]),t}(h.Component),gn=function(e){function t(){return Object(a.a)(this,t),Object(E.a)(this,Object(x.a)(t).apply(this,arguments))}return Object(I.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props,n=e.config,a=e.path,r=e.runtime,i=e.orientation,o=n.type,s=n.content,c=t.getComponentClass(o);if(void 0!==c)return v.a.createElement(c,{config:n.config,path:a,runtime:r,orientation:i});switch(o){case"PlainText":return v.a.createElement("div",null,s);default:return console.error("Interpreter does not know component type ".concat(o)),v.a.createElement("div",null,"Interpreter does not know component type: ".concat(o))}}}],[{key:"getComponentClass",value:function(e){switch(e){case"CbaContainer":return Tt;case"CbaRectangle":return Pt;case"CbaSingleLineInputField":return et;case"CbaSimpleTextField":return It;case"CbaButton":return Ot;case"CbaRadioButton":return Rt;case"CbaCheckbox":return Dt;case"CbaLink":return Nt;case"CbaPageArea":return ve;case"CbaRegionMap":return Ft;case"CbaInnerHtml":return jt;case"CbaRichTextField":return Xe;case"CbaComboBox":return ge;case"CbaExternalPageFrame":return Lt;case"CbaMedia":return yt;case"CbaTree":return Bt;case"CbaTreeChildArea":return ut;case"CbaTreeView":return Ht;case"CbaTable":return Gt;case"CbaTableCell":return tt;case"CbaTableCellEditor":return zt;case"CbaCalculatorInput":return Jt;case"CbaCalculatorHistory":return _t;case"CbaInputField":return Yt;case"CbaStopWatch":return Xt;case"CbaTimer":return ln;case"CbaScaleValueInput":return $t;case"CbaSpinnerValueInput":return an;case"CbaList":return dn;default:return}}}]),t}(h.Component),fn=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).openDialog=function(e,t,a){n.setState({isDialogOpen:!0,currentModal:e,currentModalTitle:t,currentModalContent:a})},n.handleClose=function(){return n.setState({isDialogOpen:!1})},n.pause=function(){return n.setState({isPaused:!0})},n.resume=function(){return n.setState({isPaused:!1})},n.generateTaskStyles=function(e){return v.a.createElement("style",{dangerouslySetInnerHTML:{__html:e}})},n.state={isDialogOpen:!1,currentModal:"",currentModalTitle:"",currentModalContent:{},isPaused:!1},e.runtime.testPresenter=Object(O.a)(Object(O.a)(n)),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e,n,a=this,r=this.props,i=r.runtime,o=r.taskId,s=r.settings,c=i.presenterStateManager.getTaskState(o),l=c.cssStyles,u=void 0!==c&&void 0!==c.itemWidth?c.itemWidth:600,g=void 0!==c&&void 0!==c.itemHeight?c.itemHeight:600,f=t.findPageForPageName(c.standardPage,i);void 0===f&&console.error("Cannot find top level page ".concat(c.standardPage," for taskId ").concat(o,", showing error page now!"),c);var p=void 0===f?{content:{type:"PlainText",content:"Cannot find page ".concat(c.standardPage)},isRighToLeft:!1}:f,h=t.findPageForPageName(c.xPage,i),m=t.buildPathForPage(c.standardPage,"standard",i),y=t.buildPathForPage(c.xPage,"xPage",i),b=c.withEditContextMenu,k=c.itemLayout,S=t.isHorizontalDivider(k),C=t.isXPageFirst(k),T=t.getXAreaSize(k),P=t.calculateDividerOffset(C,S,T,g,u),E=t.getDividerWidth(k),x=t.isDividerMovable(k),I=0===E&&!x,O=t.getRtlOrientation(p),M=t.getRtlOrientation(h),w=t.getRtlDir(p,h,C),R="right"===O?"rtl":"ltr",D=(e={position:"absolute"},Object(N.a)(e,O,0),Object(N.a)(e,"top",0),Object(N.a)(e,"width",u),Object(N.a)(e,"height",g),Object(N.a)(e,"overflow","auto"),Object(N.a)(e,"background","rgb(192, 192, 192)"),e),L=Object(N.a)({width:u,height:g,position:"absolute"},O,0),V={width:S?"100%":E+10,height:S?E+10:"100%",background:t.getDividerColor(c.itemLayout),display:I?"none":"block",MozBoxSizing:"border-box",WebkitBoxSizing:"border-box",boxSizing:"border-box",MozBackgroundClip:"padding",WebkitBackgroundClip:"padding",backgroundClip:"padding-box",transition:"none"},U={overflow:"auto",background:"rgb(192, 192, 192)"},B=(n={position:"absolute"},Object(N.a)(n,C?M:O,0),Object(N.a)(n,"top",0),Object(N.a)(n,"background","rgb(192, 192, 192)"),n),H={openConfigParams:["alt+v"],cut:["ctrl+x"],copy:["ctrl+c"],paste:["ctrl+v"],print:["ctrl+p","ctrl+shift+p"]},W={openConfigParams:function(e){d.printCbaVersion()},cut:b?function(e){i.clipboardManager.cut("keyboard",void 0,i)}:function(e){},copy:b?function(e){i.clipboardManager.copy("keyboard",void 0,i)}:function(e){},paste:b?function(e){i.clipboardManager.paste("keyboard",void 0,i)}:function(e){},print:function(e){e.stopPropagation(),e.preventDefault()}},K=s.debugScoreHotKey,q=s.debugTraceHotKey,G=s.debugStatemachineHotKey;void 0!==q&&q.length>0&&(H.openTrace=[q],W.openTrace=function(e){e.preventDefault();var t=i.traceLogBuffer;a.openDialog("Tracing","Tracing Debug Window",t)}),void 0!==K&&K.length>0&&(H.openScoring=[K],W.openScoring=function(e){e.preventDefault();var t=i.taskManager.getScoring();a.openDialog("Scoring","Scoring Debug Window",t)}),void 0!==G&&G.length>0&&(H.openStateMachine=[G],W.openStateMachine=function(e){e.preventDefault();var t=i.statemachinesManager,n=i.variableManager,r=t.getCurrentStateMachineLeafStates(),s=n.buildVariablesInfoArrayForTask(o),c={variables:void 0===s?[]:s,states:void 0===r?[]:r,visitedStates:t.getVisitedStates(),raisedEvents:t.getRaisedEvents()};a.openDialog("State Machine","State Machine Debug Window",c)});var z=this.state,_=z.isDialogOpen,J=z.currentModal,X=z.currentModalTitle,Z=z.currentModalContent,Q=z.isPaused,$=i.taskManager.getCurrentTestTaskItemNames().item,ee=Y.buildCustomFontsCss(i.taskManager.getCustomFontMappings($),i);return v.a.createElement(F.HotKeys,{className:"appContainer",style:{width:u,height:g},keyMap:H,handlers:W,tabIndex:1},ee?this.generateTaskStyles(ee):null,l?this.generateTaskStyles(l):null,void 0===h?v.a.createElement("div",{style:D,dir:t.isRightToLeftPage(p)?"rtl":"",onScroll:Re.traceUserScroll(m,i)},v.a.createElement(gn,{config:p.content,path:m,runtime:i,orientation:O})):v.a.createElement("div",{key:j.getRootFromPath(m),style:L,dir:R,onScroll:Re.traceUserScroll(m,i,y,C)},v.a.createElement(A.a,{split:S?"horizontal":"vertical",pane1Style:U,pane2Style:U,resizerStyle:V,minSize:0,maxSize:0===E?-1:-E,defaultSize:P,allowResize:x},v.a.createElement("div",{style:B,dir:w.firstAreaDir},v.a.createElement(gn,{config:C?h.content:p.content,path:C?y:m,runtime:i,orientation:C?M:O})),v.a.createElement("div",{style:B,dir:w.secondAreaDir},v.a.createElement(gn,{config:C?p.content:h.content,path:C?m:y,runtime:i,orientation:C?O:M})))),v.a.createElement(xe,{isOpen:_,closeDialog:this.handleClose,currentModal:J,currentModalTitle:X,currentModalContent:Z,runtime:i}),v.a.createElement(we,{runtime:i,findPageForPageName:t.findPageForPageName}),v.a.createElement("div",{className:"pause-backdrop ".concat(Q?"":"display-none")},v.a.createElement("div",{className:"pause-button"}," ")))}}],[{key:"findPageForPageName",value:function(e,t){if(void 0!==e){var n=t.pageConfigurationsManager.findPage(e);return void 0===n&&console.error("Could not find page with name ".concat(e)),n}}},{key:"buildPathForPage",value:function(e,t,n){if(void 0!==e)return j.appendPageSegmentToPathRoot(n.taskManager.getCurrentStatePathRoot(),"main",t,j.buildPageSegment(e))}},{key:"isRightToLeftPage",value:function(e){if(void 0!==e)return e.isRightToLeft}},{key:"getPagePosition",value:function(e){if(void 0!==e&&void 0!==e.content&&void 0!==e.content.config)return e.content.config.position}},{key:"getPageWidth",value:function(e,n){var a=t.getPagePosition(e);return void 0===a?n:a.width+a.x}},{key:"getPageHeight",value:function(e,n){var a=t.getPagePosition(e);return void 0===a?n:a.height+a.y}},{key:"getDividerConfig",value:function(e){if(void 0!==e)return e.divider}},{key:"getDividerWidth",value:function(e){var n=t.getDividerConfig(e);return void 0===n?0:void 0===n.width?0:n.width}},{key:"getDividerColor",value:function(e){var n=t.getDividerConfig(e);return void 0===n?"rgb(0,0,0,1)":void 0===n.color?"rgb(0,0,0,1)":n.color}},{key:"getXAreaSize",value:function(e){return void 0===e?0:void 0===e.xSize?0:e.xSize}},{key:"getXPlacement",value:function(e){return void 0===e?"left":void 0===e.xPlacement?"left":e.xPlacement}},{key:"isHorizontalDivider",value:function(e){var n=t.getXPlacement(e);return"top"===n||"bottom"===n}},{key:"isDividerMovable",value:function(e){return void 0!==e&&e.divider.moveable}},{key:"isXPageFirst",value:function(e){var n=t.getXPlacement(e);return"top"===n||"left"===n}},{key:"getRtlOrientation",value:function(e){return t.isRightToLeftPage(e)?"right":"left"}},{key:"getRtlDir",value:function(e,n,a){return a?{firstAreaDir:t.isRightToLeftPage(n)?"rtl":"ltr",secondAreaDir:t.isRightToLeftPage(e)?"rtl":"ltr"}:{firstAreaDir:t.isRightToLeftPage(e)?"rtl":"ltr",secondAreaDir:t.isRightToLeftPage(n)?"rtl":"ltr"}}},{key:"calculateDividerOffset",value:function(e,t,n,a,r){return e?n:t?a-n:r-n}}]),t}(h.Component),pn=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).handleClick=function(e,t,a){var r=n.props.runtime,i={index:a};Re.addMouseEventDetails(e,i),r.traceLogBuffer.reportEvent("HeaderButton",new Date,i),Re.sendEvent(t.event,r),n.setState(function(e){return{renderHelper:e.renderHelper+1}})},n.getLargestHeightFromButtons=function(e){var t=0;return e.forEach(function(e){t=t<e.height?e.height:t}),t},n.isButtonInvalid=function(e){var t=!1;return(!e.width||e.width<=0)&&(e.width=110),(!e.height||e.height<=0)&&(e.height=26),e.image||e.text||(console.log("Button Config for ",e,"  has no image or no text"),t=!0),e.event&&"string"===typeof e.event||(console.log("Button Config for ",e," has invalid event"),t=!0),t},n.buildButtons=function(e,t){var a=n.getLargestHeightFromButtons(e),r=0,i=n.props.runtime;return e.map(function(e,o){if(n.isButtonInvalid(e))return null;var s={height:a||32,width:e.width||"auto",overflow:"hidden",cursor:"pointer"},c={padding:5,display:"inline-block",float:"right"};return e.image&&(s.backgroundImage="url(".concat(Y.getProperResourcePath(e.image,i),")"),s.backgroundSize="contain",s.backgroundPosition="center",s.backgroundRepeat="no-repeat"),(r+=e.width+10)>t?null:v.a.createElement("span",{style:c,key:o},v.a.createElement("button",{type:"button",onClick:function(t){n.handleClick(t,e,o)},style:s},!e.image&&e.text))})},n.state={renderHelper:0},n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props,t=e.runtime,n=e.config;if(!n||!d.isNonEmptyArray(n))return null;var a=t.taskManager.getTopLevelConfiguration().itemWidth,r={width:a},i=this.buildButtons(n,a);return v.a.createElement("div",{style:r,className:"headerButtonsToolbar"},i)}}]),t}(h.Component),hn=n(100),vn=(n(577),n(578),function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).buildSlides=function(e){return e.map(function(e,t){return v.a.createElement(hn.d,{key:e.key,index:t},v.a.createElement("span",{className:"button-container"},e))})},n.buildCarouselConfig=function(e,a){var r=n.props.itemWidth,i=t.getButtonPadding(),o=e*a,s=r-50-2*i,c=e+2*i,l=o+2*i,u=c,d=String.fromCharCode("0x2039"),g=String.fromCharCode("0x203A"),f={width:r,marginBottom:t.getCarouselMarginBottom()},p={width:s,height:c,margin:"0 auto"},h={height:c};return{button:{height:e,width:o,padding:i},slides:{width:l,height:u,visibleSlides:Math.floor(s/l)},carouselWidth:s,carouselHeight:c,arrows:{left:d,right:g},styles:{carouselStyle:p,buttonStyle:h,carouselWrapStyle:f}}},n.computeCurrentSlideCenter=function(e,t){var n=0;if(e>=t.length)return n;var a,r=Math.ceil(e/2);return t.forEach(function(e,t){"active"===e.props.className&&(a=t+1)}),n=(n=(n=a-r)<0?0:n)>t.length-e?t.length-e:n},n.computeCurrentSlideNotCenter=function(){return n.carousel?n.carousel.carouselStore.getStoreState().currentSlide:0},n.buildCurrentSlide=function(e,t){var a=n.props.buttons;return t?n.computeCurrentSlideCenter(e.slides.visibleSlides,a):n.computeCurrentSlideNotCenter()},n.currentSlide=0,n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.buttonHeight,a=t.buttonRatio,r=t.activateCenterToolbarOnChange,i=t.className,o=t.buttons,s=this.buildCarouselConfig(n,a);return this.currentSlide=this.buildCurrentSlide(s,r),v.a.createElement("div",{className:"carousel-wrap ".concat(i),style:s.styles.carouselWrapStyle},v.a.createElement(hn.c,{ref:function(t){e.carousel=t},style:s.styles.carouselStyle,className:i,naturalSlideWidth:s.slides.width,naturalSlideHeight:s.slides.height,totalSlides:o.length,visibleSlides:s.slides.visibleSlides,currentSlide:this.currentSlide},v.a.createElement(hn.e,{style:s.styles.carouselStyle},this.buildSlides(o)),v.a.createElement(hn.a,{className:"nav-buttons back",style:s.styles.buttonStyle},s.arrows.left),v.a.createElement(hn.b,{className:"nav-buttons next",style:s.styles.buttonStyle},s.arrows.right)))}}],[{key:"getButtonPadding",value:function(){return 5}},{key:"getCarouselMarginBottom",value:function(){return 5}}]),t}(h.Component));vn.getCarouselHeight=function(e){return e+2*vn.getButtonPadding()+vn.getCarouselMarginBottom()},vn.defaultProps={itemWidth:800,buttonRatio:3,activateCenterToolbarOnChange:!1};n(579);var mn=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).highlightRecommendations=function(e){void 0===e&&console.error("Invalid recommendations in highlight call ignored!");var t=void 0===e?[]:e;n.setState(function(e){return{recommendations:t}})},n.buildTestButton=function(e){var a=n.state.recommendations,r=_.findFirstRecommendationForTest(a,e),i=n.selectDefaultTaskForTest(e,r),o=n.props,s=o.runtime,c=o.testButtonHeight,l=o.currentTest,u=void 0===i?function(t){console.info("Ignored navigation request to test named ".concat(e," since the test has no tasks assigned."))}:function(n){t.traceNavigation(!0,e,n,s),t.navigateToTest(e,i.item,i.task,s)};return v.a.createElement("button",{type:"button",key:e,onClick:u,title:e,style:t.buildButtonStyle(c,e===l,void 0!==r),className:t.buildButtonClassName(e===l,void 0!==r)},e)},n.selectDefaultTaskForTest=function(e,a){var r=n.props,i=r.runtime,o=r.tests;if(void 0!==a&&void 0!==a.taskName){var s=t.findFirstTaskWithNameForTest(o,e,a.taskName);if(void 0!==s)return{item:s.item,task:s.task}}var c=i.taskNavigatorStateManager.getTestState(e);if(void 0!==c)return{item:c.itemName,task:c.taskName};var l=t.findDefaultTaskForTest(o,e);return void 0!==l?{item:l.item,task:l.task}:void 0},n.buildTestNavigation=function(){return n.props.courses.map(function(e){return n.buildTestButton(e)})},n.buildTaskButton=function(e,a,r){var i=n.state.recommendations,o=n.props,s=o.runtime,c=o.taskButtonHeight,l=o.currentItem,u=o.currentTask,d=_.findFirstRecommendationForTask(i,e,r),g=void 0===r?function(e){}:function(n){t.traceNavigation(!1,r,n,s),t.navigateToTask(r,a,s),s.recommendationsManager.processTaskSelected(e,a,r)};return v.a.createElement("button",{type:"button",key:"".concat(e,".").concat(a,".").concat(r),onClick:g,title:r,style:t.buildButtonStyle(c,r===u&&a===l,void 0!==d),className:t.buildButtonClassName(r===u&&a===l,void 0!==d)},r)},n.buildTopLayerStyle=function(){return{width:n.props.runtime.taskManager.getTopLevelConfiguration().itemWidth}},n.assignRatioToButton=function(e){return function(t){var n=e*t.props.style.height;return t.props.style.width=n,t.props.style.minWidth=n,t}},n.buildTaskNavigation=function(){var e=n.props,a=e.tests,r=e.currentTest,i=t.findTestForName(a,r);return void 0===i||void 0===i.taskCourse?v.a.createElement("div",null,"--- Test invalid, no tasks found ---"):i.taskCourse.map(function(e){return n.buildTaskButton(r,e.item,e.task)})},n.state={recommendations:[]},n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props,t=e.runtime,n=e.testButtonHeight,a=t.taskManager.getTopLevelConfiguration().itemWidth;return v.a.createElement("div",{className:"task-navigator",style:this.buildTopLayerStyle()},v.a.createElement(vn,{className:"test-navigation",buttons:this.buildTestNavigation(),itemWidth:a,buttonHeight:n,buttonRatio:2,activateCenterToolbarOnChange:!1}),v.a.createElement("div",{className:"task-navigation"},this.buildTaskNavigation().map(this.assignRatioToButton(2))))}}],[{key:"buildButtonStyle",value:function(e,t,n){var a={height:e};if(t){var r=1+2*vn.getButtonPadding()/e;a.transform="scale(".concat(r,")")}return n&&(a.backgroundColor=_.getRecommendationColor()),a}},{key:"buildButtonClassName",value:function(e,t){var n="";return e&&(n+="active"),t&&(n+=" recommended"),n}},{key:"findTestIndexForName",value:function(e,t){var n=e.findIndex(function(e,n,a){return e.name===t});if(void 0!==n)return n;console.error("Test navigator could not find test with name ".concat(t))}},{key:"findTestForName",value:function(e,t){var n=e.find(function(e,n,a){return e.name===t});if(void 0!==n)return n;console.error("Test navigator could not find test with name ".concat(t))}},{key:"findFirstTaskInTest",value:function(e){if(void 0!==e&&void 0!==e.taskCourse[0])return e.taskCourse[0]}},{key:"findDefaultTaskForTest",value:function(e,n){var a=t.findTestForName(e,n);return t.findFirstTaskInTest(a)}},{key:"findFirstTaskWithNameForTest",value:function(e,n,a){var r=t.findTestForName(e,n);if(void 0!==r)return r.taskCourse.find(function(e,t,n){return e.task===a})}},{key:"navigateToTest",value:function(e,t,n,a){a.taskManager.switchTaskInterTest(e,t,n)}},{key:"traceNavigation",value:function(e,t,n,a){var r={navigationType:e?"test":"task",navigationTarget:t};Re.addMouseEventDetails(n,r),a.traceLogBuffer.reportEvent("NavigationButton",new Date,r)}},{key:"navigateToTask",value:function(e,t,n){n.taskManager.switchTaskIntraTest(t,e)}}]),t}(h.Component);mn.getTaskNavigatorHeight=function(e,t){return vn.getCarouselHeight(e)+vn.getCarouselHeight(t)-vn.getCarouselMarginBottom()};var yn=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).handleTopLevelPageChange=function(){n.testPresenter.current&&Q.triggerRendering(n.testPresenter.current)},n.setTaskNavigator=function(e){n.props.runtime.recommendationsManager.setTaskNavigator(e)},n.buildTaskNavigator=function(e,t){if(n.shouldBuildNavigator()){var a=n.props,r=a.courses,i=a.tests,o=a.runtime,s=o.taskManager.getCurrentTestTaskItemNames(),c=s.test,l=s.item,u=s.task;return v.a.createElement(mn,{courses:r,tests:i,currentTest:c,currentItem:l,currentTask:u,testButtonHeight:e,taskButtonHeight:t,ref:n.setTaskNavigator,runtime:o})}},n.shouldBuildNavigator=function(){var e=n.props.settings;return!!e&&e.ShowTaskNavigationBars},n.testPresenter=v.a.createRef(),n.contextMenu=v.a.createRef(),n.props.runtime.taskManager.setTopLevelPageChangeHandler(n.handleTopLevelPageChange),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.runtime;if(e.traceLogUploader.startAutomaticTransmissions(),e.contextMenu=this.contextMenu.current,window.reactClientLoaded)try{window.reactClientLoaded()}catch(t){console.log(t.message)}}},{key:"componentWillUnmount",value:function(){this.props.runtime.traceLogUploader.stopAutomaticTransmissions()}},{key:"render",value:function(){var e=this.props,t=e.runtime,n=e.settings,a=e.headerButtons,r=e.scaleValue,i=t.taskManager.getCurrentStatePathRoot(),o={transform:"scale(".concat(r,")")};return v.a.createElement("div",{className:"appDiv",style:o},v.a.createElement("div",{className:"topToolBarContainer"},v.a.createElement(pn,{runtime:t,config:a}),this.buildTaskNavigator(70,50)),v.a.createElement(D.a,null),v.a.createElement(fn,{taskId:i,ref:this.testPresenter,runtime:t,settings:n}),v.a.createElement(oe,{ref:this.contextMenu,runtime:t}))}}]),t}(h.Component),bn=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).switchToLoginState=function(){(0,n.props.handleLogin)(n.state.loggedUserName)},n.handleLoginClick=function(e){n.switchToLoginState()},n.updateInputLoginValue=function(e){n.setState({loggedUserName:e.target.value})},n.handleKeyPress=function(e){"Enter"===e.key&&n.switchToLoginState()},n.inputRef=v.a.createRef(),n.state={loggedUserName:""},n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){this.inputRef.current.focus()}},{key:"render",value:function(){var e=this,t=this.state.loggedUserName,n=this.props,a=n.titleLabel,r=n.fieldLabel,i=n.buttonLabel,o=n.disabled;return v.a.createElement("div",{className:"appDiv"},v.a.createElement("div",{className:"login-container"},v.a.createElement("div",{className:"login-head"},v.a.createElement("h3",null,a)),v.a.createElement("div",{className:"login-body"},v.a.createElement("div",{className:"form-group"},v.a.createElement("label",{htmlFor:"usernameInputName"},v.a.createElement("b",null,r),v.a.createElement("input",{ref:this.inputRef,type:"text",placeholder:"",name:"usernameInputName",value:t,onChange:function(t){return e.updateInputLoginValue(t)},onKeyPress:this.handleKeyPress}))),v.a.createElement("div",{className:"btn-container"},v.a.createElement("button",{className:"btn blue-button",type:"button",onClick:this.handleLoginClick,disabled:o},"".concat(o?"...":i))))))}}]),t}(h.Component),kn=n(216),Sn=n.n(kn),Cn={pageBlur:"PAGE_HIDDEN",pageFocus:"PAGE_SHOWN",enterFullscreen:"ENTER_FULLSCREEN",exitFullscreen:"EXIT_FULLSCREEN"},Tn=function(){function e(t){var n=this;Object(a.a)(this,e),this.lastVisibilityTime=null,this.lastFullScreenTime=null,this.isFullScreen=null,this.handleVisibility=function(e){return function(){var t=n.getMoment(),a=n.computeTimeDifference(t,n.lastVisibilityTime);n.traceAction(e,a),n.lastVisibilityTime=t}},this.traceAction=function(e,t){switch(e){case Cn.pageBlur:n.reportEvent("ApplicationVisibility",new Date,n.buildTraceDetails("pageHidden",t));break;case Cn.pageFocus:n.reportEvent("ApplicationVisibility",new Date,n.buildTraceDetails("pageShown",t));break;case Cn.enterFullscreen:n.reportEvent("ApplicationFullScreen",new Date,n.buildTraceDetails("enterFullscreen",t));break;case Cn.exitFullscreen:n.reportEvent("ApplicationFullScreen",new Date,n.buildTraceDetails("exitFullscreen",t));break;default:console.warn("Wrong type provided in PageEventsObserverssss")}},this.computeTimeDifference=function(e,t){return S.a.duration(e.diff(t)).asSeconds()},this.buildTraceDetails=function(e,t){return{type:e,alternateStateDuration:t}},this.handleFullScreen=function(e){var t=n.getMoment(),a=n.computeTimeDifference(t,n.lastFullScreenTime);if(n.isFullScreen!==e){var r=e?Cn.enterFullscreen:Cn.exitFullscreen;n.traceAction(r,a),n.isFullScreen=e,n.lastFullScreenTime=t}},this.getMoment=function(){return S()()},this.lastVisibilityTime=S()(),this.lastFullScreenTime=S()(),this.reportEvent=t.traceLogBuffer.reportEvent}return Object(r.a)(e,[{key:"initObserver",value:function(){Sn.a.on("blur",this.handleVisibility(Cn.pageBlur)),Sn.a.on("focus",this.handleVisibility(Cn.pageFocus))}}]),e}(),Pn=function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e))).resize=function(){if("showTask"===n.state.displayMode){var e=n.computeScalingValue();n.setState(function(){return Object.assign({},{scaleValue:e})})}},n.showWaiting=function(){n.runtime.taskManager.stopTask(),n.setState(function(e){return{displayMode:"waiting"}})},n.showLogin=function(e,t,a,r){n.setState(function(n){return{displayMode:"showLogin",loginTitleLabel:e,loginFieldLabel:t,loginButtonLabel:a,loginDialogClosedHandler:r,loginDialogDisabled:!1}})},n.showTask=function(e,a,r,i,o,s,c){if(void 0!==n.runtime.taskManager.switchTask(e,a,r,!1)){var l=n.computeScalingValue(n.scalingConfig.scalingMode);t.dumpTasksViewConfigurationToTraceLog(s,c,i,o,n.runtime.traceLogBuffer),n.setState(function(e){return{displayMode:"showTask",settings:i,headerButtons:o,courseForNavigator:s,testsForNavigator:c,scaleValue:l}})}else console.info("Could not switch to task ".concat(e,"/").concat(a,"/").concat(r,"."))},n.showReplay=function(e,a,r,i,o,s,c){if(void 0!==n.runtime.taskManager.switchTask(e,a,r,!0)){var l=n.computeScalingValue(n.scalingConfig.scalingMode);t.dumpTasksViewConfigurationToTraceLog(s,c,i,o,n.runtime.traceLogBuffer),n.setState(function(e){return{displayMode:"showTask",settings:i,headerButtons:o,courseForNavigator:s,testsForNavigator:c,scaleValue:l}})}else console.info("Could not switch replay to task ".concat(e,"/").concat(a,"/").concat(r,"."))},n.setScalingConfig=function(e){n.scalingConfig=e},n.computeScalingValue=function(){var e,t=n.props.runtime,a=window.innerWidth/t.taskManager.getTopLevelConfiguration().itemWidth,r=window.innerHeight/t.taskManager.getTopLevelConfiguration().itemHeight;switch(n.scalingConfig.scalingMode){case"no-scaling":e=1;break;case"scale-up":e=a>1&&r>1?a<r?a:r:1;break;case"scale-down":e=a<1||r<1?a<r?a:r:1;break;case"scale-up-down":e=a<r?a:r;break;default:e=1}return e},n.getScalingAlignmentCssClass=function(){var e=n.scalingConfig,t=e.alignmentHorizontal,a=e.alignmentVertical,r="";switch(t){case"left":r+="left";break;case"center":r+="horizontal-center";break;case"right":r+="right";break;default:r+="left"}switch(r+=" ",a){case"top":r+="top";break;case"center":r+="vertical-center";break;case"bottom":r+="bottom";break;default:r+="top"}return r},n.handleLoginClick=function(e){var t=n.state.loginDialogClosedHandler;n.setState(function(e){return{loginDialogDisabled:!0}}),t(e)},n.renderWaiting=function(){var e=void 0===n.waitingMessageTexts?"":n.waitingMessageTexts.primary,t=void 0===n.waitingMessageTexts?"":n.waitingMessageTexts.secondary;return v.a.createElement("div",{className:"appDivContainer top left"},v.a.createElement("div",{className:"appDiv"},e,v.a.createElement("br",null),v.a.createElement("br",null),t))},n.renderLogin=function(){var e=n.state,t=e.loginTitleLabel,a=e.loginFieldLabel,r=e.loginButtonLabel,i=e.loginDialogDisabled;return v.a.createElement("div",{className:"appDivContainer horizontal-center vertical-center"},v.a.createElement(bn,{handleLogin:n.handleLoginClick,titleLabel:t,fieldLabel:a,buttonLabel:r,disabled:i}))},n.renderTask=function(){var e=n.props.runtime,t=n.state,a=t.settings,r=t.headerButtons,i=t.courseForNavigator,o=t.testsForNavigator,s=t.scaleValue;return v.a.createElement("div",{className:"appDivContainer ".concat(n.getScalingAlignmentCssClass()," ").concat(1===s?"overflow-auto":"")},v.a.createElement(yn,{courses:i,tests:o,settings:a,headerButtons:r,runtime:e,scaleValue:s}))};var r=n.props,i=r.runtime,o=r.waitingMessageTexts;return n.runtime=i,i.app=Object(O.a)(Object(O.a)(n)),n.waitingMessageTexts=o,n.scalingConfig={alignmentHorizontal:"left",alignmentVertical:"top",scalingMode:"no-scaling"},n.state={displayMode:"waiting",scaleValue:1},i.pageEventsObserver=new Tn(i),i.pageEventsObserver.initObserver(),n}return Object(I.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",w()(this.resize,200))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",w()(this.resize,200))}},{key:"setWaitingMessageTexts",value:function(e){this.waitingMessageTexts=e,"waiting"===this.state.displayMode&&this.showWaiting()}},{key:"render",value:function(){switch(this.state.displayMode){case"waiting":return this.renderWaiting();case"showLogin":return this.renderLogin();case"showTask":return this.renderTask();default:return this.renderWaiting()}}}],[{key:"dumpTasksViewConfigurationToTraceLog",value:function(e,t,n,a,r){r.reportEvent("TasksViewVisible",new Date,{settings:n,headerButtons:a,upperHeaderMenu:e,lowerHeaderMenu:t})}}]),t}(h.Component),En=function(){function e(){var t=this;Object(a.a)(this,e),this.clear=function(){t.stateMap={}},this.getStateSnapshot=function(e){return t.getSnapshot(function(e){return!0},e)},this.getTaskSnapshot=function(e,n,a,r){return t.getSnapshot(function(t){return j.getRootFromPath(t[0])===j.buildPathRoot(e,n,a)},r)},this.preloadWithStateSnapshot=function(n){t.stateMap=e.fromSnapshotRepresentation(Object.entries(n))},this.registerStateChangeFromSnapshot=function(n,a){t.stateMap[n]=e.fromSnapshotRepresentationForSingleEntry(n,a)},this.registerStateByPathId=function(n,a,r){t.stateMap[n]=e.doDeepCopyIfRequired(a),Z.dumpStateChangeToTrace("ComponentState",{pathId:n,state:e.toSnapshotRepresentationForSingleEntry(n,t.stateMap[n])},r.traceLogBuffer)},this.findOrBuildStateForPathId=function(e,n){return t.findOrBuildStateForPathIdInternal(e,n)},this.registerStateByUserDefPath=function(e,n,a){t.registerStateByPathId(X.getIndexPathForUserDefPath(e,a),n,a)},this.findOrBuildStateByUserDefPath=function(e,n){return t.findOrBuildStateForPathId(X.getIndexPathForUserDefPath(e,n),n)},this.filterExistingPathIds=function(e){return Object.keys(t.stateMap).filter(function(t){return e(t)})},this.findOrBuildStateForPathIdInternal=function(n,a){var r=e.doDeepCopyIfRequired(t.stateMap[n]);if(void 0!==r)return r;var i=j.getRootFromPath(n),o=a.taskManager.getCurrentStatePathRoot();if(!i!==o){var s=e.buildStateFromConfig(n,a);return t.registerStateByPathId(n,s,a),s}console.warn("Cannot create state for ".concat(n," since runtime is loaded for ").concat(o))},this.stateMap={}}return Object(r.a)(e,[{key:"getSnapshot",value:function(t,n){return e.updateVolatiles(Object.entries(this.stateMap).filter(t),n),e.toSnapshotRepresentation(Object.entries(this.stateMap).filter(t))}}],[{key:"buildStateFromConfig",value:function(t,n){var a=j.getLastPageSegmentFromPath(t);void 0===a&&console.warn("Empty page segment chopped off from path id ".concat(t));var r=n.pageConfigurationsManager,i=r.findConfigurationForPageSegment(a);if(void 0!==i){var o=i.config,s=i.type,c={};G.setDeepCopy(c,!0),G.setVolatile(c,!1),G.setDisabled(c,Y.getDisabled(o)),G.setHidden(c,Y.getHidden(o)),G.setVisited(c,!1),G.setSelected(c,Y.getSelected(o));var l=Y.getPosition(o);void 0!==l&&G.setPosition(c,{x:l.x,y:l.y}),G.setDefaultLinkReceiver(c,e.calculateDefaultLinkReceiver(t,r)),void 0!==o.text&&void 0!==o.text.label&&G.setTextValue(c,o.text.label);var u=Y.getDragAndDrop(o);switch(G.setDragAndDrop(c,{isSender:void 0!==u&&void 0!==u.sender,isReceiver:void 0!==u&&void 0!==u.receiver}),fe.addPropagationGroupControllerState(c,o),pe.addSelectGroupControllerState(c,s,t,o),pe.addSelectGroupMemberInfo(c,s,t,n),s){case"CbaSingleLineInputField":$e.addAttributesToInitialState(c,o);break;case"CbaSimpleTextField":It.addAttributesToInitialState(c,o,n);break;case"CbaPageArea":ve.addAttributesToInitialState(c,o);break;case"CbaRichTextField":Xe.addAttributesToInitialState(c,o);break;case"CbaMedia":yt.addAttributesToInitialState(c,o);break;case"CbaTable":Gt.addAttributesToInitialState(c,o);break;case"CbaInputField":$e.addAttributesToInitialState(c,o);break;case"CbaTree":Bt.addAttributesToInitialState(c,o,t,n);break;case"CbaExternalPageFrame":Lt.addAttributesToInitialState(c,o)}return c}console.error("Cannot find configuration for path ".concat(a))}},{key:"calculateDefaultLinkReceiver",value:function(t,n){var a=j.dropPageSegmentFromPath(t);if(void 0!==a)for(var r=j.getLastPageSegmentFromPath(a);void 0!==r;){var i=e.isLinkCatcher(r,n,t);if(void 0===i)return;if(i)return j.trimRootAndPageAreaFromPath(a);a=j.dropPageSegmentFromPath(a),r=j.getLastPageSegmentFromPath(a)}}},{key:"isLinkCatcher",value:function(e,t,n){var a=t.findConfigurationForPageSegment(e);if(void 0!==a){var r=a.config.catchLinks;if(void 0!==r)return!0===r;console.error("Missing catch link configuration for page embedding component at end of inner page segment: ".concat(e," in path ").concat(n))}else console.error("Missing page embedding component at end of inner page segment: ".concat(e," in path ").concat(n))}},{key:"doDeepCopyIfRequired",value:function(e){if(void 0!==e)return void 0===G.extractDeepCopy(e)&&G.setDeepCopy(e,!0),!1===G.extractDeepCopy(e)?e:z.deepCopy(e)}},{key:"updateVolatiles",value:function(e,t){e.forEach(function(e){var n=Object(L.a)(e,2),a=n[0],r=n[1];if(G.extractVolatile(r)){var i=t.findComponent(a);void 0!==i&&i.updateStateInComponentStateManager()}})}},{key:"toSnapshotRepresentation",value:function(e){var t=this,n={};return e.forEach(function(e){var a=Object(L.a)(e,2),r=a[0],i=a[1];n[r]=t.toSnapshotRepresentationForSingleEntry(r,i)}),n}},{key:"toSnapshotRepresentationForSingleEntry",value:function(t,n){return G.extractDeepCopy(n)?z.deepCopy(n):e.toSnapshotRepresentationByComponent(t,n)}},{key:"fromSnapshotRepresentation",value:function(e){var t=this,n={};return e.forEach(function(e){var a=Object(L.a)(e,2),r=a[0],i=a[1];n[r]=t.fromSnapshotRepresentationForSingleEntry(r,i)}),n}},{key:"fromSnapshotRepresentationForSingleEntry",value:function(t,n){return G.extractDeepCopy(n)?z.deepCopy(n):e.fromSnapshotRepresentationByComponent(t,n)}},{key:"toSnapshotRepresentationByComponent",value:function(e,t){var n=G.extractComponentClassName(t);if(void 0!==n)switch(n){case"CbaRichTextField":return Xe.toSnapshot(e,t);case"CbaTable":return Gt.toSnapshot(e,t);default:return void console.error("Unexpected component class ".concat(n," for snapshot in path ").concat(e),t)}else console.error("Cannot create snapshot for component state in path ".concat(e),t)}},{key:"fromSnapshotRepresentationByComponent",value:function(e,t){var n=G.extractComponentClassName(t);if(void 0!==n)switch(n){case"CbaRichTextField":return Xe.fromSnapshot(e,t);case"CbaTable":return Gt.fromSnapshot(e,t);default:return void console.error("Unexpected component class ".concat(n," in snapshot in path ").concat(e),t)}else console.error("Cannot extract component state from snapshot for path ".concat(e),t)}}]),e}(),xn=function(){function e(){Object(a.a)(this,e),this.componentList={},this.clear=this.clear.bind(this),this.registerComponent=this.registerComponent.bind(this),this.deregisterComponent=this.deregisterComponent.bind(this),this.findComponent=this.findComponent.bind(this)}return Object(r.a)(e,[{key:"clear",value:function(){this.componentList={}}},{key:"registerComponent",value:function(e,t){this.componentList[e]=t}},{key:"deregisterComponent",value:function(e){this.componentList[e]=void 0}},{key:"findComponent",value:function(e){return this.componentList[e]}},{key:"findByComponentType",value:function(e){return Object.values(this.componentList).filter(function(t){return t instanceof e})}},{key:"findComponentsByPageName",value:function(e){var t=this;return Object.keys(this.componentList).map(function(n){if(-1!==n.indexOf("page=".concat(e)))return t.componentList[n]}).filter(function(e){return!!e})}},{key:"findSubTreeComponentsWithinAPage",value:function(e,t){for(var n=this.findComponentsByPageName(e),a=[],r=0,i=t.length;r<i;r+=1)for(var o=0,s=n.length;o<s;o+=1)n[o].props.config.userDefinedId===t[r]&&a.push(n[o]);return a}},{key:"findTreeViewComponentsWithinAPage",value:function(e,t,n){for(var a=this.findSubTreeComponentsWithinAPage(e,t)[0].props.config.treeInstnancesUserDefinedIds.filter(function(e){return e!==n}),r=this.findComponentsByPageName(e),i=[],o=0,s=a.length;o<s;o+=1)for(var c=0,l=r.length;c<l;c+=1)r[c].props.config.userDefinedId===a[o]&&i.push(r[c]);return i}}]),e}(),In=function(){function e(){var t=this;Object(a.a)(this,e),this.enterTask=function(n,a,r){t.leaveTask(a,r),t.currentTaskPath=n,t.startTimeOfCurrentTask=a,t.startTimeOfCurrentPause=void 0,t.timeSpentPausedInCurrentTask=0,t.firstReactionSeen=!1,t.lastContinuingInteractionKey=void 0;var i=t.getOrInitializeValuesForTask(n);i.nbUserInteractions=0,i.firstReactionTime=void 0,i.taskExecutionTime=0,e.dumpStateChangeToTrace(t.currentTaskPath,i,r)},this.userInteraction=function(n,a,r){if((!t.lastContinuingInteractionKey||!a||t.lastContinuingInteractionKey.type!==a.type||t.lastContinuingInteractionKey.value!==a.value)&&(t.lastContinuingInteractionKey=a,void 0!==t.currentTaskPath)){var i=t.getOrInitializeValuesForTask(t.currentTaskPath);i.nbUserInteractions+=1,i.nbUserInteractionsTotal+=1,t.firstReactionSeen||(i.firstReactionTime=e.getNonPausedTimeSpentInCurrentTask(n,t.startTimeOfCurrentTask,t.timeSpentPausedInCurrentTask,t.startTimeOfCurrentPause),i.firstReactionTimeTotal+=i.firstReactionTime,t.firstReactionSeen=!0),e.dumpStateChangeToTrace(t.currentTaskPath,i,r)}},this.leaveTask=function(n,a){if(void 0!==t.currentTaskPath){var r=t.getOrInitializeValuesForTask(t.currentTaskPath);r.taskExecutionTime=e.getNonPausedTimeSpentInCurrentTask(n,t.startTimeOfCurrentTask,t.timeSpentPausedInCurrentTask,t.startTimeOfCurrentPause),r.taskExecutionTimeTotal+=r.taskExecutionTime,e.dumpStateChangeToTrace(t.currentTaskPath,r,a)}t.currentTaskPath=void 0,t.startTimeOfCurrentTask=void 0,t.startTimeOfCurrentPause=void 0,t.timeSpentPausedInCurrentTask=void 0,t.firstReactionSeen=void 0,t.lastContinuingInteractionKey=void 0},this.pauseTask=function(e){void 0===t.startTimeOfCurrentPause&&(t.startTimeOfCurrentPause=e)},this.resumeTask=function(e){void 0!==t.startTimeOfCurrentPause&&(void 0!==t.timeSpentPausedInCurrentTask&&(t.timeSpentPausedInCurrentTask+=e-t.startTimeOfCurrentPause),t.startTimeOfCurrentPause=void 0)},this.nbUserInteractions=function(e){return t.getValuesForTask(e).nbUserInteractions},this.nbUserInteractionsTotal=function(e){return t.getValuesForTask(e).nbUserInteractionsTotal},this.firstReactionTime=function(e){return t.getValuesForTask(e).firstReactionTime},this.firstReactionTimeTotal=function(e){return t.getValuesForTask(e).firstReactionTimeTotal},this.taskExecutionTime=function(n,a){return n===t.currentTaskPath?e.getNonPausedTimeSpentInCurrentTask(a,t.startTimeOfCurrentTask,t.timeSpentPausedInCurrentTask,t.startTimeOfCurrentPause):t.getValuesForTask(n).taskExecutionTime},this.taskExecutionTimeTotal=function(e){return t.getValuesForTask(e).taskExecutionTimeTotal},this.getAllValuesForTask=function(e,n){var a=z.deepCopy(t.getValuesForTask(e));return a.taskExecutionTime=t.taskExecutionTime(e,n),a},this.getAllTasksState=function(){return z.deepCopy(t.taskValuesList)},this.clearTasksState=function(){t.taskValuesList={}},this.preloadTasksState=function(e){t.taskValuesList=z.deepCopy(e)},this.injectStateChangeAtReplay=function(e,n){t.taskValuesList[e]=n},this.getValuesForTask=function(n){return void 0===t.taskValuesList[n]?e.buildInitialValues():t.taskValuesList[n]},this.getOrInitializeValuesForTask=function(n){return void 0===t.taskValuesList[n]&&(t.taskValuesList[n]=e.buildInitialValues()),t.taskValuesList[n]},this.taskValuesList={},this.currentTaskPath=void 0,this.startTimeOfCurrentTask=void 0,this.startOfCurrentPause=void 0,this.timeSpentPausedInCurrentTask=void 0,this.firstReactionSeen=void 0,this.lastContinuingInteractionKey=void 0}return Object(r.a)(e,null,[{key:"getTimeSpentInPausedState",value:function(e,t,n){return t+(void 0===n?0:e-n)}},{key:"getNonPausedTimeSpentInCurrentTask",value:function(t,n,a,r){return t-n-e.getTimeSpentInPausedState(t,a,r)}},{key:"buildInitialValues",value:function(){return{nbUserInteractions:0,nbUserInteractionsTotal:0,firstReactionTime:void 0,firstReactionTimeTotal:0,taskExecutionTime:0,taskExecutionTimeTotal:0}}},{key:"dumpStateChangeToTrace",value:function(e,t,n){Z.dumpStateChangeToTrace("IncidentsAccumulatorState",{taskPath:e,state:t},n.traceLogBuffer)}}]),e}(),On=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"evaluateConditionalLink",value:function(t,n){if(void 0!==t){var a=t.branches;if(void 0===a)return e.logUndefinedMessage("branches array"),void e.logCalculation("undefined (branches undefined)");var r=a.find(function(t,a){return void 0===t.condition?(e.logUndefinedMessage("condition in branch"),!1):!0===bt.evaluateTerm(t.condition,n,[],"guard[".concat(a,"]"))});if(void 0!==r){if(void 0===r.actions?e.logUndefinedMessage("actions in chosen branch"):r.actions.forEach(function(t,a){void 0===t?e.logUndefinedMessage("action in action array of chosen branch"):bt.evaluateTerm(t,n,[],"action[".concat(a,"]"))}),void 0===r.page)return e.logUndefinedMessage("page in selected branch"),void e.logCalculation("undefined (no page in chosen branch)");var i=r.page;return e.logCalculation(i),i}e.logCalculation("undefined (no branch chosen)")}}},{key:"logUndefinedMessage",value:function(e){console.log("Conditional link definition contains undefined ".concat(e))}},{key:"logCalculation",value:function(e){console.log("Conditional link evaluates to ",e)}}]),e}(),Mn=function(){function e(t){Object(a.a)(this,e),this.pagesList=t.pages,this.buildMappings(t.pages),this.findPage=this.findPage.bind(this),this.findPageSegmentForUserDefId=this.findPageSegmentForUserDefId.bind(this),this.findConfigurationForPageSegment=this.findConfigurationForPageSegment.bind(this)}return Object(r.a)(e,[{key:"findPage",value:function(e){return this.pagesList.find(function(t,n,a){return t.name===e})}},{key:"findPageSegmentForUserDefId",value:function(e){var t=this.userDefinedIdCatalog[e];return void 0===t&&console.warn("Cannot find page segment for user defined id ".concat(e)),t}},{key:"findPageSegmentForTextBlockOwner",value:function(e){return this.textBlockNameCatalog[e]}},{key:"findConfigurationForPageSegment",value:function(e,t){var n=this.pageSegmentCatalog[e];return t||void 0!==n||console.warn("Cannot find configuration for page segment ".concat(e)),n}},{key:"buildMappings",value:function(e){var t=this;this.userDefinedIdCatalog={},this.textBlockNameCatalog={},this.pageSegmentCatalog={},e.forEach(function(e,n,a){t.addMappingsForPage(e)})}},{key:"addMappingsForPage",value:function(e){var t=e.name;this.addMappingsForComponent(j.buildPageSegment(t),e.content)}},{key:"addMappingsForComponent",value:function(e,t){var n=this;void 0!==t&&void 0!==t.config||console.warn("Found invalid component configuration at page segment ".concat(e)),this.addMappings(e,t);var a=t.type,r=t.config;switch(a){case"CbaContainer":this.addMappingsForComponentList(e,t.config.cbaChildren);break;case"CbaRegionMap":this.addMappingsForComponentList(e,t.config.regions);break;case"CbaComboBox":this.addMappingsForComponentList(e,ge.buildComboBoxItemsArray(t.config.items));break;case"CbaList":this.addMappingsForComponentList(e,dn.buildListItemsArray(t.config.items));break;case"CbaRichTextField":this.addMappingsForComponentList(Xe.addLinkIndex(e),Xe.buildLinkConfigurationsArray(t.config)),void 0!==r.contentModifiers&&this.addMappingsForComponentList(Xe.addContentModifierIndex(e),t.config.contentModifiers),void 0!==r.textBlocks&&t.config.textBlocks.forEach(function(t,a,r){n.textBlockNameCatalog[t.name]=e});break;case"CbaTable":this.addMappingsForComponentList(e,r.cbaChildren);break;case"CbaTableCell":if(!0===r.isSpreadsheet)if(void 0!==r.items){var i=tt.createCellCopy(t,e,"CbaComboBox");this.addMappings(i.path,i),this.addMappingsForComponentList(i.path,ge.buildComboBoxItemsArray(r.items))}else{var o=tt.createCellCopy(t,e,"CbaSingleLineInputField");this.addMappings(o.path,o)}this.addMappingsForComponentList(e,r.cbaChildren);break;case"CbaCalculatorInput":var s=Jt.createDelegateComponent(t,e,"CbaSimpleTextField"),c=s.delegatePath,l=s.delegateComponent;this.addMappings(c,l);break;case"CbaCalculatorHistory":var u=Jt.createDelegateComponent(t,e,"CbaSimpleTextField"),d=u.delegatePath,g=u.delegateComponent;this.addMappings(d,g);break;case"CbaMedia":this.addMappingsForComponentList(e,r.cbaChildren)}}},{key:"addMappings",value:function(e,t){this.pageSegmentCatalog[e]=t;var n=Y.getUserDefinedId(t.config);void 0!==n&&(this.userDefinedIdCatalog[n]=e)}},{key:"addMappingsForComponentList",value:function(e,t){var n=this;void 0!==t&&t.forEach(function(t,a,r){var i=j.appendIndexToPageSegment(e,a);n.addMappingsForComponent(i,t)})}}]),e}(),wn=function e(t){var n=this;Object(a.a)(this,e),this.findCalculationByTaskName=function(e,t){var a=n.findAllCalculationsByTaskName(e).find(function(e,n,a){return e.name===t});return void 0===a?void 0:a.calculation},this.findAllCalculationsByTaskName=function(e){var t=n.tasksList.find(function(t,n,a){return t.name===e});return void 0===t?(console.error("Cannot find task configuration for task name ".concat(e)),[]):t.namedCalculations},this.findScoreResultListByTaskName=function(e,t){var a=n.findAllScoreResultListsByTaskName(e).find(function(e,n,a){return e.name===t});return void 0===a?(console.log("Cannot find score result list configuration for task name ".concat(e," and list name ").concat(t)),[]):a.elements},this.findAllScoreResultListsByTaskName=function(e){var t=n.tasksList.find(function(t,n,a){return t.name===e});return void 0===t?(console.error("Cannot find task configuration for task name ".concat(e)),[]):t.scoreResult.lists},this.findScoreResultAttributesByTaskName=function(e){var t=n.tasksList.find(function(t,n,a){return t.name===e});return void 0===t?(console.error("Cannot find task configuration for task name ".concat(e)),[]):t.scoreResult.attributes},this.tasksList=t.tasks},Rn=function(){function e(){var t=this;Object(a.a)(this,e),this.saveTaskState=function(e,n,a){var r=z.deepCopy(n);t.taskEntriesList[e]=r,Z.dumpStateChangeToTrace("PresenterStateManagerState",{taskPath:e,state:r},a.traceLogBuffer)},this.getTaskState=function(e){return z.deepCopy(t.taskEntriesList[e])},this.removeDialog=function(e,n,a,r){var i=t.taskEntriesList[a];i.dialogs=i.dialogs.filter(function(t){return t.pageAreaName!==e||t.type!==n}),t.saveTaskState(a,i,r)},this.hideDialog=function(e,n,a,r){var i=t.taskEntriesList[a],o=i.dialogs.find(function(t){return t.pageAreaName===e&&t.type===n});o?o.visible=!1:console.warn("Dialog not found - ",n,e),t.saveTaskState(a,i,r)},this.updatePositionAndFocusDialog=function(e,n,a,r,i){var o=t.taskEntriesList[a];o.dialogs.forEach(function(t,a){t.pageAreaName===e&&t.type===n?(t.position=r,t.focused=!0):t.focused=!1}),t.saveTaskState(a,o,i)},this.getAllTasksState=function(){return z.deepCopy(t.taskEntriesList)},this.clearTasksState=function(){t.taskEntriesList={}},this.preloadTasksState=function(e){t.taskEntriesList=z.deepCopy(e)},this.injectStateChangeAtReplay=function(e,n){t.taskEntriesList[e]=n},this.taskEntriesList={}}return Object(r.a)(e,null,[{key:"buildInitialTaskStateObject",value:function(e,t,n,a,r,i,o,s,c){return{standardPage:e,xPage:t,itemWidth:n,itemHeight:a,itemLayout:r,withEditContextMenu:i,dialogs:[],itemHighlightColor:o,highlightColors:s,cssStyles:c}}},{key:"setPageForPageAreaInTaskState",value:function(t,n,a,r,i){switch(a){case"main":e.setMainAreaPage(t,r,i);break;case"dialog":e.changeOrCreatePageArea(t,n,r,"dialog",i.dialogs);break;case"modal":e.changeOrCreatePageArea(t,n,r,"modal",i.dialogs);break;default:console.error("Unknown page area type: ".concat(a))}}},{key:"setMainAreaPage",value:function(e,t,n){switch(t){case"standard":n.standardPage=e;break;case"xPage":n.xPage=e;break;default:console.error("Unknown page area name for 'main' page area type: ".concat(t))}}},{key:"changeOrCreatePageArea",value:function(e,t,n,a,r){var i=r.find(function(e){return e.pageAreaName===n&&e.type===a});void 0===i?r.push({pageAreaName:n,type:a,pageName:e,position:t,visible:!0}):(i.pageName=e,i.position=t,i.visible=!0)}}]),e}(),Dn=function e(t,n){var r=this;Object(a.a)(this,e),this.getMappedValue=function(e,t){var n=r.valueMaps.find(function(t){return t.name===e});if(void 0!==n){var a=n.guards.find(function(n,a){return!0===bt.evaluateTerm(n.guardTerm,r.runtime,[t],"guard[".concat(a,"]_").concat(e))});if(void 0!==a)return a.value}},this.valueMaps=t.valueMaps,this.runtime=n},Nn=function(){function e(t){var n=this;Object(a.a)(this,e),this.setTopLevelPageChangeHandler=function(e){n.handleTopLevelPageChange=e},this.addItem=function(e,t,a){n.itemInfoEntries.push({itemConfiguration:e,resourcePath:t,externalResourcePath:a})},this.clearItems=function(){n.itemInfoEntries=[]},this.setSwitchCallback=function(e){n.switchCallback=e},this.setAvailabilityCallback=function(e){n.availabilityCallback=e},this.switchFirstMatchingTaskInterTest=function(e,t){n.triggerGoToTask(e,void 0,t)},this.switchFirstMatchingTaskIntraTest=function(e){n.switchFirstMatchingTaskInterTest(n.activeTestName,e)},this.switchTaskInterTest=function(e,t,a){n.triggerGoToTask(e,t,a)},this.switchTaskIntraTest=function(e,t){n.triggerGoToTask(n.activeTestName,e,t)},this.switchTaskIntraItem=function(e){n.triggerGoToTask(n.activeTestName,n.activeItemName,e)},this.switchTaskNext=function(){n.triggerTaskSwitch("nextTask",void 0,void 0,void 0)},this.nextTaskAvailable=function(){return n.checkAvailableTask("nextTask",void 0,void 0,void 0)},this.switchTaskPrevious=function(){n.triggerTaskSwitch("previousTask",void 0,void 0,void 0)},this.previousTaskAvailable=function(){return n.checkAvailableTask("previousTask",void 0,void 0,void 0)},this.cancelTask=function(){n.triggerTaskSwitch("cancelTask",void 0,void 0,void 0)},this.switchPage=function(e,t,a,r,i,o,s,c,l){if(void 0===o){var u=On.evaluateConditionalLink(t,n.runtime);if(void 0===u)if(void 0===e)console.error("No page chosen by link specification: default page: ".concat(e," conditionalLink: ").concat(t));else{var d=void 0===l?Re.getTopComponentPosition(e,n.runtime.pageConfigurationsManager):l;n.switchTopLevelPage(r,i,e,d)}else n.switchTopLevelPage(u.pageAreaType,u.pageAreaName,u.pageName,u.position)}else{var g=j.appendPageSegmentToPathRoot(n.getCurrentStatePathRoot(),r,i,o);if(void 0===c){var f=On.evaluateConditionalLink(t,n.runtime);if(void 0===f)void 0===e?console.error("No page chosen by link specification: default page: ".concat(e," conditionalLink: ").concat(t)):n.switchEmbeddedPage(g,e,a,s);else{var p=f.pageAreaType;"main"===p?n.switchEmbeddedPage(g,f.pageName,f.pageUrl,f.receiverTab):n.switchTopLevelPage(p,f.pageAreaName,f.pageName,f.position)}}else n.doHistoryMove(g,c)}},this.switchTopLevelPage=function(t,a,r,i){n.runtime.traceLogBuffer.reportEvent("PageSwitchTopLevel",new Date,{pageAreaType:t,pageAreaName:a,newPageName:r,position:i}),e.preparePageSwitchInPresenterState(n.activeTestName,n.activeItemName,n.activeTaskName,t,a,r,i,n.runtime),void 0!==n.handleTopLevelPageChange&&n.handleTopLevelPageChange()},this.switchEmbeddedPage=function(e,t,a,r){var i=X.getUserDefPathForIndexPath(e,n.runtime);n.runtime.traceLogBuffer.reportEvent("PageSwitchEmbedded",new Date,{indexPath:e,userDefIdPath:i,userDefId:q.getLastUserDefIdFromPath(i),tab:void 0===r?void 0:r.name,newPageName:t}),ve.setPageName(e,r,t,a,n.runtime),Q.triggerRenderingViaPath(e,n.runtime)},this.doHistoryMove=function(e,t){ve.doHistoryMove(e,t,n.runtime),Q.triggerRenderingViaPath(e,n.runtime)},this.getCurrentStatePathRoot=function(){return j.buildPathRoot(n.activeTestName,n.activeItemName,n.activeTaskName)},this.getStatePathRootForTask=function(e){return j.buildPathRoot(n.activeTestName,n.activeItemName,e)},this.getCurrentTestTaskItemNames=function(){return{test:n.activeTestName,item:n.activeItemName,task:n.activeTaskName}},this.getCurrentPageNames=function(){var e=j.buildPathRoot(n.activeTestName,n.activeItemName,n.activeTaskName),t=n.runtime.presenterStateManager.getTaskState(e);return{standardPage:void 0===t?void 0:t.standardPage,xPage:void 0===t?void 0:t.xPage}},this.saveCurrentTaskResults=function(){var e=n.runtime.calculationsConfigurationManager.findAllCalculationsByTaskName(n.activeTaskName);n.runtime.taskResultsManager.saveTaskResults(n.getCurrentStatePathRoot(),e,n.runtime)},this.getCurrentTaskResults=function(){return n.saveCurrentTaskResults(),n.runtime.taskResultsManager.getResultsListForTask(n.getCurrentStatePathRoot())},this.getOldTaskResults=function(e,t,a){return n.runtime.taskResultsManager.getResultsListForTask(j.buildPathRoot(a,t,e))},this.getScoring=function(){var e={hitRows:n.buildScoringHitMissListEvaluationResult("hitList"),missRows:n.buildScoringHitMissListEvaluationResult("missList"),hitClassRows:n.buildScoringClassListEvaluationResult("hitClassList"),missClassRows:n.buildScoringClassListEvaluationResult("missClassList")};return n.addScoringAttributesEvaluationResult(e),e},this.getTopLevelConfiguration=function(){return n.runtime.presenterStateManager.getTaskState(n.getCurrentStatePathRoot())},this.getResourcePath=function(){return n.activeResourcePath},this.getExternalResourcePath=function(){return n.activeExternalResourcePath},this.stopTask=function(){if(void 0!==n.activeTaskName){var e=n.runtime;n.saveCurrentTaskResults(),Z.dumpSnapshotToTrace(e),e.traceLogBuffer.reportEvent("TaskSwitch",new Date,{oldTask:n.activeTaskName,oldItem:n.activeItemName,oldTest:n.activeTestName,newTask:void 0,newItem:void 0,newTest:void 0,taskResult:e.taskResultsManager.getResultsListForTask(n.getCurrentStatePathRoot())}),e.incidentsAccumulator.leaveTask((new Date).getTime(),e),e.statemachinesManager.stopCurrentStatemachine(),n.activeTaskName=void 0,e.traceLogBuffer.setTestItemTaskNames(n.activeTestName,n.activeItemName,n.activeTaskName)}},this.switchTask=function(t,a,r,i){var o=n.runtime;void 0!==n.activeTaskName&&(n.saveCurrentTaskResults(),Z.dumpSnapshotToTrace(o));var s=e.getItemInfoForName(n.itemInfoEntries,a);if(void 0!==s){var c=s.itemConfiguration,l=e.getTaskForName(c,r);if(void 0!==l){var u=j.buildPathRoot(t,a,r);return o.traceLogBuffer.reportEvent("TaskSwitch",new Date,{oldTask:n.activeTaskName,oldItem:n.activeItemName,oldTest:n.activeTestName,newTask:r,newItem:a,newTest:t,taskResult:o.taskResultsManager.getResultsListForTask(n.getCurrentStatePathRoot())}),o.traceLogBuffer.setTestItemTaskNames(t,a,r),a!==n.activeItemName&&(o.pageConfigurationsManager=new Mn(c),o.calculationsConfigurationManager=new wn(c),o.valueMapper=new Dn(c,o),o.traceLogBuffer.reportEvent("ItemSwitch",new Date,{item:c}),n.activeResourcePath=s.resourcePath,n.activeExternalResourcePath=s.externalResourcePath),n.activeTestName=t,n.activeItemName=a,n.activeTaskName=r,i?(o.statemachinesManager.stopCurrentStatemachine(),o.calculatorsManager.setOrInitializeCurrentCalculator(u,o),o.statemachinesManager.switchCurrentStatemachineWithoutStarting(u)):(o.incidentsAccumulator.enterTask(u,(new Date).getTime(),o),o.statemachinesManager.stopCurrentStatemachine(),o.variableManager.initializeVariablesForTask(u,c.variables,e.getTaskForName(c,r).traceVariableValues,o),e.prepareTaskSwitchInPresenterAndNavigatorState(t,a,r,u,l,o),o.calculatorsManager.setOrInitializeCurrentCalculator(u,o),o.statemachinesManager.startOrInitializeCurrentStatemachine(u,c.statemachine,o),Z.dumpFullStateToTrace(o)),u}}},this.getAllTasksState=function(){var e=n.runtime,t=e.componentStateManager,a=e.componentDirectory,r=e.variableManager,i=e.statemachinesManager,o=e.incidentsAccumulator,s=e.presenterStateManager,c=e.taskNavigatorStateManager,l=e.taskResultsManager,u=e.clipboardManager,d=e.calculatorsManager;return{componentsState:t.getStateSnapshot(a),statemachines:i.getStatemachinesPreloadData(),variables:r.getAllTasksState(),incidents:o.getAllTasksState(),presenterState:s.getAllTasksState(),taskNavigatorState:c.getAllTasksState(),taskResults:l.getAllTasksState(),clipboard:u.getAllTasksState(),calculators:d.getAllTasksState()}},this.clearTasksState=function(){var e=n.runtime,t=e.componentStateManager,a=e.variableManager,r=e.statemachinesManager,i=e.incidentsAccumulator,o=e.presenterStateManager,s=e.taskNavigatorStateManager,c=e.taskResultsManager,l=e.clipboardManager,u=e.calculatorsManager;t.clear(),a.clearTasksState(),r.clearStatemachines(n.runtime),i.clearTasksState(),o.clearTasksState(),s.clearTasksState(),c.clearTasksState(),l.clearTasksState(),u.clearTasksState()},this.preloadTasksState=function(e){var t=n.runtime,a=t.componentStateManager,r=t.variableManager,i=t.statemachinesManager,o=t.incidentsAccumulator,s=t.presenterStateManager,c=t.taskNavigatorStateManager,l=t.taskResultsManager,u=t.clipboardManager,d=t.calculatorsManager;a.preloadWithStateSnapshot(e.componentsState),r.preloadTasksState(e.variables),i.preloadStatemachinesData(e.statemachines,n.runtime),o.preloadTasksState(e.incidents),s.preloadTasksState(e.presenterState),c.preloadTasksState(e.taskNavigatorState),l.preloadTasksState(e.taskResults),u.preloadTasksState(e.clipboard),d.preloadTasksState(e.calculators)},this.getItemResources=function(e){var t=n.getItemInfo(e);if(!t)return console.error("Could not find item",e),null;var a=t.itemConfiguration,r=t.externalResourcePath,i=t.resourcePath,o=a.usedResources,s=d.mapResourcePath(o.externalResources,r,!0),c=d.mapResourcePath(o.resources,i,!1);return s.concat(c)},this.getCustomFontMappings=function(e){var t=n.getItemInfo(e);return t?t.itemConfiguration.usedResources.fontMappings:(console.error("Could not find item",e),null)},this.getItemInfo=function(e){return n.itemInfoEntries.find(function(t){return t.itemConfiguration.name===e})},this.checkAvailableTask=function(e,t,a,r){var i=n.availabilityCallback;return void 0!==i&&i(e,t,a,r)},this.triggerGoToTask=function(e,t,a){n.triggerTaskSwitch("goToTask",e,t,a)},this.triggerTaskSwitch=function(e,t,a,r){var i=n.switchCallback;void 0!==i&&i(e,t,a,r)},this.addScoringAttributesEvaluationResult=function(e){var t=n.runtime.calculationsConfigurationManager.findScoreResultAttributesByTaskName(n.activeTaskName);Object.keys(t).forEach(function(a){e[a]=bt.evaluateTerm(t[a],n.runtime,[],a)})},this.buildScoringHitMissListEvaluationResult=function(e){var t=n.runtime.calculationsConfigurationManager.findScoreResultListByTaskName(n.activeTaskName,e),a=[];return t.forEach(function(e){if(bt.evaluateTerm(e.result,n.runtime,[],e.name)){var t=bt.evaluateTerm(e.resultText,n.runtime,[],"".concat(e.name,"_text"));a.push({name:e.name,weight:e.weight,class:e.class,resultText:t})}}),a},this.buildScoringClassListEvaluationResult=function(e){return n.runtime.calculationsConfigurationManager.findScoreResultListByTaskName(n.activeTaskName,e).map(function(e){return{name:e.name,comment:e.comment,value:bt.evaluateTerm(e.value,n.runtime,[],e.name),result:void 0===e.result?void 0:bt.evaluateTerm(e.result,n.runtime,[],"".concat(e.name,"_result"))}})},this.itemInfoEntries=[],this.handleTopLevelPageChange=void 0,this.switchCallback=void 0,this.availabilityCallback=void 0,this.runtime=t,this.activeTestName=void 0,this.activeItemName=void 0,this.activeTaskName=void 0,this.activeResourcePath=void 0,this.activeExternalResourcePath=void 0}return Object(r.a)(e,null,[{key:"evaluateConditionalLink",value:function(e,t,n){if(void 0===t)return e;var a=On.evaluateConditionalLink(t,n);return void 0===a?e:a}},{key:"getItemInfoForName",value:function(e,t){var n=e.find(function(e,n,a){return e.itemConfiguration.name===t});return void 0===n&&console.error("Could not find info for item ".concat(t)),n}},{key:"getTaskForName",value:function(e,t){var n=e.tasks.find(function(e,n,a){return e.name===t});return void 0===n&&console.error("Could not find task ".concat(t," in item ").concat(e.name)),n}},{key:"prepareTaskSwitchInPresenterAndNavigatorState",value:function(e,t,n,a,r,i){var o=i.taskNavigatorStateManager,s=i.presenterStateManager;if(o.saveTestState(e,{itemName:t,taskName:n},i),void 0===s.getTaskState(a)){var c=Rn.buildInitialTaskStateObject(r.initialPage,r.initialXPage,r.itemWidth,r.itemHeight,r.itemLayout,r.withEditContextMenu,r.itemHighlightColor,r.highlightColors,r.cssStyles);s.saveTaskState(a,c,i);var l=On.evaluateConditionalLink(r.initRule,i);if(void 0!==l){var u=s.getTaskState(a);Rn.setPageForPageAreaInTaskState(l.pageName,l.position,l.pageAreaType,l.pageAreaName,u),s.saveTaskState(a,u,i)}}}},{key:"preparePageSwitchInPresenterState",value:function(e,t,n,a,r,i,o,s){var c=j.buildPathRoot(e,t,n),l=s.presenterStateManager.getTaskState(c);void 0===l?console.error("Switch to page ".concat(i," for not existing task: ").concat(c)):(Rn.setPageForPageAreaInTaskState(i,o,a,r,l),s.presenterStateManager.saveTaskState(c,l,s))}}]),e}(),An=function e(){var t=this;Object(a.a)(this,e),this.saveTaskResults=function(e,n,a){t.taskEntriesList[e]={};var r=t.taskEntriesList[e];n.forEach(function(t,n,i){r[t.name]=bt.evaluateTerm(t.calculation,a,[{useExistingCalculationResults:!0,taskPath:e}],t.name)})},this.getResult=function(e,n){return t.getResultsListForTask(e)[n]},this.getResultsListForTask=function(e){return void 0===t.taskEntriesList[e]?{}:t.taskEntriesList[e]},this.getAllTasksState=function(){return z.deepCopy(t.taskEntriesList)},this.clearTasksState=function(){t.taskEntriesList={}},this.preloadTasksState=function(e){t.taskEntriesList=z.deepCopy(e)},this.taskEntriesList={}},Fn=(n(580),n(328)),jn=n.n(Fn),Ln=function(){function e(){var t=this;Object(a.a)(this,e),this.putEntry=function(n,a,r){var i=t.getEntry(n);void 0!==i?(console.warn("Updating already existing timed event with name ".concat(n)),i.triggerInterval=a,i.acceptingStatesList=r):t.timedEventsList.push(e.buildTimedEventEntry(n,a,r,void 0,void 0,void 0))},this.getEntry=function(e){return t.timedEventsList.find(function(t){return t.name===e})},this.getTimerIntervals=function(){var e={};return t.timedEventsList.forEach(function(t){e[t.name]=t.triggerInterval}),e},this.clearTimeoutHook=function(e){window.clearTimeout(e)},this.setTimeoutHook=function(e,t,n){return window.setTimeout(e,t,n)},this.timedEventsList=[]}return Object(r.a)(e,[{key:"findUnscheduledEventsByState",value:function(e){return this.timedEventsList.filter(function(t){return t.acceptingStatesList.includes(e)&&void 0===t.scheduledTimeoutHandle&&void 0===t.scheduledTriggerTime&&void 0===t.remainingInterval})}},{key:"findScheduledEventsByState",value:function(e){return this.timedEventsList.filter(function(t){return t.acceptingStatesList.includes(e)&&(void 0!==t.scheduledTimeoutHandle||void 0!==t.scheduledTriggerTime||void 0!==t.remainingInterval)})}},{key:"findScheduledEvents",value:function(){return this.timedEventsList.filter(function(e){return void 0!==e.scheduledTimeoutHandle||void 0!==e.scheduledTriggerTime||void 0!==e.remainingInterval})}},{key:"startTimedEvent",value:function(e,t){this.scheduleTimedEvent(e,e.triggerInterval,t)}},{key:"resumeTimedEvent",value:function(e,t){void 0!==e.remainingInterval&&this.scheduleTimedEvent(e,e.remainingInterval,t)}},{key:"stopTimedEvent",value:function(t){void 0!==t.scheduledTimeoutHandle&&this.clearTimeoutHook(t.scheduledTimeoutHandle),e.setScheduledDataInTimedEventEntry(void 0,void 0,void 0,t)}},{key:"pauseTimedEvent",value:function(t,n){if(void 0!==t.scheduledTimeoutHandle){this.clearTimeoutHook(t.scheduledTimeoutHandle);var a=t.scheduledTriggerTime.getTime()-n.getTime();e.setScheduledDataInTimedEventEntry(void 0,void 0,a,t)}}},{key:"scheduleTimedEvent",value:function(t,n,a){var r=a.getNow(),i=new Date(r.getTime()+n);if(void 0!==i){void 0!==t.scheduledTimeoutHandle&&(console.warn("Rescheduling scheduled event: ".concat(t.name," from ").concat(t.scheduledTriggerTime," to ").concat(i)),this.clearTimeoutHook(t.scheduledTimeoutHandle));var o=this.setTimeoutHook(function(t){e.setScheduledDataInTimedEventEntry(void 0,void 0,void 0,t),a.triggerEvent(t.name)},n,t);e.setScheduledDataInTimedEventEntry(o,i,void 0,t)}else console.error("Invalid target time to schedule event: ".concat(t.name," with start interval ").concat(n))}}],[{key:"getEventData",value:function(e,t){var n=void 0!==e.scheduledTimeoutHandle,a=n?e.scheduledTriggerTime.getTime()-t.getTime():e.remainingInterval;return{totalTime:e.triggerInterval,isRunning:n,remainingTime:a}}},{key:"isPaused",value:function(e){return void 0!==e.remainingInterval}},{key:"setTriggerIntervalInEventEntry",value:function(e,t){t.triggerInterval=e}},{key:"setScheduledDataInTimedEventEntry",value:function(e,t,n,a){a.scheduledTimeoutHandle=e,a.scheduledTriggerTime=t,a.remainingInterval=n}},{key:"buildTimedEventEntry",value:function(e,t,n,a,r,i){return{name:e,triggerInterval:t,acceptingStatesList:void 0===n?[]:n.map(function(e){return e}),scheduledTimeoutHandle:a,scheduledTriggerTime:r,remainingInterval:i}}}]),e}(),Vn=function(){function e(t){var n=this;Object(a.a)(this,e),this.getHistoryDataForSnapshot=function(){return z.deepCopy({raisedEvents:n.raisedEvents,raisedEventsPerState:n.raisedEventsPerState,totalNbOfRaisedEvents:n.totalNbOfRaisedEvents,visitedStates:n.visitedStates,valuesPerVariable:n.valuesPerVariable,valuesPerVariableAfterLastArtificialEvent:n.valuesPerVariableAfterLastArtificialEvent})},this.reportBeforeEvent=function(t,a,r){n.addVisitedStates(a),e.isArtificialEvent(t)||(n.addRaisedEvent(t),n.addRaisedEventPerStates(a,t),0!==n.valuesPerVariableAfterLastArtificialEvent.length&&(n.addVariableValues(n.valuesPerVariableAfterLastArtificialEvent),n.valuesPerVariableAfterLastArtificialEvent=[]),n.addVariableValues(r))},this.reportAfterEvent=function(e,t,a){n.addVisitedStates(t),n.valuesPerVariableAfterLastArtificialEvent=a.map(function(e){return{name:e.name,value:e.value}})},this.getRaisedEvents=function(){return n.raisedEvents.slice()},this.getRaisedEventsInState=function(e){var t=n.raisedEventsPerState.find(function(t){return t.state===e});return void 0===t?[]:t.events.slice()},this.getTotalNbOfRaisedEvents=function(){return n.totalNbOfRaisedEvents},this.getVisitedStates=function(){return n.visitedStates.slice()},this.getValuesOfVariable=function(e){var t=n.valuesPerVariable.find(function(t){return t.name===e}),a=n.valuesPerVariableAfterLastArtificialEvent.find(function(t){return t.name===e});if(void 0===t&&void 0===a)return[];if(void 0===t)return[a.value];var r=t.values.slice();return void 0===a||r.includes(a.value)||r.push(a.value),r},this.addRaisedEvent=function(e){n.totalNbOfRaisedEvents+=1,n.raisedEvents.includes(e)||n.raisedEvents.push(e)},this.addRaisedEventPerState=function(e,t){var a=n.raisedEventsPerState.find(function(t){return t.state===e});void 0===a?n.raisedEventsPerState.push({state:e,events:[t]}):a.events.includes(t)||a.events.push(t)},this.addRaisedEventPerStates=function(e,t){e.forEach(function(e){n.addRaisedEventPerState(e,t)})},this.addVisitedState=function(e){n.visitedStates.includes(e)||n.visitedStates.push(e)},this.addVisitedStates=function(e){e.forEach(function(e){n.addVisitedState(e)})},this.addValuePerVariable=function(t,a){if(!e.isArtificialVariable(t)){var r=n.valuesPerVariable.find(function(e){return e.name===t});void 0===r?n.valuesPerVariable.push({name:t,values:[a]}):r.values.includes(a)||r.values.push(a)}},this.addVariableValues=function(e){e.forEach(function(e){n.addValuePerVariable(e.name,e.value)})};var r=void 0!==t?z.deepCopy(t):{raisedEvents:[],raisedEventsPerState:[],totalNbOfRaisedEvents:0,visitedStates:[],valuesPerVariable:[],valuesPerVariableAfterLastArtificialEvent:[]};this.raisedEvents=r.raisedEvents,this.raisedEventsPerState=r.raisedEventsPerState,this.totalNbOfRaisedEvents=r.totalNbOfRaisedEvents,this.visitedStates=r.visitedStates,this.valuesPerVariable=r.valuesPerVariable,this.valuesPerVariableAfterLastArtificialEvent=r.valuesPerVariableAfterLastArtificialEvent}return Object(r.a)(e,null,[{key:"isArtificialEvent",value:function(e){return e.startsWith(".")}},{key:"isArtificialVariable",value:function(e){return-1!==e.indexOf(".")}}]),e}(),Un=function(){function e(t,n,r,i,o,s){var c=this;Object(a.a)(this,e),this.start=function(){c.running=!0,c.triggerEvent(".init.")},this.stop=function(){c.stopTimedEvents(),c.running=!1},this.continue=function(){c.running=!0,c.paused=!1,c.getCurrentStates().forEach(function(e){c.startTimedEvents(e)})},this.pause=function(){c.paused=!0,c.pauseTimedEvents()},this.resume=function(){c.resumeTimedEvents(),c.paused=!1},this.triggerEvent=function(t){if(!0===c.running&&!1===c.paused)if(c.eventProcessingRuns)c.enqueueEventLastOut(t);else{c.eventProcessingRuns=!0,c.runSingleEventWithHistoryReports(t),c.eventProcessingRuns=!1;var n=c.pendingEventQueue.pop();if(void 0!==n)c.triggerEvent(n);else if(void 0!==c.pendingTaskSwitch){var a=c.pendingTaskSwitch;c.pendingTaskSwitch=void 0,e.executePendingTaskSwitch(a,c.runtime)}}else console.warn("Event ".concat(t," ignored since statmachine is not running currently."))},this.setPostponedTaskSwitch=function(e){c.pendingTaskSwitch=e},this.getTimerData=function(e){var t=c.timedEvents.getEntry(e);if(void 0!==t)return Ln.getEventData(t,c.getNow())},this.setTimedEventInterval=function(e,t){var n=c.timedEvents.getEntry(e);void 0!==n&&Ln.setTriggerIntervalInEventEntry(t,n)},this.getCurrentTimerIntervals=function(){return c.timedEvents.getTimerIntervals()},this.getStatePageAssignments=function(){return z.deepCopy(c.statePageMap)},this.setStatePageAssignment=function(e,t,n,a){var r=c.statePageMap.findIndex(function(t){return t.state===e});-1===r?c.statePageMap.push({state:e,pageName:t,areaType:n,areaName:a}):c.statePageMap[r]={state:e,pageName:t,areaType:n,areaName:a}},this.getCurrentVariableValues=function(){var e=c.runtime,t=e.taskManager,n=e.variableManager,a=t.getCurrentStatePathRoot(),r=n.getVariableValuesMapForTask(a);return z.deepCopy(r)},this.getHistoryData=function(){return c.history.getHistoryDataForSnapshot()},this.getCurrentLeafStates=function(){return c.interpreter.getConfiguration()},this.getCurrentStates=function(){return c.interpreter.getFullConfiguration().filter(function(e){return!e.startsWith("$generated-state-")})},this.getAllCurrentStates=function(){return c.interpreter.getFullConfiguration()},this.getRaisedEvents=function(){return c.history.getRaisedEvents()},this.getRaisedEventsInState=function(e){return c.history.getRaisedEventsInState(e)},this.getTotalNbOfRaisedEvents=function(){return c.history.getTotalNbOfRaisedEvents()},this.getVisitedStates=function(){return c.history.getVisitedStates()},this.getValuesOfVariable=function(e){return c.history.getValuesOfVariable(e)},this.getSnapshot=function(){return z.deepCopy(c.interpreter.getSnapshot())},this.buildStateMachine=function(t,n,a,r){c.timedEvents=e.buildTimedEventsCatalog(t.timedEvents,t.states),Object.keys(n).forEach(function(e){c.setTimedEventInterval(e,n[e])}),c.interpreter=new jn.a.scion.Statechart(c.transformMachineModel(t.states,a),{snapshot:r}),c.interpreter.on("onError",function(e){console.error("Caught statemachine error on ".concat(e.tagname," in line/col ").concat(e.line,"/").concat(e.column," : ").concat(e.reason))})},this.transformMachineModel=function(t,n){var a=e.modelCopy(t);return c.transformStates(a,"",n),{states:a}},this.transformStates=function(t,n,a){t.forEach(function(t){var r=void 0!==t.states&&t.states.length>0,i=e.buildStatePath(n,t.id);c.transformEntryExitActions(t,r?e.buildInitEventName(i):void 0,a),t.transitions.forEach(function(r){e.transformTransition(t,r,n,a)}),r&&c.transformStates(t.states,i,a)})},this.transformEntryExitActions=function(t,n,a){t.onEntry=c.buildOnEntryFunction(t,t.onEntry,n,a),void 0!==t.onExit&&(t.onExit=e.buildOnExitFunction(t,t.onExit,a))},this.buildOnEntryFunction=function(e,t,n,a){var r=c.enqueueEventFirstOut,i=c.startTimedEvents,o=c.statePageMap;return function(s){void 0!==t&&t.forEach(function(e,t,n){bt.evaluateTerm(e,a,[],"in-action:".concat(s.name,"[").concat(t,"]"))});var c=o.filter(function(t){return t.state===e.id}).map(function(e){return{pageName:e.pageName,areaType:e.areaType,areaName:e.areaName}}).find(function(e){return!0});void 0!==c&&a.taskManager.switchPage(c.pageName,void 0,void 0,c.areaType,c.areaName,void 0,void 0,void 0,void 0),void 0!==n&&r(n),i(e.id)}},this.startTimedEvents=function(e){c.timedEvents.findScheduledEventsByState(e).forEach(function(e){c.timedEvents.stopTimedEvent(e)}),c.timedEvents.findUnscheduledEventsByState(e).forEach(function(e){c.timedEvents.startTimedEvent(e,c)},c)},this.stopTimedEvents=function(){c.timedEvents.findScheduledEvents().forEach(function(e){c.timedEvents.stopTimedEvent(e)})},this.pauseTimedEvents=function(){var e=c.getNow();c.timedEvents.findScheduledEvents().forEach(function(t){c.timedEvents.pauseTimedEvent(t,e)})},this.resumeTimedEvents=function(){c.timedEvents.findScheduledEvents().forEach(function(e){Ln.isPaused(e)&&c.timedEvents.resumeTimedEvent(e,c)},c)},this.runSingleEventWithHistoryReports=function(e){c.history.reportBeforeEvent(e,c.getCurrentStates(),c.buildVariablesInfoArray()),c.interpreter.gen({name:e,data:void 0}),c.history.reportAfterEvent(e,c.getCurrentStates(),c.buildVariablesInfoArray())},this.enqueueEventLastOut=function(e){c.pendingEventQueue.unshift(e)},this.enqueueEventFirstOut=function(e){c.pendingEventQueue.push(e)},this.buildVariablesInfoArray=function(){var e=c.runtime,t=e.taskManager,n=e.variableManager,a=t.getCurrentStatePathRoot();return n.buildVariablesInfoArrayForTask(a)},this.getNow=function(){return new Date},this.interpreter=void 0,this.pendingEventQueue=[],this.pendingTaskSwitch=void 0,this.timedEvents=new Ln,this.statePageMap=e.buildStatePageMap(t.statePageAssignments,r),this.history=new Vn(o),this.running=!1,this.paused=!1,this.eventProcessingRuns=!1,this.runtime=s,this.buildStateMachine(t,n,s,i),void 0!==i&&null!==i||this.interpreter.start()}return Object(r.a)(e,null,[{key:"buildStatePageMap",value:function(e,t){var n=[];return e.forEach(function(e){n.push({state:e.state,pageName:e.pageName,areaType:e.areaType,areaName:e.areaName})}),void 0!==t&&t.forEach(function(e){var t=n.findIndex(function(t){return t.state===e.state});-1===t?n.push({state:e.state,pageName:e.pageName,areaType:e.areaType,areaName:e.areaName}):n[t]={state:e.state,pageName:e.pageName,areaType:e.areaType,areaName:e.areaName}}),n}},{key:"buildTimedEventsCatalog",value:function(t,n){var a=new Ln;return t.forEach(function(t){var r=e.findAcceptingStates(t.name,n);a.putEntry(t.name,t.interval,r)}),a}},{key:"findAcceptingStates",value:function(e,t){var n=this,a=[];return t.forEach(function(t){(void 0!==t.transitions&&t.transitions.some(function(t){return t.event===e})&&a.push(t.id),void 0!==t.states)&&n.findAcceptingStates(e,t.states).forEach(function(e){a.push(e)})}),a}},{key:"buildStatePath",value:function(e,t){return"".concat(e,".").concat(t)}},{key:"buildInitEventName",value:function(e){return".init".concat(e)}},{key:"transformTransition",value:function(t,n,a,r){void 0===n.event&&(n.event=e.buildInitEventName(a)),void 0!==n.cond&&(n.cond=e.buildConditionFunction(n.cond,r)),n.onTransition=e.buildOnTransitionFunction(t,n.target,n.actions,r),delete n.actions}},{key:"buildOnExitFunction",value:function(e,t,n){return function(e){void 0!==t&&t.forEach(function(t,a,r){bt.evaluateTerm(t,n,[],"ex-action:".concat(e.name,"[").concat(a,"]"))})}}},{key:"buildOnTransitionFunction",value:function(e,t,n,a){return function(e){void 0!==n&&n.forEach(function(t,n,r){bt.evaluateTerm(t,a,[],"tr-action:".concat(e.name,"[").concat(n,"]"))})}}},{key:"buildConditionFunction",value:function(e,t){return function(n){return bt.evaluateTerm(e,t,[],"event:".concat(n.name))}}},{key:"executePendingTaskSwitch",value:function(e,t){bt.evaluateTerm(e,t,[],"postp-task")}},{key:"modelCopy",value:function(e){if(void 0!==e)return JSON.parse(JSON.stringify(e))}}]),e}(),Bn=function e(){var t=this;Object(a.a)(this,e),this.stopCurrentStatemachine=function(){void 0!==t.currentMachine&&(t.currentMachine.stop(),t.currentMachine=void 0),t.timedEventDefaults={},t.statePageMapDefaults=[],t.preInitTriggeredEvents=[]},this.startOrInitializeCurrentStatemachine=function(e,n,a){void 0!==t.currentMachine&&(console.error("Cannot run two state machines in parallel.",e),t.stopCurrentStatemachine());var r=t.statemachinesList[e];if(void 0===r){t.statemachineModelsList[e]=n;var i=void 0===n?void 0:new Un(n,t.timedEventDefaults,t.statePageMapDefaults,void 0,void 0,a);t.statemachinesList[e]=i,t.currentMachine=i,void 0!==t.currentMachine&&(t.currentMachine.start(),t.preInitTriggeredEvents.forEach(function(e){t.currentMachine.triggerEvent(e)}))}else t.currentMachine=r,t.currentMachine.continue();t.timedEventDefaults={},t.statePageMapDefaults=[],t.preInitTriggeredEvents=[],a.variableManager.triggerRerenderForAllChangeObservers(a)},this.switchCurrentStatemachineWithoutStarting=function(e){t.currentMachine=t.statemachinesList[e]},this.pauseCurrentStatemachine=function(){void 0!==t.currentMachine&&t.currentMachine.pause()},this.resumeCurrentStatemachine=function(){void 0!==t.currentMachine&&t.currentMachine.resume()},this.triggerEvent=function(e){void 0===t.currentMachine?t.preInitTriggeredEvents.push(e):t.currentMachine.triggerEvent(e)},this.setPostponedTaskSwitch=function(e){void 0!==t.currentMachine&&t.currentMachine.setPostponedTaskSwitch(e)},this.getTimerData=function(e){return void 0===t.currentMachine?void 0:t.currentMachine.getTimerData(e)},this.setTimedEventInterval=function(e,n){void 0===t.currentMachine?t.timedEventDefaults[e]=n:t.currentMachine.setTimedEventInterval(e,n)},this.setStatePageAssignment=function(e,n,a,r){if(void 0===t.currentMachine){var i=t.statePageMapDefaults.findIndex(function(t){return t.state===e});-1===i?t.statePageMapDefaults.push({state:e,pageName:n,areaType:a,areaName:r}):t.statePageMapDefault[i]={state:e,pageName:n,areaType:a,areaName:r}}else t.currentMachine.setStatePageAssignment(e,n,a,r)},this.getCurrentStateMachineLeafStates=function(){return void 0===t.currentMachine?[]:t.currentMachine.getCurrentLeafStates()},this.getHistoryStatemachineData=function(){return void 0===t.currentMachine?{}:t.currentMachine.getHistoryData()},this.getRaisedEvents=function(){return void 0===t.currentMachine?[]:t.currentMachine.getRaisedEvents()},this.getRaisedEventsInState=function(e){return void 0===t.currentMachine?[]:t.currentMachine.getRaisedEventsInState(e)},this.getTotalNbOfRaisedEvents=function(){return void 0===t.currentMachine?0:t.currentMachine.getTotalNbOfRaisedEvents()},this.getVisitedStates=function(){return void 0===t.currentMachine?[]:t.currentMachine.getVisitedStates()},this.getValuesOfVariable=function(e){return void 0===t.currentMachine?[]:t.currentMachine.getValuesOfVariable(e)},this.getStatemachinesPreloadData=function(){var e={};return Object.keys(t.statemachinesList).forEach(function(n){var a=t.statemachinesList[n];void 0!==a&&(e[n]={timerIntervals:a.getCurrentTimerIntervals(),statePageMap:a.getStatePageAssignments(),snapshot:a.getSnapshot(),historyData:a.getHistoryData(),model:z.deepCopy(t.statemachineModelsList[n])})}),e},this.clearStatemachines=function(e){t.stopCurrentStatemachine(),t.statemachinesList={},t.statemachineModelsList={}},this.preloadStatemachinesData=function(e,n){t.clearStatemachines(n),Object.keys(e).forEach(function(a){var r=e[a];t.statemachinesList[a]=new Un(r.model,r.timerIntervals,r.statePageMap,r.snapshot,r.historyData,n),t.statemachineModelsList[a]=r.model})},this.statemachinesList={},this.statemachineModelsList={},this.currentMachine=void 0,this.timedEventDefaults={},this.statePageMapDefaults=[],this.preInitTriggeredEvents=[]},Hn=function e(){var t=this;Object(a.a)(this,e),this.saveTestState=function(e,n,a){t.testEntriesList[e]=z.deepCopy(n),Z.dumpStateChangeToTrace("TaskNavigatorStateManagerState",{name:e,value:t.testEntriesList[e]},a.traceLogBuffer)},this.getTestState=function(e){return z.deepCopy(t.testEntriesList[e])},this.getAllTasksState=function(){return z.deepCopy(t.testEntriesList)},this.clearTasksState=function(){t.testEntriesList={}},this.preloadTasksState=function(e){t.testEntriesList=z.deepCopy(e)},this.injectStateChangeAtReplay=function(e,n){t.testEntriesList[e]=z.deepCopy(n)},this.testEntriesList={}},Wn=function(){function e(){var t=this;Object(a.a)(this,e),this.reportEvent=function(n,a,r){if((t.withReplaySupport||!e.isReplaySupportType(n))&&(!t.withoutSnapshot||"Snapshot"!==n)){var i={entryId:t.getNextCount().toString(),timestamp:e.buildTimeString(a),type:n,details:z.deepCopy(r)};t.withExtendedMetaData&&(i.item=t.item,i.task=t.task,i.scope=t.scope,i.sessionId=t.traceContextId),t.withoutItemConfiguration&&"ItemSwitch"===n&&(i.details.item=void 0),t.withoutScoring&&"TaskSwitch"===n&&(i.details.taskResult=void 0),t.logEntriesList.push(i),void 0!==t.newEntryListener&&t.newEntryListener()}},this.popEntries=function(){var e=t.logEntriesList;return t.logEntriesList=[],e},this.peekEntries=function(){return z.deepCopy(t.logEntriesList)},this.setNewEntryListener=function(e){t.newEntryListener=e},this.setWithReplaySupport=function(e){t.withReplaySupport=e},this.setWithExtendedMetaData=function(e){t.withExtendedMetaData=e},this.setWithoutItemConfiguration=function(e){t.withoutItemConfiguration=e},this.setWithoutSnapshot=function(e){t.withoutSnapshot=e},this.setWithoutScoring=function(e){t.withoutScoring=e},this.setTraceContextId=function(e){t.traceContextId=e},this.setTestItemTaskNames=function(e,n,a){t.scope=e,t.item=n,t.task=a},this.getNextCount=function(){return t.entryCounter+=1,t.entryCounter},this.logEntriesList=[],this.entryCounter=0,this.newEntryListener=void 0,this.withReplaySupport=!1,this.withExtendedMetaData=!1,this.withoutItemConfiguration=!1,this.withoutSnapshot=!1,this.withoutScoring=!1,this.item=void 0,this.task=void 0,this.scope=void 0,this.traceContextId=void 0}return Object(r.a)(e,null,[{key:"buildTimeString",value:function(t){return"".concat(e.padLeadingZeroes(t.getFullYear(),4),"-").concat(e.padLeadingZeroes(t.getMonth()+1,2),"-").concat(e.padLeadingZeroes(t.getDate(),2),"T").concat(e.padLeadingZeroes(t.getHours(),2),":").concat(e.padLeadingZeroes(t.getMinutes(),2),":").concat(e.padLeadingZeroes(t.getSeconds(),2),".").concat(e.padLeadingZeroes(t.getMilliseconds(),3)).concat(e.buildTimeZoneOffsetString(t.getTimezoneOffset()))}},{key:"buildTimeZoneOffsetString",value:function(t){var n=Math.abs(t),a=n%60,r=(n-a)/60;return(t>0?"-":"+")+e.padLeadingZeroes(r.toString(),2)+e.padLeadingZeroes(a.toString(),2)}},{key:"padLeadingZeroes",value:function(e,t){for(var n="".concat(e);n.length<t;)n="0".concat(n);return n}}]),e}();Wn.isReplaySupportType=function(e){return"FullState"===e||"StateChange"===e||"RenderTriggered"===e||"ContextMenu"===e||"ScrollTriggered"===e};var Kn=function e(t){var n=this;Object(a.a)(this,e),this.cut=function(e,t,a){var r=n.currentSelectionHolder;void 0!==r&&!1===r.isReadOnlyCallback()?(n.setClipboardContent(r.getSelectionCallback(!0)),n.traceCutCopy(e,"cut",t,r,!0,a),n.currentSelectionHolder=void 0,n.currentInsertPosition=void 0):n.traceCutCopy(e,"cut",t,r,!1,a)},this.cutEnabled=function(){return void 0!==n.currentSelectionHolder&&!1===n.currentSelectionHolder.isReadOnlyCallback()},this.copy=function(e,t,a){var r=n.currentSelectionHolder;void 0!==r?(n.setClipboardContent(r.getSelectionCallback(!1)),n.traceCutCopy(e,"copy",t,r,!0,a),n.currentSelectionHolder=void 0,n.currentInsertPosition=void 0):n.traceCutCopy(e,"copy",t,r,!1,a)},this.copyEnabled=function(){return void 0!==n.currentSelectionHolder},this.paste=function(e,t,a){var r=n.currentInsertPosition;void 0!==n.currentInsertPosition&&void 0!==n.clipboardContent?(n.currentInsertPosition.insertCallback(n.clipboardContent),n.tracePaste(e,t,r,!0,a),n.currentSelectionHolder=void 0,n.currentInsertPosition=void 0):n.tracePaste(e,t,r,!1,a)},this.pasteEnabled=function(){return void 0!==n.currentInsertPosition&&void 0!==n.clipboardContent},this.registerSelection=function(e,t,a){n.currentSelectionHolder={indexPath:e,getSelectionCallback:t,isReadOnlyCallback:a}},this.deregisterSelection=function(e){void 0!==n.currentSelectionHolder&&n.currentSelectionHolder.indexPath===e&&(n.currentSelectionHolder=void 0)},this.registerInsertPosition=function(e,t){n.currentInsertPosition={indexPath:e,insertCallback:t}},this.deregisterInsertPosition=function(e){void 0!==n.currentInsertPosition&&n.currentInsertPosition.indexPath===e&&(n.currentInsertPosition=void 0)},this.registerFocus=function(e){void 0!==n.currentInsertPosition&&n.currentInsertPosition.indexPath!==e&&(n.currentInsertPosition=void 0),void 0!==n.currentSelectionHolder&&n.currentSelectionHolder.indexPath!==e&&(n.currentSelectionHolder=void 0)},this.getStateForTracing=function(){return z.deepCopy({clipboardContent:n.clipboardContent,selectionHolder:void 0===n.currentSelectionHolder?void 0:{indexPath:n.currentSelectionHolder.indexPath},insertPosition:void 0===n.currentInsertPosition?void 0:{indexPath:n.currentInsertPosition.indexPath}})},this.getAllTasksState=function(){return z.deepCopy(n.clipboardContent)},this.clearTasksState=function(){n.clipboardContent=void 0,n.currentSelectionHolder=void 0,n.currentInsertPosition=void 0},this.preloadTasksState=function(e){n.clipboardContent=z.deepCopy(e)},this.injectStateChangeAtReplay=function(e){n.clipboardContent=e},this.setClipboardContent=function(e){n.clipboardContent=e,Z.dumpStateChangeToTrace("ClipboardState",{state:e},n.traceLog)},this.traceCutCopy=function(e,t,a,r,i,o){n.trace(e,t,a,void 0===r?void 0:r.indexPath,i?n.clipboardContent:void 0,i,o)},this.tracePaste=function(e,t,a,r,i){n.trace(e,"paste",t,void 0===a?void 0:a.indexPath,r?n.clipboardContent:void 0,r,i)},this.trace=function(e,t,a,r,i,o,s){var c=X.getUserDefPathForIndexPath(a,s),l=X.getUserDefPathForIndexPath(r,s);n.traceLog.reportEvent("CutCopyPaste",new Date,{triggerType:e,triggerIndexPath:a,triggerUserDefIdPath:c,triggerUserDefId:q.getLastUserDefIdFromPath(c),operation:t,contentIndexPath:r,contentUserDefIdPath:l,contentUserDefId:q.getLastUserDefIdFromPath(l),content:i,isPerformed:o})},this.traceLog=t,this.clipboardContent=void 0,this.currentSelectionHolder=void 0,this.currentInsertPosition=void 0},qn=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"toFirstUpper",value:function(e){return"string"!==typeof e?"":e.charAt(0).toUpperCase()+e.slice(1)}}]),e}(),Gn=function(){function e(t,n,r){var i=this;Object(a.a)(this,e),this.setSessionContext=function(e,t,n){i.sessionContext={sessionId:e,username:t,loginTimestamp:n}},this.getSessionContext=function(){return i.sessionContext},this.startAutomaticTransmissions=function(){i.transmitInterval>0?i.setNewTimer():i.setImmediateCallback()},this.stopAutomaticTransmissions=function(){i.stopOldTimer(),i.dropImmediateCallback()},this.collectEntriesAndTriggerTransmission=function(){void 0===i.transmitterPromise||!0===i.transmitterPromiseIsResolved?(i.transmitterPromiseIsResolved=!1,i.transmitterPromise=i.collectEntriesAndBuildTransmitPromise().then(function(){i.transmitterPromiseIsResolved=!0})):i.transmitterPromise=i.transmitterPromise.then(function(){return i.transmitterPromiseIsResolved=!1,i.collectEntriesAndBuildTransmitPromise().then(function(){i.transmitterPromiseIsResolved=!0})})},this.collectEntriesAndBuildTransmitPromise=function(){var e=i.notificationToaster;if(i.addUserDataEntries(i.userDataBuffer.popEntries()),0===i.getUserDataEntriesList().length)return Promise.resolve();if(!i.shouldTryAgainToSend()){if(!i.isMaxFailCountErrorDisplayed()){var t="Max tries of error send occurred on the ".concat(i.getFailCount(),"th time and will not try again.");console.log("postTrace: ",t),i.setMaxFailCountErrorDisplayed(),setTimeout(function(){try{e.show(t,"error")}catch(n){console.warn("Did not inform user about max transmission failures. This might happen when an error occurs before we have a task running.")}},3e3)}return Promise.resolve()}var n=i.buildUserDataPostContentCallback(S()().format(),i.getSessionContext(),i.getUserDataEntriesList());return i.getTransmittingPromise(n).then(function(e){i.updateUserDataEntriesListAfterSuccessfulSend(e.noOfEntriesTransmitted)},function(t){console.log(t),i.increaseNextSentFailCount();try{e.show("Error sending ".concat(i.dataType,"s! Fail count:").concat(i.getFailCount()),"warning")}catch(n){console.warn("Did not inform user about the previous transmission failure. This might happen when an error occurs before we have a task running.")}})},this.setPostMessageTransmissionChannel=function(e,t,n){i.transmissionChannel="postMessage",i.targetWindowType=e,i.domainUri=t,i.axiosInstance=void 0,i.transmitCallback=void 0,i.setTransmitInterval(n),i.resetMaxFailCount()},this.setCallbackTransmissionChannel=function(e,t){i.transmissionChannel="callback",i.targetWindowType=void 0,i.domainUri=void 0,i.axiosInstance=void 0,i.transmitCallback=e,i.setTransmitInterval(t),i.resetMaxFailCount()},this.setConsoleTransmissionChannel=function(e){i.transmissionChannel="console",i.targetWindowType=void 0,i.domainUri=void 0,i.axiosInstance=void 0,i.transmitCallback=void 0,i.setTransmitInterval(e),i.resetMaxFailCount()},this.setHttpTransmissionChannel=function(e,t,n){i.transmissionChannel="http",i.targetWindowType=void 0,i.domainUri=void 0,i.axiosInstance=s.a.create({baseURL:e,timeout:void 0===n?3e4:n,headers:{"Content-Type":"application/json"}}),i.transmitCallback=void 0,i.setTransmitInterval(t),i.resetMaxFailCount()},this.setNotificationToaster=function(e){i.notificationToaster=e},this.resetMaxFailCount=function(){i.isMaxFailCountError=!1,i.lastSentFailCount=0},this.setTransmitInterval=function(e){e!==i.transmitInterval&&(i.stopOldTimer(),i.dropImmediateCallback(),i.transmitInterval=e,i.transmitInterval>0?i.setNewTimer():i.setImmediateCallback())},this.setImmediateCallback=function(){i.userDataBuffer.setNewEntryListener(i.collectEntriesAndTriggerTransmission)},this.dropImmediateCallback=function(){void 0!==i.traceLogBuffer&&i.traceLogBuffer.setNewEntryListener(void 0)},this.stopOldTimer=function(){void 0!==i.currentTimer&&(clearInterval(i.currentTimer),i.currentTimer=void 0,i.collectEntriesAndTriggerTransmission())},this.setNewTimer=function(){i.stopOldTimer(),i.currentTimer=setInterval(function(){return i.collectEntriesAndTriggerTransmission()},i.transmitInterval)},this.increaseNextSentFailCount=function(){i.lastSentFailCount+=1},this.getFailCount=function(){return i.lastSentFailCount},this.isMaxFailCountErrorDisplayed=function(){return i.isMaxFailCountError},this.setMaxFailCountErrorDisplayed=function(){i.isMaxFailCountError=!0},this.shouldTryAgainToSend=function(){return i.getFailCount()<10},this.getUserDataEntriesList=function(){return i.userDataEntriesList},this.addUserDataEntries=function(e){e.length>0&&(i.userDataEntriesList=i.userDataEntriesList.concat(e))},this.updateUserDataEntriesListAfterSuccessfulSend=function(e){i.userDataEntriesList=i.userDataEntriesList.filter(function(t,n){return n>e}),i.lastSentFailCount=0},this.getTransmittingPromise=function(t){switch(i.transmissionChannel){case"postMessage":return e.transmitViaPostMessage(t,i.targetWindowType,i.domainUri,i);case"callback":return e.transmitViaCallback(t,i.transmitCallback,i);case"console":return e.transmitViaConsole(t,i);case"http":return e.transmitViaHttp(t,i.axiosInstance,i);default:return e.transmitViaConsole(t,i)}},this.dataType=r,this.userDataBuffer=t,this.buildUserDataPostContentCallback=n,this.userDataEntriesList=[],this.lastSentFailCount=0,this.isMaxFailCountError=!1,this.notificationToaster=R.notify,this.transmitterPromise=void 0,this.transmitterPromiseIsResolved=!1,this.sessionContext={},this.transmissionChannel="console",this.targetWindowType=void 0,this.domainUri=void 0,this.axiosInstance=void 0,this.transmitCallback=void 0,this.transmitInterval=void 0,this.currentTimer=void 0}return Object(r.a)(e,null,[{key:"transmitViaPostMessage",value:function(t,n,a,r){return new Promise(function(i,o){var s=Object(N.a)({eventType:"".concat(r.dataType,"Transmission")},"".concat(r.dataType,"Data"),t),c=e.getTargetWindow(n);if(void 0===c)throw console.error("Cannot find target window for target window type ".concat(n)),new Error("Cannot deliver ".concat(r.dataType,"s via post message."));try{c.postMessage(JSON.stringify(s),a),i({noOfEntriesTransmitted:t["".concat(e.getDataType(r.dataType),"EntriesList")].length})}catch(l){throw console.error("Cannot deliver ".concat(r.dataType,"s via postMessage"),l),new Error("Cannot deliver ".concat(r.dataType,"s via post message."))}})}},{key:"getTargetWindow",value:function(e){switch(e){case"parent":return window.parent;case"opener":return window.opener;case"self":return window;default:return void console.error("Unknown target window type!")}}},{key:"transmitViaCallback",value:function(t,n,a){return new Promise(function(r,i){try{n(t)}catch(o){throw console.error("Cannot deliver ".concat(a.dataType,"s via callback"),o),new Error("Cannot deliver ".concat(a.dataType,"s via callback"))}r({noOfEntriesTransmitted:t["".concat(e.getDataType(a.dataType),"EntriesList")].length})})}},{key:"transmitViaHttp",value:function(t,n,a){var r=t["".concat(e.getDataType(a.dataType),"EntriesList")].length;return n.post("",t).then(function(e){return{noOfEntriesTransmitted:r}}).catch(function(e){throw e.response?console.error(e.response.status,"Error: Cannot deliver ".concat(a.dataType,"s to URL ").concat(e.response.config.url)):e.request?console.log(e.request):console.log("Error",e.message),console.log(e.config),new Error("Cannot deliver ".concat(a.dataType,"s to server."))})}},{key:"transmitViaConsole",value:function(t,n){var a=t["".concat(e.getDataType(n.dataType),"EntriesList")];return new Promise(function(e,r){try{var i=qn.toFirstUpper(n.dataType);console.log("".concat(i," message sent to console: "),JSON.parse(JSON.stringify(t)))}catch(o){throw console.error("Cannot deliver ".concat(n.dataType,"s to console"),o),new Error("Cannot deliver ".concat(n.dataType,"s to console"))}e({noOfEntriesTransmitted:a.length})})}}]),e}();Gn.getDataType=function(e){return"recording"===e?e:"log"};var zn=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e,t.buildTracePostContent,"traceLog"))).transmitInterval=2e4,n}return Object(I.a)(t,e),t}(Gn);zn.buildTracePostContent=function(e,t,n){var a=t.sessionId,r=t.username,i=t.loginTimestamp;return void 0===a&&console.warn("Sending trace log with dummy session id!"),{metaData:{userId:r,sessionId:void 0===a?"dummySessionId":a,loginTimestamp:i,sendTimestamp:e,cbaVers:d.getCbaVersion()},logEntriesList:n}};var _n=function(){function e(){var t=this;Object(a.a)(this,e),this.registerAcceptableUrlForExternalPageFrameEvent=function(n){var a=e.tryToParseURL(n);if(void 0!==a){var r=a.origin;void 0===r||r.length<1?console.log("We only accept http(s) protocols as source URLs for post message events.  Ignored URL is: ".concat(n)):t.acceptedExternalPageFrameUrlsList.includes(r)||t.acceptedExternalPageFrameUrlsList.push(r)}else console.log("We don't accept invalid URLs as source URLs for post message events.  Ignored URL is: ".concat(n))},this.startReceiving=function(e,n){if(void 0!==e)if(void 0!==n){t.runtime=e,t.taskPlayer=n;var a=d.getCallingUrlWithoutPath();t.defaultAcceptedUrl="file:"===a||"atom:"===a?"null":a,t.acceptedExternalPageFrameUrlsList.push(t.defaultAcceptedUrl),window.addEventListener("message",t.receiveEvent,!1)}else console.error("Cannot start receiving events without a task player reference.");else console.error("Cannot start receiving events without a runtime context.")},this.sendTaskPlayerReadyEvent=function(n,a){e.sendResponseEvent({eventType:"taskPlayerReady"},n,t.getTargetWindow(a),t.responder)},this.receiveEvent=function(n){var a=n.origin,r=n.source,i=n.data;if(t.defaultAcceptedUrl===a||t.acceptedExternalPageFrameUrlsList.includes(a)){var o=e.tryJsonParse(i);if(void 0!==o){var s=new Date,c=!1;c||(c=t.processRuntimeControlEvent(a,r,o)),c||(c=t.processIfExternalPageFrameEvent(s,a,r,o)),c||console.log("PostMessageReceiver ignored unknown event with data: ".concat(i))}else console.log("PostMessageReceiver ignored event with non-JSON data: ".concat(i))}else console.log("PostMessageReceiver ignored event from origin ".concat(a,", our default accepted url is ").concat(t.defaultAcceptedUrl,", additional accepted URLs:"),t.acceptedExternalPageFrameUrlsList)},this.processIfExternalPageFrameEvent=function(n,a,r,i){if(!t.acceptedExternalPageFrameUrlsList.includes(a))return!1;var o=i.traceMessage,s=i.traceType,c=i.microfinEvent,l=i.microfinVariable,u=i.setVariable,d=i.getVariable,g=i.indexPath,f=i.userDefIdPath,p=t.runtime,h=p.taskManager,v=p.variableManager,m=h.getCurrentStatePathRoot();if(e.isEmptyOrNoValue(o)&&e.isEmptyOrNoValue(c)&&e.isEmptyOrNoValue(l)&&e.isNoValue(u)&&e.isEmptyOrNoValue(d))return!1;if(!e.isEmptyOrNoValue(o)){var y=e.isEmptyOrNoValue(g)?void 0:g,b=e.isEmptyOrNoValue(f)?void 0:f;t.runtime.traceLogBuffer.reportEvent("JavaScriptInjected",n,{indexPath:y,userDefIdPath:b,userDefId:void 0===b?void 0:q.getLastUserDefIdFromPath(b),origin:a,message:o,type:s})}if(!e.isEmptyOrNoValue(l)){var k=l.variableName,S=l.newValue;e.isEmptyOrNoValue(k)||e.isEmptyOrNoValue(S)||v.setVariable(m,k,S,void 0,t.runtime)}if(!e.isNoValue(u)){var C=u.variableName,T=u.newValue,P=u.newType;e.isEmptyOrNoValue(C)||e.isNoValue(T)||v.setVariable(m,C,T,P,t.runtime)}if(e.isEmptyOrNoValue(c)||t.runtime.statemachinesManager.triggerEvent(c),!e.isEmptyOrNoValue(d)){var E=d.variableName,x=d.callId;if(!e.isEmptyOrNoValue(E)&&!e.isEmptyOrNoValue(x)){var I={result:v.getVariable(m,E,!0),callId:x};if(void 0!==r)try{r.postMessage(JSON.stringify(I),a)}catch(M){throw console.error("Cannot send variable value result,",M),new Error("Cannot send variable value result.")}}}for(var O=0;O<e.getUserInteractionCount(i);O+=1)t.runtime.incidentsAccumulator.userInteraction(n,void 0,t.runtime);return!0},this.processAvailabilityMessage=function(e){var n=t.availableTaskSwitches.find(function(t){return t.request===e.request&&t.scope===e.scope&&t.item===e.item&&t.task===e.task});void 0===n?t.availableTaskSwitches.push({request:e.request,scope:e.scope,item:e.item,task:e.task,value:e.value}):n.value=e.value},this.isTaskSwitchAvailable=function(e,n,a,r){var i=t.availableTaskSwitches.find(function(t){return t.request===e&&t.scope===n&&t.item===a&&t.task===r});return void 0!==i&&i.value},this.processRuntimeControlEvent=function(n,a,r){var i=t.runtime;if(t.defaultAcceptedUrl!==n)return!1;if(void 0===r.eventType)return!1;switch(r.eventType){case"taskPlayerReady":console.info("Task player ready (outgoing event) ignored.");break;case"setWaitMessages":t.taskPlayer.setWaitMessages(r.primary,r.secondary);break;case"addItem":t.taskPlayer.addItem(r.itemConfig,r.resourcePath,r.externalResourcePath,r.libraryPathsMap);break;case"clearItems":t.taskPlayer.clearItems();break;case"setScalingConfiguration":t.taskPlayer.setScalingConfiguration({scalingMode:r.scalingMode,alignmentHorizontal:r.alignmentHorizontal,alignmentVertical:r.alignmentVertical});break;case"setPreload":var o=t.taskPlayer.setPreload(r.itemName);void 0!==o&&o.then(function(i){e.sendResponseEvent({eventType:"setPreloadReturn",requestId:r.requestId,isSuccess:!0,message:{images:i[0],videos:i[1],audios:i[2]}},n,a,t.responder)},function(i){e.sendResponseEvent({eventType:"setPreloadReturn",requestId:r.requestId,isSuccess:!1,message:i},n,a,t.responder)});break;case"setPreloadReturn":console.info("Return event for setPreload request (outgoing event) ignored.");break;case"insertMessageInTrace":t.taskPlayer.insertMessageInTrace(r.message);break;case"logStateToTrace":t.taskPlayer.logStateToTrace();break;case"flushTrace":t.taskPlayer.flushTrace();break;case"setTraceLogTransmissionChannel":"http"===r.channel?i.traceLogUploader.setHttpTransmissionChannel(r.transmitUrl,r.interval,r.httpTimeout):"postMessage"===r.channel?e.isValidTargetOrigin(r.targetOrigin)?i.traceLogUploader.setPostMessageTransmissionChannel(r.targetWindowType,r.targetOrigin,r.interval):console.warn("Trace log channel configuration with invalid target origin setting ignored: ".concat(r.targetOrigin)):"console"===r.channel?i.traceLogUploader.setConsoleTransmissionChannel(r.interval):console.error("Invalid trace log channel setting ignored: ".concat(r.channel));break;case"traceLogTransmission":console.info("Trace log event echo (outgoing event) ignored.");break;case"setTraceContextId":t.taskPlayer.setTraceContextId(r.contextId);break;case"setTraceContentFilter":t.taskPlayer.setTraceContentFilter(r.replaySupport,r.withExtendedMetaData,r.withoutItemConfiguration,r.withoutSnapshot,r.withoutScoring);break;case"setRecordingTransmissionChannel":"http"===r.channel?i.recordingUploader.setHttpTransmissionChannel(r.transmitUrl,void 0,r.httpTimeout):"postMessage"===r.channel?e.isValidTargetOrigin(r.targetOrigin)?i.recordingUploader.setPostMessageTransmissionChannel(r.targetWindowType,r.targetOrigin,void 0):console.warn("Recording channel configuration with invalid target origin setting ignored: ".concat(r.targetOrigin)):"console"===r.channel?i.recordingUploader.setConsoleTransmissionChannel(void 0):console.error("Invalid trace log channel setting ignored: ".concat(r.channel));break;case"recordingTransmission":console.info("Recording transmission event echo (outgoing event) ignored.");break;case"setRecordingContextId":t.taskPlayer.setRecordingContextId(r.contextId);break;case"setUserId":t.taskPlayer.setUserId(r.id);break;case"logout":t.taskPlayer.logout();break;case"getUserId":e.sendResponseEvent({eventType:"getUserIdReturn",requestId:r.requestId,id:t.taskPlayer.getUserId()},n,a,t.responder);break;case"getUserIdReturn":console.info("Return event for getUserId request (outgoing event) ignored.");break;case"showLogin":t.taskPlayer.showLogin(r.titleLabel,r.fieldLabel,r.buttonLabel,function(i){e.sendResponseEvent({eventType:"loginDialogClosed",requestId:r.requestId,fieldValue:i},n,a,t.responder)});break;case"loginDialogClosed":console.info("Return event for showLogin request (outgoing event) ignored.");break;case"startTask":t.taskPlayer.startTask(r.scope,r.item,r.task);break;case"stopTask":t.taskPlayer.stopTask();break;case"pauseTask":t.taskPlayer.pauseTask();break;case"resumeTask":t.taskPlayer.resumeTask();break;case"getTask":var s=t.taskPlayer.getTask(),c=void 0===s?{}:s,l=c.scope,u=c.item,d=c.task;e.sendResponseEvent({eventType:"getTaskReturn",requestId:r.requestId,scope:l,item:u,task:d},n,a,t.responder);break;case"getTaskReturn":console.info("Return event for getTask request (outgoing event) ignored.");break;case"setTaskSequencer":var g=t.responder,f=t.getTargetWindow(r.targetWindowType);e.isValidTargetOrigin(r.targetOrigin)?t.taskPlayer.setTaskSequencer(function(t,n,a,i){e.sendResponseEvent({eventType:"taskSwitchRequest",request:t,scope:n,item:a,task:i},r.targetOrigin,f,g)},function(e,n,a,r){return t.isTaskSwitchAvailable(e,n,a,r)}):console.warn("Task sequencer configuration with invalid target origin ignored: ".concat(r.targetOrigin));break;case"taskSwitchRequest":console.info("Task switch request (outgoing event) ignored.");break;case"setSwitchAvailability":t.processAvailabilityMessage(r);break;case"getTasksState":e.sendResponseEvent({eventType:"getTasksStateReturn",requestId:r.requestId,userId:t.taskPlayer.getUserId(),state:t.taskPlayer.getTasksState()},n,a,t.responder);break;case"getTasksStateReturn":console.info("Return event for getTasksState request (outgoing event) ignored.");break;case"clearTasksState":t.taskPlayer.clearTasksState();break;case"preloadTasksState":t.taskPlayer.preloadTasksState(r.state);break;case"replay":t.taskPlayer.replay(r.story);break;case"getScoringResult":e.sendResponseEvent({eventType:"getScoringResultReturn",requestId:r.requestId,result:t.taskPlayer.getScoringResult()},n,a,t.responder);break;case"getScoringResultReturn":console.info("Return event for getScoringResult request (outgoing event) ignored.");break;case"getOldScoringResult":e.sendResponseEvent({eventType:"getOldScoringResultReturn",requestId:r.requestId,result:t.taskPlayer.getOldScoringResult(r.scope,r.item,r.task)},n,a,t.responder);break;case"getOldScoringResultReturn":console.info("Return event for getOldScoringResult request (outgoing event) ignored.");break;case"sendStatemachineEvent":t.taskPlayer.sendStatemachineEvent(r.event);break;case"setHeaderButtons":t.taskPlayer.setHeaderButtons(r.headerButtons);break;case"setMenuCarousels":t.taskPlayer.setMenuCarousels(r.course,r.scopes);break;case"activateDebuggingWindows":t.taskPlayer.activateDebuggingWindows(r.scoreHotKey,r.traceHotKey,r.statemachineHotKey);break;default:return!1}return!0},this.getTargetWindow=function(e){switch(e){case"parent":return window.parent;case"opener":return window.opener;case"self":return window;default:return void console.error("Unknown target window type ".concat(e))}},this.acceptedExternalPageFrameUrlsList=[],this.defaultAcceptedUrl=void 0,this.availableTaskSwitches=[],this.responder=function(e,t,n){try{var a=JSON.stringify(e),r=void 0===t||null==t||0===t.length||"null"===t?"*":t;n.postMessage(a,r)}catch(i){console.error("Sending a response message failed.",i)}}}return Object(r.a)(e,null,[{key:"tryToParseURL",value:function(e){try{return new URL(e)}catch(t){return}}},{key:"tryJsonParse",value:function(e){try{return JSON.parse(e)}catch(t){return}}},{key:"isEmptyOrNoValue",value:function(e){return void 0===e||null===e||""===e}},{key:"isNoValue",value:function(e){return void 0===e||null===e}},{key:"sendResponseEvent",value:function(e,t,n,a){a(e,t,n)}},{key:"getUserInteractionCount",value:function(t){return!e.isEmptyOrNoValue(t.traceCount)&&t.traceCount>=0?t.traceCount:(console.warn("Invalid traceCount in external page frame event ignored: ".concat(t.traceCount)),0)}},{key:"isValidTargetOrigin",value:function(e){if("*"===e)return!0;try{var t=l.a.parse(e);return e==="".concat(t.protocol,"//").concat(t.host)}catch(n){return!1}}}]),e}(),Jn=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"isMultipleOfPi",value:function(e,t,n,a){var r=a?180:Math.PI;return(e-n*r)/t/r%1===0}}]),e}();Jn.ANGLE_DEGREE="Degree",Jn.ANGLE_RADIAN="Radian",Jn.fak=function(e){return e<0||e>170?NaN:Jn.isInt(e)?e<=1?1:e*Jn.fak(e-1):NaN},Jn.nthroot=function(e,t){var n=t%2===1&&e<0;n&&(e=-e);var a=Math.pow(e,1/t),r=Math.pow(a,t);return Math.abs(e-r)<1&&e>0===r>0?n?-a:a:NaN},Jn.isInt=function(e){return e%1===0},Jn.isBigger=function(e){return e>10};var Yn=function e(){var t=this;Object(a.a)(this,e),this.getFullState=function(){return{stack:z.deepCopy(t.stack),num:t.num,repeatingRunStatus:z.deepCopy(t.repeatingRunStatus)}},this.restoreState=function(e){t.stack=z.deepCopy(e.stack),t.num=e.num,t.repeatingRunStatus=z.deepCopy(e.repeatingRunStatus)},this.calc=function(e,n){var a=t.translateKey(n);if(t.updateRepeatingRunStatus(a,e),t.isStackEmpty())return"="===a?t.repeatingRunIsActive()?"".concat(t.calcValue(e,t.getRepeatingRunKey(),t.getRepeatingRunValue())):"".concat(e):(t.pushStackEntry(e,a),"".concat(e));var r=0,i=t.getRankForKey(a),o=t.peekStackKey(),s=t.peekStackValue();if(i>t.getRankForKey(o))t.pushStackEntry(e,a),r=e;else{var c=t.calcValue(s,o,e);t.popStackEntry(),!t.isStackEmpty()&&i<=t.getRankForKey(t.peekStackKey())?r=t.calc(c,a):(t.pushStackEntry(c,a),r=c)}return"="===a&&t.resetStack(),"".concat(r)},this.reset=function(){t.resetStack(),t.resetRepeatingRun()},this.calcValue=function(e,t,n){var a;switch(t){case"log":a=Math.log(e)/Math.log(n);break;case"yx":a=Math.pow(e,n);break;case"x\u221ay":a=Jn.nthroot(e,n);break;case"EE":a=e*Math.pow(10,n);break;case"+":a=+e+ +n;break;case"-":a=e-n;break;case"*":a=e*n;break;case"/":a=e/n;break;default:throw new Error("NO case for operator ".concat(t))}return a},this.resetRepeatingRun=function(){t.repeatingRunStatus={key:void 0,value:void 0}},this.updateRepeatingRunStatus=function(e,n){"="!==e?(t.setRepeatingRunValue(void 0),t.setRepeatingRunKey(e)):void 0===t.getRepeatingRunValue()&&t.setRepeatingRunValue(n)},this.repeatingRunIsActive=function(){return void 0!==t.getRepeatingRunKey()&&void 0!==t.getRepeatingRunValue},this.getRepeatingRunValue=function(){return t.repeatingRunStatus.value},this.getRepeatingRunKey=function(){return t.repeatingRunStatus.key},this.setRepeatingRunKey=function(e){t.repeatingRunStatus.key=e},this.setRepeatingRunValue=function(e){t.repeatingRunStatus.value=e},this.resetStack=function(){t.stack=[],t.num=0},this.isStackEmpty=function(){return t.num<=0},this.peekStackValue=function(){return t.stack[t.num-1][0]},this.peekStackKey=function(){return t.stack[t.num-1][1]},this.pushStackEntry=function(e,n){t.stack[t.num]=[e,n],t.num+=1},this.popStackEntry=function(){return t.num-=1,t.stack[t.num]},this.translateKey=function(e){return"\xd7"===e?"*":"\xf7"===e?"/":"\u2013"===e?"-":e},this.getRankForKey=function(t){return e.RANK[t]},this.reset()};Yn.RANK={"=":0,"+":1,"-":1,"/":2,"*":2,yx:3,"x\u221ay":3,log:3,EE:3};var Xn=function(){function e(t,n){var r=this;Object(a.a)(this,e),this.setConfiguration=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];r.angle=t||Jn.ANGLE_DEGREE,r.bigger=Jn.isBigger(e),r.silentOnErrors=n},this.getFullState=function(){var e={};return e.expressions=z.deepCopy(r.expressions.map(function(e){return e.getFullState()})),e.expressionNestingDepth=r.expressionNestingDepth,e.isError=r.isError,e.memory=z.deepCopy(r.memory),e.resultBuffer=r.resultBuffer,e.keysBuffer=z.deepCopy(r.keysBuffer),e.angle=r.angle,e.bigger=r.bigger,e},this.restoreState=function(e){r.expressions=e.expressions.map(function(e){var t=new Yn;return t.restoreState(e),t}),r.expressionNestingDepth=e.expressionNestingDepth,r.isError=e.isError,r.memory=e.memory,r.resultBuffer=e.resultBuffer,r.keysBuffer=e.keysBuffer,r.angle=e.angle,r.bigger=e.bigger},this.getMem=function(e){return e=e||0,r.memory[e]?Math.round(Number(r.memory[e])):0},this.paste=function(e){r.initRenderCommands();var t=Number.parseFloat(e).toString();return r.setCurrentEvaluationResult(t),r.sendToRender(t),r.getRenderCommands()},this.evalKey=function(e,t){return r.initRenderCommands(),r.evalKeyInternal(e,t),r.getRenderCommands()},this.initRenderCommands=function(){r.renderCommands={render:[],history:[]}},this.getRenderCommands=function(){return r.renderCommands},this.sendToRender=function(e){r.renderCommands.render.push(e)},this.sendToRenderHistory=function(e,t,n){r.isError?r.renderCommands.history.push({key:"AC"}):r.renderCommands.history.push({key:e,operand:t,value:n})},this.resetExpressionsStack=function(){r.expressionNestingDepth=0,r.expressions=[],r.expressions[0]=new Yn},this.pushNestedExpression=function(){r.expressionNestingDepth+=1,r.expressions[r.expressionNestingDepth]=new Yn},this.popNestedExpression=function(){var e=r.expressions[r.expressionNestingDepth];return r.expressionNestingDepth-=1,e},this.peekNestedExpression=function(){return r.expressions[r.expressionNestingDepth]},this.hasNestedExpression=function(){return r.expressionNestingDepth>0},this.setCurrentEvaluationResult=function(e){e.match(/NaN|Inf|Error/)?(r.resultBuffer="0",r.isError=!0):r.resultBuffer=e},this.getCurrentEvaluationResult=function(){return r.resultBuffer},this.resetKeysBuffer=function(){r.keysBuffer=[]},this.pushKeyToKeysBuffer=function(e){r.keysBuffer.push({key:e}),("="===r.getPreviousKey().key&&"="!==e||r.isKeyAC(e))&&(r.keysBuffer=[{key:e}])},this.popKeyFromKeysBuffer=function(){return r.keysBuffer.pop()},this.getKeysBufferLength=function(){return r.keysBuffer.length},this.getPreviousKey=function(){return r.keysBuffer[r.keysBuffer.length-2]||{}},this.getCurrentKey=function(){return r.keysBuffer[r.keysBuffer.length-1]||{}},this.evalKeyInternal=function(e,t){(!r.isError||r.isKeyAC(e)||r.isKeyC(e))&&(r.isError=!1,r.pushKeyToKeysBuffer(e),r.operations[e]({key:e,operand:t,dispVal:r.getCurrentEvaluationResult()}))},this.evalOperation=function(e){return function(t){var n=t.dispVal,a=t.key,i=t.operand;try{var o=e({key:a,operand:i,dispVal:n}),s=void 0===o?void 0:o.toString();return r.setCurrentEvaluationResult(s),r.sendToRender(s),r.sendToRenderHistory(a,i,r.getCurrentEvaluationResult()),s}catch(c){return void(r.silentOnErrors||console.warn("---\x3e Ignored key ".concat(a," with operand ").concat(i," at current value ").concat(n,": ").concat(c.toString())))}}},this.evalShouldResetHistoryIfDigitOnNextKey=function(e){return function(t){var n=e(t);return r.getCurrentKey().shouldResetHistoryIfDigitOnNextKey=!0,n}},this.evalEndOfTerm=function(e){return function(t){var n=e(t);return r.getCurrentKey().isEndOfTerm=!0,n}},this.evalsin=function(e){var t=e.dispVal;return Jn.isMultipleOfPi(t,1,0,r.deg())?0:Jn.isMultipleOfPi(t,2,.5,r.deg())?1:Jn.isMultipleOfPi(t,2,1.5,r.deg())?-1:Math.sin(r.getRadiantValue(t))},this.evalcsc=function(e){var t=e.dispVal;return Jn.isMultipleOfPi(t,1,0,r.deg())?NaN:Jn.isMultipleOfPi(t,2,.5,r.deg())?1:Jn.isMultipleOfPi(t,2,1.5,r.deg())?-1:1/Math.sin(r.getRadiantValue(t))},this.evalsin1=function(e){var t=e.dispVal;return r.getDisplayValueFromRadiant(Math.asin(t))},this.evalcos=function(e){var t=e.dispVal;return Jn.isMultipleOfPi(t,1,.5,r.deg())?0:Jn.isMultipleOfPi(t,2,0,r.deg())?1:Jn.isMultipleOfPi(t,2,1,r.deg())?-1:Math.cos(r.getRadiantValue(t))},this.evalsec=function(e){var t=e.dispVal;return Jn.isMultipleOfPi(t,1,.5,r.deg())?NaN:Jn.isMultipleOfPi(t,2,0,r.deg())?1:Jn.isMultipleOfPi(t,2,1,r.deg())?-1:1/Math.cos(r.getRadiantValue(t))},this.evalcos1=function(e){var t=e.dispVal;return r.getDisplayValueFromRadiant(Math.acos(t))},this.evaltan=function(e){var t=e.dispVal;return Jn.isMultipleOfPi(t,1,0,r.deg())?0:Jn.isMultipleOfPi(t,1,.5,r.deg())?NaN:Math.tan(r.getRadiantValue(t))},this.evalcot=function(e){var t=e.dispVal;return Jn.isMultipleOfPi(t,1,0,r.deg())?NaN:Jn.isMultipleOfPi(t,1,.5,r.deg())?0:1/Math.tan(r.getRadiantValue(t))},this.evaltan1=function(e){var t=e.dispVal;return r.getDisplayValueFromRadiant(Math.atan(t))},this.evalsinh=function(e){var t=e.dispVal;return(Math.pow(Math.E,t)-Math.pow(Math.E,-t))/2},this.evalsinh1=function(e){var t=e.dispVal;return Math.log(+t+Math.sqrt(1+Math.pow(t,2)))},this.evalcosh=function(e){var t=e.dispVal;return(Math.pow(Math.E,t)+Math.pow(Math.E,-t))/2},this.evalcosh1=function(e){var t=e.dispVal;return 2*Math.log(Math.sqrt((+t+1)/2)+Math.sqrt((+t-1)/2))},this.evaltanh=function(e){var t=e.dispVal,n=Math.pow(Math.E,t),a=Math.pow(Math.E,-t);return(n-a)/(n+a)},this.evaltanh1=function(e){var t=e.dispVal;return(Math.log(+t+1)-Math.log(1-t))/2},this.evalPI=function(e){e.dispVal;return Math.PI},this.deg=function(){return r.angle===Jn.ANGLE_DEGREE},this.eval1perx=function(e){return 1/e.dispVal},this.evalx2=function(e){var t=e.dispVal;return Math.pow(t,2)},this.evalx3=function(e){var t=e.dispVal;return Math.pow(t,3)},this.eval2x=function(e){var t=e.dispVal;return Math.pow(2,t)},this.evalex=function(e){var t=e.dispVal;return Math.exp(t)},this.evaloperandyx=function(e){var t=e.dispVal,n=e.operand;return Math.pow(t,n)},this.evaloperandex=function(e){var t=e.dispVal,n=e.operand;return Math.pow(n,t)},this.eval2root=function(e){var t=e.dispVal;return Math.sqrt(t)},this.eval3root=function(e){var t=e.dispVal;return Jn.nthroot(t,3)},this.evaloperandxrooty=function(e){var t=e.dispVal,n=e.operand;return Jn.nthroot(t,n)},this.evalfactorial=function(e){var t=e.dispVal;return Jn.fak(t)},this.evalln=function(e){var t=e.dispVal;return Math.log(t)},this.evallog2=function(e){var t=e.dispVal;return Math.log(t)/Math.log(2)},this.evallog10=function(e){var t=e.dispVal;return Math.log(t)/Math.log(10)},this.evaloperandlog=function(e){var t=e.dispVal,n=e.operand;return Math.log(t)/Math.log(n)},this.evalRandom=function(e){e.dispVal;return Math.random()},this.evalLeftBracket=function(e){var t=e.dispVal;return r.pushNestedExpression(),t},this.evalRightBracket=function(e){var t=e.dispVal;return r.hasNestedExpression()?r.popNestedExpression().calc(t,"="):t},this.evalPlusMinus=function(e){var t=e.dispVal,n=e.key,a=r.getPreviousKey().isEndOfTerm?"0":t,i=a.replace(/e[+|-]/,"").match("-")?a.replace(/^-/,""):"-".concat(a);return r.setCurrentEvaluationResult(i),r.sendToRender(i),r.sendToRenderHistory(n,void 0,r.getCurrentEvaluationResult()),i},this.evalEquals=function(e){for(var t=e.dispVal;r.hasNestedExpression();)t=r.popNestedExpression().calc(t,"="),r.setCurrentEvaluationResult(t);return t=r.peekNestedExpression().calc(t,"="),r.setCurrentEvaluationResult(t),t},this.evalDigitOrDecimalPoint=function(e){var t=e.dispVal,n=e.key,a=r.getPreviousKey(),i=a.shouldResetHistoryIfDigitOnNextKey,o=a.isEndOfTerm||1===r.getKeysBufferLength()?"0":t;if(r.willOverflow(o,n))throw r.popKeyFromKeysBuffer(),Error("cannot add key ".concat(n," to number due to value overflow"));if(r.isAlreadyDecimalPoint(o,n))throw r.popKeyFromKeysBuffer(),Error("cannot add key ".concat(n," to number since we have a decimal point already"));return i&&r.sendToRenderHistory("AC"),(o+n).replace(/^(-)*?0(\d)$/,"$1$2")},this.evalDecimalPoint=function(e){var t,n=e.dispVal,a=e.key;try{t=r.evalDigitOrDecimalPoint({dispVal:n,key:a}),r.setCurrentEvaluationResult(t),r.sendToRender(t),r.sendToRenderHistory(a,void 0,r.getCurrentEvaluationResult())}catch(i){t=n}return t},this.willOverflow=function(e,t){return Math.abs(+(e+t))>(r.bigger?1e15:1e9)||e.replace(/^-/,"").length>15||e.replace("-","").replace(/\./g,"").length>(r.bigger?14:8)},this.isAlreadyDecimalPoint=function(e,t){return e.match(/\.|e\+/)&&"."===t},this.evalMClear=function(e){var t=e.dispVal,n=e.operand;return delete r.memory[n],t},this.evalMSave=function(e){var t=e.dispVal,n=e.operand;return r.memory[n]=t,t},this.evalMAdd=function(e){var t=e.dispVal,n=e.operand;return r.doMemoryOperation(n,"+",t),t},this.evalMMinus=function(e){var t=e.dispVal,n=e.operand;return r.doMemoryOperation(n,"-",t),t},this.evalMRead=function(e){var t=e.operand;if(void 0===r.memory[t])throw new Error("No value in memory for key ".concat(t));var n=r.getMemoryValue(t);return"".concat(n)},this.doMemoryOperation=function(e,t,n){var a=new Yn;a.calc(r.getMemoryValue(e),t);var i=a.calc(n,"=");r.memory[e]=i},this.getMemoryValue=function(e){return r.memory[e]||0},this.evalAC=function(e){e.key;return r.resetExpressionsStack(),"0"},this.evalC=function(e){e.key;return"0"},this.evalBackspace=function(e){var t=e.dispVal;if(r.popKeyFromKeysBuffer(),r.getCurrentKey().isEndOfTerm)throw Error("Cannot delete beyond last number's input.");var n=t;if("+/\u2013"===r.getCurrentKey().key)r.evalKeyInternal("+/\u2013"),r.popKeyFromKeysBuffer(),r.popKeyFromKeysBuffer(),n=r.getCurrentEvaluationResult();else if(t.match(/-\d$/))r.popKeyFromKeysBuffer(),n="-0";else if(t.match(/^\d$/))r.popKeyFromKeysBuffer(),n="0";else{if(!(t.length>0))throw Error("Cannot delete beyond last number's input.");r.popKeyFromKeysBuffer(),n=n.substring(0,n.length-1)}return"."===r.getCurrentKey().key&&(r.popKeyFromKeysBuffer(),n=n.substring(0,n.length-1)),n},this.evalViaExpressionEvaluator=function(e){var t=e.dispVal,n=e.key;if("("===r.getPreviousKey().key)switch(n){case"+":case"\u2013":case"\xd7":case"\xf7":case"yx":case"x\u221ay":t=0;break;case"log":t=1}return r.peekNestedExpression().calc(t,n)},this.isKeyAC=function(e){return"AC"===e},this.isKeyC=function(e){return"C"===e},this.isError=!1,this.memory={},this.resetExpressionsStack(),this.setCurrentEvaluationResult("0"),this.resetKeysBuffer(),this.operations=e.buildHardcodedCommandsList(this),this.setConfiguration(t,n)}return Object(r.a)(e,[{key:"getRadiantValue",value:function(e){return e*(this.deg()?Math.PI/180:1)}},{key:"getDisplayValueFromRadiant",value:function(e){return e*(this.deg()?180/Math.PI:1)}}],[{key:"buildHardcodedCommandsList",value:function(t){return{sin:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalsin),csc:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalcsc),"sin-1":void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalsin1),cos:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalcos),sec:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalsec),"cos-1":void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalcos1),tan:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evaltan),cot:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalcot),"tan-1":void 0===t?null:e.buildUnaryOperatorCommand(t,t.evaltan1),sinh:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalsinh),"sinh-1":void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalsinh1),cosh:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalcosh),"cosh-1":void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalcosh1),tanh:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evaltanh),"tanh-1":void 0===t?null:e.buildUnaryOperatorCommand(t,t.evaltanh1),"\u03c0":void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalPI),"1/x":void 0===t?null:e.buildUnaryOperatorCommand(t,t.eval1perx),x2:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalx2),x3:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalx3),yx:void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalViaExpressionEvaluator),"2x":void 0===t?null:e.buildUnaryOperatorCommand(t,t.eval2x),ex:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalex),operandyx:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evaloperandyx),operandex:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evaloperandex),"2\u221a":void 0===t?null:e.buildUnaryOperatorCommand(t,t.eval2root),"3\u221a":void 0===t?null:e.buildUnaryOperatorCommand(t,t.eval3root),"x\u221ay":void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalViaExpressionEvaluator),"operandx\u221ay":void 0===t?null:e.buildUnaryOperatorCommand(t,t.evaloperandxrooty),"x!":void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalfactorial),ln:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalln),log:void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalViaExpressionEvaluator),log2:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evallog2),log10:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evallog10),operandlog:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evaloperandlog),Rand:void 0===t?null:e.buildUnaryOperatorCommand(t,t.evalRandom),"(":void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalLeftBracket),")":void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalRightBracket),"\xd7":void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalViaExpressionEvaluator),"\xf7":void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalViaExpressionEvaluator),"+":void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalViaExpressionEvaluator),"\u2013":void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalViaExpressionEvaluator),"+/\u2013":void 0===t?null:t.evalPlusMinus,"=":void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalEquals),0:void 0===t?null:t.evalOperation(t.evalDigitOrDecimalPoint),1:void 0===t?null:t.evalOperation(t.evalDigitOrDecimalPoint),2:void 0===t?null:t.evalOperation(t.evalDigitOrDecimalPoint),3:void 0===t?null:t.evalOperation(t.evalDigitOrDecimalPoint),4:void 0===t?null:t.evalOperation(t.evalDigitOrDecimalPoint),5:void 0===t?null:t.evalOperation(t.evalDigitOrDecimalPoint),6:void 0===t?null:t.evalOperation(t.evalDigitOrDecimalPoint),7:void 0===t?null:t.evalOperation(t.evalDigitOrDecimalPoint),8:void 0===t?null:t.evalOperation(t.evalDigitOrDecimalPoint),9:void 0===t?null:t.evalOperation(t.evalDigitOrDecimalPoint),".":void 0===t?null:t.evalDecimalPoint,mc:void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalMClear),ms:void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalMSave),"m+":void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalMAdd),"m-":void 0===t?null:e.buildBinaryOperatorCommand(t,t.evalMMinus),mr:void 0===t?null:t.evalOperation(t.evalMRead),AC:void 0===t?null:t.evalOperation(t.evalAC),C:void 0===t?null:t.evalOperation(t.evalC),back:void 0===t?null:t.evalOperation(t.evalBackspace)}}},{key:"buildUnaryOperatorCommand",value:function(e,t){return e.evalEndOfTerm(e.evalShouldResetHistoryIfDigitOnNextKey(e.evalOperation(t)))}},{key:"buildBinaryOperatorCommand",value:function(e,t){return e.evalEndOfTerm(e.evalOperation(t))}}]),e}();Xn.getSupportedOperations=function(){return Object.keys(Xn.buildHardcodedCommandsList(void 0))};var Zn=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"lookupForOperation",value:function(t,n){for(var a,r=n.split("|"),i=0,o=r.length;i<o;i+=2)if(t===r[i]){a=r[i+1];break}return e.isSupportedOperation(a)?a:void 0}}]),e}();Zn.fromKeyStrokeToCalculatorSupportedOperation=function(e){var t=Zn.isSupportedOperation(e)?e:void 0;return t||(t=Zn.lookupForOperation(e,"+|+|=|=|,|.|-|\u2013|/|\xf7|*|\xd7|#|+/\u2013|x|x!|E|EE|e|ex| |2nd|r|x\u221ay|R|2\u221a|^|yx|'|yx|\"|yx|m|mr|v|mc|b|m+|n|m-|s|sin|c|cos|t|tan|S|sin-1|C|cos-1|T|tan-1|l|ln|L|log|\\|1/x|X|2x|Enter|=|Backspace|back|0|0|1|1|2|2|3|3|4|4|5|5|6|6|7|7|8|8|9|9|0|0")),t},Zn.fromStatemachineToCalculatorSupportedOperation=function(e){return Zn.lookupForOperation(e,"clear|C|clearall|AC|equals|=|add|+|subtract|\u2013|multiply|\xd7|divide|\xf7|power|operandyx|npower|yx|root|operandx\u221ay|nroot|x\u221ay|sin|sin|cos|cos|tan|tan|csc|csc|sec|sec|cot|cot|e|ex|exp|operandex|ln|ln|log|operandlog|invmult|1/x|invpower|log|leftbr|(|rightbr|)|fact|x!|mclear|mc|mread|mr|msave|ms|madd|m+|msubtract|m-")},Zn.isSupportedOperation=function(e){return Xn.getSupportedOperations().includes(e)},Zn.isDigitKey=function(e){return-1!=="0123456789".indexOf(e)};var Qn=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,null,[{key:"limitFractionalDigits",value:function(t,n){var a=e.splitValue(t);if(void 0===a.fractionalPart)return t;var r=e.calculateTargetDigitCount(n,void 0!==a.exponentPart),i=e.roundFractionalDigits(a.fractionalPart,r),o=i.digits,s=i.overflow,c=+a.integralPart+(s?1:0),l=""!==o?".".concat(o):"",u=void 0===a.exponentPart?"":"e".concat(a.exponentPart);return"".concat(a.sign).concat(c).concat(l).concat(u)}},{key:"splitValue",value:function(e){if(void 0===e||null===e)return{};var t=e.split("."),n=Object(L.a)(t,2),a=n[0],r=n[1],i="-"===a[0]?"-":"",o=a.replace(/^-/,""),s=r?r.split("e"):[r,void 0],c=Object(L.a)(s,2);return{sign:i,integralPart:o,fractionalPart:c[0],exponentPart:c[1]}}},{key:"calculateTargetDigitCount",value:function(e,t){return e?15:t?6:8}},{key:"roundFractionalDigits",value:function(e,t){if(t>e.length)return{digits:e,overflow:!1};var n=(+"1.".concat(e)).toPrecision(t+1).toString(),a=n>=2;return{digits:a?"":n.substr(2).padEnd(t,"0"),overflow:a}}}]),e}();Qn.msg={errorMessage:"Err",nroot:"nroot"},Qn.render=function(e,t,n,a){var r=Jn.isBigger(t);if(e.match(/NaN|Inf|Error/))return Qn.msg.errorMessage;var i=e.match(/\.$/),o=i?e.substring(0,e.length-1):e;if(0===o.length)return e;var s=Qn.shortenValue(o,r);return function(e,t,n,a){if(null===e||void 0===e)return e;var r=e.toString().split(".");return t&&(r[0]=r[0].replace(/\B(?=(\d{3})+(?!\d))/g,a.grouping)),"".concat(r.join(a.decimal)).concat(n?a.decimal:"")}(Qn.limitFractionalDigits(s,r),n,i,a)},Qn.shortenValue=function(e,t){var n=Math.abs(+e);return!t&&n>=1e10?(+e).toExponential(8).toString():n>=1e16?(+e).toExponential(13).toString():e};var $n=function e(t,n,r){var i=this;Object(a.a)(this,e),this.calcSettings=function(e,t,n){i.displayWidth=e,i.withThousandSeparator=t,i.format=n},this.getFullState=function(){var e={};return e.historyEntries=z.deepCopy(i.historyEntries),e.displayWidth=i.displayWidth,e.withThousandSeparator=i.withThousandSeparator,e.format=z.deepCopy(i.format),e},this.restoreState=function(e){i.historyEntries=e.historyEntries,i.displayWidth=e.displayWidth,i.withThousandSeparator=e.withThousandSeparator,i.format=e.format},this.render=function(e,t,n){return i.pushToHistory(e,t,n),i.recalculateHistoryString()},this.pushToHistory=function(e,t,n){i.isKeyAC(e)?i.pushToHistoryAC(e,t):i.isKeyC(e)?i.pushToHistoryC(e,t):i.isKeyOneOperatorAfterAnotherOperator(e)?i.pushToHistoryOneOperatorAfterAnotherOperator(e,t):i.isKeyBackspace(e,t)?i.pushToHistoryBackspace():i.isKeyEquals(e)?i.pushKeyToHistoryEquals(e,t):e.match(/2nd|Degree|Radian|m/)||(i.isKeyUsingOperand(n)?(i.pushToHistoryKey("operand".concat(n),t),i.pushToHistoryKey(e,t)):i.pushToHistoryKey(e,t))},this.pushToHistoryOneOperatorAfterAnotherOperator=function(e,t){i.historyEntries[i.historyEntries.length-1]=e},this.pushToHistoryBackspace=function(e,t){var n=i.historyEntries.length,a=n>0?i.historyEntries[n-1]:void 0;void 0!==a&&a.match(/^(\.|\d|\(|\))/)&&(i.historyEntries.pop(),"."===i.historyEntries[i.historyEntries.length-1]&&i.historyEntries.pop())},this.pushKeyToHistoryEquals=function(e,t){i.historyEntries=["=".concat(t)]},this.pushToHistoryAC=function(e,t){i.historyEntries=[]},this.pushToHistoryC=function(e,t){for(var n=i.historyEntries.pop();void 0!==n&&n.match(/\d/);)n=i.historyEntries.pop();void 0!==n&&i.historyEntries.push(n)},this.pushToHistoryKey=function(e,t){i.handleCaseOfEqualsFollowedByAnOperationOrByAnOperand(e),i.historyEntries.push(e)},this.handleCaseOfEqualsFollowedByAnOperationOrByAnOperand=function(e){var t=i.historyEntries[i.historyEntries.length-1];void 0!==t&&t.match(/^=-?\d/)&&(Number.isNaN(Number(e))?i.historyEntries[i.historyEntries.length-1]=t.substring(1):i.historyEntries=[])},this.isKeyC=function(e){return"C"===e},this.isKeyAC=function(e){return"AC"===e},this.isKeyOneOperatorAfterAnotherOperator=function(e){var t=i.historyEntries.length,n=t>0?i.historyEntries[t-1]:void 0;return void 0!==n&&n.match(/^(\+|\u2013|\xf7|\xd7|yx|log|x\u221ay|E)+$/)&&e.match(/^(\+|\u2013|\xf7|\xd7|yx|log|x\u221ay|E)+$/)},this.isKeyBackspace=function(e){return"back"===e},this.isKeyEquals=function(e){return"="===e},this.isKeyUsingOperand=function(e){return void 0!==e},this.recalculateHistoryString=function(){var e="",t=0,n=[];return i.historyEntries.forEach(function(a){"+"===(a=a.replace("\xf7","/").replace("-","\u2013"))||"\xd7"===a||"/"===a||"\u2013"===a?(e+=i.recalculateHistoryForStackBetweenOperators(n),e+=a,n=[]):"("===a?(t+=1,n.push(a)):")"===a?t>0&&(t-=1,n.push(a)):a.startsWith("=")?n.push(a.substring(1)):n.push(a)}),e+=i.recalculateHistoryForStackBetweenOperators(n),e=i.formatAllNumbers(e)},this.recalculateHistoryForStackBetweenOperators=function(e){for(var t="",n=0;n<e.length;n+=1){var a=e[n];"ex"===a?t="e^(".concat(t,")"):"ln"===a?t="ln(".concat(t,")"):"x3"===a?t="".concat(t,"^3"):"x2"===a?t="".concat(t,"^2"):"yx"===a?t="".concat(t,"^"):"x\u221ay"===a?t="".concat(t," ").concat(Qn.msg.nroot," "):"3\u221a"===a?t="".concat(t," ").concat(Qn.msg.nroot," 3"):"2\u221a"===a?t="".concat(t," ").concat(Qn.msg.nroot," 2"):"x!"===a?t="".concat(t,"!"):"+/\u2013"===a?t=t.startsWith("-")?t.substring(1):"-".concat(t):"1/x"===a?t="1/".concat(t):"sin"===a||"csc"===a||"cos"===a||"sec"===a||"tan"===a||"cot"===a||"sin\u20131"===a||"cos\u20131"===a||"tan\u20131"===a?t="".concat(a,"(").concat(t,")"):"operandlog"===a?t="".concat(t,"log").concat(i.getOperandValue(e,n)):"operandyx"===a?t="".concat(t,"^").concat(i.getOperandValue(e,n)):"operandx\u221ay"===a?t="".concat(t," ").concat(Qn.msg.nroot," ").concat(i.getOperandValue(e,n)):"operandex"===a?t="".concat(i.getOperandValue(e,n),"^(").concat(t,")"):a.startsWith("operand")||(t+=a)}return t},this.getOperandValue=function(e,t){var n=t>0?e[t-1]:"";return(n=n.startsWith("operand")?n:"").substring("operand".length)},this.numberDetectorRegEx=new RegExp("([0-9]+\\.?[0-9]*)","g"),this.formatAllNumbers=function(e){return e.replace(i.numberDetectorRegEx,function(e,t){return Qn.render(t,i.displayWidth,i.withThousandSeparator,i.format)})},this.displayWidth=t,this.withThousandSeparator=n,this.format=r,this.historyEntries=[]},ea=function e(t,n){var r=this;Object(a.a)(this,e),this.getFullState=function(){var e={};return e.evaluator=z.deepCopy(r.evaluator.getFullState()),e.historyRenderer=z.deepCopy(r.historyRenderer.getFullState()),e.settings=z.deepCopy(r.settings),e.displayingValue=r.displayingValue,e.historyDisplayingValue=r.historyDisplayingValue,e},this.restoreState=function(e){r.evaluator.restoreState(e.evaluator),r.historyRenderer.restoreState(e.historyRenderer),r.settings=e.settings,r.displayingValue=e.displayingValue,r.historyDisplayingValue=e.historyDisplayingValue},this.calcGetMem=function(e){return r.evaluator.getMem(e)},this.calcOp=function(e,t){var n=Zn.fromStatemachineToCalculatorSupportedOperation(e);n&&r.evalKey(n,t)},this.calcOpnd=function(e,t){switch(e){case"add":for(var n=0,a=(t="".concat(t)).length;n<a;n+=1)r.evalKey(t.charAt(n));break;case"decimal":r.evalKey(".");break;case"back":r.evalKey("back");break;case"invadd":r.evalKey("+/\u2013")}},this.calcSettings=function(e){r.settings=Object.assign(r.settings,e),r.historyRenderer.calcSettings(r.settings.displayWidth,r.settings.withThousandSeparator,r.settings.format),r.evaluator.setConfiguration(r.settings.displayWidth,r.settings.angle,r.settings.silentOnErrors)},this.keypress=function(e){var t=Zn.fromKeyStrokeToCalculatorSupportedOperation(e);t&&r.evalKey(t)},this.paste=function(e){var t=r.evaluator.paste(e);r.triggerRendering(t)},this.evalKey=function(e,t){var n=r.evaluator.evalKey(e,t);r.triggerRendering(n)},this.triggerRendering=function(e){e.render.forEach(function(e){return r.render(e)}),e.history.forEach(function(e){return r.renderHistory(e)})},this.render=function(e){r.displayingValue=void 0===e?void 0:Qn.render(e,r.settings.displayWidth,r.settings.withThousandSeparator,r.settings.format),r.runtime.componentDirectory.findByComponentType(Jt).forEach(function(e){Jt.setDisplayValueInState(e,r.displayingValue),Q.triggerRendering(e)})},this.renderHistory=function(e){var t=e.key,n=e.value,a=e.operand;r.historyDisplayingValue=r.historyRenderer.render(t,n,a),(!Zn.isDigitKey(t)||Zn.isDigitKey(t)&&r.settings.includeOperandInHistory)&&r.triggerHistoryRendering(r.historyDisplayingValue)},this.triggerHistoryRendering=function(e){r.runtime.componentDirectory.findByComponentType(_t).forEach(function(t){_t.setDisplayValueInState(t,e),Q.triggerRendering(t)})},this.getTaskPath=function(){return r.taskPath},this.taskPath=t,this.runtime=n,this.settings={angle:Jn.ANGLE_DEGREE,displayWidth:10,includeOperandInHistory:!0,withThousandSeparator:!0,scale:0,format:lt.EN,silentOnErrors:!0},this.evaluator=new Xn(this.settings.displayWidth,this.settings.angle),this.historyRenderer=new $n(this.settings.displayWidth,this.settings.withThousandSeparator,this.settings.format),this.displayingValue="0",this.historyDisplayingValue=void 0},ta=function e(){var t=this;Object(a.a)(this,e),this.setOrInitializeCurrentCalculator=function(e,n){t.currentCalculator=new ea(e,n),t.runtime=n,t.restoreState(t.calculatorsStateList[e])},this.getHistoryDisplayingValue=function(){return t.safeCall(function(){return t.currentCalculator.historyDisplayingValue})},this.getDisplayingValue=function(){return t.safeCall(function(){return t.currentCalculator.displayingValue})},this.calcGetMem=function(e){return t.safeCall(function(){return t.currentCalculator.calcGetMem(e)})},this.calcOp=function(e,n){return t.safeCall(function(){return t.currentCalculator.calcOp(e,n)})},this.calcOpnd=function(e,n){return t.safeCall(function(){return t.currentCalculator.calcOpnd(e,n)})},this.calcSettings=function(e){return t.safeCall(function(){return t.currentCalculator.calcSettings(e)})},this.keypress=function(e){return t.safeCall(function(){return t.currentCalculator.keypress(e)})},this.paste=function(e){return t.safeCall(function(){return t.currentCalculator.paste(e)})},this.getStateForTask=function(e){return t.calculatorsStateList[e]},this.getAllTasksState=function(){return z.deepCopy(t.calculatorsStateList)},this.clearTasksState=function(){t.calculatorsStateList={},t.currentCalculator=void 0},this.preloadTasksState=function(e){t.calculatorsStateList=z.deepCopy(e)},this.injectStateChangeAtReplay=function(e,n){t.calculatorsStateList[e]=n,void 0!==t.currentCalculator&&t.currentCalculator.getTaskPath()===e&&t.currentCalculator.restoreState(n)},this.safeCall=function(e){if(void 0!==t.currentCalculator){var n=e();return t.saveState(),n}},this.saveState=function(){if(void 0!==t.currentCalculator){var e=t.currentCalculator.taskPath,n=t.currentCalculator.getFullState();t.calculatorsStateList[e]=n,Z.dumpStateChangeToTrace("CalculatorState",{taskPath:e,state:n},t.runtime.traceLogBuffer)}},this.restoreState=function(e){void 0!==t.currentCalculator&&void 0!==e&&t.currentCalculator.restoreState(e)},this.calculatorsStateList={},this.currentCalculator=void 0,this.runtime=void 0},na=(n(783),function e(){var t=this;Object(a.a)(this,e),this.registerAction=function(e,n){var a=[];t.actionsMap.has(e)&&(a=t.actionsMap.get(e)),a.push(n),t.actionsMap.set(e,a)},this.hasActionsRegisteredForPath=function(e){return t.actionsMap.has(e)&&0!==t.actionsMap.get(e).length},this.getRegisteredActionsForPath=function(e){return t.actionsMap.get(e)},this.clearRegisteredActionsForPath=function(e){return t.actionsMap.delete(e)},this.actionsMap=new Map}),aa=function e(){var t=this;Object(a.a)(this,e),this.registerFocus=function(e){t.focusMap.set(e,!0)},this.hasActionsRegisteredForPath=function(e){return t.focusMap.has(e)&&t.focusMap.get(e)},this.focusMap=new Map},ra=n(786),ia={position:"fixed",pointerEvents:"none",zIndex:100,left:0,top:0,width:"100%",height:"100%"};function oa(e,t){if(!e||!t)return{display:"none"};var n=t.x,a=t.y,r="translate(".concat(n,"px, ").concat(a,"px)");return{transform:r,WebkitTransform:r}}var sa=function(e){var t=e.runtime,n=Object(ra.a)(function(e){return{item:e.getItem(),itemType:e.getItemType(),initialOffset:e.getInitialSourceClientOffset(),currentOffset:e.getSourceClientOffset(),isDragging:e.isDragging()}}),a=n.itemType,r=n.isDragging,i=n.item,o=n.initialOffset,s=n.currentOffset;return r?v.a.createElement("div",{style:ia},v.a.createElement("div",{style:oa(o,s)},function(){switch(a){case kt.VALUE_DISPLAY:var e=t.app?t.app.state.scaleValue:1,n=d.safeDeepCopy(i.previewData.style),r=parseFloat(i.previewData.style.width)*e,o=parseFloat(i.previewData.style.height)*e,s=parseFloat(i.previewData.style.fontSize)*e,c=Object.assign(n,{width:r,height:o,fontSize:s,left:0,top:0});return v.a.createElement("textarea",{readOnly:!0,title:i.previewData.title,style:c,value:i.previewData.value,className:"hide-selection"});default:return v.a.createElement("div",null,"Dragging...")}}())):null},ca=function e(){var t=this;Object(a.a)(this,e),this.reportRecording=function(e,n,a,r,i,o){return new Promise(function(c,l){s.a.get(r,{responseType:"blob"}).then(function(r){var s=new FileReader;s.readAsDataURL(r.data),s.onloadend=function(){var r=s.result,l=i.test,u=i.item,d=i.task,g={recordingInfo:{sourceComponent:e,userDefinedIDPath:o,nbOfRecordingOnComponentInstance:a,recordingStartTime:n,test:l,item:u,task:d},data:r};t.recordingList.push(g),void 0!==t.newEntryListener&&t.newEntryListener(),c()}})})},this.popEntries=function(){var e=t.recordingList;return t.recordingList=[],e},this.peekEntries=function(){return z.deepCopy(t.recordingList)},this.setNewEntryListener=function(e){t.newEntryListener=e},this.recordingList=[],this.newEntryListener=void 0},la=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(E.a)(this,Object(x.a)(t).call(this,e,t.buildRecordingPostContent,"recording"))).transmitInterval=void 0,n.startAutomaticTransmissions(),n}return Object(I.a)(t,e),t}(Gn);la.buildRecordingPostContent=function(e,t,n){var a=t.sessionId,r=t.username,i=t.loginTimestamp;return void 0===a&&console.warn("Sending recording with dummy session id!"),{metaData:{userId:r,sessionId:void 0===a?"dummySessionId":a,loginTimestamp:i,sendTimestamp:e,cbaVers:d.getCbaVersion()},recordingEntriesList:n}};var ua=function(){function e(){Object(a.a)(this,e),this.librariesUsedMap={}}return Object(r.a)(e,[{key:"addLibrariesForItem",value:function(t,n){var a=this;!t||t&&!t.length>0||!n||n&&!Object.keys(n).length>0||e.checkLibraryPaths(t,n)&&t.forEach(function(e){switch(e.name){case"MathJax":a.addMathJax(n[e.name]);break;default:console.error("Unexpected library provied",e.name)}})}},{key:"addMathJax",value:function(e){if(!this.librariesUsedMap.MathJax){this.librariesUsedMap.MathJax=e;var t=document.createElement("script");t.setAttribute("src",e),t.setAttribute("async",!0),t.setAttribute("id","MathJax-script"),document.head.appendChild(t)}}}],[{key:"checkLibraryPaths",value:function(e,t){return e.map(function(e){return!!t[e.name]}).every(function(e){return!0===e})}}]),e}(),da=function(){function e(){var t=this;Object(a.a)(this,e),this.buildVariablesInfoArrayForTask=function(e){var n=t.variableMap[e],a=[];return n&&Object.keys(n).forEach(function(e){a.push(n[e])}),a},this.addVariableChangeObserver=function(e,n){void 0===t.variableObservers.find(function(t){return t.indexPath===e&&t.variableName===n})&&t.variableObservers.push({indexPath:e,variableName:n})},this.dropVariableChangeObserver=function(e,n){var a=t.variableObservers.findIndex(function(t){return t.indexPath===e&&t.variableName===n});void 0!==a&&t.variableObservers.splice(a,1)},this.dropChangeObserverForPath=function(e){var n=t.variableObservers.filter(function(t){return t.indexPath===e});void 0!==n&&n.length>0&&n.forEach(function(n){t.dropVariableChangeObserver(e,n.variableName)})},this.triggerRerenderForAllChangeObservers=function(e){t.variableObservers.forEach(function(t){Q.triggerRenderingViaPath(t.indexPath,e)})},this.clearAllChangeObservers=function(){t.variableObservers=[]},this.getAllTasksState=function(){return z.deepCopy(t.variableMap)},this.clearTasksState=function(){t.variableMap={},t.clearAllChangeObservers()},this.preloadTasksState=function(e){t.variableMap=z.deepCopy(e)},this.injectStateChangeAtReplay=function(e,n,a){t.variableMap[e]||(t.variableMap[e]={}),t.variableMap[e][n]=a},this.variableMap={},this.variableObservers=[],this.tracing=!1}return Object(r.a)(e,[{key:"initializeVariablesForTask",value:function(e,t,n,a){var r=this;t&&!this.variableMap[e]&&t.forEach(function(t){var n=t.name,i=t.value,o=t.type;r.setVariable(e,n,i,o,a)}),this.tracing=n}},{key:"getVariable",value:function(e,t,n){var a=this.variableMap[e];if(void 0!==a){var r=a[t];if(void 0!==r)return n?r:r.value}}},{key:"setVariable",value:function(e,t,n,a,r){this.variableMap[e]||(this.variableMap[e]={});var i=this.variableMap[e][t];if(i){if(!d.checkType(n,i.type))return console.error("Provided variable value is of the wrong type. Expected ".concat(i.type)),void this.traceVariableChangeAttempt(t,i.type,a,i.value,n,"valueWrongType",r);if(a&&a!==i.type)return console.error("Provided type is wrong. Expected ".concat(i.type)),void this.traceVariableChangeAttempt(t,i.type,a,i.value,n,"givenTypeNoMatch",r);var o=i.value;this.variableMap[e][t].value=n,this.traceVariableChangeAttempt(t,i.type,a,o,n,"ok",r)}else{if(!a)return console.error("Provided variable must have a type"),void this.traceVariableChangeAttempt(t,void 0,void 0,void 0,n,"typeMissing",r);if(!d.checkType(n,a))return console.error("Provided variable value has inconsistent type. Expected ".concat(a)),void this.traceVariableChangeAttempt(t,void 0,a,void 0,n,"typeInconsistent",r);var s={name:t,value:n,type:a};this.variableMap[e][t]=s}Z.dumpStateChangeToTrace("VariableManagerState",{taskPath:e,name:t,value:this.variableMap[e][t]},r.traceLogBuffer),this.variableObservers.filter(function(e){return e.variableName===t}).forEach(function(e){Q.triggerRenderingViaPath(e.indexPath,r)})}},{key:"traceVariableChangeAttempt",value:function(e,t,n,a,r,i,o){this.tracing&&o.traceLogBuffer.reportEvent("SetVariableValue",new Date,{variableName:e,variableType:t,newValueType:n,oldValue:"".concat(a),newValue:"".concat(r),operationStatus:i})}},{key:"getVariableValuesMapForTask",value:function(e,t){var n=this.variableMap[e],a={};return n&&Object.keys(n).forEach(function(e){a[e]=t?n[e]:n[e].value}),d.safeDeepCopy(a)}}]),e}(),ga=function(){function e(){var t=this;Object(a.a)(this,e),this.setNowProvider=function(e){t.nowProvider=e},this.setDelayProcessor=function(e){t.delayProcessor=e},this.replay=function(e,n,a,r,i,o,s){t.replayFromTaskStartingPoint(e,0,{settings:a,headerButtons:r,courseForNavigator:i,testsForNavigator:o},n,s)},this.replayFromTaskStartingPoint=function(n,a,r,i,o){var s=e.grabInitializingTriple(n,a);if(void 0!==s){var c=s.taskSwitchEntry,l=s.fullStateEntry,u=s.tasksViewVisibleEntry,d=s.stateChangeEntries,g=s.nextIndex,f=o.taskManager,p=o.app;f.preloadTasksState(l.details),d.forEach(function(t){var n=t.details,a=n.stateType,r=n.stateDelta;e.processStateChangeStep(a,r,o)});var h=c.details,v=h.newTest,m=h.newItem,y=h.newTask,b=r.settings,k=r.headerButtons,S=r.courseForNavigator,C=r.testsForNavigator;p.showReplay(v,m,y,b,k,S,C);var T=void 0===u.details.replayTick?0:u.details.replayTick,P=t.nowProvider();t.continueStoryExecution(n,g,T,P,function(e){return t.executeNextReplayStep(n,e,r,i,o)},i)}else console.info("Could not find task start for replay -> replay command aborted.")},this.continueStoryExecution=function(n,a,r,i,o,s){for(var c=a,l=n[c],u=e.calculateDelayMillisByNow(r,i,l,t.nowProvider);void 0!==l&&u<100;){if(o(c))return;l=n[c+=1],u=e.calculateDelayMillisByNow(r,i,l,t.nowProvider)}void 0!==l?t.delayProcessor(u,function(){t.continueStoryExecution(n,c,r,i,o,s)}):s()},this.nowProvider=function(){return Date.now()},this.delayProcessor=function(e,t){console.info("Replay step with delay: ".concat(e)),setTimeout(t,e)}}return Object(r.a)(e,[{key:"executeNextReplayStep",value:function(t,n,a,r,i){var o,s=t[n];switch(s.type){case"StateChange":var c=s.details,l=c.stateType,u=c.stateDelta;return e.processStateChangeStep(l,u,i),!1;case"FullState":return!1;case"RenderTriggered":var g=i.componentDirectory.findComponent(s.details.indexPath);return void 0!==g?Q.triggerRendering(g):(console.log("Component missing for rendering -> trigger render from top"),i.taskManager.handleTopLevelPageChange()),!1;case"TaskSwitch":return void 0===s.details.newTask?(i.app.showWaiting(),!1):(this.replayFromTaskStartingPoint(t,n,a,r,i),!0);case"ContextMenu":return s.details.shouldOpen?((o=new Event(s.details.event.type)).clientX=s.details.event.clientX,o.clientY=s.details.event.clientY,i.contextMenu.openMenuItemTree({entries:s.details.entries,event:o})):oe.closeMenuItemTree(),!1;case"ScrollTriggered":var f=i.componentDirectory.findComponent(s.details.path),p=s.details,h=p.scrollTop,v=p.scrollLeft;if(!f&&!f.containerRendererRef)return!1;for(var m=f.containerRendererRef.current;"hidden"===getComputedStyle(m).overflow;)if((m=m.parentElement)===document.body)return!1;return d.doScroll(h,v,m),!1;default:return!1}}}],[{key:"processStateChangeStep",value:function(e,t,n){switch(e){case"ComponentState":var a=t.pathId,r=t.state;n.componentStateManager.registerStateChangeFromSnapshot(a,r);break;case"PresenterStateManagerState":var i=t.taskPath,o=t.state;n.presenterStateManager.injectStateChangeAtReplay(i,o);break;case"TaskNavigatorStateManagerState":var s=t.name,c=t.value;n.taskNavigatorStateManager.injectStateChangeAtReplay(s,c);break;case"IncidentsAccumulatorState":var l=t.taskPath,u=t.state;n.incidentsAccumulator.injectStateChangeAtReplay(l,u);break;case"VariableManagerState":var d=t.taskPath,g=t.name,f=t.value;n.variableManager.injectStateChangeAtReplay(d,g,f);break;case"CalculatorState":var p=t.taskPath,h=t.state;n.calculatorsManager.injectStateChangeAtReplay(p,h);break;case"ClipboardState":var v=t.state;n.clipboardManager.injectStateChangeAtReplay(v);break;default:console.warn("Unknown StateChange replay step type ignored!")}}},{key:"calculateDelayMillisByNow",value:function(t,n,a,r){return void 0===a||void 0===a.replayTick?0:e.calculateDelayMillis(t,n,a.replayTick,r())}},{key:"calculateDelayMillis",value:function(e,t,n,a){return Math.max(0,n-e-(a-t))}},{key:"grabInitializingTriple",value:function(e,t){var n,a=!1;for(n=t;n<e.length&&!a;){var r=e[n];"TaskSwitch"===r.type&&void 0!==r.details.newTask?a=!0:n+=1}if(a){for(var i=e[n],o=e[n+=1];void 0!==o&&"StateChange"===o.type;)o=e[n+=1];if(void 0!==o&&"FullState"===o.type){var s=o,c=[];for(o=e[n+=1];void 0!==o&&"StateChange"===o.type;)c.push(o),o=e[n+=1];if(void 0!==o&&"TasksViewVisible"===o.type)return{taskSwitchEntry:i,fullStateEntry:s,tasksViewVisibleEntry:o,stateChangeEntries:c,nextIndex:n+1}}}}}]),e}(),fa=function e(){var t=this;Object(a.a)(this,e),this.incrementReplayStep=function(){t.currentReplayStepId+=1},this.getCurrentReplayStepId=function(){return t.currentReplayStepId},this.currentReplayStepId=0},pa=function(){function e(t,n){var r=this;Object(a.a)(this,e),this.runPlayer=function(){d.printCbaVersion(),r.apiState="notLoggedIn";var e=r.runtime,t=d.isTouchDevice(),n=d.getWaitingMessageTexts();y.a.render(v.a.createElement(P.a,{backend:t?T.a:C.a,options:t?{enableMouseEvents:!0}:{}},v.a.createElement(Pn,{runtime:e,waitingMessageTexts:n}),v.a.createElement(sa,{runtime:e})),document.getElementById("root"))},this.sendPlayerReady=function(){r.checkNotRunning&&r.runtime.postMessageReceiver.sendTaskPlayerReadyEvent(r.eventDomainUri,r.eventTargetWindow)},this.setWaitMessages=function(e,t){r.checkNotLoggedInOrNoTaskRunning("waitMessages")&&r.runtime.app.setWaitingMessageTexts({primary:e,secondary:t})},this.addItem=function(t,n,a,i){if(r.checkNotLoggedInOrNoTaskRunning("addItem")){var o=t.runtimeCompatibilityVersion;e.isCompatibleVersion(o)?(r.runtime.taskManager.addItem(t,n,a),r.runtime.libraryManager.addLibrariesForItem(t.dependencies,i)):console.info("Ignored item ".concat(t.name," with incompatible version: ").concat(o))}},this.clearItems=function(){r.checkNotLoggedInOrNoTaskRunning("clearItems")&&r.runtime.taskManager.clearItems()},this.setScalingConfiguration=function(e){if(r.checkNotLoggedInOrNoTaskRunning("scalingConfiguration")){var t=e.scalingMode,n=e.alignmentHorizontal,a=e.alignmentVertical,i=["no-scaling","scale-up","scale-down","scale-up-down"],o=["left","right","center"],s=["top","bottom","center"];i.includes(t)||(console.log("scalingConfiguration not correct, scalingMode must be one of: ",i),t=i[0]),o.includes(n)||(console.log("scalingConfiguration not correct, alignmentHorizontal must be one of: ",o),n=o[0]),s.includes(a)||(console.log("scalingConfiguration not correct, alignmentVertical must be one of: ",s),a=s[0]),r.runtime.app.setScalingConfig({scalingMode:t,alignmentHorizontal:n,alignmentVertical:a})}},this.setPreload=function(e){return r.checkNotLoggedInOrNoTaskRunning("setPreload")?r.preloadItemResources(e):void 0},this.insertMessageInTrace=function(t){r.checkNoTaskRunningOrTaskRunning("insertMessageInTrace")&&e.dumpMessageToTraceLog(t,r.runtime.traceLogBuffer)},this.logStateToTrace=function(){r.checkNoTaskRunningOrTaskRunning("logStateToTrace")&&Z.dumpSnapshotToTrace(r.runtime)},this.flushTrace=function(){r.checkNoTaskRunningOrTaskRunning("flushTrace")&&r.runtime.traceLogUploader.collectEntriesAndTriggerTransmission()},this.setCallbackTraceTransmission=function(e,t){r.checkNotLoggedIn("setCallbackTraceTransmission")&&r.runtime.traceLogUploader.setCallbackTransmissionChannel(e,t)},this.setHttpTraceTransmission=function(e,t,n){r.checkNotLoggedIn("setHttpTraceTransmission")&&r.runtime.traceLogUploader.setHttpTransmissionChannel(e,t,n)},this.setConsoleTraceTransmission=function(e){r.checkNotLoggedIn("setConsoleTraceTransmission")&&r.runtime.traceLogUploader.setConsoleTransmissionChannel(e)},this.setTraceContextId=function(e){if(r.checkNotLoggedInOrNoTaskRunning("setTraceContextId")){var t=r.runtime,n=t.traceLogUploader,a=t.traceLogBuffer,i=n.getSessionContext(),o=i.username,s=i.loginTimestamp;n.setSessionContext(e,o,s),a.setTraceContextId(e)}},this.setTraceContentFilter=function(e,t,n,a,i){if(r.checkNotLoggedInOrNoTaskRunning("setTraceContentFilter")){var o=r.runtime.traceLogBuffer;o.setWithReplaySupport(e),o.setWithExtendedMetaData(t),o.setWithoutItemConfiguration(n),o.setWithoutSnapshot(a),o.setWithoutScoring(i)}},this.setCallbackRecordingTransmission=function(e){r.checkNotLoggedIn("setCallbackRecordingTransmission")&&r.runtime.recordingUploader.setCallbackTransmissionChannel(e,void 0)},this.setHttpRecordingTransmission=function(e,t){r.checkNotLoggedIn("setHttpRecordingTransmission")&&r.runtime.recordingUploader.setHttpTransmissionChannel(e,void 0,t)},this.setConsoleRecordingTransmission=function(){r.checkNotLoggedIn("setConsoleRecordingTransmission")&&r.runtime.recordingUploader.setConsoleTransmissionChannel(void 0)},this.setRecordingContextId=function(e){if(r.checkNotLoggedInOrNoTaskRunning("setRecordingContextId")){var t=r.runtime.recordingUploader,n=t.getSessionContext(),a=n.username,i=n.loginTimestamp;t.setSessionContext(e,a,i)}},this.setUserId=function(t){if(r.checkNotLoggedIn("setUserId")){var n=S()().format(),a=r.runtime,i=a.traceLogUploader,o=a.recordingUploader,s=a.traceLogBuffer,c=i.getSessionContext().sessionId;i.setSessionContext(c,t,n);var l=o.getSessionContext().sessionId;o.setSessionContext(l,t,n),e.dumpLoginToTraceLog(t,n,s),r.apiState="noTaskRunning"}},this.logout=function(){if(r.checkNoTaskRunning("logout")){var e=r.runtime,t=e.traceLogUploader,n=e.componentStateManager;t.collectEntriesAndTriggerTransmission();var a=t.getSessionContext().sessionId;t.setSessionContext(a,void 0,void 0),n.clear(),r.apiState="notLoggedIn"}},this.getUserId=function(){return"notLoggedIn"===r.apiState?void 0:r.runtime.traceLogUploader.getSessionContext().username},this.showLogin=function(e,t,n,a){r.checkNotLoggedInOrNoTaskRunning("showLogin")&&r.runtime.app.showLogin(e,t,n,a)},this.startTask=function(e,t,n){r.checkNoTaskRunning("startTask")&&(r.runtime.app.showTask(e,t,n,r.settings,r.headerButtons,r.courseForNavigator,r.testsForNavigator),r.apiState="taskRunning")},this.stopTask=function(){r.checkTaskRunning("stopTask")&&(r.runtime.app.showWaiting(),r.apiState="noTaskRunning")},this.pauseTask=function(){r.checkTaskRunning("pauseTask")&&e.pauseOrResume(!0,r.runtime)},this.resumeTask=function(){r.checkTaskRunning("resumeTask")&&e.pauseOrResume(!1,r.runtime)},this.getTask=function(){if("taskRunning"===r.apiState){var e=r.runtime.taskManager.getCurrentTestTaskItemNames();return{scope:e.test,item:e.item,task:e.task}}},this.setTaskSequencer=function(e,t){if(r.checkNoTaskRunning("setTaskSequencer")){var n=r.runtime.taskManager;n.setSwitchCallback(e),n.setAvailabilityCallback(t)}},this.getTasksState=function(){return r.checkNoTaskRunningOrTaskRunning("getTasksState")?r.runtime.taskManager.getAllTasksState():void 0},this.clearTasksState=function(){r.checkNoTaskRunning("clearTasksState")&&r.runtime.taskManager.clearTasksState()},this.preloadTasksState=function(e){r.checkNoTaskRunning("preloadTasksState")&&(r.runtime.taskManager.preloadTasksState(e),Z.dumpSnapshotToTrace(r.runtime))},this.replay=function(e){r.checkNoTaskRunning("replay")&&(r.apiState="taskRunning",(new ga).replay(e,function(){r.apiState=void 0===r.runtime.taskManager.getCurrentTestTaskItemNames().task?"noTaskRunning":"taskRunning",console.info("Replay finished. API state now is ".concat(r.apiState))},r.settings,r.headerButtons,r.courseForNavigator,r.testsForNavigator,r.runtime))},this.getScoringResult=function(){return r.checkTaskRunning("getScoringResult")?r.runtime.taskManager.getCurrentTaskResults():void 0},this.getOldScoringResult=function(e,t,n){return r.checkNoTaskRunning("getOldScoringResult")?r.runtime.taskManager.getOldTaskResults(n,t,e):void 0},this.sendStatemachineEvent=function(t){if(r.checkTaskRunning("sendStatemachineEvent")){var n=r.runtime,a=n.statemachinesManager,i=n.traceLogBuffer;e.dumpStatemachineEventToTraceLog(t,i),a.triggerEvent(t)}},this.setHeaderButtons=function(e){r.checkNotLoggedInOrNoTaskRunning("setHeaderButtons")&&(r.headerButtons=e)},this.setMenuCarousels=function(e,t){r.checkNotLoggedInOrNoTaskRunning("setMenuCarousels")&&(r.settings.ShowTaskNavigationBars=e.length>0,r.courseForNavigator=e,r.testsForNavigator=t.map(function(e){return{name:e.name,taskCourse:e.tasks}}))},this.activateDebuggingWindows=function(t,n,a){r.checkNotLoggedInOrNoTaskRunning("activateDebuggingWindows")&&(r.settings.debugScoreHotKey=e.normalizeHotKeySpecification(t,"scoring"),r.settings.debugTraceHotKey=e.normalizeHotKeySpecification(n,"trace"),r.settings.debugStatemachineHotKey=e.normalizeHotKeySpecification(a,"state machine"))},this.checkNotRunning=function(e){return r.checkApiState(["appNotRunning"],e)},this.checkNotLoggedIn=function(e){return r.checkApiState(["notLoggedIn"],e)},this.checkNoTaskRunning=function(e){return r.checkApiState(["noTaskRunning"],e)},this.checkTaskRunning=function(e){return r.checkApiState(["taskRunning"],e)},this.checkNotLoggedInOrNoTaskRunning=function(e){return r.checkApiState(["notLoggedIn","noTaskRunning"],e)},this.checkNoTaskRunningOrTaskRunning=function(e){return r.checkApiState(["noTaskRunning","taskRunning"],e)},this.checkApiState=function(e,t){var n=e.includes(r.apiState);return n||console.info("TaskPlayer API call ".concat(t," denied in state ").concat(r.apiState)),n},this.preloadItemResources=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,a){console.log("Starting preload for item",e);if(!(t=Object.assign({image:!0,video:!0,audio:!0},t)).image&&!t.video&&!t.audio)return a("Wrong config? If no preload is required, a call to this function is not required.");var i=r.runtime.taskManager.getItemResources(e);if(!i||0===i.length)return a("No resources to preload");var o,s,c;if(t.image){var l=i.filter(function(e){return"image"===e.type});o=g.preloadResources(l,"image")}if(t.video){var u=i.filter(function(e){return"video"===e.type});s=g.preloadResources(u,"video")}if(t.audio){var d=i.filter(function(e){return"audio"===e.type});c=g.preloadResources(d,"audio")}return n(Promise.all([o,s,c]))})},this.runtime=e.buildRuntime(),this.runtime.postMessageReceiver.startReceiving(this.runtime,this),this.eventTargetWindow=void 0===t?"self":t,this.eventDomainUri=void 0===n?d.getCallingUrlWithoutPath():n,this.apiState="appNotRunning",this.settings={debugScoreHotKey:void 0,debugTraceHotKey:void 0,debugStatemachineHotKey:void 0,ShowTaskNavigationBars:!1},this.headerButtons=[],this.courseForNavigator=[],this.testsForNavigator=[]}return Object(r.a)(e,null,[{key:"buildRuntime",value:function(){var e=new Wn,t=new ca,n={componentStateManager:new En,componentDirectory:new xn,incidentsAccumulator:new In,taskResultsManager:new An,statemachinesManager:new Bn,presenterStateManager:new Rn,taskNavigatorStateManager:new Hn,traceLogBuffer:e,traceLogUploader:new zn(e),recordingBuffer:t,recordingUploader:new la(t),eventEmitter:new b.EventEmitter,clipboardManager:new Kn(e),postMessageReceiver:new _n,calculatorsManager:new ta,actionRegister:new na,focusRegister:new aa,libraryManager:new ua,variableManager:new da,replayStepMonitor:new fa};return n.recommendationsManager=new _(n),n.taskManager=new Nn(n),n}},{key:"normalizeHotKeySpecification",value:function(e,t){if(void 0!==e&&""!==e){var n=e.startsWith("ctrl+")?e.substring(5):e;if(1===(n.startsWith("shift+")?n.substring(6):n).length)return e;console.error("Invalid hot key for ".concat(t," debugging window ignored: ").concat(e))}}},{key:"dumpLoginToTraceLog",value:function(e,t,n){n.reportEvent("UserLogin",new Date,{user:e,loginTimestamp:t,runtimeVersion:d.getCbaVersion(),webClientUserAgent:window.navigator.userAgent})}},{key:"dumpMessageToTraceLog",value:function(e,t){t.reportEvent("RuntimeController",new Date,{actionType:"insertMessageInTrace",details:e})}},{key:"dumpStatemachineEventToTraceLog",value:function(e,t){t.reportEvent("RuntimeController",new Date,{actionType:"sendStatemachineEvent",details:e})}},{key:"dumpPauseResumeToTraceLog",value:function(e,t){t.reportEvent("PauseResume",new Date,{type:!0===e?"pause":"resume"})}},{key:"isCompatibleVersion",value:function(e){return e===d.getCbaVersionNumber()}},{key:"pauseOrResume",value:function(t,n){var a=n.testPresenter,r=n.traceLogBuffer,o=n.incidentsAccumulator,s=n.statemachinesManager,c=n.taskManager;e.dumpPauseResumeToTraceLog(t,r),null!==a&&(t?a.pause():a.resume());var l=(new Date).getTime();t?(o.pauseTask(l),s.pauseCurrentStatemachine()):(o.resumeTask(l),s.resumeCurrentStatemachine());var u=c.getCurrentPageNames(),d=u.standardPage,g=u.xPage;[].concat(Object(i.a)(n.componentDirectory.findComponentsByPageName(d)),Object(i.a)(n.componentDirectory.findComponentsByPageName(g))).forEach(function(e){e.handleTaskPauseOrResume&&e.handleTaskPauseOrResume(t)})}}]),e}();function ha(e){e.sendPlayerReady(),e.runPlayer()}!function(){var e=d.getEventReceiverConfiguration(),t=new pa(e.eventTargetWindow,e.eventDomainUri);!function(){var e="external-controller"===d.getControllerMode();return e&&console.log("Wait for external controller to take over..."),!e}()?e.startTaskPlayerEvent?window.addEventListener(e.startTaskPlayerEvent,function(e){ha(t)}):ha(t):(new p).runController(t)}()}},[[332,1,2]]]);
//# sourceMappingURL=main.b6285a4a.chunk.js.map