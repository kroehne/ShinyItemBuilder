<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Use Custom `end`-Function to Provide Immediate Feedback using Knitr â€¢ ShinyItemBuilder</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use Custom `end`-Function to Provide Immediate Feedback using Knitr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ShinyItemBuilder</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/access.html">Use Custom `end`- and `login` - Functions to Controll Access</a></li>
    <li><a class="dropdown-item" href="../articles/booklets.html">Use Custom `navigation`-Function to Implement a Booklet Design</a></li>
    <li><a class="dropdown-item" href="../articles/cat_with_catR.html">Use `catR`-Package for Adaptive Testing</a></li>
    <li><a class="dropdown-item" href="../articles/datastorage.html">Options for Persistent Data Storage</a></li>
    <li><a class="dropdown-item" href="../articles/feedback.html">Use Custom `end`-Function to Provide Immediate Feedback using Knitr</a></li>
    <li><a class="dropdown-item" href="../articles/inspect_log_events.html">Use Custom `trace`-Functions to Inspect Log Events</a></li>
    <li><a class="dropdown-item" href="../articles/maintenance.html">Use the Maintenance Dialog to Access Data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Use Custom `end`-Function to Provide Immediate Feedback using Knitr</h1>
            
      

      <div class="d-none name"><code>feedback.Rmd</code></div>
    </div>

    
    
<p>This example shows how to use the package
<code>ShinyItemBuilder</code> to display a feedback after an
assessment.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ShinyItemBuilder</span><span class="op">)</span></span></code></pre></div>
<p>For illustration purposes, three items from the <code>demo01</code>
included in the package <code>ShinyItemBuilder</code> are used. After
calling <code>getDemoPool("demo01")</code> the object
<code>item_pool</code> contains information about all items, but we only
select item 2, 3 and 4:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">item_pool</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDemoPool.html">getDemoPool</a></span><span class="op">(</span><span class="st">"demo01"</span><span class="op">)</span></span>
<span><span class="va">item_pool</span> <span class="op">&lt;-</span> <span class="va">item_pool</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Project
</th>
<th style="text-align:left;">
Task
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
SinglePageItems_01SC.zip
</td>
<td style="text-align:left;">
task0
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
SinglePageItems_02MC.zip
</td>
<td style="text-align:left;">
task0
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
SinglePageItems_03TXT.zip
</td>
<td style="text-align:left;">
task0
</td>
</tr>
</tbody>
</table>
<p>To implement the booklet design, we overwrite the end function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">assessment_config</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getConfig.html">getConfig</a></span><span class="op">(</span>Verbose <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> </span></code></pre></div>
<p>After calling <code><a href="../reference/getConfig.html">getConfig()</a></code>, the object
<code>assessment_config</code> already contains the (default)
implementation of the <code>end</code>-function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">assessment_config</span><span class="op">$</span><span class="va">end</span></span>
<span><span class="co">#&gt; function (session) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     showModal(modalDialog(title = "You Answered all Items", "Please close the browser / tab.", </span></span>
<span><span class="co">#&gt;         footer = tagList(actionButton("endActionButtonOK", "Restart"))))</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b51462fc88&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b51463ce48&gt;</span></span></code></pre></div>
<p>This function can be overwritten by assigning a new function
<code>end = function(session)</code> with the same signature. In this
new function, we first load the data gathered for this session, stored
in the variable <code>session$userData$cbasession</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>data <span class="ot">&lt;-</span> runtime.data[[session<span class="sc">$</span>userData<span class="sc">$</span>cbasession]</span></code></pre></div>
<p>In the following lines we create a simple data.frame representation
of the scoring results:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">ResultData</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parse_ib_scoring.html">parse_ib_scoring</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">ResultData</span><span class="op">[</span><span class="va">d</span>,<span class="st">"Resultdata"</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">a</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Project<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">ResultData</span><span class="op">[</span><span class="va">d</span>,<span class="st">"Project"</span><span class="op">]</span>,</span>
<span>                       Task<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">ResultData</span><span class="op">[</span><span class="va">d</span>,<span class="st">"Task"</span><span class="op">]</span>,</span>
<span>                       Scope<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">ResultData</span><span class="op">[</span><span class="va">d</span>,<span class="st">"Scope"</span><span class="op">]</span>,</span>
<span>                       <span class="va">s</span><span class="op">[</span><span class="va">s</span><span class="op">$</span><span class="va">Active</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>,<span class="st">"ResultText"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<p>This is followed by the markdown template that will be used to
generate the feedback. In this example the markdown is created within
the function, but it could also be stored in a separate
<code>*.Rmd</code> file.</p>
<p>After writing the markdown template to file (see
<code>write(template, ...)</code>), render it to html (see
<code>rmarkdown::render(...)</code>), the generated content is loaded
from file as base64 encoded string (see
<code>base64enc::dataURI(file = ...)</code>). Finally, the generated
html (as base64 encoded string) is displayed in a modal dialog:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showModal.html" class="external-link">showModal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/modalDialog.html" class="external-link">modalDialog</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Feedback"</span>,</span>
<span>    footer <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html" class="external-link">actionButton</a></span><span class="op">(</span><span class="st">"endActionButtonOK"</span>, <span class="st">"Restart"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">iframe</span><span class="op">(</span>src<span class="op">=</span><span class="va">b64</span>, height<span class="op">=</span><span class="fl">400</span>, width<span class="op">=</span><span class="fl">550</span>, frameBorder<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span>, <span class="va">session</span><span class="op">)</span></span></code></pre></div>
<p>Taking everything together, this is an custom
<code>end</code>-function that provides immediate feedback about the
scores obtained in CBA ItemBuilder items:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">assessment_config</span><span class="op">$</span><span class="va">end</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">runtime.data</span><span class="op">[[</span><span class="va">session</span><span class="op">$</span><span class="va">userData</span><span class="op">$</span><span class="va">cbasession</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">ResultData</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parse_ib_scoring.html">parse_ib_scoring</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">ResultData</span><span class="op">[</span><span class="va">d</span>,<span class="st">"Resultdata"</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">a</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Project<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">ResultData</span><span class="op">[</span><span class="va">d</span>,<span class="st">"Project"</span><span class="op">]</span>,</span>
<span>                       Task<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">ResultData</span><span class="op">[</span><span class="va">d</span>,<span class="st">"Task"</span><span class="op">]</span>,</span>
<span>                       Scope<span class="op">=</span><span class="va">data</span><span class="op">$</span><span class="va">ResultData</span><span class="op">[</span><span class="va">d</span>,<span class="st">"Scope"</span><span class="op">]</span>,</span>
<span>                       <span class="va">s</span><span class="op">[</span><span class="va">s</span><span class="op">$</span><span class="va">Active</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>,<span class="st">"ResultText"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span> </span>
<span>  <span class="va">template</span> <span class="op">&lt;-</span> <span class="st">'---</span></span>
<span><span class="st">    output: html_document</span></span>
<span><span class="st">    ---</span></span>
<span><span class="st">    ### Your Results: A Score of `r sum(a$Name == "ScoreCorrect")`</span></span>
<span><span class="st"></span></span>
<span><span class="st">    ```{r, echo=F}</span></span>
<span><span class="st">    knitr::kable(a)</span></span>
<span><span class="st">    ```</span></span>
<span><span class="st">'</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span><span class="va">template</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">session</span><span class="op">$</span><span class="va">userData</span><span class="op">$</span><span class="va">cbasession</span>,<span class="st">".rmd"</span><span class="op">)</span>, append <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tmpfile</span> <span class="op">&lt;-</span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">session</span><span class="op">$</span><span class="va">userData</span><span class="op">$</span><span class="va">cbasession</span>,<span class="st">".rmd"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">b64</span> <span class="op">&lt;-</span> <span class="fu">base64enc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/base64enc/man/dataURI.html" class="external-link">dataURI</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">tmpfile</span>, mime <span class="op">=</span> <span class="st">"text/html"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">tmpfile</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">tmpfile</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">session</span><span class="op">$</span><span class="va">userData</span><span class="op">$</span><span class="va">cbasession</span>,<span class="st">".rmd"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">session</span><span class="op">$</span><span class="va">userData</span><span class="op">$</span><span class="va">cbasession</span>,<span class="st">".rmd"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showModal.html" class="external-link">showModal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/modalDialog.html" class="external-link">modalDialog</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Feedback"</span>,</span>
<span>    footer <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html" class="external-link">actionButton</a></span><span class="op">(</span><span class="st">"endActionButtonOK"</span>, <span class="st">"Restart"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">iframe</span><span class="op">(</span>src<span class="op">=</span><span class="va">b64</span>, height<span class="op">=</span><span class="fl">400</span>, width<span class="op">=</span><span class="fl">550</span>, frameBorder<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span>, <span class="va">session</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note that the dialog includes the actionButton with the name
<code>endActionButtonOK</code> (see
<code>footer = tagList(actionButton("endActionButtonOK", "Restart"))</code>),
that restarts the assessment.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ulf Kroehne.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
